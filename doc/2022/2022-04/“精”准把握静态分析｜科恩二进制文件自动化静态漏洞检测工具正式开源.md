#  â€œç²¾â€å‡†æŠŠæ¡é™æ€åˆ†æï½œç§‘æ©äºŒè¿›åˆ¶æ–‡ä»¶è‡ªåŠ¨åŒ–é™æ€æ¼æ´æ£€æµ‹å·¥å…·æ­£å¼å¼€æº   
åŸåˆ› è…¾è®¯ç§‘æ©å®éªŒå®¤  è…¾è®¯ç§‘æ©å®éªŒå®¤   2022-04-20 14:10  
  
**å¼•è¨€**  
  
ä¸ºæå‡é™æ€åˆ†æåœ¨äºŒè¿›åˆ¶æ–‡ä»¶æ¼æ´æ£€æµ‹é¢†åŸŸæ•ˆç‡å’Œå¯æ‰©å±•æ€§ï¼Œç§‘æ©å­µåŒ–å¹¶å¼€æºäºŒè¿›åˆ¶æ–‡ä»¶é™æ€æ¼æ´åˆ†æå·¥å…·BinAbsInspectoré¡¹ç›®ã€‚  
  
ä»£ç ä»“åº“åœ°å€ï¼š  
  
  
https://github.com/KeenSecurityLab/BinAbsInspector  
  
  
ï¼ˆâ¬‡ï¸æ–‡æœ«å°†æŠ½å–å¹¸è¿å„¿è·å¾—è…¾è®¯å­£å¡ğŸï¼‰  
  
  
**èƒŒæ™¯**  
  
**è½¯ä»¶æ¼æ´æ£€æµ‹â€œä¸¤æ¿æ–§****â€**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
éšç€ä¿¡æ¯äº§ä¸šçš„å‘å±•ï¼Œç½‘ç»œå®‰å…¨é—®é¢˜æ—¥ç›Šä¸¥å³»ï¼Œè½¯ä»¶æ¼æ´å¯¹äºäº’è”ç½‘å¨èƒæå¤§ï¼Œæ˜¯ç½‘ç»œå®‰å…¨ä¸­çš„æ ¸å¿ƒé—®é¢˜ã€‚ä¸ºäº†ç¼“è§£æ¼æ´æ‰€é€ æˆçš„å±å®³ï¼Œéœ€è¦å¯¹è½¯ä»¶è¿›è¡Œå®‰å…¨æ£€æµ‹ï¼Œå°½å¯èƒ½åœ°å‘ç°å¹¶æ¶ˆé™¤æ½œåœ¨æ¼æ´ã€‚ç›®å‰å¸¸è§çš„è‡ªåŠ¨åŒ–æ¼æ´æ£€æµ‹æ‰‹æ®µå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š  
åŠ¨æ€åˆ†ææµ‹è¯•  
å’Œ  
é™æ€åˆ†æ  
ã€‚  
  
  
åŠ¨æ€åˆ†ææµ‹è¯•æ–¹æ³•ï¼ˆå¦‚fuzzingç­‰ï¼‰åœ¨è¿‡å»äº”å¹´é‡Œå¸å¼•äº†ç ”ç©¶è€…çš„å¹¿æ³›å…³æ³¨ï¼Œç›¸å…³ç³»ç»Ÿåœ¨å·¥ä¸šç•Œä¸­å·²ç»å¾—åˆ°äº†å¤§è§„æ¨¡çš„éƒ¨ç½²å’Œåº”ç”¨ã€‚ç›¸æ¯”äºåŠ¨æ€æ–¹æ³•ï¼Œé™æ€åˆ†æé€šå¸¸èƒ½å¤Ÿå¾—åˆ°æ›´ä¸ºå…¨é¢å¯é çš„ç¨‹åºçŠ¶æ€ï¼Œå¯ä»¥ä»æ ¹æºä¸Šæœ‰æ•ˆåœ°å…‹æœåŠ¨æ€åˆ†æçš„è¦†ç›–ç‡é—®é¢˜ï¼›ç„¶è€Œåœ¨ç°å®ä¸­é™æ€åˆ†æå¦‚ä½•å…¼é¡¾å¹³è¡¡ç²¾åº¦å’Œå¤æ‚åº¦åœ¨å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œä»æ˜¯ä¸€å¤§éš¾é¢˜ï¼Œåœ¨äº§å“ä¸­ä¹Ÿå¤šä¾èµ–äººå·¥ç»éªŒè§„åˆ™è¿›è¡Œè¡¥å……ï¼Œè¿™å¯¼è‡´å…¶åœ¨ç°å®åœºæ™¯ä¸­çš„è½åœ°ä¸å°½å¦‚äººæ„ã€‚  
  
  
**é™æ€åˆ†æå·¥å…·ç°çŠ¶**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
ç›®å‰å›½é™…ä¸Šè¾ƒä¸ºæˆåŠŸçš„å•†ä¸šåŒ–åˆ†æå·¥å…·æœ‰Coverity[1]ã€CodeSonar[2]ã€VeraCode[3]ç­‰ï¼Œå®ƒä»¬åœ¨ä»£ç è´¨é‡ä¿éšœä¸Šå‘æŒ¥äº†é‡è¦ä½œç”¨ï¼Œç›¸å…³äº§å“ä¹Ÿåœ¨Googleç­‰å…¬å¸çš„DevOpsæµç¨‹ä¸­å¾—åˆ°äº†å¹¿æ³›éƒ¨ç½²å’Œä½¿ç”¨ã€‚  
  
  
åŒ…æ‹¬å¼€æºåŠå•†ä¸šåŒ–äº§å“åœ¨å†…ï¼Œç°æœ‰çš„é™æ€åˆ†ææ–¹æ¡ˆå¤šä¸ºæºç çº§åˆ†æã€‚é¢å‘æºä»£ç è¿›è¡Œæ‰«æï¼Œå°½ç®¡å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ»¡è¶³è½¯ä»¶å®‰å…¨éœ€è¦ï¼Œç„¶è€Œåœ¨çœŸå®å®‰å…¨åœºæ™¯ä¸­ï¼Œå¾…åˆ†æå¯¹è±¡å¤šä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚åµŒå…¥å¼ç³»ç»Ÿå›ºä»¶ï¼Œå•†ä¸šè½¯ä»¶ç­‰ï¼Œç ”ç©¶äººå‘˜éš¾ä»¥è·å¾—ç›¸åº”çš„æºä»£ç ï¼Œæ­¤æ—¶æºç çº§é™æ€åˆ†ææ–¹æ¡ˆä¸å†é€‚ç”¨ã€‚  
  
  
å€¼å¾—ä¸€æçš„æ˜¯ï¼Œéƒ¨åˆ†å•†ä¸šåŒ–äº§å“ï¼ˆå¦‚CodeSonarç­‰ï¼‰ä¹Ÿæä¾›äº†å¯¹äºäºŒè¿›åˆ¶æ–‡ä»¶çš„åˆ†æèƒ½åŠ›ï¼Œç„¶è€Œå•†ä¸šåŒ–è·¯çº¿æ‰€å¸¦æ¥çš„å°é—­æ€§ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šé™åˆ¶äº†æ™®é€šç ”ç©¶è€…çš„ä½¿ç”¨å’ŒäºŒæ¬¡å¼€å‘ã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨å¼€æºç¤¾åŒºä¸­ä¹Ÿæ¶Œç°å‡ºä¸€æ‰¹çŸ¥åçš„äºŒè¿›åˆ¶åˆ†æå·¥å…·ï¼Œå¦‚angr[4]ã€BAP[5]ã€cwe_checker[6]ã€‚å…¶ä¸­ï¼Œangrå’ŒBAPé€æ¸å¾€é€šç”¨åˆ†ææ¡†æ¶å‘å±•ï¼Œå¹¶éä¸“æ³¨äºäºŒè¿›åˆ¶æ¼æ´æ‰«æï¼Œå› æ­¤å…¶å†…éƒ¨çš„åˆ†æç®—æ³•è¾ƒä¸ºåºæ‚ï¼Œä¸åˆ©äºè¿›ä¸€æ­¥æ‰©å±•å’Œä¼˜åŒ–ï¼›cwe_checkerçš„å®šä½ç›¸å¯¹æ¸…æ™°ï¼Œä¸“æ³¨äºå®‰å…¨æ¼æ´æ‰«æï¼Œä½†å…¶ç²¾åº¦å’Œæ•ˆç‡å´ä¸ç”šç†æƒ³ã€‚ç›®å‰ä¸šç•ŒäºŸéœ€ä¸€ç§æ›´ä¸ºå…ˆè¿›çš„äºŒè¿›åˆ¶æ¼æ´æ‰«æå·¥å…·ï¼Œåœ¨å¼€æºçš„å¤§å‰æä¸‹ï¼Œå…¶æ€§èƒ½å’Œå¯æ‰©å±•æ€§ä¹Ÿè¦æ»¡è¶³çœŸå®åœºæ™¯çš„éœ€è¦ã€‚ä¸ºæ­¤ï¼Œç§‘æ©å®éªŒå®¤åŸºäºè‡ªèº«åœ¨äºŒè¿›åˆ¶é¢†åŸŸä¸°å¯Œçš„ç ”ç©¶ä¸å®è·µç»éªŒï¼ŒåŒæ—¶ç»“åˆä¸šå†…ç›¸å…³ä¼˜ç§€å·¥å…·çš„è®¾è®¡ç†å¿µï¼Œæœ€ç»ˆå­µåŒ–å‡ºæ€§èƒ½å‡ºè‰²ä¸”è‡ªä¸»å¯æ§çš„äºŒè¿›åˆ¶æ¼æ´é™æ€æ‰«æå·¥å…·â€”â€”BinAbsInspectorã€‚  
  
  
**åŸç†ä¸å®ç°**  
  
BinAbsInspectorçš„è®¾è®¡æ€æƒ³æ¥æºäºä¸Šä¸–çºª70å¹´ä»£è¯ç”Ÿçš„ç»å…¸ç¨‹åºåˆ†æç†è®ºâ€œæŠ½è±¡è§£é‡Šâ€ï¼›åœ¨å…·ä½“å®ç°ä¸Šï¼ŒBinAbsInspectorçš„åˆ†æåŸºäºGhidra[7]æ‰€æä¾›çš„ä¸­é—´è¡¨ç¤ºPcodeä¸Šã€‚é€šè¿‡è®¾è®¡åˆé€‚çš„æŠ½è±¡åŸŸï¼Œå®ç°å…¶ä¸Šçš„å¤šç§è¿ç®—ï¼Œå®Œæˆç›¸å…³Pcodeçš„æ“ä½œè¯­ä¹‰ï¼Œæ‰§è¡Œæµæ•æ„Ÿï¼ˆflow-sensitiveï¼‰å’Œä¸Šä¸‹æ–‡æ•æ„Ÿï¼ˆcontext-sensitiveï¼‰çš„è¿‡ç¨‹é—´åˆ†æï¼ŒåŒæ—¶åŠ å…¥é™æ€æ±¡ç‚¹åˆ†æçš„èƒ½åŠ›ï¼Œå®Œæˆå¯¹ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€çš„æŠ½è±¡ä¼°è®¡ï¼Œæœ€ååŸºäºä¸Šè¿°åˆ†ææ‰€å¾—çš„æŠ½è±¡æ•°æ®æµä¿¡æ¯å¯¹å¤šç§æ¼æ´ç±»å‹è¿›è¡Œå»ºæ¨¡æ£€æŸ¥ï¼Œå®ç°å¯¹äºŒè¿›åˆ¶æ¼æ´çš„é™æ€æ‰«æã€‚  
  
  
å…³äºå¦‚ä½•å¯¹ç¨‹åºè¿è¡Œæ—¶çŠ¶æ€è¿›è¡ŒæŠ½è±¡è¿™ä¸€å…³é”®é—®é¢˜ï¼Œæˆ‘ä»¬ä¸»è¦å‚è€ƒäº†ç»å…¸è®ºæ–‡ã€ŠWYSINWYX: What you see is not what you eXecuteã€‹[8]ä¸­çš„åšæ³•å¹¶åŠ ä»¥æ”¹è‰¯ã€ç®€åŒ–å’Œæå‡ã€‚  
  
  
å…·ä½“æ¥è¯´ï¼Œåœ¨BinAbsInspectorä¸­æ•´ä¸ªè¿è¡Œæ—¶ç¯å¢ƒè¢«åˆ†ä¸ºLocal ï¼ˆæŠ½è±¡æ ˆï¼‰ã€Heapï¼ˆæŠ½è±¡å †ï¼‰ã€Globalï¼ˆå…¨å±€å˜é‡å’Œæ•°å€¼ï¼‰ã€Uniqueï¼ˆå¯¹åº”Ghidraä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡åŒºï¼‰å’ŒRegisterï¼ˆå¯„å­˜å™¨åŒºï¼‰äº”ç§regionã€‚åœ¨è¿™äº›ä¸åŒçš„æŠ½è±¡åŒºåŸŸä¸ŠåŠ ä¸Šåç§»æ•°å€¼offsetï¼Œä¾¿å¯ä»¥ç»„æˆä¸€ä¸ªæŠ½è±¡å˜é‡ALocï¼ˆAbstract Location/Variableï¼‰ã€‚å› ä¸ºåœ¨äºŒè¿›åˆ¶ç¨‹åºä¸­ï¼Œå˜é‡å¹¶éå…¨éƒ¨æ˜¾å¼è¡¨ç¤ºï¼ŒALocä¾¿æ˜¯å¯¹å®é™…ç¨‹åºä¸­å˜é‡çš„ä¸€ç§ä¼°ç®—å’Œè¯†åˆ«ã€‚  
å¯¹åº”ä¸åŒçš„ç¨‹åºç‚¹ï¼Œéœ€è¦è®°å½•æ­¤å¤„å¯èƒ½å­˜æ´»çš„æŠ½è±¡å˜é‡å’Œå…¶å¯¹åº”çš„æŠ½è±¡å€¼ï¼Œç§°ä¹‹ä¸ºAbsEnvï¼ˆAbstract Environmentï¼‰ã€‚  
  
  
å› ä¸ºæ˜¯é™æ€çš„æŠ½è±¡ï¼Œé‚£ä¹ˆå¯¹äºä¸€ä¸ªç¨‹åºç‚¹çš„ä¸€ä¸ªæŠ½è±¡å˜é‡ï¼Œå®ƒå¯èƒ½ä¼šåŒ…å«å¤šä¸ªæŠ½è±¡å€¼ï¼Œè¿™äº›æŠ½è±¡å€¼ç»„æˆäº†ä¸€ä¸ªé›†åˆã€‚è™½ç„¶è¿™ä¸ªé›†åˆå¯èƒ½ä¼šåŒ…å«æ— ç©·å¤šä¸ªå…ƒç´ ï¼Œä½†æ˜¯ä¸ºäº†ä¿è¯æ•´ä¸ªè®¡ç®—è¿‡ç¨‹å®è·µä¸Šå¯æ”¶æ•›ï¼Œä»¤æ­¤é›†åˆå–ä¸€ä¸ªä¸Šé™Kï¼Œè¿™ç§é›†åˆç§°ä¹‹ä¸ºKSetã€‚ä¸€æ—¦å…¶ä¸­åŒ…å«çš„å…ƒç´ è¶…è¿‡Kï¼Œä¾¿å°†å…¶å˜ä¸ºä¸€ä¸ªTopï¼Œå³åŒ…å«æ‰€æœ‰æŠ½è±¡å€¼ã€‚æ­¤æ–¹æ³•ä¸å‰äººé‡è¦ç›¸å…³å·¥ä½œJakstab[9]ä¸­çš„KSetè¾ƒä¸ºç›¸ä¼¼ã€‚KSetæ”¯æŒå¤šç§ç®—æ•°å’Œé€»è¾‘è¿ç®—ã€‚æ­¤å¤–æ¯ä¸€ä¸ªKSetå¯¹è±¡ä¹Ÿä¼šåŒ…å«ä¸€ä¸ªæ±¡ç‚¹çš„ä½å›¾ï¼Œç”¨æ¥è·Ÿè¸ªå¤šä¸ªæ±¡ç‚¹çš„åŒæ—¶ä¼ æ’­ï¼Œä»è€Œå®ç°é™æ€æ±¡ç‚¹åˆ†æã€‚è¿™æ ·AbsEnvä¾¿å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªä»ALocåˆ°KSetçš„mapã€‚  
  
  
ç”±äºBinAbsInspectorçš„åˆ†ææ˜¯ä¸Šä¸‹æ–‡æ•æ„Ÿçš„ï¼Œå¯¹äºè¢«è°ƒç”¨è€…çš„ä¸Šä¸‹æ–‡ ï¼ˆContextï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€è¿‘çš„call stringï¼ˆcall siteï¼‰æ¥è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚å³å¯¹äºåŒä¸€ä¸ªè¢«è°ƒç”¨è€…ï¼Œä¸åŒçš„è°ƒç”¨è€…ä¼šç”Ÿæˆä¸åŒçš„Contextï¼Œä¸€èˆ¬åªè®°å½•æœ€è¿‘çš„å‡ ä¸ªè°ƒç”¨è€…ã€‚è¿™æ ·æˆ‘ä»¬ä¾¿æŠŠç¨‹åºç‚¹å¤„çš„AbsEnvè®°å½•åœ¨ä¸åŒçš„Contextä¸­ã€‚  
  
  
é™¤æ­¤ï¼Œå¯¹äºè¿‡ç¨‹å†…çš„ä¸åŠ¨ç‚¹è®¡ç®—BinAbsInspectoré‡Œä½¿ç”¨äº†worklistç®—æ³•ï¼Œå³æŠŠå¾…å¤„ç†çš„ç¨‹åºç‚¹ä¸æ–­åœ°æ”¾å…¥worklistä¸­ï¼Œç›´åˆ°å…¶ç©ºä¸ºæ­¢ã€‚è¿‡ç¨‹é—´åˆ†æä¸»è¦åœ¨äºä¸åŒçš„Contextä¹‹é—´çš„è½¬å˜ï¼Œè¿™æ˜¯é€šè¿‡call/returnæŒ‡ä»¤çš„è¯­ä¹‰å®ç°çš„ã€‚è¿™æ ·é€šè¿‡å¯¹æ•´ä¸ªç¨‹åºæŒ‡ä»¤çš„è¿­ä»£è®¡ç®—å€¼å¹¶åŠ ä»¥Contextçš„è½¬æ¢ï¼ŒContextåŠå…¶é™„å±çš„worklistå¾—åˆ°é€ä¸€å¤„ç†ï¼Œç›´åˆ°æ‰€æœ‰çš„worklistè®¡ç®—ç»“æŸï¼Œæœ€åè¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚  
  
  
é€šè¿‡è¿™æ•´ä¸ªçš„è®¡ç®—è¿‡ç¨‹ï¼Œä¾¿ä¼šå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„Contextä»¥åŠå¯¹åº”çš„æ¯ä¸ªç¨‹åºç‚¹çš„AbsEnvã€‚è¿™æ ·ç›¸å½“äºå¾—åˆ°äº†ä¸€ä¸ªå¯¹ç¨‹åºè¡Œä¸ºå¯é çš„ä¼°ç®—ï¼Œæœ‰äº†è¿™äº›æŠ½è±¡æ•°æ®æµçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥è¿›è¡Œå†…å­˜ç ´åæ¼æ´ã€å‘½ä»¤æ³¨å…¥æ¼æ´ç­‰å¤šç§æ¼æ´çš„æ£€æµ‹äº†ã€‚  
  
  
**å®ä¾‹æ¼”ç¤º**  
  
ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªåŒ…å«  
Use-After-Freeæ¼æ´  
çš„ç®€å•æ ·ä¾‹æ¥æ¼”ç¤ºBinAbsInepectorçš„è¿è¡Œæƒ…å†µå’ŒåŸºæœ¬åŸç†ã€‚  
  
**æ¼æ´åŸç†**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
â€œCWE416_Use_After_Free__malloc_free_struct_01_badâ€å‡½æ•°ä¸­é¦–å…ˆè°ƒç”¨â€œmallocâ€å‡½æ•°åˆ†é…å†…å­˜ç”¨äºå­˜æ”¾100ä¸ªâ€œtwoIntsStructâ€å¯¹è±¡â€”>ä¾æ¬¡å¯¹è¿™éƒ¨åˆ†å¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ“ä½œâ€”>ç›´æ¥é‡Šæ”¾å†…å­˜â€”>é‡Šæ”¾å†…å­˜è¿‡åå†æ¬¡è°ƒç”¨äº†â€œprintStructLineâ€å‡½æ•°è®¿é—®å·²é‡Šæ”¾å†…å­˜ä¸­çš„åœ°å€â€”>é€ æˆUse-After-Freeæ¼æ´ã€‚  
```
void CWE416_Use_After_Free__malloc_free_struct_01_bad()
{
    twoIntsStruct * data;
    /* Initialize data */
    data = NULL;
    data = (twoIntsStruct *)malloc(100*sizeof(twoIntsStruct));
    if (data == NULL) {exit(-1);}
    {
        size_t i;
        for(i = 0; i < 100; i++)
        {
            data[i].intOne = 1;
            data[i].intTwo = 2;
        }
    }
    /* POTENTIAL FLAW: Free data in the source - the bad sink attempts to use data */
    free(data);
    /* POTENTIAL FLAW: Use of data that may have been freed */
    printStructLine(&data[0]);
    /* POTENTIAL INCIDENTAL - Possible memory leak here if data was not freed */
}

int main(int argc, char * argv[])
{
    /* seed randomness */
    srand( (unsigned)time(NULL) );
    printLine("Calling bad()...");
    CWE416_Use_After_Free__malloc_free_struct_01_bad();
    printLine("Finished bad()");
    return 0;
}
```  
  
  
**å®‰è£…åŠå¯¼å…¥**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
BinAbsInspectorä½œä¸ºGhidra Extensionçš„å½¢å¼è¿›è¡Œå¼€å‘ï¼Œæ„å»ºåå®‰è£…åœ¨Ghidraä¸­ï¼Œæ”¯æŒGUIå’ŒHeadlessæ¨¡å¼è¿è¡Œï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡é¡¹ç›®ä¸­æä¾›çš„Dockerfileæ„å»ºdockeré•œåƒä½“éªŒåŠŸèƒ½ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•è§ã€ä»“åº“READMEã€‘ï¼šhttps://github.com/KeenSecurityLab/BinAbsInspectorã€‚åœ¨æ­¤æˆ‘ä»¬ä»¥  
GUIæ¨¡å¼  
ä¸ºä¾‹ä»‹ç»ä½¿ç”¨æ­¥éª¤ã€‚  
  
  
é¦–å…ˆå°†BinAbsInspectorå®‰è£…åœ¨Ghidraï¼Œæˆ‘ä»¬å°†ç¼–è¯‘å¥½çš„æ ·æœ¬ç¨‹åºï¼ˆarmv7ï¼‰å¯¼å…¥Ghidraï¼Œå¾…Ghidraçš„åˆ†æå®Œæˆï¼Œä¾¿å¯ä»¥è¿è¡Œæˆ‘ä»¬çš„åˆ†æäº†ã€‚è¿™æ—¶ä¼šå¼¹å‡ºå·¥å…·çš„åˆ†æé€‰é¡¹æ¡†ï¼Œå°†åˆ†æè¿‡ç¨‹çš„é…ç½®å‚æ•°æš‚æ—¶ä¿æŒé»˜è®¤å³å¯ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfmVRYubn0jIUj4FxTPPPxn27XLiaIs9JXm5ibQImsZXlt6rYsVRohCZ0Q/640?wx_fmt=png "")  
  
Â    
Â    
Â  Â å›¾1-å·¥å…·åˆ†æé€‰é¡¹æ¡†  
  
  
**ç»“æœå±•ç¤º**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
åˆ†ææ˜¾ç¤ºæ‰¾åˆ°2å¤„CWEå‘Šè­¦ï¼Œåœ¨ä¸‹æ–¹å‘½ä»¤è¡Œä¸­ä¼šæ˜¾ç¤ºå…·ä½“å‘Šè­¦çš„åœ°å€ã€‚  
  
**æ ‡è®°1**  
ï¼šè§¦å‘å‘Šè­¦çš„åœ°å€ï¼Œå³äº§ç”ŸUse-After-Freeè®¿é—®çš„æŒ‡ä»¤åœ°å€ï¼›  
  
**æ ‡è®°2**  
ï¼šä¸Šä¸‹æ–‡è°ƒç”¨è®°å½•ï¼Œå¯ä»¥ç†è§£ä¸ºå‡½æ•°çš„è°ƒç”¨æ ˆï¼›  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfz9xBdmkt8qGxx61gRkjStzgAVIFapoBbzrUKDz2YLyJ98T22sMH6Nw/640?wx_fmt=png "")  
  
å›¾2-1 åˆ†æç»“æœå±•ç°  
  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â   
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfGI2rV7YZ7KyZjIWTwibGFZTQzyUXMZZ2b6RIictPQeIetvGdJK7NortA/640?wx_fmt=png "")  
  
å›¾2-2Â åˆ†æç»“æœå±•ç°ç»†èŠ‚å›¾  
  
  
  
**åˆ†ææº¯æº**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
åŒå‡»å‘½ä»¤è¡Œä¸­çš„å‘Šè­¦åœ°å€å¯ä»¥åœ¨æ±‡ç¼–çª—å£è·³è½¬åˆ°å¯¹åº”çš„æŒ‡ä»¤ï¼Œå¦å¤–å³è¾¹çš„åç¼–è¯‘çª—å£ä¹Ÿå°†åŒæ­¥å±•ç¤ºå¯¹åº”çš„ä¼ªä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤æ¡å‘Šè­¦çš„æŒ‡ä»¤éƒ½ä½äºâ€œprintStructLineâ€ å‡½æ•°çš„å†…éƒ¨ï¼Œéƒ½æ˜¯è®¿é—®å·²é‡Šæ”¾å†…å­˜çš„LDRæŒ‡ä»¤ï¼Œç»“æœç¬¦åˆé¢„æœŸã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfjqJfkTOb3S5CyNe0cDl4Tfq0NRYvC2CJNl1q5MVzMmktslXhP7qJoQ/640?wx_fmt=png "")  
  
Â å›¾3-1 åˆ†ææº¯æºåæ±‡ç¼–æ¡†  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfuHCpzBeqrzPOmkE70iborppqkO4e61LAOr26zEu5ZAXh5nRZmTeCU0Q/640?wx_fmt=png "")  
  
Â å›¾3-2Â   
åˆ†ææº¯  
æºåç¼–è¯‘æ¡†  
  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfOeNgIiaesHFYTjO4JibUerjn8T6oEPrtpqquFMSiaXNHV5hmGlHDeeZjg/640?wx_fmt=png "")  
  
Â å›¾3-3Â   
åˆ†ææº¯  
æºæŠ¥å‘Šæ¡†  
  
  
åŸç†ä¸Šç®€è€Œè¨€ä¹‹ï¼Œåœ¨ç¬¬6è¡Œâ€œmallocâ€å¤„åˆ›å»ºäº†ä¸€ä¸ªHeap regionï¼Œdataçš„æŠ½è±¡å€¼ä¸ºæ­¤HeapåŠåç§»å€¼0ï¼Œè¿™ä¸€ä¿¡æ¯è¢«åŠ å…¥å½“å‰çš„AbsEnvä¸­å¹¶ç»§ç»­å‘åä¼ æ’­ï¼Œç»è¿‡ç¬¬17è¡Œçš„â€œfreeâ€ï¼Œdataçš„æŠ½è±¡å€¼æ•°å€¼ä¿æŒä¸å˜ï¼Œå…¶ä¸­çš„Heap regionå˜æˆäº†ä¸€ä¸ªç›¸åŒæ•°å€¼ä½†æ˜¯ä¸ºæ— æ•ˆçŠ¶æ€çš„æ–°regionï¼Œå½“å‰çš„AbsEnvä¹Ÿä¼šåŒæ­¥æ›´æ–°è¿™ä¸€å˜åŒ–å¹¶å°†è¿™ä¸€æ”¹åŠ¨å‘åä¼ æ’­ï¼Œæœ€ååœ¨19è¡Œâ€œprintStructLineâ€å†…éƒ¨çš„LDRæŒ‡ä»¤æ—¶ï¼Œé€šè¿‡æŸ¥è¯¢ä¼ æ’­åˆ°æ­¤çš„AbsEnvï¼Œæ£€æµ‹åˆ°dataæŒ‡å‘çš„æ˜¯ä¸€ä¸ªæ— æ•ˆçš„Heap regionï¼Œè¿™æ ·ä¾¿å¯ä»¥æŸ¥æ‰¾å‡ºè¿™ä¸ªUse-After-Freeçš„é—®é¢˜ã€‚  
  
  
**æ€§èƒ½è¯„ä¼°**  
  
æˆ‘ä»¬é€‰å–Juliet[10]è¿™ä¸€è¾ƒä¸ºæƒå¨çš„æµ‹è¯•é›†ï¼Œåœ¨x86ã€x64ã€armv7ä¸‰ä¸ªæ¶æ„ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå¹¶ä¸cwe_checkeræµ‹è¯•ç»“æœè¿›è¡Œå¯¹ç…§æ¯”è¾ƒã€‚å¦å¤–ï¼ŒBinAbsInspectorä¹Ÿæ”¯æŒå¯¹aarch64æ¶æ„æ ·æœ¬çš„æ£€æµ‹ï¼Œè¿™æ˜¯cwe_checkerç›®å‰ä¸æ”¯æŒçš„ã€‚  
  
  
ä¸‹é¢è¡¨æ ¼å±•ç¤ºçš„æ˜¯åœ¨CWE415 (Double-Free)ï¼Œ CWE416 (Use-After-Free)ï¼ŒCWE476 (Null Poionter Deference), CWE78 (Command Injection) 4ç§æ ¸å¿ƒæ¼æ´æ£€æµ‹èƒ½åŠ›ä¸cwe_checkerçš„å¯¹æ¯”ç»“æœã€‚  
  
ç»“æœè¡¨æ˜ï¼ŒBinAbsInspectorçš„æµ‹è¯•ç»“æœåœ¨æ‰€æ”¯æŒçš„CWEç±»å‹ä¸Šå‡å–å¾—è¾ƒå¤§å¹…åº¦ä¼˜åŠ¿ã€‚  
  
  
(BAI: BinAbsInspector, CC: cwe_checker, TP: True Positiveæ­£é˜³æ€§, FP: False Positiveå‡é˜³æ€§, TN: True Negativeæ­£é˜´æ€§, FN: False Negativeå‡é˜´æ€§)  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoer89jLgDZTenc5rADESgLYaiaq28R5xuM2FA1jbQYOL1ibw5GiadYEJrEZhPXT3wBnxpBEypL7dkibFEZw/640?wx_fmt=png "")  
  
Â  Â   
 Â  Â  å›¾4-x86ä¸‹-æ ¸å¿ƒæ£€æµ‹èƒ½åŠ›æ•°æ®å¯¹æ¯”  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoer89jLgDZTenc5rADESgLYaiayRdsmyIDSMM84PEJa49LepeMuZFNoqia56BFCibh4DZ56XDW6AgW5vjQ/640?wx_fmt=png "")  
  
å›¾5-x64ä¸‹-æ ¸å¿ƒæ£€æµ‹èƒ½åŠ›æ•°æ®å¯¹æ¯”  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoer89jLgDZTenc5rADESgLYaiaDQjg6DiaQHuylFEPwCZDDHru2ecBTUdwCLBYAjicKapSeQMPRsXZpPicw/640?wx_fmt=png "")  
  
å›¾6-armv7ä¸‹-æ ¸å¿ƒæ£€æµ‹èƒ½åŠ›æ•°æ®å¯¹æ¯”  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoericaePKHOqEd6jSkoIlbgkRfUaallGaDt5Qh3cHE7z50ZNMlekE74mfCIAiauibgKAee6JKCwDt0XhQQ/640?wx_fmt=png "")  
  
å›¾7-ä¸‰ç§æ¶æ„ä¸‹æ ¸å¿ƒæ¼æ´æ£€æµ‹è¯¯æŠ¥ç‡å¯¹æ¯”  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoer89jLgDZTenc5rADESgLYaiaYUyy4LS3y1iaSqmibOhoHEVHOiaFkKZibBu2sDogKP4zkibIwVB3qSrqS9Q/640?wx_fmt=png "")  
  
å›¾8- ä¸‰ç§æ¶æ„ä¸‹æ ¸å¿ƒæ¼æ´æ£€æµ‹æ¼æŠ¥ç‡å¯¹æ¯”  
  
  
**æ€»ç»“**  
  
****  
**è¿„ä»Šæˆæœ**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
ç§‘æ©åœ¨äºŒè¿›åˆ¶å®‰å…¨ç ”ç©¶é¢†åŸŸæœ‰ç€æ·±åšç§¯ç´¯ï¼Œå…¶ä¸­äºŒè¿›åˆ¶è½¯ä»¶æˆåˆ†åˆ†æå¹³å°[BinaryAI[11]](http://mp.weixin.qq.com/s?__biz=MzU1MjgwNzc4Ng==&mid=2247496102&idx=1&sn=7835a7682a921a324d1a1e65a23a9c2d&chksm=fbfecda3cc8944b5a620e57ab9b32272f629bd31c3ecdf56ecbdc66e52ae39eb537dd49182c1&scene=21#wechat_redirect)  
å·²å…è´¹å¼€æ”¾ï¼Œæ¨åŠ¨è½¯ä»¶æˆåˆ†åˆ†æåœ¨DevSecOpsã€å®‰å…¨ç ”ç©¶ç­‰åœºæ™¯çš„åº”ç”¨ä¸å‘å±•ã€‚åœ¨äºŒè¿›åˆ¶é™æ€åˆ†ææ–¹å‘ï¼Œç§‘æ©å­µåŒ–é«˜æ•ˆã€å‡†ç¡®çš„è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ–‡ä»¶é™æ€æ¼æ´åˆ†æå·¥å…·BinAbsInspectorã€‚ç»è¿‡å†…éƒ¨åº”ç”¨å®è·µåŠä¼˜åŒ–ï¼ŒBinAbsInspectorå·²è¾¾åˆ°äº†è¾ƒå¥½çš„å®Œæˆåº¦ã€‚  
  
  
**æ­¥å±¥ä¸åœ**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/zZKnUibvoer89jLgDZTenc5rADESgLYaia6ycDicHIEqzzdyFSFypdYH0FrteXRoevKvJI3EbHZXPMfGpsZOccONQ/640?wx_fmt=gif "")  
  
  
  
BinAbsInspectoræœªæ¥å°†æŒç»­æ‰“ç£¨ç®—æ³•åŠå·¥ç¨‹ä¸Šçš„å¯æé«˜ä¹‹å¤„ï¼Œç»“åˆç§‘æ©äºŒè¿›åˆ¶åˆ†æã€ç®—æ³•ç­‰èƒ½åŠ›è¾“å‡ºï¼Œèµ‹èƒ½æ›´å¤šè½¯ä»¶ç›¸å…³ä»ä¸šè€…ï¼ŒåŠ©åŠ›æå‡æ•´ä½“ä»£ç å®‰å…¨é˜²æ²»æ•ˆç‡ã€‚å…³äºæ›´å¤šçš„æŠ€æœ¯ç»†èŠ‚å’Œä»£ç å®ç°ï¼Œè¯·ç§»æ­¥æˆ‘ä»¬çš„å¼€æºä»“åº“åŠwikiæ–‡æ¡£ï¼Œç‚¹å‡»æ–‡æœ«  
â€œé˜…è¯»åŸæ–‡â€  
å³å¯è·³è½¬ã€‚æ¬¢è¿æ‰€æœ‰æ„Ÿå…´è¶£çš„å°ä¼™ä¼´ä¸€èµ·å‚ä¸ååŒå¼€å‘ï¼Œåœ¨å®è·µä¸­è¿­ä»£ä¼˜åŒ–ï¼Œæ‰“é€ æ›´ä¼˜ç§€çš„äºŒè¿›åˆ¶æ¼æ´é™æ€åˆ†æåˆ©å™¨ã€‚  
  
  
**æœ‰å¥–åé¦ˆ**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/zZKnUibvoer89jLgDZTenc5rADESgLYaiaBFGLZiaM1bkoBPhCkcyrbC9YuIF8DJem8v5Vh15VtkaB1PmGw0ejiczA/640?wx_fmt=png "")  
  
å¡«å†™ä½¿ç”¨åé¦ˆé—®å·  
  
ç§‘æ©å°†åœ¨4æœˆ25æ—¥æ™šå…«ç‚¹ä»åé¦ˆé—®å·ä¸­  
  
æŠ½å–äº”ä½ä¼˜è´¨åé¦ˆèµ é€**è…¾è®¯è§†é¢‘ä¼šå‘˜å­£å¡**ä¸€ä»½ï½ğŸ  
  
  
**æ–‡çŒ®å‚è€ƒ**  
  
[1]  
https://www.synopsys.com/software-integrity/security-testing/static-analysis-sast.html  
  
[2]  
https://www.grammatech.com/products/source-code-analysis  
  
[3]  
https://www.veracode.com/  
  
[4]  
https://angr.io/  
  
[5]  
https://github.com/BinaryAnalysisPlatform/bap/  
  
[6]  
https://github.com/fkie-cad/cwe_checker/  
  
[7]  
Â https://ghidra-sre.org/  
  
[8]  
https://dl.acm.org/doi/pdf/10.1145/1749608.1749612  
  
[9]  
http://www.jakstab.org/  
  
[10]  
https://samate.nist.gov/SRD/testsuite.php  
  
[11]  
https://www.binaryai.net/  
  
  
ç‚¹å‡»â€œé˜…è¯»åŸæ–‡â€è·³è½¬åˆ°é¡¹ç›®é“¾æ¥  
  
  
