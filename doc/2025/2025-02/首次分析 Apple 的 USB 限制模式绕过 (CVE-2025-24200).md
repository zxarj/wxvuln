#  é¦–æ¬¡åˆ†æ Apple çš„ USB é™åˆ¶æ¨¡å¼ç»•è¿‡ (CVE-2025-24200)   
 Otså®‰å…¨   2025-02-15 10:56  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn7gtxSFZlfuCW6AdQib8Q1onbR0U2h9icP1eRO6wH0AcyJmqZ7USD0uOYncCYIH7ZEE8IicAOPxyb9IA/640?wx_fmt=gif "")  
  
Apple å‘å¸ƒäº† iOS 18.3.1 (build ) æ¥ä¿®è¡¥å…¬æ°‘å®éªŒå®¤æŠ¥å‘Šçš„ä¸è¾…åŠ©åŠŸèƒ½22D72æ¡†æ¶ç›¸å…³çš„æ¼æ´ã€‚è®©æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å§ï¼  
  
æ¼æ´å…¬å‘Šå¯åœ¨æ­¤å¤„æ‰¾åˆ°ã€‚ä»¥ä¸‹æ˜¯ç›´æ¥æ‘˜è‡ª Apple ç½‘ç«™çš„æ¦‚è¿°ï¼š  
  
æ— éšœç¢è®¾æ–½  
é€‚ç”¨äºï¼š iPhone XS åŠæ›´æ–°æœºå‹ã€iPad Pro 13 è‹±å¯¸ã€iPad Pro 12.9 è‹±å¯¸ç¬¬ 3 ä»£åŠæ›´æ–°æœºå‹ã€iPad Pro 11 è‹±å¯¸ç¬¬ 1 ä»£åŠæ›´æ–°æœºå‹ã€iPad Air ç¬¬ 3 ä»£åŠæ›´æ–°æœºå‹ã€iPad ç¬¬ 7 ä»£åŠæ›´æ–°æœºå‹ã€iPad mini ç¬¬ 5 ä»£åŠæ›´æ–°æœºå‹  
  
å½±å“ï¼š ç‰©ç†æ”»å‡»å¯èƒ½ä¼šç¦ç”¨é”å®šè®¾å¤‡ä¸Šçš„ USB é™åˆ¶æ¨¡å¼ã€‚Apple è·æ‚‰ä¸€ä»½æŠ¥å‘Šç§°ï¼Œè¯¥é—®é¢˜å¯èƒ½å·²è¢«åˆ©ç”¨äºé’ˆå¯¹ç‰¹å®šä¸ªäººçš„æå…¶å¤æ‚çš„æ”»å‡»ä¸­ã€‚  
  
æè¿°ï¼šå·²é€šè¿‡æ”¹è¿›çŠ¶æ€ç®¡ç†è§£å†³æˆæƒé—®é¢˜ã€‚  
  
CVE-2025-24200ï¼šå¤šä¼¦å¤šå¤§å­¦è’™å…‹å­¦é™¢å…¬æ°‘å®éªŒå®¤çš„ Bill Marczak  
  
åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†è¿„ä»Šä¸ºæ­¢æˆ‘ä»¬å¯¹è¯¥è¡¥ä¸çš„ç†è§£ã€‚  
  
ğŸš§ USB é™åˆ¶æ¨¡å¼  
  
åœ¨åˆ†ææ›´æ–°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç®€å•æä¸€ä¸‹ USB é™åˆ¶æ¨¡å¼ä»¥åŠå®ƒçš„é‡è¦æ€§ã€‚  
  
å¦‚æœ iPhone åœ¨æ¿€æ´»è¯¥åŠŸèƒ½æ—¶ä¿æŒé”å®šçŠ¶æ€è¶…è¿‡ä¸€å°æ—¶ï¼Œåˆ™é€šè¿‡å…¶ç«¯å£çš„æ•°æ®è¿æ¥å°†è¢«ç¦ç”¨ï¼Œç›´åˆ°ç”¨æˆ·è§£é”è®¾å¤‡å¹¶æ˜ç¡®æˆäºˆé…ä»¶è¿æ¥çš„æƒé™ï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/rWGOWg48tadUaJuxqw6XicXfPFDYYAHLibpACxfmTjuxSEsEOMibd9Yfh7Twzvfx9ZktDibrD5o721xyMiaOFRqXj0w/640?wx_fmt=jpeg&from=appmsg "")  
  
è¿™å¯¹äºå‡è½»æ¶‰åŠå¤–éƒ¨è®¾å¤‡ï¼ˆå¦‚æ³•åŒ»æå–å™¨ï¼‰çš„å¤æ‚æ”»å‡»è‡³å…³é‡è¦ï¼Œä¾‹å¦‚è¿™ä¸ªæˆ–è¿™ä¸ªã€‚  
  
èƒ½å¤Ÿä»é”å®šå±å¹•ç»•è¿‡æ­¤æœºåˆ¶å°†æ¢å¤ä½¿ç”¨æ­¤ç±»è®¾å¤‡çš„å¯èƒ½æ€§ã€‚è¿™æ¡æœ€æ–°æ¨æ–‡æ˜¾ç¤ºäº†æ­¤åŠŸèƒ½å¯¹äºå¨èƒè¡Œä¸ºè€…çš„é‡è¦æ€§ï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tadUaJuxqw6XicXfPFDYYAHLibUHic71TGMibfic84raibqU0r3E5zm8N1GH96d0VJazL1aOKkJBN3ZXJcrw/640?wx_fmt=png&from=appmsg "")  
  
åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ CVE-2025-24200 è¿›è¡Œåˆæ­¥åˆ†æï¼Œè¯¥æ¼æ´å¯ä»¥åœ¨æŸäº›æ¡ä»¶ä¸‹ç»•è¿‡ USB é™åˆ¶æ¨¡å¼ã€‚  
  
ğŸ“¦è®¾ç½®  
åœ¨æ‰¾åˆ°å®é™…è¡¥ä¸ä¹‹å‰ï¼Œç¬¬ä¸€æ­¥æ˜¯ä¸‹è½½è¡¥ä¸å‰åçš„ iOS ç‰ˆæœ¬ï¼š  
  
```
#Â pre-patchipsw download ipsw --device iPhone14,4 --build 22D63#Â post-patchipsw download ipsw --device iPhone14,4 --build 22D72
```  
  
  
ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªç‰ˆæœ¬ä¸­æå–æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å’Œåº“æ¥è°ƒæŸ¥æ›´æ”¹ã€‚  
  
ğŸ”¬ æŸ¥æ‰¾è¡¥ä¸  
æˆ‘ä»¬é¦–å…ˆæŸ¥çœ‹äº†Blacktopé’ˆå¯¹æ¯ä¸ª iOS ç‰ˆæœ¬ç”Ÿæˆå¹¶å‘å¸ƒçš„å·®å¼‚æŠ¥å‘Šã€‚ipsw diff  
  
ä»è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ¯ä¸ªå€¼å¾—æ³¨æ„çš„å˜åŒ–ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨å…¬å‘Šä¸­ï¼ŒApple æåˆ°äº†æ”¹è¿›çš„çŠ¶æ€ç®¡ç†ï¼Œè¿™å¯èƒ½éœ€è¦é¢å¤–çš„æ£€æŸ¥ï¼Œä»è€Œå¼•å…¥æ–°çš„åŸºæœ¬å—ã€‚  
  
ä½¿ç”¨ä»¥ä¸‹ï¼ˆæ— å¤´ï¼‰äºŒè¿›åˆ¶å¿è€…è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºåŒä¸€äºŒè¿›åˆ¶æ–‡ä»¶çš„ä¸¤ä¸ªç¬¦å·åŒ–ç‰ˆæœ¬çš„åŸºæœ¬å—è®¡æ•°å·®å¼‚ï¼š  
  
```
importÂ binaryninjabinaryninja.disable_default_log()defbuild_table(bv: binaryninja.BinaryView):Â  Â Â """Builds a table of function names to their basic block count."""Â  Â  table = {}Â  Â Â forÂ fÂ inÂ bv.functions:Â  Â  Â  Â Â ifnotÂ f.name.startswith('sub_'):Â  Â  Â  Â  Â  Â  table[f.name] = [len(f.basic_blocks)]Â  Â Â returnÂ tabledefdiff_tables(original, patched):Â  Â Â """Compares two basic block tables and prints changes."""Â  Â Â forÂ fnÂ inÂ original.keys() & patched.keys():Â  Â  Â  Â Â ifÂ original[fn] != patched[fn]:Â  Â  Â  Â  Â  Â  print(f'{fn}:Â {original[fn]}Â ->Â {patched[fn]}')t1 = build_table("/path/to/original")t2 = build_table("/path/to/patched")diff_tables(t1, t2)
```  
  
  
åœ¨æ¥ä¸‹æ¥çš„å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å…¶ä¸­ä¸¤ä¸ªç»„ä»¶ä¸­å‘ç°çš„æ˜¾è‘—å˜åŒ–ã€‚  
  
æ›´æ”¹Â   
AXSpringBoardServerInstance  
åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œä¸‹é¢çš„å‡½æ•°ä¼¼ä¹æœ‰4ä¸ªæ–°çš„åŸºæœ¬å—ã€‚  
  
```
-[AXSpringBoardServerHelper _handleDisallowUSBRestrictedModeSCInformativeOnly:]
```  
  
  
ä»”ç»†æ£€æŸ¥åå‘ç°ï¼ŒApple ä¼¼ä¹åœ¨å‡½æ•°çš„æœ€å¼€å§‹å¤„æ·»åŠ äº†ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®ä¿è®¾å¤‡åœ¨æ˜¾ç¤ºè­¦æŠ¥ä¹‹å‰å·²è§£é”ã€‚æ­¤è­¦æŠ¥çš„æ ‡é¢˜ä¸º id çš„æœ¬åœ°åŒ–å­—ç¬¦ä¸²  
sc.disallow.usb.restricted.mode.alert.title  
ï¼Œä»¥åŠä¸€ä¸ªå¯ç‚¹å‡»çš„æ“ä½œï¼Œå³  
OK  
ã€‚  
  
é¡¾åæ€ä¹‰ï¼Œè¯¥å‡½æ•°ä»…æä¾›ä¿¡æ¯ï¼Œå³å®ƒä»…å½±å“ç”¨æˆ·ç•Œé¢ã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦æ‰¾åˆ°åœ¨å‡ºç°è­¦æŠ¥åæœ‰æ•ˆç¦ç”¨ USB é™åˆ¶æ¨¡å¼çš„ä½ç½®ã€‚  
  
æ›´æ”¹Â   
pr  
ofiled  
  
profiled æ˜¯ä¸€ä¸ªé‡è¦çš„ iOS å®ˆæŠ¤è¿›ç¨‹ï¼Œå¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œå…¶ä¸­åŒ…æ‹¬è¾…åŠ©åŠŸèƒ½ã€è¿œç¨‹è®¾å¤‡ç®¡ç† (MDM) ç­‰ç­‰â€¦â€¦  
åœ¨æ­¤ç‰ˆæœ¬ä¸­ï¼Œä¿®è¡¥äº†ä»¥ä¸‹åŠŸèƒ½å¹¶è·å¾—äº† 6 ä¸ªåŸºæœ¬å—ï¼š  
  
```
-[MCProfileServicer setParametersForSettingsByType:configurationUUID:toSystem:user:passcode:credentialSet:completion:]
```  
  
  
ä»¥ä¸‹æ˜¯æˆ‘ä»¬é€šè¿‡å¯¹ä¸¤ä¸ªç‰ˆæœ¬è¿›è¡Œé€†å‘å·¥ç¨‹æˆåŠŸæ¢å¤çš„è¡¥ä¸ï¼š  
  
```
diff --git a/original.m b/patched.mindex cd2b537..7fe1bd4 100644--- a/original.m+++ b/patched.m@@ -8,6 +8,13 @@ BOOL has_ent = [selfif (has_some_entitlement == NO) {Â  Â  // Unchanged} else {+Â NSDict *rb = [settingsByType objectForKeyedSubscript: @"RestrictedBool"];+Â BOOL is_device_locked [[MCDependencyManager sharedManager] isDeviceLocked];+Â BOOL restricted_mode_allowed = [+Â rb objectForKeyedSubscript: @"FeatureUSBRestrictedModeAllowed"+Â ]++Â if (restricted_mode_allowed == NO || is_device_locked == NO) {Â  Â  Â  Â  Â  Â  Â  Â [[[MCProfileServiceServer sharedServer]]Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â setParametersForSettingsByType: typeÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â sender: [self remoteProcessBundleID]Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â completion: completionÂ  Â  Â  Â  Â  Â  Â  Â ]++Â } else {+Â NSError *error = [+Â MCErrorWithDomain: _MCSettingsErrorDomain+Â code: 0x6d66+Â descriptionArray: _MCErrorArray+Â errorType: _MCErrorTypeFatal+Â ];++Â if (completion) {+Â completion.completionHandler(completion, error);+Â }+Â }Â }
```  
  
  
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è°ƒç”¨setParametersForSettingsByTypeæœ‰æ•ˆè®¾ç½®æ‰€éœ€è®¾ç½®ï¼ˆå³æˆ‘ä»¬ä¾‹å­ä¸­çš„å—é™æ¨¡å¼çŠ¶æ€ğŸ‘€ï¼‰çš„å†…éƒ¨æ–¹æ³•ä¹‹å‰ï¼Œè¯¥å‡½æ•°ä¼šæ£€æŸ¥è®¾å¤‡æ˜¯å¦å·²è§£é”ã€‚  
  
è¿™ä¼¼ä¹æ˜¯æœ‰æ•ˆç¼“è§£ CVE-2025-24200 çš„è¡¥ä¸ã€‚  
  
æ”»å‡»å‘é‡  
ç°åœ¨æˆ‘ä»¬å¯¹è¡¥ä¸æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¯ä»¥è®©æˆ‘ä»¬åˆ©ç”¨åº•å±‚æ¼æ´çš„ä»£ç è·¯å¾„ã€‚  
  
ç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°å¯ä»¥é€šè¿‡ä¹‹å‰ç¡®å®šçš„ä¸¤ä¸ªä¿®è¡¥å‡½æ•°ä¹‹ä¸€ç¦ç”¨ USB é™åˆ¶æ¨¡å¼çš„ä½ç½®ã€‚  
  
ç»è¿‡ä¸€ç•ªç ”ç©¶ï¼Œæˆ‘ä»¬å‘ç°assistivetouchdå®ˆæŠ¤è¿›ç¨‹åŒ…å«é€šè¿‡ä»¥ä¸‹å‡½æ•°ç¦ç”¨ USB é™åˆ¶æ¨¡å¼çš„ä»£ç ï¼š  
  
```
-[SCATScannerManager _setUSBRMPreferenceDisabled]
```  
  
  
æ­¤å‡½æ•°åŒ…å«å¯¹å¤šä¸ªç±»çš„å¼•ç”¨AX[...]ã€‚è¿™æš—ç¤ºå®ƒå¯èƒ½ä¸æˆ‘ä»¬è®¨è®ºçš„è¡¥ä¸çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆå‘å‡ºè­¦æŠ¥ï¼‰æœ‰å…³ã€‚è¿™ä¿ƒä½¿æˆ‘ä»¬æ›´åŠ å…³æ³¨è¿™ä¸ªå®ˆæŠ¤è¿›ç¨‹ã€‚  
  
assistivetouchdå®ˆæŠ¤è¿›ç¨‹  
Â   
assistivetouchdÂ   
æ‚¨å¯ä»¥åœ¨ iOS è®¾å¤‡ä¸Šçš„ä»¥ä¸‹ä½ç½®æ‰¾åˆ°è¯¥å®ˆæŠ¤è¿›ç¨‹ï¼š  
  
```
System/Library/CoreServices/AssistiveTouch.app/assistivetouchd
```  
  
  
æ¯å½“è®¾å¤‡ä¸Šå¯ç”¨æŸäº›è¾…åŠ©åŠŸèƒ½æ—¶ï¼Œå®ƒéƒ½ä¼šåœ¨åå°æŒç»­è¿è¡Œã€‚æœ€å¼•äººæ³¨ç›®çš„ä¾‹å­æ˜¯Assistive TouchåŠŸèƒ½ï¼Œå®ƒå…è®¸æ‚¨ä»å±å¹•ä¸Šå§‹ç»ˆæ˜¾ç¤ºçš„æ–°èœå•ä¸­æ‰§è¡ŒæŸäº›æ“ä½œï¼š  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tadUaJuxqw6XicXfPFDYYAHLibYMV1pyaQicu808UKql2Y1AvnLyYWFHIdXBXgWQkGiaibQlgldQ7js8ebg/640?wx_fmt=png&from=appmsg "")  
  
é€šè¿‡æŸ¥çœ‹äº¤å‰å¼•ç”¨æ¥assistivetouchdæŸ¥æ‰¾_setUSBRMPreferenceDisabledå¯ä»¥è°ƒç”¨çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä»¥ä¸‹å‡½æ•°ï¼š  
  
```
-[SCATScannerManager handleUSBMFiDeviceConnected]
```  
  
  
æ ¹æ®å…¶åç§°ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸåªéœ€è¿æ¥ MFiï¼ˆç» iPhone è®¤è¯ï¼‰è®¾å¤‡å°±è¶³ä»¥æ¿€æ´»å®ƒã€‚  
  
ä¸‹é¢æ˜¯æˆ‘ä»¬æˆåŠŸé€†å‘çš„è¯¥å‡½æ•°çš„ä»£ç ï¼ˆè™½ç„¶å¯èƒ½å­˜åœ¨ä¸å‡†ç¡®ä¹‹å¤„ï¼‰ï¼š  
  
```
@implementationSCATScannerManager- (void)handleUSBMFiDeviceConnected {Â  Â  AXSettings btm = [SCATBluetoothManager sharedInstance];Â  Â Â boolÂ did_read_rm_alert = [btm switchControlUserDidReadUSBRestrictedModeAlert];Â  Â Â boolÂ has_disabled_rm = [selfÂ userHasDisabledUSBRM];Â  Â Â boolÂ should_disallow_rm = [btm switchControlShouldDisallowUSBRestrictedMode];Â  Â Â ifÂ (!did_read_rm_alert && !has_disabled_rm && should_disallow_rm) {Â  Â  Â  Â  [btm setSwitchControlShouldDisallowUSBRestrictedMode:NO];Â  Â  Â  Â Â // Forwards a call to the AXSettings framework that is responsibleÂ  Â  Â  Â Â // for showing the alert discussed earlier in the patch sectionÂ  Â  Â  Â Â // The -[SCATScannerManager _setUSBRMPreferenceDisabled] function thatÂ  Â  Â  Â Â // disables USB restricted mode is passed as the callback handler forÂ  Â  Â  Â Â // this alert.Â  Â  }}@end
```  
  
  
æ‰§è¡Œä¸€äº›åŸºæœ¬æ£€æŸ¥ä»¥ç¡®å®šæ˜¯å¦åº”æ˜¾ç¤ºè­¦æŠ¥ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœå°šæœªæ˜¾ç¤ºè­¦æŠ¥å¹¶ä¸”å¯ç”¨äº† USB é™åˆ¶æ¨¡å¼ï¼Œåˆ™åº”è¯¥æ˜¾ç¤ºè­¦æŠ¥ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå”¯ä¸€çš„é€‰æ‹©æ˜¯å•å‡»OKï¼Œè¿™å°†è§¦å‘æä¾›çš„å›è°ƒã€‚  
  
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå›è°ƒå°±æ˜¯_setUSBRMPreferenceDisabledå‡½æ•°ã€‚  
  
æ‰‹åŠ¨è§¦å‘è¯¥åŠŸèƒ½ä»¥è¿›è¡Œæµ‹è¯•  
ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„å‡è®¾ï¼Œæˆ‘ä»¬æƒ³åœ¨å¯ä»¥ä½¿ç”¨FridahandleUSBMFiDeviceConnectedè°ƒè¯•çš„ iOS è®¾å¤‡ä¸Šä»»æ„è°ƒç”¨è¯¥æ–¹æ³•ã€‚  
  
ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡ModuleAPI è·å¾—è¯¥å‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šé‡‡ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œå¹¶assistivetouchä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»è®¾å¤‡ä¸­æå–äºŒè¿›åˆ¶æ–‡ä»¶ï¼š  
  
```
frida-pull -U /System/Library/CoreServices/AssistiveTouch.app/assistivetouchd
```  
  
  
ä»è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¡ç®—å¯è§¦å‘å‡½æ•°å’Œç›®æ ‡å‡½æ•°ä¹‹é—´çš„åç§»é‡ã€‚  
  
åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨é’©å­ï¼Œ-[HNDRocker _shakePressed]å› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è®¾å¤‡é”å®šæ—¶ä»è¾…åŠ©è§¦æ‘¸èœå•è§¦å‘å®ƒã€‚ä»¥ä¸‹æ˜¯onEnterå¤„ç†ç¨‹åºï¼š  
  
```
onEnter(log, args, state) {Â  Â Â //Â Following addresses need to be adaptedÂ forÂ each buildÂ  Â  shakePressedBaseAddr =Â 0x100042858;Â  Â  handleUSBMFiDeviceConnectedBaseAddr =Â 0x1000ad1c8;Â  Â Â offÂ = handleUSBMFiDeviceConnectedBaseAddr - shakePressedBaseAddrÂ  Â  shakePressedAddr =Â this.context.pc;Â  Â  log('ShakePressed::', shakePressedAddr)Â  Â  handleUSBMFiDeviceConnectedAddr = shakePressedAddr.add(off)Â  Â  log('handleUSBMFiDeviceConnected:', handleUSBMFiDeviceConnectedAddr)Â  Â  handle =Â newÂ NativeFunction(handleUSBMFiDeviceConnectedAddr,Â 'long', []);Â  Â  handle()},
```  
  
  
è¿½è¸ªæ–¹æ³•å¦‚ä¸‹ï¼š  
  
```
frida-trace -U assistivetouchd -mÂ '-[HNDRocker _shakePressed]'
```  
  
  
æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å•å‡»Shakeæ¥è§¦å‘è·Ÿè¸ªå‡½æ•°ï¼›æ„Ÿè°¢æˆ‘ä»¬çš„é’©å­è°ƒç”¨è¯¥handleUSBMFiDeviceConnectedå‡½æ•°å¹¶å¼¹å‡ºçª—å£ï¼š  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tadUaJuxqw6XicXfPFDYYAHLib2vT07wLdgsp5AdQEXGcG38jwFp3QpvA51bZr5LiaSSIiak4UvrJ7hcGQ/640?wx_fmt=png&from=appmsg "")  
  
å¦‚å‰æ‰€è¿°ï¼Œæ­¤æ—¶æ”»å‡»è€…åªéœ€å•å‡»OKé”å®šå±å¹•å³å¯ç¦ç”¨ USB é™åˆ¶æ¨¡å¼ã€‚  
- æœ¬èŠ‚æè¿°çš„æµ‹è¯•æ˜¯iPhone10,3ä½¿ç”¨è¿è¡Œ iOS 16.7.10 (build 20H350) çš„ iPhone X ( ) è¿›è¡Œçš„ã€‚  
  
å¦‚ä½•åœ¨å®é™…æƒ…å†µä¸‹è§¦å‘æ­¤åŠŸèƒ½  
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡ä»»æ„è°ƒç”¨è¯¥æ–¹æ³•æ¥ä½¿è­¦æŠ¥å‡ºç°-[SCATScannerManager handleUSBMFiDeviceConnected]ï¼Œä½†æˆ‘ä»¬è¿˜ä¸çŸ¥é“åœ¨å®é™…æ¡ä»¶ä¸‹åº”è¯¥å¦‚ä½•è°ƒç”¨å®ƒã€‚  
  
æˆ‘ä»¬æ²¡æœ‰æåˆ°çš„ä¸€ç‚¹æ˜¯ï¼ŒAssistive TouchåŠŸèƒ½å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªè®©assistivetouchdå®ˆæŠ¤è¿›ç¨‹åœ¨åå°è¿è¡Œçš„åŠŸèƒ½ã€‚å¦ä¸€ä¸ªå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹çš„è¾…åŠ©åŠŸèƒ½æ˜¯Switch Controlã€‚  
  
æ­¤åŠŸèƒ½å…è®¸å°†å¤–éƒ¨è®¾å¤‡æ’å…¥ iPhone ä»¥è¿›è¡Œæ§åˆ¶ã€‚ä»æˆ‘ä»¬è¿„ä»Šä¸ºæ­¢æŸ¥çœ‹çš„å„ç§æ–¹æ³•çš„ç±»åæ¥çœ‹ï¼Œå®ƒä»¬éƒ½ä»¥SCï¼ˆå¯èƒ½æ˜¯ Switch Controlï¼‰ å¼€å¤´ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­è¿™æ˜¯åˆæ³•çš„æ–¹æ³•ï¼šå°†ç»è¿‡ MFi è®¤è¯çš„å¼€å…³æ§åˆ¶è®¾å¤‡æ’å…¥ iPhoneã€‚  
  
çœ‹äº†å¸‚é¢ä¸Šçš„å¼€å…³æ§åˆ¶è®¾å¤‡ï¼Œä¼¼ä¹å¤§éƒ¨åˆ†éƒ½æ˜¯è“ç‰™è®¾å¤‡ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªæ›¾ç»é€šè¿‡é›·ç”µæ“ä½œçš„è®¾å¤‡ã€‚  
  
ä»¥ä¸‹æ˜¯è¯¥äº§å“ä¾›åº”å•†ç½‘ç«™çš„æˆªå›¾ã€‚è¯·æ³¨æ„ï¼Œè¯¥äº§å“ä¸å†å¯ç”¨ï¼š  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/rWGOWg48tadUaJuxqw6XicXfPFDYYAHLibeaib8fIxfWyujugLNP54AibgT4GdGaW7ecnAaB7ChgTof05q5SXPqkDg/640?wx_fmt=png&from=appmsg "")  
  
å½“è®¾å¤‡å¤„äºå—é™æ¨¡å¼æ—¶ï¼ŒUSB åè®®å°†è¢«å®Œå…¨ç¦ç”¨ã€‚ä½†æ˜¯ï¼Œå…¶ä»–åè®®å¯ä»¥é€šè¿‡é—ªç”µç«¯å£è‡ªç”±ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œ MFi è®¾å¤‡å¯ä»¥ä½¿ç”¨çš„iAP2åè®®å°±æ˜¯è¿™ç§æƒ…å†µã€‚  
  
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è®¤ä¸ºå°†è¿™ç§è®¾å¤‡æ’å…¥å¯ç”¨äº†åˆ‡æ¢æ§åˆ¶çš„ iPhone å¯èƒ½è¶³ä»¥ä½¿å¼¹å‡ºçª—å£å‡ºç°å¹¶åœ¨ iOS 18.3.1 ä¹‹å‰ä»é”å®šå±å¹•ç¦ç”¨ USB é™åˆ¶æ¨¡å¼ã€‚  
  
å…è´£å£°æ˜ï¼š  
è™½ç„¶æˆ‘ä»¬ç›¸ä¿¡è¿™ç§æ–¹æ³•å¯è¡Œï¼Œä½†ç›®å‰æˆ‘ä»¬ç¼ºä¹æµ‹è¯•æ‰€éœ€çš„ç¡¬ä»¶ã€‚æˆ‘ä»¬è¿˜çŸ¥é“ï¼Œå¯¹äºç‰©ç†é…ä»¶è€Œè¨€ï¼Œé™åˆ¶æ¨¡å¼å¹¶ä¸æ˜¯å”¯ä¸€çš„ç¼“è§£æªæ–½ï¼Œå®é™…åˆ©ç”¨æ–¹æ³•å¯èƒ½æ›´ä¸ºå¤æ‚ã€‚  
  
æ­¤å¤–ï¼Œæˆ‘ä»¬ä»…æ¢ç´¢äº†æ­¤æ¼æ´çš„ä¸€ä¸ªå¯èƒ½æ”»å‡»åª’ä»‹ï¼Œä½†å¯èƒ½è¿˜å­˜åœ¨å…¶ä»–æ”»å‡»åª’ä»‹ã€‚å³ä½¿æ‚¨ä¸ä½¿ç”¨è¾…åŠ©åŠŸèƒ½ï¼Œä¹Ÿå»ºè®®æ‚¨å°†è®¾å¤‡æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚  
  
å‚è€ƒ  
  
å®‰å…¨åœ°æ¿€æ´»æ•°æ®è¿æ¥ - Apple æ”¯æŒï¼ˆè‹±å›½ï¼‰  
- https://support.apple.com/en-gb/guide/security/sec5044aad1b/1/web/1  
  
å…³äº iOS 18.3.1 å’Œ iPadOS 18.3.1 çš„å®‰å…¨æ€§å†…å®¹ - Apple æ”¯æŒ (æˆ‘å›½)  
- https://support.apple.com/en-ca/122174  
  
å…³äº Blue2 å’Œ Hook+ å¼€å…³æ¥å£çš„é‡è¦ä¿¡æ¯ï¼ˆ2024 å¹´ 4 æœˆ 8 æ—¥æ›´æ–°ï¼‰| OMazing Kids AAC Consulting  
- https://omazingkidsllc.com/2022/06/30/important-info-about-the-blue2-and-hook-switch-interfaces/  
  
stacksmashing - Hithackers çš„ Apple Lightning å’Œ JTAG é»‘å®¢æŒ‡å— - V02  
- https://media.defcon.org/DEF%20CON%2030/DEF%20CON%2030%20presentations/stacksmashing%20-%20The%20hitchhackers%20guide%20to%20iPhone%20Lightning%20%20%20JTAG%20hacking.pdf  
  
  
  
æ„Ÿè°¢æ‚¨æŠ½å‡º  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycd5KMTutPwNWA97H5MPISWXLTXp0ibK5LXCBAXX388gY0ibXhWOxoEKBA/640?wx_fmt=gif "")  
  
.  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif "")  
  
æ¥é˜…è¯»æœ¬æ–‡  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWge7Mibiad1tV0iaF8zSD5gzicbxDmfZCEL7vuOevN97CwUoUM5MLeKWibWlibSMwbpJ28lVg1yj1rQflyQ/640?wx_fmt=gif "")  
  
**ç‚¹å®ƒï¼Œåˆ†äº«ç‚¹èµåœ¨çœ‹éƒ½åœ¨è¿™é‡Œ**  
  
  
